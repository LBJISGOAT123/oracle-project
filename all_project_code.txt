
// === FILE: /src/App.tsx ===

// ==========================================
// FILE PATH: /src/App.tsx
// ==========================================

import React, { useState } from 'react';
import { useGameEngine } from './hooks/useGameEngine';

// ì»´í¬ë„ŒíŠ¸ë“¤
import { Header } from './components/layout/Header';
import { GameStats } from './components/dashboard/GameStats';
import { SystemMenu } from './components/common/SystemMenu';

import { HeroStatsView } from './components/hero/HeroStatsView';
import { HeroManagement } from './components/hero/HeroManagement';
import { PatchModal } from './components/hero/PatchModal';
import { UserDashboard } from './components/user/UserDashboard';
import { UserDetailModal } from './components/user/UserDetailModal';
import { BattleDashboard } from './components/battle/BattleDashboard';
import { BattlefieldTab } from './components/battle/BattlefieldTab';
import { CommunityBoard } from './components/community/CommunityBoard';
import { PostDetailModal } from './components/community/PostDetailModal';
import { LiveGameListModal } from './components/battle/LiveGameListModal';
import { SpectateModal } from './components/battle/SpectateModal';
// [ì‹ ê·œ] ìƒì  íƒ­ ì»´í¬ë„ŒíŠ¸
import { ShopTab } from './components/shop/ShopTab';

import { Swords, User, MessageSquare, Settings, Map, Crown, ShoppingBag } from 'lucide-react';
import { Hero, UserProfile, LiveMatch } from './types';

const TABS = [
  { id: 'hero-stats', label: 'ì˜ì›… í†µê³„', icon: Swords },
  { id: 'hero-manage', label: 'ì˜ì›… ê´€ë¦¬', icon: Settings },
  { id: 'shop', label: 'ì•„ì´í…œ ìƒì ', icon: ShoppingBag }, // [ì‹ ê·œ]
  { id: 'user', label: 'ìœ ì € í˜„í™©', icon: User },
  { id: 'gods', label: 'ì‹ (Gods)', icon: Crown },
  { id: 'battlefield', label: 'ì „ì¥', icon: Map },
  { id: 'community', label: 'ì»¤ë®¤ë‹ˆí‹°', icon: MessageSquare },
];

function App() {
  const { isMobile, store } = useGameEngine();
  const { gameState, selectedPost, closePost } = store;

  if (!gameState) return <div style={{ color: '#fff', padding: '20px' }}>ì´ˆê¸°í™” ì¤‘...</div>;

  const [selectedHero, setSelectedHero] = useState<Hero | null>(null);
  const [selectedUser, setSelectedUser] = useState<UserProfile | null>(null);
  const [showSystemMenu, setShowSystemMenu] = useState(false);
  const [showGameList, setShowGameList] = useState(false);
  const [spectatingMatch, setSpectatingMatch] = useState<LiveMatch | null>(null);
  const [activeTab, setActiveTab] = useState('hero-stats');

  return (
    <div style={{ maxWidth: '1400px', margin: '0 auto', padding: isMobile ? '10px' : '20px', paddingBottom: '100px' }}>

      <Header isMobile={isMobile} onOpenSystemMenu={() => setShowSystemMenu(true)} />

      <GameStats isMobile={isMobile} onOpenGameList={() => setShowGameList(true)} />

      {!isMobile && (
        <div style={{ display: 'flex', gap: '10px', marginBottom: '20px', flexWrap:'wrap' }}>
          {TABS.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)} style={{ padding: '12px 24px', borderRadius: '8px', border: 'none', cursor: 'pointer', background: activeTab === tab.id ? '#58a6ff' : '#161b22', color: activeTab === tab.id ? '#000' : '#8b949e', fontWeight: 'bold', display: 'flex', gap: '8px', alignItems: 'center' }}>
              <tab.icon size={16} /> {tab.label}
            </button>
          ))}
        </div>
      )}

      <div style={{ minHeight: '600px' }}>
        {activeTab === 'hero-stats' && <HeroStatsView />}
        {activeTab === 'hero-manage' && <HeroManagement onEditHero={setSelectedHero} />}
        {activeTab === 'shop' && <ShopTab />} {/* [ì‹ ê·œ] ìƒì  íƒ­ ì—°ê²° */}
        {activeTab === 'user' && <UserDashboard onUserClick={setSelectedUser} />}
        {activeTab === 'gods' && <BattleDashboard />}
        {activeTab === 'battlefield' && <BattlefieldTab />}
        {activeTab === 'community' && <CommunityBoard />}
      </div>

      {isMobile && (
        <nav style={{ position: 'fixed', bottom: 0, left: 0, width: '100%', background: '#161b22', borderTop: '1px solid #333', display: 'flex', justifyContent: 'space-around', padding: '10px 0', zIndex: 9000, paddingBottom: '20px', overflowX:'auto' }}>
          {TABS.map(tab => (
            <button key={tab.id} onClick={() => setActiveTab(tab.id)} style={{ background: 'none', border: 'none', color: activeTab === tab.id ? '#58a6ff' : '#8b949e', display: 'flex', flexDirection: 'column', alignItems: 'center', fontSize: '11px', gap: '4px', minWidth:'60px' }}>
              <tab.icon size={20} />
              {tab.label.split(' ')[0]}
            </button>
          ))}
        </nav>
      )}

      {showSystemMenu && <SystemMenu onClose={() => setShowSystemMenu(false)} />}
      {selectedHero && <PatchModal hero={selectedHero} onClose={() => setSelectedHero(null)} />}
      {selectedUser && <UserDetailModal user={selectedUser} onClose={() => setSelectedUser(null)} />}
      {showGameList && <LiveGameListModal onClose={() => setShowGameList(false)} onSpectate={(m) => { setShowGameList(false); setSpectatingMatch(m); }} />}
      {spectatingMatch && <SpectateModal match={spectatingMatch} onClose={() => setSpectatingMatch(null)} />}
      {selectedPost && <PostDetailModal post={selectedPost} onClose={closePost} onUserClick={(user) => setSelectedUser(user)} />}
    </div>
  );
}

export default App;

// === FILE: /src/components/battle/BattleDashboard.tsx ===

// ==========================================
// FILE PATH: /src/components/battle/BattleDashboard.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Sword, Shield, Settings, Users, Zap, Heart, Crosshair, Crown, Activity, Monitor, Coins, Camera, Upload } from 'lucide-react';
import { GameIcon } from '../common/GameIcon';

export const BattleDashboard: React.FC = () => {
  const { gameState, updateBattleSettings } = useGameStore();
  const { battleSettings, godStats } = gameState;

  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  if (!battleSettings) return <div className="panel">ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...</div>;

  const handleGodChange = (god: 'izman' | 'dante', field: string, value: any) => {
    updateBattleSettings({ [god]: { ...battleSettings[god], [field]: value } });
  };

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '25px', paddingBottom: '80px' }}>
      <div style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: isMobile ? '0 5px' : '0' }}>
        <div style={{ background: '#58a6ff22', padding: '10px', borderRadius: '12px', border: '1px solid #58a6ff44' }}>
          <Settings size={24} color="#58a6ff" />
        </div>
        <div>
          <h2 style={{ margin: 0, fontSize: isMobile ? '18px' : '22px', fontWeight: '800', letterSpacing: '-0.5px', color:'#fff' }}>ì „ì¥ ì˜¤ë²„ë¼ì´ë“œ</h2>
          <p style={{ margin: 0, fontSize: isMobile ? '11px' : '13px', color: '#8b949e' }}>
            ì§„ì˜ë³„ ë°¸ëŸ°ìŠ¤ ë° í•˜ìˆ˜ì¸ ìŠ¤í™ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì œì–´í•©ë‹ˆë‹¤.
          </p>
        </div>
      </div>

      <GlobalBattleStats stats={godStats} isMobile={isMobile} />

      <div style={{ display: 'grid', gridTemplateColumns: isMobile ? '1fr' : '1fr 1fr', gap: '25px' }}>
        <GodPanel 
          side="RED" settings={battleSettings.izman} stats={godStats}
          color="#ff4d4d" glowColor="rgba(255, 77, 77, 0.1)"
          onChange={(field: string, val: any) => handleGodChange('izman', field, val)}
          icon={<Sword size={20} />} isMobile={isMobile}
        />
        <GodPanel 
          side="BLUE" settings={battleSettings.dante} stats={godStats}
          color="#4d94ff" glowColor="rgba(77, 148, 255, 0.1)"
          onChange={(field: string, val: any) => handleGodChange('dante', field, val)}
          icon={<Shield size={20} />} isMobile={isMobile}
        />
      </div>
    </div>
  );
};

// --- Sub Components ---

const MinionCard = ({ type, data, onChange, color }: any) => {
  let typeIcon = <Sword size={14} />;
  let typeLabel = "ê·¼ê±°ë¦¬";
  if (type === 'ranged') { typeIcon = <Crosshair size={14}/>; typeLabel = "ì›ê±°ë¦¬"; }
  if (type === 'siege') { typeIcon = <Shield size={14}/>; typeLabel = "ê³µì„±"; }

  return (
    <div style={{ background: 'rgba(0,0,0,0.3)', border: `1px solid ${color}33`, borderRadius: '8px', padding: '10px', marginBottom: '10px' }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px', borderBottom:`1px dashed ${color}33`, paddingBottom:'5px' }}>
        <div style={{ fontWeight: 'bold', color: color, fontSize: '13px', display:'flex', alignItems:'center', gap:'6px' }}>{typeIcon} {data.label}</div>
        <span style={{ fontSize: '10px', color: '#666', background:'rgba(255,255,255,0.05)', padding:'2px 6px', borderRadius:'4px' }}>{typeLabel} TYPE</span>
      </div>
      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '8px', marginBottom:'8px' }}>
        <MiniInput label="ì²´ë ¥" icon={<Heart size={10} color="#2ecc71"/>} value={data.hp} onChange={(v:number) => onChange(type, 'hp', v)} />
        <MiniInput label="ë°©ì–´" icon={<Shield size={10} color="#3498db"/>} value={data.def} onChange={(v:number) => onChange(type, 'def', v)} />
        <MiniInput label="ê³µê²©" icon={<Sword size={10} color="#e74c3c"/>} value={data.atk} onChange={(v:number) => onChange(type, 'atk', v)} />
      </div>
      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>
        <MiniInput label="ê³¨ë“œ" icon={<Coins size={10} color="#f1c40f"/>} value={data.gold} onChange={(v:number) => onChange(type, 'gold', v)} />
        <MiniInput label="ê²½í—˜ì¹˜" icon={<Zap size={10} color="#9b59b6"/>} value={data.xp} onChange={(v:number) => onChange(type, 'xp', v)} />
      </div>
    </div>
  );
};

const MiniInput = ({ label, icon, value, onChange }: any) => (
  <div style={{ background: '#0d1117', border: '1px solid #30363d', borderRadius: '4px', padding: '4px 8px', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
    <div style={{ display: 'flex', alignItems: 'center', gap: '4px', fontSize: '10px', color: '#888' }}>{icon} {label}</div>
    <input type="number" value={value} onChange={(e) => onChange(Number(e.target.value))} style={{ width: '40px', background: 'transparent', border: 'none', color: '#fff', fontSize: '11px', fontWeight: 'bold', textAlign: 'right', outline: 'none', padding: 0 }} />
  </div>
);

// [ìˆ˜ì •ëœ GodPanel: ì™•ê´€ í´ë¦­ ì‹œ ì—…ë¡œë“œ]
const GodPanel = ({ side, settings, color, glowColor, onChange, icon }: any) => {
  const isRed = side === 'RED';
  const { setCustomImage } = useGameStore();
  const godId = isRed ? 'god_izman' : 'god_dante';

  // ì™•ê´€ í˜¸ë²„ ìƒíƒœ ê´€ë¦¬
  const [isCrownHover, setIsCrownHover] = useState(false);

  const handleUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if(file) {
        const reader = new FileReader();
        reader.onloadend = () => { if(typeof reader.result === 'string') setCustomImage(godId, reader.result); };
        reader.readAsDataURL(file);
    }
  };

  return (
    <div style={{ background: 'linear-gradient(145deg, #121418 0%, #0d1117 100%)', borderRadius: '24px', border: `1px solid ${isRed ? '#4a1e1e' : '#1e3a5f'}`, boxShadow: `0 20px 40px rgba(0,0,0,0.3), inset 0 0 60px ${glowColor}`, overflow: 'hidden' }}>

      {/* í—¤ë” */}
      <div style={{ padding: '25px', borderBottom: `1px solid ${color}22`, display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: `linear-gradient(90deg, ${color}11, transparent)` }}>

        {/* [ì™¼ìª½] í”„ë¡œí•„ ì •ë³´ (í´ë¦­ ë¶ˆê°€, í‘œì‹œìš©) */}
        <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>

          <div style={{ position: 'relative' }}>
            {/* ìˆœìˆ˜ ì´ë¯¸ì§€ í‘œì‹œìš© GameIcon */}
            <GameIcon 
              id={godId} 
              size={64} 
              fallback={icon} 
              border={`2px solid ${color}44`} 
              shape="rounded"
            />
          </div>

          <div>
            <div style={{ display:'flex', alignItems:'center', gap:'8px', marginBottom:'4px' }}>
              <span style={{ fontSize: '10px', fontWeight: '900', color: '#fff', background: color, padding:'2px 8px', borderRadius:'10px' }}>
                {side} FACTION
              </span>
            </div>
            <h3 style={{ margin: 0, fontSize: '24px', fontWeight: '900', color: '#fff', letterSpacing:'-0.5px' }}>{settings.name}</h3>
          </div>
        </div>

        {/* [ì˜¤ë¥¸ìª½] ì™•ê´€ ì•„ì´ì½˜ (ì—…ë¡œë“œ ë²„íŠ¼) */}
        <div 
          onMouseEnter={() => setIsCrownHover(true)}
          onMouseLeave={() => setIsCrownHover(false)}
          style={{ position: 'relative' }}
        >
          <label style={{ cursor: 'pointer', display:'flex', alignItems:'center', justifyContent:'center' }}>

            {/* í˜¸ë²„ ì‹œ 'ì‚¬ì§„ ë³€ê²½' í…ìŠ¤íŠ¸ í‘œì‹œ */}
            {isCrownHover && (
              <span style={{ 
                position: 'absolute', right: '45px', 
                fontSize: '11px', color: color, fontWeight: 'bold', 
                whiteSpace: 'nowrap', background: '#161b22', padding: '4px 8px', borderRadius: '4px', border: `1px solid ${color}44`
              }}>
                ì‚¬ì§„ ë³€ê²½
              </span>
            )}

            {/* ì™•ê´€ ì•„ì´ì½˜ */}
            <Crown 
              size={32} 
              color={color} 
              style={{ 
                opacity: isCrownHover ? 1 : 0.3, // í˜¸ë²„ì‹œ ë°ì•„ì§
                transform: isCrownHover ? 'scale(1.1) rotate(15deg)' : 'rotate(15deg)', // í˜¸ë²„ì‹œ ì»¤ì§
                transition: 'all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)'
              }} 
            />

            {/* ì™•ê´€ ì˜†ì— ì‘ì€ ì¹´ë©”ë¼ ë±ƒì§€ */}
            <div style={{ 
              position: 'absolute', bottom: -2, right: -2, 
              background: '#161b22', borderRadius: '50%', padding: '3px',
              border: `1px solid ${color}44`,
              opacity: isCrownHover ? 1 : 0.5
            }}>
              <Camera size={10} color={color}/>
            </div>

            {/* ìˆ¨ê²¨ì§„ íŒŒì¼ ì¸í’‹ */}
            <input type="file" style={{display:'none'}} accept="image/*" onChange={handleUpload}/>
          </label>
        </div>

      </div>

      <div style={{ padding: '25px', display: 'flex', flexDirection: 'column', gap: '30px' }}>
        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
          <CustomSlider label="ì „íˆ¬ ê³µê²©ë ¥ ë³´ì •" icon={<Crosshair size={14}/>} value={settings.atkRatio} min={0.5} max={2.0} step={0.01} onChange={(v: number)=>onChange('atkRatio', v)} color={color} suffix="x" />
          <CustomSlider label="ë°©ì–´/ì²´ë ¥ íš¨ìœ¨" icon={<Shield size={14}/>} value={settings.defRatio} min={0.5} max={2.0} step={0.01} onChange={(v: number)=>onChange('defRatio', v)} color={color} suffix="x" />
          <CustomSlider label="ë„¥ì„œìŠ¤ ìµœëŒ€ ë‚´êµ¬ë„" icon={<Heart size={14}/>} value={settings.hpRatio} min={5000} max={50000} step={1000} onChange={(v: number)=>onChange('hpRatio', v)} color={color} />
        </div>
        <div style={{ height: '1px', background: '#30363d' }} />
        <div>
          <SectionLabel icon={<Monitor size={12}/>} label="STRUCTURAL INTEGRITY" color="#8b949e" />
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginTop:'10px' }}>
            <TechInput label="ìˆ˜í˜¸ì ìƒëª…ë ¥" value={settings.guardianHp} onChange={(v: number)=>onChange('guardianHp', v)} icon={<Crown size={14} color={color}/>} unit="HP" />
            <TechInput label="ë°©ì–´ íƒ€ì›Œ ìœ„ë ¥" value={settings.towerAtk} onChange={(v: number)=>onChange('towerAtk', v)} icon={<Crosshair size={14} color={color}/>} unit="DMG" />
          </div>
        </div>
        <div>
          <SectionLabel icon={<Users size={12}/>} label="MINION WAVES" color="#8b949e" />
          <div style={{ marginTop:'10px' }}>
            {settings.minions && (
              <>
                <MinionCard type="melee" data={settings.minions.melee} color={color} onChange={(t: string, f: string, v: number) => onChange('minions', { ...settings.minions, [t]: { ...settings.minions[t], [f]: v } })} />
                <MinionCard type="ranged" data={settings.minions.ranged} color={color} onChange={(t: string, f: string, v: number) => onChange('minions', { ...settings.minions, [t]: { ...settings.minions[t], [f]: v } })} />
                <MinionCard type="siege" data={settings.minions.siege} color={color} onChange={(t: string, f: string, v: number) => onChange('minions', { ...settings.minions, [t]: { ...settings.minions[t], [f]: v } })} />
              </>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

const GlobalBattleStats = ({ stats }: any) => {
  const total = stats.totalMatches || 1;
  const redWinRate = ((stats.izmanWins / total) * 100).toFixed(1);
  const blueWinRate = ((stats.danteWins / total) * 100).toFixed(1);
  return (
    <div style={{ background: '#161b22', padding: '20px', borderRadius: '16px', border: '1px solid #30363d', boxShadow: '0 10px 30px -10px rgba(0,0,0,0.5)' }}>
      <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'15px', fontSize:'12px', color:'#8b949e', fontWeight:'bold' }}>
        <div style={{ display:'flex', alignItems:'center', gap:'6px' }}><Activity size={14}/> ì‹œë®¬ë ˆì´ì…˜ ì§‘ê³„</div>
        <div>ì´ {total.toLocaleString()} ë§¤ì¹˜ ë¶„ì„ë¨</div>
      </div>
      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '8px' }}>
        <span style={{ color: '#ff4d4d', fontWeight: '900', fontSize: '18px' }}>{redWinRate}%</span>
        <span style={{ color: '#555', fontSize: '12px', fontWeight: 'bold' }}>WIN RATE</span>
        <span style={{ color: '#4d94ff', fontWeight: '900', fontSize: '18px' }}>{blueWinRate}%</span>
      </div>
      <div style={{ width: '100%', height: '12px', background: '#21262d', borderRadius: '6px', overflow: 'hidden', display: 'flex', marginBottom:'20px' }}>
        <div style={{ width: `${redWinRate}%`, background: 'linear-gradient(90deg, #8a1c1c, #ff4d4d)', height: '100%' }}></div>
        <div style={{ width: '2px', background: '#000' }}></div>
        <div style={{ flex: 1, background: 'linear-gradient(90deg, #4d94ff, #1c4b8a)', height: '100%' }}></div>
      </div>
      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1px 1fr', gap: '10px', alignItems: 'center' }}>
        <div style={{ display: 'flex', justifyContent: 'space-around' }}>
          <StatBox label="í‰ê·  KDA" value={stats.izmanAvgKills} color="#ff4d4d" align="center" />
          <StatBox label="ìŠ¹ë¦¬" value={stats.izmanWins} color="#ff4d4d" align="center" />
        </div>
        <div style={{ width: '1px', height: '30px', background: '#30363d' }}></div>
        <div style={{ display: 'flex', justifyContent: 'space-around' }}>
          <StatBox label="ìŠ¹ë¦¬" value={stats.danteWins} color="#4d94ff" align="center" />
          <StatBox label="í‰ê·  KDA" value={stats.danteAvgKills} color="#4d94ff" align="center" />
        </div>
      </div>
    </div>
  );
};

const StatBox = ({ label, value, color, align }: any) => (
  <div style={{ textAlign: align || 'left' }}>
    <div style={{ fontSize: '10px', color: '#8b949e', marginBottom: '2px' }}>{label}</div>
    <div style={{ fontSize: '16px', fontWeight: 'bold', color: color || '#fff', fontFamily: 'JetBrains Mono' }}>{value}</div>
  </div>
);

const SectionLabel = ({ icon, label, color }: any) => (
  <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '10px', fontWeight: '800', color: color, letterSpacing: '1px' }}>
    {icon} {label}
  </div>
);

const TechInput = ({ label, value, onChange, icon, unit }: any) => (
  <div style={{ background: '#0d1117', borderRadius: '12px', border: '1px solid #30363d', padding: '12px 15px', display: 'flex', flexDirection: 'column', gap: '6px', transition: 'all 0.2s' }}
  onMouseEnter={e => e.currentTarget.style.borderColor = '#58a6ff'} onMouseLeave={e => e.currentTarget.style.borderColor = '#30363d'}>
    <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '11px', color: '#8b949e', fontWeight:'600' }}>{icon} {label}</div>
    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
      <input type="number" value={value} onChange={(e)=>onChange(Number(e.target.value))} style={{ background: 'none', border: 'none', color: '#fff', fontSize: '18px', fontWeight: '800', outline: 'none', width: '100%', fontFamily: 'JetBrains Mono' }} />
      {unit && <span style={{ fontSize: '10px', color: '#555', fontWeight: 'bold' }}>{unit}</span>}
    </div>
  </div>
);

const CustomSlider = ({ label, icon, value, min, max, step, onChange, color, suffix }: any) => (
  <div>
    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
      <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#ccc', fontSize: '12px', fontWeight:'bold' }}>{icon} {label}</div>
      <span style={{ color: color, fontFamily: 'JetBrains Mono', fontWeight: '800', fontSize: '14px', background:`${color}11`, padding:'2px 6px', borderRadius:'4px' }}>
        {suffix === 'x' ? 'x' : ''}{value.toLocaleString()}{suffix !== 'x' ? suffix : ''}
      </span>
    </div>
    <div style={{ position: 'relative', display: 'flex', alignItems: 'center' }}>
      <input type="range" min={min} max={max} step={step} value={value} onChange={(e)=>onChange(parseFloat(e.target.value))} style={{ width: '100%', accentColor: color, height: '6px', cursor: 'pointer', background: '#1c1c1f', borderRadius: '3px', outline: 'none' }} />
    </div>
  </div>
);

// === FILE: /src/components/battle/BattlefieldTab.tsx ===

// ==========================================
// FILE PATH: /src/components/battle/BattlefieldTab.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Shield, Skull, Circle, Coins, Heart, Zap, Swords, Bot, Timer, Ghost, Layers, Gem, AlertTriangle, Sword } from 'lucide-react';
import { JUNGLE_CONFIG } from '../../data/jungle';

export const BattlefieldTab: React.FC = () => {
  const { gameState, updateFieldSettings } = useGameStore();
  const settings = gameState.fieldSettings;

  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  if (!settings) return <div>ì„¤ì • ë¡œë”© ì¤‘...</div>;

  const handleChange = (target: string, field: string, value: any) => {
    // @ts-ignore
    updateFieldSettings({ [target]: { ...settings[target], [field]: value } });
  };

  return (
    <div style={{ 
      display: 'grid', 
      gridTemplateColumns: isMobile ? '1fr' : 'repeat(auto-fit, minmax(300px, 1fr))', 
      gap: '20px', 
      paddingBottom: '80px' 
    }}>

      {/* 1. í˜¼ëˆì˜ ê· ì—´ (ê³µê²©ë ¥/ë°©ì–´ë ¥ ë¶„ë¦¬ ì ìš©) */}
      <ObjectConfigCard 
        title={JUNGLE_CONFIG.NAME}
        description={JUNGLE_CONFIG.DESCRIPTION}
        icon={<Ghost size={20} color="#d580ff"/>}
        color="#d580ff"
        isJungle={true}
      >
        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
          <InputSlider 
            label="ìƒíƒœê³„ ë°€ë„ (ë¦¬ì  ìœ¨)" 
            icon={<Layers size={14}/>} 
            value={settings.jungle?.density ?? 50} 
            min={0} max={100} step={1} 
            onChange={(v: number) => handleChange('jungle', 'density', v)} 
            color="#d580ff" 
            unit="%"
          />

          {/* [ì‹ ê·œ] í¬ë¦¬ì²˜ ê³µê²©ë ¥ */}
          <InputSlider 
            label="í¬ë¦¬ì²˜ ê³µê²©ë ¥ (ì•„í””)" 
            icon={<Sword size={14}/>} 
            value={settings.jungle?.attack ?? 30} 
            min={0} max={100} step={1} 
            onChange={(v: number) => handleChange('jungle', 'attack', v)} 
            color="#ff4d4d" 
            unit="Atk"
          />

          {/* [ì‹ ê·œ] í¬ë¦¬ì²˜ ë°©ì–´ë ¥ */}
          <InputSlider 
            label="í¬ë¦¬ì²˜ ë°©ì–´ë ¥ (ë‹¨ë‹¨í•¨)" 
            icon={<Shield size={14}/>} 
            value={settings.jungle?.defense ?? 20} 
            min={0} max={100} step={1} 
            onChange={(v: number) => handleChange('jungle', 'defense', v)} 
            color="#3498db" 
            unit="Def"
          />

          <InputSlider 
            label="ìì› í’ìš”ë„ (ë³´ìƒ)" 
            icon={<Gem size={14}/>} 
            value={settings.jungle?.yield ?? 50} 
            min={0} max={100} step={1} 
            onChange={(v: number) => handleChange('jungle', 'yield', v)} 
            color="#f1c40f" 
            unit="Gold"
          />
        </div>
        <div style={{ marginTop:'15px', padding:'10px', background:'#2a1a36', borderRadius:'6px', fontSize:'11px', color:'#d580ff', lineHeight:'1.4' }}>
          * ê³µê²©ë ¥ì´ ë†’ìœ¼ë©´ ì •ê¸€ëŸ¬ ì²´ë ¥ ê´€ë¦¬ê°€ í˜ë“¤ê³ , ë°©ì–´ë ¥ì´ ë†’ìœ¼ë©´ ì„±ì¥ ì†ë„ê°€ ëŠë ¤ì§‘ë‹ˆë‹¤.
        </div>
      </ObjectConfigCard>

      {/* 2. ê±°ì‹ ë³‘ ë“± ë‚˜ë¨¸ì§€ ì¹´ë“œë“¤ì€ ê¸°ì¡´ ìœ ì§€ */}
      <ObjectConfigCard 
        title="ê±°ì‹ ë³‘ (Colossus)" 
        description="ê³ ëŒ€ ë¬¸ëª…ì˜ ë³‘ê¸°ì…ë‹ˆë‹¤. íŒŒê´´í•œ ì§„ì˜ì€ ì´ ë³‘ê¸°ë¥¼ í•´í‚¹í•˜ì—¬ ì ì˜ í¬íƒ‘ì„ ì² ê±°í•˜ëŠ” ë° ì‚¬ìš©í•©ë‹ˆë‹¤."
        icon={<Skull size={20} color="#7ee787"/>}
        color="#7ee787"
        data={settings.colossus}
        onChange={(f: string, v: any) => handleChange('colossus', f, v)}
      >
        <InputSlider label="ìµœëŒ€ ì²´ë ¥ (HP)" icon={<Heart size={14}/>} value={settings.colossus.hp} min={1000} max={50000} step={100} onChange={(v:number) => handleChange('colossus', 'hp', v)} color="#7ee787" />
        <InputSlider label="ë°©ì–´ë ¥ (Armor)" icon={<Shield size={14}/>} value={settings.colossus.armor} min={0} max={500} step={1} onChange={(v:number) => handleChange('colossus', 'armor', v)} color="#7ee787" />
        <InputSlider label="ê¸°ë³¸ ë³´ìƒ (Gold)" icon={<Coins size={14}/>} value={settings.colossus.rewardGold} min={0} max={1000} step={10} onChange={(v:number) => handleChange('colossus', 'rewardGold', v)} color="#e89d40" />
        <div style={{ borderTop: '1px dashed #333', paddingTop: '15px', marginTop: '10px' }}>
          <div style={{ fontSize: '12px', color: '#7ee787', fontWeight: 'bold', marginBottom: '10px', display: 'flex', alignItems: 'center', gap: '6px' }}>
            <Bot size={14}/> ì†Œí™˜ìˆ˜ ëŠ¥ë ¥ì¹˜ ì„¤ì •
          </div>
          <InputSlider label="ê³µì„± ê³µê²©ë ¥" icon={<Swords size={12}/>} value={settings.colossus.attack} min={10} max={200} step={1} onChange={(v:number) => handleChange('colossus', 'attack', v)} color="#7ee787" />
        </div>
      </ObjectConfigCard>

      {/* 3. ê³µí—ˆì˜ ì£¼ì‹œì */}
      <ObjectConfigCard 
        title="ê³µí—ˆì˜ ì£¼ì‹œì" 
        description="ì°¨ì›ì˜ ëˆˆì„ ê°€ì§„ ì ˆëŒ€ìì…ë‹ˆë‹¤. ì²˜ì¹˜ ì‹œ ì•„êµ° ì „ì²´ì—ê²Œ ê°•ë ¥í•œ ë²„í”„ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤."
        icon={<Circle size={20} color="#a371f7"/>}
        color="#a371f7"
        data={settings.watcher}
        onChange={(f: string, v: any) => handleChange('watcher', f, v)}
      >
        <InputSlider label="ìµœëŒ€ ì²´ë ¥ (HP)" icon={<Heart size={14}/>} value={settings.watcher.hp} min={1000} max={50000} step={100} onChange={(v:number) => handleChange('watcher', 'hp', v)} color="#a371f7" />
        <InputSlider label="ë°©ì–´ë ¥ (Armor)" icon={<Shield size={14}/>} value={settings.watcher.armor} min={0} max={500} step={1} onChange={(v:number) => handleChange('watcher', 'armor', v)} color="#a371f7" />
        <InputSlider label="ê¸°ë³¸ ë³´ìƒ (Gold)" icon={<Coins size={14}/>} value={settings.watcher.rewardGold} min={0} max={1000} step={10} onChange={(v:number) => handleChange('watcher', 'rewardGold', v)} color="#e89d40" />
        <div style={{ borderTop: '1px dashed #333', paddingTop: '15px', marginTop: '10px' }}>
          <div style={{ fontSize: '12px', color: '#a371f7', fontWeight: 'bold', marginBottom: '10px', display: 'flex', alignItems: 'center', gap: '6px' }}>
            <Zap size={14}/> ì²˜ì¹˜ ë²„í”„ ì„¤ì •
          </div>
          <div style={{ marginBottom: '15px' }}>
            <label style={{ display:'block', fontSize:'11px', color:'#8b949e', marginBottom:'5px' }}>ë²„í”„ íš¨ê³¼</label>
            <select 
              value={settings.watcher.buffType} 
              onChange={(e) => handleChange('watcher', 'buffType', e.target.value)}
              style={{ width:'100%', background:'#0d1117', border:'1px solid #30363d', color:'#fff', padding:'8px', borderRadius:'4px' }}
            >
              <option value="COMBAT">âš”ï¸ ì „íˆ¬ë ¥ ê°•í™” (ìŠ¹ë¥  ìƒìŠ¹)</option>
              <option value="GOLD">ğŸ’° í™©ê¸ˆì˜ ì† (ê³¨ë“œ íšë“ëŸ‰ ì¦ê°€)</option>
            </select>
          </div>
          <InputSlider label="íš¨ê³¼ ìˆ˜ì¹˜ (%)" icon={<Zap size={12}/>} value={settings.watcher.buffAmount} min={5} max={100} step={1} onChange={(v:number) => handleChange('watcher', 'buffAmount', v)} color="#a371f7" />
          <div style={{ height:'10px' }}></div>
          <InputSlider label="ì§€ì† ì‹œê°„ (ì´ˆ)" icon={<Timer size={12}/>} value={settings.watcher.buffDuration} min={60} max={600} step={10} onChange={(v:number) => handleChange('watcher', 'buffDuration', v)} color="#a371f7" />
        </div>
      </ObjectConfigCard>

      {/* 4. í¬íƒ‘ */}
      <ObjectConfigCard 
        title="ë°©ì–´ í¬íƒ‘" 
        description="ê° ë¼ì¸ì„ ì§€í‚¤ëŠ” ë§ˆë²• êµ¬ì¡°ë¬¼ì…ë‹ˆë‹¤. ì ì˜ ì§„ê²©ì„ ì €ì§€í•˜ëŠ” 1ì°¨ ë°©ì–´ì„ ì…ë‹ˆë‹¤."
        icon={<Shield size={20} color="#58a6ff"/>}
        color="#58a6ff"
        data={settings.tower}
        onChange={(f: string, v: any) => handleChange('tower', f, v)}
      >
        <InputSlider label="ìµœëŒ€ ì²´ë ¥ (HP)" icon={<Heart size={14}/>} value={settings.tower.hp} min={1000} max={10000} step={100} onChange={(v:number) => handleChange('tower', 'hp', v)} color="#58a6ff" />
        <InputSlider label="ë°©ì–´ë ¥ (Armor)" icon={<Shield size={14}/>} value={settings.tower.armor} min={0} max={500} step={1} onChange={(v:number) => handleChange('tower', 'armor', v)} color="#58a6ff" />
        <InputSlider label="ê¸°ë³¸ ë³´ìƒ (Gold)" icon={<Coins size={14}/>} value={settings.tower.rewardGold} min={0} max={500} step={10} onChange={(v:number) => handleChange('tower', 'rewardGold', v)} color="#e89d40" />
      </ObjectConfigCard>

    </div>
  );
};

const ObjectConfigCard = ({ title, description, icon, color, data, onChange, children, isJungle }: any) => {
  return (
    <div style={{ 
      background: '#161b22', borderRadius: '12px', border: `1px solid ${color}44`, 
      overflow: 'hidden', display:'flex', flexDirection:'column',
      boxShadow: `0 4px 20px -5px ${color}11`
    }}>
      <div style={{ padding: '15px', background: `${color}11`, borderBottom: `1px solid ${color}22` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '8px' }}>
          {icon}
          <h3 style={{ margin: 0, fontSize: '16px', color: '#fff' }}>{title}</h3>
        </div>
        <div style={{ fontSize: '12px', color: '#ccc', fontStyle: 'italic', lineHeight: '1.4', opacity: 0.8 }}>
          "{description}"
        </div>
      </div>

      <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '20px', flex:1 }}>
        {children}
      </div>
    </div>
  );
};

const InputSlider = ({ label, icon, value, min, max, step, onChange, color, unit }: any) => (
  <div>
    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px', fontSize: '12px', color: '#8b949e' }}>
      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>{icon} {label}</div>
      <span style={{ fontWeight: 'bold', color: '#fff', fontFamily: 'monospace' }}>
        {value.toLocaleString()}{unit ? ` ${unit}` : ''}
      </span>
    </div>
    <input 
      type="range" min={min} max={max} step={step} value={value} 
      onChange={(e) => onChange(Number(e.target.value))}
      style={{ width: '100%', accentColor: color, cursor: 'pointer', height: '6px', background: '#30363d', borderRadius: '3px' }} 
    />
  </div>
);

// === FILE: /src/components/battle/LiveGameListModal.tsx ===

// ==========================================
// FILE PATH: /src/components/battle/LiveGameListModal.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { X, Eye, Swords, Clock, User, ChevronDown, ChevronUp } from 'lucide-react';
import { LiveMatch } from '../../types';

interface Props { onClose: () => void; onSpectate: (match: LiveMatch) => void; }

export const LiveGameListModal: React.FC<Props> = ({ onClose, onSpectate }) => {
  const { gameState, heroes } = useGameStore();
  const matches = gameState.liveMatches;

  // ëª¨ë°”ì¼ ì—¬ë¶€ í™•ì¸
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
  // ì„ íƒëœ ë§¤ì¹˜ ID
  const [selectedMatchId, setSelectedMatchId] = useState<string | null>(null);

  useEffect(() => {
    const handleResize = () => {
      const mobile = window.innerWidth <= 768;
      setIsMobile(mobile);
      if (!mobile && !selectedMatchId && matches.length > 0) {
        setSelectedMatchId(matches[0].id);
      }
    };
    window.addEventListener('resize', handleResize);
    // ì´ˆê¸° ë¡œë“œ ì‹œ PCë¼ë©´ ì²« ë²ˆì§¸ ì„ íƒ
    if (!isMobile && matches.length > 0 && !selectedMatchId) {
      setSelectedMatchId(matches[0].id);
    }
    return () => window.removeEventListener('resize', handleResize);
  }, [isMobile, matches, selectedMatchId]);

  const getHeroName = (id: string) => heroes.find(h => h.id === id)?.name || id;

  const formatDuration = (seconds: number) => {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m}ë¶„ ${String(s).padStart(2, '0')}ì´ˆ`;
  };

  // ê²Œì„ ëª©ë¡ ì•„ì´í…œ
  const MatchListItem = ({ match, isSelected, onClick }: { match: LiveMatch, isSelected: boolean, onClick: () => void }) => (
    <div 
      onClick={onClick}
      style={{ 
        padding: '15px', 
        borderBottom: '1px solid #2c2c2f', 
        cursor: 'pointer',
        background: isSelected ? '#2a2a2e' : '#1c1c1f',
        borderLeft: isSelected ? '4px solid #58a6ff' : '4px solid transparent',
        transition: 'background 0.2s'
      }}
    >
      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '6px', fontSize: '11px', color: '#888' }}>
        <span>{match.avgTier}</span>
        <span style={{ display:'flex', alignItems:'center', gap:'4px', fontFamily:'monospace' }}>
          <Clock size={10}/> {formatDuration(match.currentDuration)}
        </span>
      </div>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
        <div style={{ display:'flex', gap:'8px', alignItems:'center', width:'40%' }}>
          <span style={{ color: '#58a6ff', fontSize: '15px', fontWeight:'900' }}>{match.score.blue}</span>
          <span style={{ fontSize:'10px', color:'#58a6ff55' }}>BLUE</span>
        </div>
        <div style={{ fontSize: '12px', color: '#555', fontWeight:'bold' }}>VS</div>
        <div style={{ display:'flex', gap:'8px', alignItems:'center', width:'40%', justifyContent:'flex-end' }}>
          <span style={{ fontSize:'10px', color:'#e8405755' }}>RED</span>
          <span style={{ color: '#e84057', fontSize: '15px', fontWeight:'900' }}>{match.score.red}</span>
        </div>
      </div>
      {isMobile && (
        <div style={{ textAlign:'center', marginTop:'-10px', marginBottom:'-5px' }}>
          {isSelected ? <ChevronUp size={14} color="#555"/> : <ChevronDown size={14} color="#333"/>}
        </div>
      )}
    </div>
  );

  // [ìˆ˜ì •ë¨] ì•ˆì „ì¥ì¹˜ê°€ ì¶”ê°€ëœ ìƒì„¸ ì •ë³´ ë·°
  const MatchDetailView = ({ match }: { match: LiveMatch | undefined }) => {
    // ğŸš¨ ì—¬ê¸°ì„œ matchê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ í™”ë©´ ëŒ€ì‹  ì•ˆë‚´ ë¬¸êµ¬ë¥¼ ë„ì›€ (Crash ë°©ì§€)
    if (!match) {
        return (
            <div style={{ padding: '50px', textAlign: 'center', color: '#666', fontSize:'13px' }}>
                ì„ íƒëœ ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆê±°ë‚˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
            </div>
        );
    }

    return (
      <div style={{ background: '#0d1117', paddingBottom: '20px', borderBottom: '1px solid #30363d' }}>
        {/* ìƒë‹¨: ê´€ì „ ë²„íŠ¼ */}
        <div style={{ padding: '20px', textAlign: 'center', background: '#121212', borderBottom: '1px solid #333' }}>
          <button 
            onClick={() => onSpectate(match)}
            style={{ 
              padding: '10px 30px', borderRadius: '8px', 
              background: '#238636', color: '#fff', border: 'none', 
              fontSize: '14px', fontWeight: 'bold', cursor: 'pointer',
              display: 'inline-flex', alignItems: 'center', gap: '8px',
              boxShadow: '0 4px 15px rgba(35,134,54,0.3)'
            }}
          >
            <Eye size={18} /> ì‹¤ì‹œê°„ ê´€ì „ ì…ì¥
          </button>
        </div>

        {/* í”Œë ˆì´ì–´ ëª©ë¡ */}
        <div style={{ padding: '10px', display: 'grid', gridTemplateColumns: isMobile ? '1fr' : '1fr 1fr', gap: '10px' }}>
          {/* ë¸”ë£¨íŒ€ */}
          <div>
            <h4 style={{ color: '#58a6ff', margin: '10px 5px', fontSize:'11px', borderBottom: '2px solid #58a6ff', paddingBottom:'4px' }}>
              BLUE TEAM (ë‹¨í…Œ)
            </h4>
            {match.blueTeam && match.blueTeam.map((p, i) => (
              <PlayerCard key={i} p={p} color="#58a6ff" heroName={getHeroName(p.heroId)} />
            ))}
          </div>

          {/* ë ˆë“œíŒ€ */}
          <div style={{ marginTop: isMobile ? '10px' : '0' }}>
            <h4 style={{ color: '#e84057', margin: '10px 5px', fontSize:'11px', borderBottom: '2px solid #e84057', paddingBottom:'4px', textAlign: isMobile ? 'left' : 'right' }}>
              RED TEAM (ì´ì¦ˆë§ˆí•œ)
            </h4>
            {match.redTeam && match.redTeam.map((p, i) => (
              <PlayerCard key={i} p={p} color="#e84057" heroName={getHeroName(p.heroId)} alignRight={!isMobile} />
            ))}
          </div>
        </div>
      </div>
    );
  };

  return (
    <div style={{
      position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',
      backgroundColor: 'rgba(0,0,0,0.95)', zIndex: 9000,
      backdropFilter: 'blur(5px)',
      overflowY: 'auto', WebkitOverflowScrolling: 'touch',
      display: 'flex', justifyContent: 'center', 
      alignItems: isMobile ? 'flex-start' : 'center',
      padding: isMobile ? '0' : '20px'
    }}>

      <div className="panel" style={{ 
        width: isMobile ? '100%' : '1000px', 
        height: isMobile ? 'auto' : '80vh', 
        minHeight: isMobile ? '100vh' : 'auto',
        background: '#1c1c1f', 
        border: isMobile ? 'none' : '1px solid #30363d', 
        display: 'flex', flexDirection: 'column', 
        borderRadius: isMobile ? '0' : '12px',
        boxShadow: '0 20px 50px rgba(0,0,0,0.8)',
        overflow: 'hidden'
      }}>

        {/* í—¤ë” */}
        <div style={{ 
          padding: '15px 20px', borderBottom: '1px solid #333', 
          display: 'flex', justifyContent: 'space-between', alignItems: 'center', 
          background:'#252528', position: isMobile ? 'sticky' : 'relative', top: 0, zIndex: 50 
        }}>
          <h3 style={{ margin: 0, color:'#fff', display:'flex', alignItems:'center', gap:'10px', fontSize:'16px' }}>
            <Swords size={20} /> ì§„í–‰ ì¤‘ì¸ ê²Œì„ ({matches.length})
          </h3>
          <button onClick={onClose} style={{ background:'none', border:'none', color:'#fff', cursor:'pointer' }}><X size={24}/></button>
        </div>

        {/* [ëª¨ë°”ì¼] ì•„ì½”ë””ì–¸ ë°©ì‹ ë Œë”ë§ */}
        {isMobile ? (
          <div style={{ flex: 1 }}>
            {matches.map(match => (
              <div key={match.id}>
                <MatchListItem 
                  match={match} 
                  isSelected={selectedMatchId === match.id} 
                  onClick={() => setSelectedMatchId(selectedMatchId === match.id ? null : match.id)} 
                />
                {/* ì„ íƒë˜ë©´ ë°”ë¡œ ì•„ë˜ì— ìƒì„¸ ì •ë³´ í‘œì‹œ */}
                {selectedMatchId === match.id && (
                  <MatchDetailView match={match} />
                )}
              </div>
            ))}
            {matches.length === 0 && <div style={{padding:'20px', textAlign:'center', color:'#555'}}>ì§„í–‰ ì¤‘ì¸ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.</div>}
          </div>
        ) : (
          /* [PC] ì¢Œìš° ë¶„í•  ë°©ì‹ ë Œë”ë§ */
          <div style={{ flex: 1, display: 'flex', overflow: 'hidden' }}>
            {/* ì¢Œì¸¡ ë¦¬ìŠ¤íŠ¸ */}
            <div style={{ width: '320px', borderRight: '1px solid #333', overflowY: 'auto', background: '#161b22' }}>
              {matches.map(match => (
                <MatchListItem 
                  key={match.id} 
                  match={match} 
                  isSelected={selectedMatchId === match.id} 
                  onClick={() => setSelectedMatchId(match.id)} 
                />
              ))}
            </div>
            {/* ìš°ì¸¡ ìƒì„¸ */}
            <div style={{ flex: 1, overflowY: 'auto', background: '#0d1117' }}>
              <MatchDetailView match={matches.find(m => m.id === selectedMatchId)} />
            </div>
          </div>
        )}

      </div>
    </div>
  );
};

// í”Œë ˆì´ì–´ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
const PlayerCard = ({ p, color, heroName, alignRight = false }: any) => (
  <div style={{ 
    display: 'flex', 
    flexDirection: alignRight ? 'row-reverse' : 'row',
    alignItems: 'center', 
    justifyContent: 'space-between',
    padding: '8px 10px', 
    marginBottom: '6px', 
    background: '#1c1c1f', 
    borderRadius: '6px', 
    borderLeft: alignRight ? 'none' : `3px solid ${color}`,
    borderRight: alignRight ? `3px solid ${color}` : 'none',
    boxShadow: '0 2px 5px rgba(0,0,0,0.2)'
  }}>
    <div style={{ display: 'flex', alignItems: 'center', gap: '10px', flexDirection: alignRight ? 'row-reverse' : 'row' }}>
      <div style={{ 
        width: '30px', height: '30px', background: '#252528', 
        borderRadius: '6px', display:'flex', alignItems:'center', justifyContent:'center', 
        border: `1px solid ${color}44`, fontSize:'16px'
      }}>
        ğŸ§™â€â™‚ï¸
      </div>
      <div style={{ textAlign: alignRight ? 'right' : 'left' }}>
        <div style={{ color: '#fff', fontWeight:'bold', fontSize:'12px' }}>{heroName}</div>
        <div style={{ color: '#888', fontSize: '10px', display:'flex', alignItems:'center', gap:'3px', justifyContent: alignRight ? 'flex-end' : 'flex-start' }}>
          <User size={9}/> {p.name}
        </div>
      </div>
    </div>
    <div style={{ textAlign: alignRight ? 'left' : 'right' }}>
      <div style={{ color: '#ccc', fontWeight:'bold', fontSize:'12px', letterSpacing:'0.5px' }}>
        <span style={{color:'#fff'}}>{p.kills}</span>/<span style={{color:'#da3633'}}>{p.deaths}</span>/<span style={{color:'#fff'}}>{p.assists}</span>
      </div>
      <div style={{ color: '#e89d40', fontSize: '10px', fontWeight:'bold' }}>
        {(p.gold).toLocaleString()} G
      </div>
    </div>
  </div>
);


// === FILE: /src/components/battle/SpectateMap.tsx ===

// src/components/battle/SpectateMap.tsx
import React from 'react';

export const SpectateMap: React.FC = () => {
  return (
    <div style={{
      position: 'absolute',
      inset: 0,
      background: '#0a0f0a', // ë§µ ë¡œë“œ ì „ ê¸°ë³¸ ë°°ê²½ìƒ‰
      backgroundImage: `url('https://raw.githubusercontent.com/RiotGames/developer-relations/master/assets/maps/summoners_rift.png')`, 
      backgroundSize: '100% 100%',
      backgroundPosition: 'center',
      opacity: 0.8,
      zIndex: 0
    }}>
      {/* ë§µì´ ì•ˆ ë³´ì¼ ë•Œë¥¼ ëŒ€ë¹„í•œ ìµœì†Œí•œì˜ ë¼ì¸ í‘œì‹œ */}
      <svg width="100%" height="100%" viewBox="0 0 100 100" style={{ position: 'absolute', top: 0, left: 0 }}>
        <g stroke="rgba(255,255,255,0.2)" strokeWidth="0.5" fill="none">
          <path d="M 12 88 L 12 12 L 88 12" /> {/* íƒ‘ */}
          <line x1="12" y1="88" x2="88" y2="12" /> {/* ë¯¸ë“œ */}
          <path d="M 12 88 L 88 88 L 88 12" /> {/* ë´‡ */}
        </g>
      </svg>
    </div>
  );
};

// === FILE: /src/components/battle/SpectateModal.tsx ===

import React, { useState } from 'react';
import { X, Clock, Shield, Zap, Circle, Terminal, Swords, Briefcase, Crown, BarChart2, Activity, Coins, Ban } from 'lucide-react';
import { LiveMatch, LivePlayer, Item, TeamStats, Hero } from '../../types';
import { useGameStore } from '../../store/useGameStore';
import { GameIcon } from '../common/GameIcon';

interface Props { match: LiveMatch; onClose: () => void; }

export const SpectateModal: React.FC<Props> = ({ match, onClose }) => {
  const { heroes } = useGameStore(); 

  const [selectedHeroId, setSelectedHeroId] = useState<string | null>(null);
  const [viewingItem, setViewingItem] = useState<Item | null>(null);
  const [viewingBanHero, setViewingBanHero] = useState<Hero | null>(null);

  const getHeroName = (id: string) => heroes.find(h => h.id === id)?.name || id;

  const formatTime = (seconds: number) => {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
  };

  const maxDamage = Math.max(...match.blueTeam.map(p=>p.totalDamageDealt), ...match.redTeam.map(p=>p.totalDamageDealt), 1);

  // [ìˆ˜ì •ë¨] hero íƒ€ì… ëª…ì‹œ
  const BanDetailPopup = ({ hero, onClose }: { hero: Hero, onClose: () => void }) => {
    return (
      <div 
        onClick={onClose}
        style={{ 
          position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', zIndex: 11000, 
          display: 'flex', justifyContent: 'center', alignItems: 'center', padding: '20px',
          backdropFilter: 'blur(3px)'
        }}
      >
        <div 
          onClick={e => e.stopPropagation()}
          style={{ 
            width: '280px', background: '#1c1c1f', borderRadius: '16px', border: '1px solid #da3633', 
            overflow: 'hidden', boxShadow: '0 10px 40px rgba(218, 54, 51, 0.2)', display:'flex', flexDirection:'column', alignItems:'center'
          }}
        >
          <div style={{ background:'#da3633', width:'100%', padding:'10px', textAlign:'center', color:'#fff', fontWeight:'bold', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px' }}>
            <Ban size={18}/> BANNED HERO
          </div>

          <div style={{ padding: '30px 20px', display:'flex', flexDirection:'column', alignItems:'center', gap:'15px' }}>
            <div style={{ position:'relative', width: '80px', height: '80px' }}>
              <GameIcon id={hero.id} size={80} shape="rounded" border="2px solid #444" fallback={<span style={{fontSize:'30px'}}>ğŸ§™â€â™‚ï¸</span>} />
              <div style={{ 
                position: 'absolute', top: '50%', left: '50%', width: '120%', height: '4px', 
                background: '#da3633', transform: 'translate(-50%, -50%) rotate(45deg)',
                boxShadow: '0 0 5px rgba(0,0,0,0.5)'
              }}></div>
            </div>

            <div style={{ textAlign:'center' }}>
              <div style={{ fontSize:'12px', color:'#da3633', fontWeight:'bold', border:'1px solid #da3633', borderRadius:'4px', padding:'2px 6px', display:'inline-block', marginBottom:'6px' }}>
                ê¸ˆì§€ë¨
              </div>
              <div style={{ fontSize:'20px', fontWeight:'bold', color:'#fff', marginBottom:'4px' }}>{hero.name}</div>
              <div style={{ fontSize:'13px', color:'#888' }}>{hero.role}</div>
            </div>
          </div>

          <button onClick={onClose} style={{ width: '100%', padding: '12px', background: '#252528', border: 'none', borderTop: '1px solid #333', color: '#ccc', cursor: 'pointer', fontWeight:'bold' }}>
            ë‹«ê¸°
          </button>
        </div>
      </div>
    );
  };

  // [ìˆ˜ì •ë¨] heroId íƒ€ì… ëª…ì‹œ
  const BanCard = ({ heroId }: { heroId: string }) => {
    const hero = heroes.find(h => h.id === heroId);
    if (!hero) return null;

    return (
      <div 
        onClick={() => setViewingBanHero(hero)}
        title={`BANNED: ${hero.name}`} 
        style={{ 
          position: 'relative', width: '32px', height: '32px', cursor: 'pointer',
          transition: 'transform 0.1s',
          borderRadius: '6px',
          overflow: 'hidden' 
        }}
        onMouseEnter={e => e.currentTarget.style.transform = 'scale(1.1)'}
        onMouseLeave={e => e.currentTarget.style.transform = 'scale(1)'}
      >
        <div style={{ filter: 'grayscale(100%) brightness(0.6)' }}>
          <GameIcon id={heroId} size={32} shape="square" border="1px solid #444" fallback={<span style={{fontSize:'12px'}}>ğŸš«</span>} />
        </div>
        <div style={{ 
          position: 'absolute', top: '50%', left: '50%', width: '150%', height: '3px', 
          backgroundColor: '#da3633', transform: 'translate(-50%, -50%) rotate(45deg)',
          boxShadow: '0 0 2px #000', pointerEvents: 'none' 
        }} />
      </div>
    );
  };

  const ObjectStatBox = ({ stats, color }: { stats: TeamStats, color: string }) => {
    const s = stats || { towers: { top: 0, mid: 0, bot: 0 }, colossus: 0, watcher: 0, fury: 0, nexusHp: 0, maxNexusHp: 5000 };

    const TowerIndicator = ({ label, brokenCount }: { label: string, brokenCount: number }) => (
      <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '10px', color:'#888' }}>
        <span style={{ width:'24px' }}>{label}</span>
        <div style={{ display: 'flex', gap: '2px' }}>
          {[1, 2, 3].map(tier => (
            <div key={tier} style={{
              width: '8px', height: '8px', borderRadius: '1px',
              background: tier <= brokenCount ? '#333' : color, 
              opacity: tier <= brokenCount ? 0.3 : 1,
              border: `1px solid ${tier <= brokenCount ? '#444' : 'transparent'}`
            }} />
          ))}
        </div>
      </div>
    );

    const hpPercent = (s.nexusHp / s.maxNexusHp) * 100;

    return (
      <div style={{ background: '#161b22', border: `1px solid ${color}44`, borderRadius: '6px', padding: '10px', display:'flex', flexDirection:'column', justifyContent:'space-between' }}>
        <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:'8px' }}>
          <div style={{ display:'flex', flexDirection:'column', gap:'2px' }}>
            <TowerIndicator label="TOP" brokenCount={s.towers?.top || 0} />
            <TowerIndicator label="MID" brokenCount={s.towers?.mid || 0} />
            <TowerIndicator label="BOT" brokenCount={s.towers?.bot || 0} />
          </div>
          <div style={{ textAlign:'right' }}>
             <div style={{ fontSize:'10px', color:'#888', marginBottom:'2px' }}><Crown size={10} style={{marginRight:2}}/> ìˆ˜í˜¸ì</div>
             <div style={{ fontSize:'12px', fontWeight:'bold', color: hpPercent < 30 ? '#da3633' : '#fff' }}>
               {Math.max(0, Math.ceil(s.nexusHp)).toLocaleString()}
             </div>
          </div>
        </div>
        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', color: '#ccc', borderTop:'1px dashed #333', paddingTop:'6px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }} title="ê±°ì‹ ë³‘ ì²˜ì¹˜ ìˆ˜">
            <Skull size={12} color="#7ee787" /> <span style={{ fontWeight:'bold' }}>{s.colossus}</span>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }} title="ì£¼ì‹œì ì²˜ì¹˜ ìˆ˜">
            <Circle size={12} color="#a371f7" /> <span style={{ fontWeight:'bold' }}>{s.watcher}</span>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }} title="ë¶„ë…¸ ìŠ¤íƒ">
            <Zap size={12} color="#f1c40f" /> <span style={{ fontWeight:'bold' }}>{s.fury}</span>
          </div>
        </div>
      </div>
    );
  };

  const ItemIcon = ({ item, onClick }: { item: Item, onClick: (i: Item) => void }) => {
    const colors = { WEAPON: '#e74c3c', ARMOR: '#2ecc71', ACCESSORY: '#f1c40f', POWER: '#9b59b6' };
    const color = (colors as any)[item.type] || '#555';
    return (
      <div 
        onClick={(e) => { e.stopPropagation(); onClick(item); }}
        style={{ 
          width: '24px', height: '24px', borderRadius: '4px', background: `${color}22`, border: `1px solid ${color}`,
          display: 'flex', alignItems: 'center', justifyContent: 'center', color: color, cursor: 'pointer'
        }}
      >
        {item.type === 'WEAPON' ? <Swords size={12}/> : item.type === 'ARMOR' ? <Shield size={12}/> : item.type === 'POWER' ? <Zap size={12}/> : <Briefcase size={12}/>}
      </div>
    );
  };

  const ItemDetailPopup = ({ item, onClose }: { item: Item, onClose: () => void }) => {
    if (!item) return null;
    const colors = { WEAPON: '#e74c3c', ARMOR: '#2ecc71', ACCESSORY: '#f1c40f', POWER: '#9b59b6' };
    const color = (colors as any)[item.type] || '#fff';

    return (
      <div 
        onClick={onClose}
        style={{ 
          position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', zIndex: 11000, 
          display: 'flex', justifyContent: 'center', alignItems: 'center', padding: '20px',
          backdropFilter: 'blur(3px)'
        }}
      >
        <div 
          onClick={e => e.stopPropagation()}
          style={{ 
            width: '100%', maxWidth: '320px', background: '#1c1c1f', 
            borderRadius: '12px', border: `1px solid ${color}`, overflow: 'hidden',
            boxShadow: `0 10px 40px ${color}33`
          }}
        >
          <div style={{ padding: '15px', background: `${color}22`, borderBottom: `1px solid ${color}44` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
              <h3 style={{ margin: 0, color: color, fontSize: '16px', display:'flex', alignItems:'center', gap:'8px' }}>
                {item.type === 'WEAPON' ? <Swords size={16}/> : item.type === 'ARMOR' ? <Shield size={16}/> : <Briefcase size={16}/>}
                {item.name}
              </h3>
              <div style={{ color: '#f1c40f', fontWeight: 'bold', fontSize: '13px', display:'flex', alignItems:'center', gap:'4px' }}>
                <Coins size={12}/> {item.cost}
              </div>
            </div>
          </div>
          <div style={{ padding: '15px', display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px', fontSize: '12px' }}>
            {item.ad > 0 && <div style={{ color: '#e74c3c' }}>ê³µê²©ë ¥ +{item.ad}</div>}
            {item.ap > 0 && <div style={{ color: '#9b59b6' }}>ì£¼ë¬¸ë ¥ +{item.ap}</div>}
            {item.hp > 0 && <div style={{ color: '#2ecc71' }}>ì²´ë ¥ +{item.hp}</div>}
            {item.armor > 0 && <div style={{ color: '#3498db' }}>ë°©ì–´ë ¥ +{item.armor}</div>}
            {item.crit > 0 && <div style={{ color: '#e67e22' }}>ì¹˜ëª…íƒ€ +{item.crit}%</div>}
            {item.speed > 0 && <div style={{ color: '#fff' }}>ì´ë™ì†ë„ +{item.speed}</div>}
          </div>
          {item.description && <div style={{ padding: '15px', borderTop: '1px solid #333', color: '#ccc', fontSize: '12px', lineHeight: '1.5', background: '#161b22' }}>{item.description}</div>}
          <button onClick={onClose} style={{ width: '100%', padding: '12px', background: '#252528', border: 'none', borderTop: '1px solid #333', color: '#888', cursor: 'pointer', fontSize: '13px' }}>ë‹«ê¸°</button>
        </div>
      </div>
    );
  };

  const PlayerRow = ({ p, isBlue }: { p: LivePlayer, isBlue: boolean }) => {
    const isSelected = selectedHeroId === p.heroId;
    const hpPercent = (p.currentHp / p.maxHp) * 100;
    const heroName = getHeroName(p.heroId);

    return (
      <div 
        onClick={() => setSelectedHeroId(isSelected ? null : p.heroId)}
        style={{ 
          display: 'flex', alignItems: 'center', gap: '8px', padding: '8px', 
          borderBottom: '1px solid #30363d', cursor: 'pointer',
          background: isSelected ? (isBlue ? 'rgba(88, 166, 255, 0.2)' : 'rgba(232, 64, 87, 0.2)') 
                     : (isBlue ? 'rgba(88, 166, 255, 0.05)' : 'rgba(232, 64, 87, 0.05)'),
          borderLeft: isSelected ? `4px solid ${isBlue ? '#58a6ff' : '#e84057'}` : '4px solid transparent',
          transition: '0.2s'
        }}
      >
        <div style={{ position: 'relative' }}>
          <GameIcon id={p.heroId} size={36} shape="rounded" border={`1px solid ${isBlue ? '#58a6ff44' : '#e8405744'}`} fallback={<span style={{fontSize:'18px'}}>ğŸ§™â€â™‚ï¸</span>} />
          <div style={{ position: 'absolute', bottom: -4, right: -4, background: '#000', color: '#fff', fontSize: '9px', padding: '1px 4px', borderRadius: '3px', border:'1px solid #555', fontWeight:'bold' }}>{p.level}</div>
          <div style={{ position:'absolute', bottom:-4, left:0, width:'100%', height:'3px', background:'#333', borderRadius:'2px', overflow:'hidden' }}>
            <div style={{ width:`${hpPercent}%`, height:'100%', background: hpPercent < 30 ? '#da3633' : '#2ecc71' }}/>
          </div>
        </div>
        <div style={{ flex: 1, minWidth:0 }}>
          <div style={{ display:'flex', justifyContent:'space-between' }}>
            <div style={{ fontWeight: 'bold', color: '#fff', fontSize:'12px' }}>{heroName}</div>
            <div style={{ fontSize:'12px', fontWeight:'bold', color: '#ccc' }}>{p.kills}/{p.deaths}/{p.assists}</div>
          </div>
          <div style={{ display:'flex', justifyContent:'space-between', marginTop:'2px' }}>
            <div style={{ fontSize:'10px', color: '#888' }}>{p.name}</div>
            <div style={{ fontSize:'10px', color: '#e89d40' }}>{(p.gold/1000).toFixed(1)}k</div>
          </div>
        </div>
      </div>
    );
  };

  const InspectorPanel = ({ p }: { p: LivePlayer }) => {
    const heroName = getHeroName(p.heroId);
    const hpPercent = (p.currentHp / p.maxHp) * 100;

    const kda = p.deaths === 0 ? (p.kills + p.assists) : (p.kills + p.assists) / p.deaths;
    let grade = 'C';
    let gradeColor = '#888';
    if (kda > 8) { grade = 'S+'; gradeColor = '#f1c40f'; }
    else if (kda > 5) { grade = 'A'; gradeColor = '#58a6ff'; }
    else if (kda > 3) { grade = 'B'; gradeColor = '#2ecc71'; }

    const personalLogs = [...match.logs].filter(log => log.message.includes(heroName)).reverse();

    return (
      <div style={{ display:'flex', flexDirection:'column', height:'100%', background:'#121212' }}>
        <div style={{ padding:'15px', borderBottom:'1px solid #333', display:'flex', gap:'15px', alignItems:'center' }}>
          <div style={{ textAlign:'center' }}>
            <div style={{ fontSize:'10px', color:'#888', marginBottom:'2px' }}>KDA RATING</div>
            <div style={{ fontSize:'24px', fontWeight:'900', color:gradeColor, lineHeight:'1' }}>{grade}</div>
          </div>
          <div style={{ flex:1 }}>
            <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-end' }}>
              <span style={{ fontSize:'16px', fontWeight:'bold', color:'#fff' }}>{heroName}</span>
              <span style={{ fontSize:'11px', color:'#ccc' }}>{p.currentHp} / {p.maxHp} HP</span>
            </div>
            <div style={{ width:'100%', height:'12px', background:'#333', borderRadius:'3px', marginTop:'4px', overflow:'hidden', border:'1px solid #555' }}>
              <div style={{ width:`${hpPercent}%`, height:'100%', background: hpPercent<30?'#da3633':'#2ecc71', transition:'width 0.3s' }}/>
            </div>
          </div>
        </div>
        <div style={{ padding:'15px', borderBottom:'1px solid #333', display:'grid', gridTemplateColumns:'1fr 1fr', gap:'15px' }}>
          <div>
            <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'6px', display:'flex', alignItems:'center', gap:'4px' }}><Briefcase size={12}/> ë³´ìœ  ì•„ì´í…œ</div>
            <div style={{ display:'flex', gap:'4px' }}>
              {p.items.map((item, idx) => <ItemIcon key={idx} item={item} onClick={setViewingItem} />)}
              {Array(6 - p.items.length).fill(0).map((_, i) => <div key={i} style={{ width:'24px', height:'24px', background:'#222', borderRadius:'4px', border:'1px dashed #444' }}/>)}
            </div>
          </div>
          <div>
            <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'6px', display:'flex', alignItems:'center', gap:'4px' }}><BarChart2 size={12}/> ëˆ„ì  ë”œëŸ‰</div>
            <div style={{ display:'flex', alignItems:'center', gap:'8px' }}>
              <div style={{ flex:1, height:'6px', background:'#333', borderRadius:'3px' }}>
                <div style={{ width:`${(p.totalDamageDealt / maxDamage)*100}%`, height:'100%', background:'#da3633', borderRadius:'3px' }}/>
              </div>
              <span style={{ fontSize:'11px', color:'#da3633', fontWeight:'bold' }}>{p.totalDamageDealt.toLocaleString()}</span>
            </div>
          </div>
        </div>
        <div style={{ flex:1, overflowY:'auto', padding:'10px', background:'#0a0a0a', WebkitOverflowScrolling: 'touch' }}>
          <div style={{ fontSize:'11px', color:'#58a6ff', marginBottom:'8px', fontWeight:'bold', display:'flex', alignItems:'center', gap:'4px' }}><Activity size={12}/> íƒ€ì„ë¼ì¸</div>
          {personalLogs.length === 0 ? <div style={{ color:'#555', fontSize:'11px', padding:'10px' }}>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div> : personalLogs.map((log, i) => (
            <div key={i} style={{ fontSize:'11px', marginBottom:'4px', color:'#ccc', borderLeft:'2px solid #444', paddingLeft:'8px' }}>
              <span style={{ color:'#666', marginRight:'6px' }}>{formatTime(log.time)}</span>
              {log.message}
            </div>
          ))}
        </div>
      </div>
    );
  };

  const selectedPlayer = [...match.blueTeam, ...match.redTeam].find(p => p.heroId === selectedHeroId);
  const reversedGlobalLogs = [...match.logs].reverse();

  return (
    <>
      <div style={{ position: 'fixed', inset: 0, background: '#050505', zIndex: 10000, display: 'flex', flexDirection: 'column' }}>

        <div style={{ height: '50px', background: '#161b22', borderBottom: '1px solid #30363d', display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0 15px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '15px', flex:1, justifyContent:'center' }}>
            <div style={{ color: '#58a6ff', fontWeight: 'bold', fontSize: '18px' }}>{match.score.blue}</div>
            <div style={{ background: '#0d1117', padding: '4px 12px', borderRadius: '4px', border: '1px solid #30363d', display: 'flex', alignItems: 'center', gap: '6px', color: '#fff', fontSize: '14px', fontFamily: 'monospace' }}>
              <Clock size={14} color="#8b949e"/> {formatTime(match.currentDuration)}
            </div>
            <div style={{ color: '#e84057', fontWeight: 'bold', fontSize: '18px' }}>{match.score.red}</div>
          </div>
          <button onClick={onClose} style={{ position:'absolute', right:'15px', background: 'none', border: 'none', color: '#8b949e', cursor: 'pointer' }}><X size={24}/></button>
        </div>

        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems:'center', padding: '8px 15px', background: '#0d1117', borderBottom: '1px solid #30363d' }}>
          <div style={{ display: 'flex', gap: '6px', alignItems: 'center' }}>
            <span style={{ fontSize: '10px', color: '#58a6ff', fontWeight: 'bold', display:'flex', gap:'4px' }}>
              <Ban size={12}/> BAN
            </span>
            {match.bans.blue.map(id => <BanCard key={id} heroId={id} />)}
          </div>
          <div style={{ display: 'flex', gap: '6px', alignItems: 'center' }}>
            {match.bans.red.map(id => <BanCard key={id} heroId={id} />)}
            <span style={{ fontSize: '10px', color: '#e84057', fontWeight: 'bold', display:'flex', gap:'4px' }}>
              BAN <Ban size={12}/> 
            </span>
          </div>
        </div>

        <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
          <div style={{ flex: 1, overflowY: 'auto', padding: '10px', display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px', WebkitOverflowScrolling: 'touch' }}>
            <div style={{ display:'flex', flexDirection:'column', gap:'4px' }}>
              <div style={{ fontSize:'10px', color:'#58a6ff', fontWeight:'bold', textAlign:'center', marginBottom:'4px' }}>BLUE TEAM</div>
              {match.blueTeam.map((p, i) => <PlayerRow key={i} p={p} isBlue={true} />)}
            </div>
            <div style={{ display:'flex', flexDirection:'column', gap:'4px' }}>
              <div style={{ fontSize:'10px', color:'#e84057', fontWeight:'bold', textAlign:'center', marginBottom:'4px' }}>RED TEAM</div>
              {match.redTeam.map((p, i) => <PlayerRow key={i} p={p} isBlue={false} />)}
            </div>
          </div>

          {!selectedPlayer && (
            <div style={{ padding: '10px 15px', background: '#121212', borderTop: '1px solid #30363d', display:'grid', gridTemplateColumns:'1fr 1fr', gap:'15px' }}>
               <ObjectStatBox stats={match.stats.blue} color="#58a6ff" />
               <ObjectStatBox stats={match.stats.red} color="#e84057" />
            </div>
          )}

          <div style={{ height: selectedPlayer ? '40%' : '35%', borderTop: '1px solid #30363d', display:'flex', flexDirection:'column' }}>
            {selectedPlayer ? (
              <div style={{ flex:1, display:'flex', flexDirection:'column' }}>
                <div onClick={() => setSelectedHeroId(null)} style={{ background:'#21262d', padding:'6px', textAlign:'center', cursor:'pointer', borderBottom:'1px solid #333' }}>
                  <span style={{ fontSize:'11px', color:'#8b949e', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px' }}><X size={12}/> ì „ì²´ ë¡œê·¸ë¡œ ëŒì•„ê°€ê¸°</span>
                </div>
                <InspectorPanel p={selectedPlayer} />
              </div>
            ) : (
              <div style={{ flex:1, display:'flex', flexDirection:'column', background:'#000' }}>
                <div style={{ padding: '8px 12px', background: '#21262d', borderBottom: '1px solid #333', display: 'flex', alignItems: 'center', justifyContent:'space-between' }}>
                  <span style={{ color: '#8b949e', fontSize: '11px', fontWeight: 'bold', display:'flex', alignItems:'center', gap:'6px' }}><Terminal size={12} /> ì „ì²´ ê²Œì„ ë¡œê·¸ (ìµœì‹ ìˆœ)</span>
                  <span style={{ fontSize:'10px', color:'#555' }}>í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì—¬ ìƒì„¸ì •ë³´ í™•ì¸</span>
                </div>
                <div style={{ flex: 1, padding: '10px', overflowY: 'auto', fontFamily: 'monospace', fontSize: '12px', WebkitOverflowScrolling: 'touch' }}>
                  {reversedGlobalLogs.map((log, i) => (
                    <div key={i} style={{ marginBottom: '4px', display: 'flex', gap: '8px', lineHeight: '1.4' }}>
                      <span style={{ color: '#555', minWidth: '35px' }}>{formatTime(log.time).split(':')[0]}:{formatTime(log.time).split(':')[1]}</span>
                      {log.type === 'START' && <span style={{ color: '#e89d40' }}>âš¡ {log.message}</span>}
                      {log.type === 'KILL' && (
                        <span style={{ color: log.team === 'BLUE' ? '#58a6ff' : '#f85149' }}>
                          <Swords size={10} style={{marginRight:'4px', verticalAlign:'middle'}}/>
                          {log.message}
                        </span>
                      )}
                      {log.type === 'TOWER' && <span style={{ color: '#ccc' }}>ğŸ”¨ {log.message}</span>}
                      {log.type === 'COLOSSUS' && <span style={{ color: '#7ee787' }}>ğŸ¤– {log.message}</span>}
                      {log.type === 'WATCHER' && <span style={{ color: '#a371f7' }}>ğŸ‘ï¸ {log.message}</span>}
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>

      {viewingItem && <ItemDetailPopup item={viewingItem} onClose={() => setViewingItem(null)} />}
      {viewingBanHero && <BanDetailPopup hero={viewingBanHero} onClose={() => setViewingBanHero(null)} />}
    </>
  );
};


// === FILE: /src/components/common/DevTools.tsx ===

// src/components/common/DevTools.tsx
import React from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Trash2 } from 'lucide-react';

export const DevTools = () => {
  const { resetHeroStats } = useGameStore();

  const handleReset = () => {
    if (window.confirm('ëª¨ë“  ì±”í”¼ì–¸ì˜ ëˆ„ì  í†µê³„(ìŠ¹ë¥ , KDA, íŒìˆ˜)ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n*í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê²Œì„ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.')) {
      resetHeroStats();
      alert('í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ìƒˆë¡œìš´ ê²Œì„ ê²°ê³¼ê°€ ì¦‰ì‹œ ìŠ¹ë¥ ì— ë°˜ì˜ë©ë‹ˆë‹¤.');
    }
  };

  return (
    <div style={{
      position: 'fixed',
      bottom: '20px',
      right: '20px',
      zIndex: 9999
    }}>
      <button 
        onClick={handleReset}
        style={{
          background: '#e74c3c',
          color: 'white',
          border: 'none',
          padding: '10px 15px',
          borderRadius: '8px',
          cursor: 'pointer',
          boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
          display: 'flex',
          alignItems: 'center',
          gap: '8px',
          fontSize: '13px',
          fontWeight: 'bold'
        }}
      >
        <Trash2 size={16} />
        í†µê³„ ì´ˆê¸°í™”
      </button>
    </div>
  );
};

// === FILE: /src/components/common/GameIcon.tsx ===

// ==========================================
// FILE PATH: /src/components/common/GameIcon.tsx
// ==========================================

import React from 'react';
import { useGameStore } from '../../store/useGameStore';

interface Props {
  id: string;
  size?: string | number;
  fallback?: React.ReactNode;
  shape?: 'square' | 'circle' | 'rounded';
  border?: string;
}

export const GameIcon: React.FC<Props> = ({ id, size = 40, fallback, shape = 'rounded', border = '1px solid #444' }) => {
  const { gameState } = useGameStore();
  const customImage = gameState.customImages?.[id];

  const style: React.CSSProperties = {
    width: typeof size === 'number' ? `${size}px` : size,
    height: typeof size === 'number' ? `${size}px` : size,
    borderRadius: shape === 'circle' ? '50%' : shape === 'rounded' ? '12px' : '0',
    overflow: 'hidden',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    background: '#21262d',
    border: border,
    flexShrink: 0,
    backgroundSize: 'cover',
    backgroundPosition: 'center',
  };

  if (customImage) {
    return (
      <div style={{ ...style, backgroundImage: `url(${customImage})` }} />
    );
  }

  return (
    <div style={style}>
      {fallback || <span style={{fontSize: typeof size === 'number' ? size/2 : '12px'}}>ğŸ§™â€â™‚ï¸</span>}
    </div>
  );
};

// === FILE: /src/components/common/SaveLoadModal.tsx ===

import React, { useState, useEffect } from 'react';
import { X, Save, Upload, Download } from 'lucide-react';
import { useGameStore } from '../../store/useGameStore';
import { saveToSlot, loadFromSlot, getSlotsMeta, exportSaveFile, importSaveFile, SaveMeta } from '../../engine/SaveLoadSystem';

interface Props { onClose: () => void; }

export const SaveLoadModal: React.FC<Props> = ({ onClose }) => {
  const { heroes } = useGameStore();
  const [slots, setSlots] = useState<Record<string, SaveMeta>>({});
  const [refreshKey, setRefreshKey] = useState(0); 

  useEffect(() => {
    setSlots(getSlotsMeta());
  }, [refreshKey]);

  const handleSave = (slotId: string) => {
    if (saveToSlot(slotId)) {
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      setSlots(getSlotsMeta());
    }
  };

  const handleLoad = (slotId: string) => {
    if (!slots[slotId]) return;

    if (confirm("ì •ë§ ì´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\ní˜„ì¬ ì§„í–‰ ìƒí™©ì€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.")) {
      const success = loadFromSlot(slotId, heroes);
      if (success) {
        alert("ë¡œë“œ ì™„ë£Œ!");
        onClose();
        window.location.reload();
      } else {
        alert("ë¡œë“œ ì‹¤íŒ¨! ë°ì´í„°ê°€ ì†ìƒë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      }
    }
  };

  const handleFileImport = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    if (confirm("íŒŒì¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      const success = await importSaveFile(file, heroes);
      if (success) {
        alert("íŒŒì¼ ë¡œë“œ ì™„ë£Œ!");
        onClose();
        window.location.reload();
      }
    }
    e.target.value = ''; 
  };

  const SlotItem = ({ id, name, color }: { id: string, name: string, color: string }) => {
    const info = slots[id];
    return (
      <div style={{ background: '#21262d', padding: '15px', borderRadius: '8px', marginBottom: '10px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', border: `1px solid ${color}` }}>
        <div>
          <div style={{ fontWeight: 'bold', color: color, marginBottom: '4px' }}>{name}</div>
          {info ? (
            <div style={{ fontSize: '13px', color: '#ccc' }}>
              <div>Day {info.day} â€¢ ìœ ì € {info.totalUsers}ëª…</div>
              <div style={{ fontSize: '11px', color: '#777' }}>{new Date(info.timestamp).toLocaleString()}</div>
            </div>
          ) : (
            <div style={{ fontSize: '13px', color: '#555' }}>ë¹„ì–´ ìˆìŒ</div>
          )}
        </div>
        <div style={{ display: 'flex', gap: '8px' }}>
          {id !== 'auto' && (
            <button onClick={() => handleSave(id)} style={{ padding: '8px 12px', background: '#238636', border: 'none', borderRadius: '6px', color: '#fff', cursor: 'pointer', fontWeight: 'bold' }}>
              ì €ì¥
            </button>
          )}
          <button 
            onClick={() => handleLoad(id)} 
            disabled={!info}
            style={{ padding: '8px 12px', background: info ? '#1f6feb' : '#333', border: 'none', borderRadius: '6px', color: '#fff', cursor: info ? 'pointer' : 'default', fontWeight: 'bold', opacity: info ? 1 : 0.5 }}
          >
            ë¡œë“œ
          </button>
        </div>
      </div>
    );
  };

  return (
    <div style={{ position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', background: 'rgba(0,0,0,0.8)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 9999 }}>
      <div className="panel" style={{ width: '500px', background: '#161b22', border: '1px solid #333' }}>

        <div style={{ padding: '15px', borderBottom: '1px solid #333', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <h3 style={{ margin: 0, display:'flex', alignItems:'center', gap:'8px' }}><Save size={18}/> ì €ì¥ / ë¶ˆëŸ¬ì˜¤ê¸°</h3>
          <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer' }}><X /></button>
        </div>

        <div style={{ padding: '20px' }}>
          <SlotItem id="auto" name="ğŸ”„ ìë™ ì €ì¥ (Auto Save)" color="#e89d40" />
          <div style={{ height: '1px', background: '#333', margin: '15px 0' }}></div>
          <SlotItem id="slot1" name="ğŸ“ ì €ì¥ ìŠ¬ë¡¯ 1" color="#58a6ff" />
          <SlotItem id="slot2" name="ğŸ“ ì €ì¥ ìŠ¬ë¡¯ 2" color="#58a6ff" />
          <SlotItem id="slot3" name="ğŸ“ ì €ì¥ ìŠ¬ë¡¯ 3" color="#58a6ff" />

          <div style={{ marginTop: '20px', paddingTop: '15px', borderTop: '1px dashed #333', display: 'flex', justifyContent: 'space-between' }}>
            <button onClick={exportSaveFile} style={{ background: 'none', border: 'none', color: '#8b949e', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '5px', fontSize: '12px' }}>
              <Download size={14}/> PC íŒŒì¼ë¡œ ë°±ì—…
            </button>
            <label style={{ cursor: 'pointer', color: '#8b949e', display: 'flex', alignItems: 'center', gap: '5px', fontSize: '12px' }}>
              <Upload size={14}/> PC íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
              <input type="file" style={{ display: 'none' }} accept=".json" onChange={handleFileImport} />
            </label>
          </div>
        </div>

      </div>
    </div>
  );
};


// === FILE: /src/components/common/StatCard.tsx ===

import React, { useState, useEffect } from 'react';
import { LucideIcon } from 'lucide-react';

interface Props {
  title: string;
  value: string | number;
  icon: LucideIcon;
  color?: string;
}

export const StatCard: React.FC<Props> = ({ title, value, icon: Icon, color = "#58a6ff" }) => {
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return (
    <div className="stat-card-mini" style={{ 
      display: 'flex', 
      flexDirection: 'column', // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ìœ„ì•„ë˜ë¡œ ë°°ì¹˜
      alignItems: 'center', 
      justifyContent: 'center',
      padding: isMobile ? '8px 4px' : '16px', 
      background: '#161b22',
      border: '1px solid #30363d',
      borderRadius: '8px',
      flex: 1,
      minWidth: 0, // ì¢ì€ í™”ë©´ì—ì„œ ì°Œê·¸ëŸ¬ì§ ë°©ì§€
    }}>
      {/* ì•„ì´ì½˜ - í¬ê¸° ì¶•ì†Œ */}
      <div style={{ 
        color: color,
        marginBottom: isMobile ? '4px' : '8px',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        opacity: 0.9
      }}>
        <Icon size={isMobile ? 16 : 22} />
      </div>

      <div style={{ textAlign: 'center', width: '100%' }}>
        {/* ìˆ˜ì¹˜ - ê°€ë…ì„± í™•ë³´ */}
        <div className="text-mono" style={{ 
          fontSize: isMobile ? '13px' : '18px', 
          fontWeight: '800',
          color: '#fff',
          whiteSpace: 'nowrap',
          overflow: 'hidden',
          textOverflow: 'ellipsis'
        }}>
          {value}
        </div>
        {/* ì œëª© - ì•„ì£¼ ì‘ê²Œ í‘œì‹œ */}
        <div style={{ 
          fontSize: isMobile ? '8px' : '11px', 
          color: '#8b949e',
          marginTop: '1px',
          whiteSpace: 'nowrap'
        }}>
          {isMobile ? title.replace(' ', '') : title}
        </div>
      </div>
    </div>
  );
};

// === FILE: /src/components/common/SystemMenu.tsx ===

// ==========================================
// FILE PATH: /src/components/common/SystemMenu.tsx
// ==========================================

import React, { useState, useEffect, useRef } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { 
  saveToSlot, loadFromSlot, getSlotsMeta, deleteSlot, SaveMeta, 
  exportSaveFile, importSaveFile 
} from '../../engine/SaveLoadSystem';
import { 
  Save, Disc, AlertTriangle, X, Bot, Key, CheckCircle, 
  Download, Upload, Trash2, RefreshCw, Share2, FileJson 
} from 'lucide-react';

interface Props { onClose: () => void; }

export const SystemMenu: React.FC<Props> = ({ onClose }) => {
  const { 
    heroes, gameState, shopItems, // MOD ë‚´ë³´ë‚´ê¸°ìš© ë°ì´í„°
    updateAIConfig, resetHeroStats, hardReset, loadModData // ì•¡ì…˜ë“¤
  } = useGameStore();

  const [activeTab, setActiveTab] = useState<'SAVE' | 'LOAD' | 'OPTION'>('SAVE');
  const [slots, setSlots] = useState<Record<string, SaveMeta>>({});

  // AI ì„¤ì • ë¡œì»¬ ìƒíƒœ
  const [aiSettings, setAiSettings] = useState(gameState.aiConfig);

  // íŒŒì¼ ì…ë ¥ ì°¸ì¡°
  const fileInputRef = useRef<HTMLInputElement>(null);
  const modInputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    setSlots(getSlotsMeta());
  }, []);

  const refreshSlots = () => setSlots(getSlotsMeta());

  // --- ì €ì¥/ë¡œë“œ ê´€ë ¨ í•¸ë“¤ëŸ¬ ---
  const handleSave = (slotId: string) => {
    if (saveToSlot(slotId)) {
      alert(`${slotId === 'auto' ? 'ìë™ ì €ì¥' : `ìŠ¬ë¡¯ ${slotId}`}ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      refreshSlots();
    }
  };

  const handleLoad = (slotId: string) => {
    if (!slots[slotId]) return;
    if (confirm(`[Slot ${slotId}] ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\ní˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë‚´ìš©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.`)) {
      if (loadFromSlot(slotId, heroes)) {
        alert('ë¡œë“œ ì™„ë£Œ! ê²Œì„ì„ ì¬ì‹œì‘í•©ë‹ˆë‹¤.');
        window.location.reload();
      }
    }
  };

  const handleDelete = (e: React.MouseEvent, slotId: string) => {
    e.stopPropagation();
    if (confirm('ì´ ìŠ¬ë¡¯ì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      deleteSlot(slotId);
      refreshSlots();
    }
  };

  // --- ì˜µì…˜/ì„¤ì • ê´€ë ¨ í•¸ë“¤ëŸ¬ ---
  const saveAISettings = () => {
    updateAIConfig(aiSettings);
    alert("âœ… AI ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
  };

  const handleStatReset = () => {
    if (confirm('ëª¨ë“  ì±”í”¼ì–¸ì˜ ëˆ„ì  í†µê³„(ìŠ¹ë¥ , KDA, íŒìˆ˜)ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      resetHeroStats();
      alert('í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleSafeReset = () => {
    if(confirm('í˜„ì¬ ê²Œì„ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì €ì¥ëœ ìŠ¬ë¡¯ê³¼ ì„¤ì •ì€ ìœ ì§€ë©ë‹ˆë‹¤.)')) {
      hardReset(); 
      window.location.reload();
    }
  };

  // --- [ì‹ ê·œ] MOD ë°ì´í„° í•¸ë“¤ëŸ¬ ---
  const handleExportMod = () => {
    const modData = {
      version: 1,
      heroes: heroes,
      items: shopItems,
      settings: {
        battle: gameState.battleSettings,
        field: gameState.fieldSettings,
        role: gameState.roleSettings
      },
      images: gameState.customImages
    };

    const json = JSON.stringify(modData);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `GodsWar_ModData_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
  };

  const handleImportMod = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    if (!confirm('ì´ MOD íŒŒì¼(ì˜ì›…/ì•„ì´í…œ/ì„¤ì •/ì‚¬ì§„)ì„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n* ì£¼ì˜: í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë­í‚¹ì´ë‚˜ ìŠ¹ë¥  ë°ì´í„°ëŠ” ìœ ì§€ë˜ì§€ë§Œ, ì˜ì›…ì˜ ì´ë¦„ì´ë‚˜ ëŠ¥ë ¥ì¹˜ëŠ” ë³€ê²½ë©ë‹ˆë‹¤.')) {
      e.target.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const json = JSON.parse(ev.target?.result as string);
        if (json.heroes && json.settings) {
          loadModData(json);
          alert('âœ… MOD ë°ì´í„° ì ìš© ì™„ë£Œ!\nê²Œì„ ì„¤ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
          alert('âŒ ì˜¬ë°”ë¥´ì§€ ì•Šì€ MOD íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
        }
      } catch (err) {
        console.error(err);
        alert('âŒ íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };
    reader.readAsText(file);
    e.target.value = ''; // ì´ˆê¸°í™”
  };

  // --- UI ì»´í¬ë„ŒíŠ¸ ---
  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget) onClose();
  };

  const SlotItem = ({ id, label, isAuto = false }: { id: string, label: string, isAuto?: boolean }) => {
    const meta = slots[id];
    const isEmpty = !meta;
    return (
      <div 
        onClick={() => activeTab === 'SAVE' ? handleSave(id) : handleLoad(id)}
        style={{ 
          background: isEmpty ? '#222' : '#2a2a2e', border: '1px solid #444', borderRadius: '8px', padding: '15px', marginBottom: '10px',
          cursor: 'pointer', display: 'flex', justifyContent: 'space-between', alignItems: 'center', transition: '0.2s',
          opacity: (activeTab === 'LOAD' && isEmpty) ? 0.5 : 1, pointerEvents: (activeTab === 'LOAD' && isEmpty) ? 'none' : 'auto'
        }}
        onMouseEnter={e => e.currentTarget.style.borderColor = '#58a6ff'} onMouseLeave={e => e.currentTarget.style.borderColor = '#444'}
      >
        <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
          <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: isAuto ? '#e89d40' : '#58a6ff', color: '#000', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 'bold' }}>{isAuto ? 'A' : id}</div>
          <div>
            <div style={{ fontWeight: 'bold', color: isEmpty ? '#777' : '#fff', fontSize: '14px' }}>{label}</div>
            {isEmpty ? <div style={{ fontSize: '12px', color: '#555' }}>ë¹„ì–´ ìˆìŒ</div> : <div style={{ fontSize: '11px', color: '#aaa', marginTop: '4px' }}>Day {meta.day} â€¢ ìœ ì € {meta.totalUsers.toLocaleString()}ëª… <br/><span style={{ color: '#666' }}>{meta.dateStr}</span></div>}
          </div>
        </div>
        <div style={{ display:'flex', gap:'10px' }}>
            {activeTab === 'SAVE' && <div style={{ fontSize:'12px', color:'#58a6ff', fontWeight:'bold' }}>{isEmpty ? 'ì €ì¥í•˜ê¸°' : 'ë®ì–´ì“°ê¸°'}</div>}
            {!isEmpty && activeTab === 'SAVE' && <button onClick={(e) => handleDelete(e, id)} style={{ background:'none', border:'none', color:'#da3633', cursor:'pointer' }}><Trash2 size={16} /></button>}
        </div>
      </div>
    );
  };

  return (
    <div onClick={handleBackdropClick} style={{ position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', backgroundColor: 'rgba(0,0,0,0.85)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 9999, backdropFilter: 'blur(5px)', padding: '10px' }}>
      <div className="panel" style={{ width: '100%', maxWidth: '450px', maxHeight: '90vh', background: '#1c1c1f', border: '1px solid #30363d', display:'flex', flexDirection:'column', padding:0, overflow: 'hidden', borderRadius: '12px' }}>

        {/* í—¤ë” */}
        <div style={{ padding: '15px 20px', borderBottom: '1px solid #333', display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: '#252528', flexShrink: 0 }}>
          <h3 style={{ margin: 0, color: '#fff', fontSize: '16px' }}>ì‹œìŠ¤í…œ ë©”ë‰´</h3>
          <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding:'5px' }}><X size={24} /></button>
        </div>

        {/* íƒ­ ë²„íŠ¼ */}
        <div style={{ display: 'flex', background: '#161b22', borderBottom: '1px solid #333', flexShrink: 0 }}>
          {([
            { id: 'SAVE', label: 'ì €ì¥', icon: Save },
            { id: 'LOAD', label: 'ë¶ˆëŸ¬ì˜¤ê¸°', icon: Disc },
            { id: 'OPTION', label: 'ì˜µì…˜', icon: AlertTriangle }
          ] as const).map(t => (
            <button key={t.id} onClick={() => setActiveTab(t.id)} style={{ flex: 1, padding: '15px', background: 'none', border: 'none', borderBottom: activeTab === t.id ? '2px solid #58a6ff' : '2px solid transparent', color: activeTab === t.id ? '#fff' : '#777', fontWeight: 'bold', cursor: 'pointer', display:'flex', alignItems:'center', justifyContent:'center', gap:'8px' }}>
              <t.icon size={16} /> {t.label}
            </button>
          ))}
        </div>

        {/* ë©”ì¸ ì»¨í…ì¸  */}
        <div style={{ flex: 1, overflowY: 'auto', padding: '20px' }}>

          {(activeTab === 'SAVE' || activeTab === 'LOAD') && (
            <>
              <div style={{ fontSize:'12px', color:'#888', marginBottom:'15px', textAlign:'center' }}>{activeTab === 'SAVE' ? 'ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì—¬ ì €ì¥í•˜ì„¸ìš”.' : 'ë¶ˆëŸ¬ì˜¬ ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì„¸ìš”.'}</div>
              <SlotItem id="auto" label="ìë™ ì €ì¥ ìŠ¬ë¡¯ (Auto)" isAuto />
              <div style={{ height:'10px' }}></div>
              <SlotItem id="1" label="ì €ì¥ ìŠ¬ë¡¯ 1" />
              <SlotItem id="2" label="ì €ì¥ ìŠ¬ë¡¯ 2" />
              <SlotItem id="3" label="ì €ì¥ ìŠ¬ë¡¯ 3" />
            </>
          )}

          {activeTab === 'OPTION' && (
            <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>
               {/* 1. AI ì„¤ì • */}
               <div style={{ background: '#161b22', padding: '15px', borderRadius: '8px', border: '1px solid #30363d' }}>
                  <h4 style={{ margin:'0 0 15px 0', color:'#58a6ff', display:'flex', alignItems:'center', gap:'6px', fontSize:'14px' }}><Bot size={16}/> ì»¤ë®¤ë‹ˆí‹° AI ì„¤ì •</h4>
                  <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'12px' }}>
                    <span style={{ fontSize:'13px', color:'#fff' }}>AI ê¸€ì‘ì„± í™œì„±í™”</span>
                    <input type="checkbox" checked={aiSettings.enabled} onChange={e => setAiSettings({...aiSettings, enabled: e.target.checked})} style={{ transform:'scale(1.2)', cursor:'pointer' }}/>
                  </div>
                  <div style={{ marginBottom:'12px' }}>
                    <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'4px' }}>AI ëª¨ë¸ ì œê³µì</div>
                    <select value={aiSettings.provider} onChange={e => setAiSettings({...aiSettings, provider: e.target.value as any})} style={{ width:'100%', padding:'8px', background:'#0d1117', border:'1px solid #30363d', color:'#fff', borderRadius:'4px' }}>
                      <option value="GEMINI">Google Gemini (ë¬´ë£Œ/ë¹ ë¦„)</option>
                      <option value="OPENAI">OpenAI GPT (ìœ ë£Œ/ê³ ì„±ëŠ¥)</option>
                    </select>
                  </div>
                  <div style={{ marginBottom:'12px' }}>
                    <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'4px' }}>ì‚¬ìš©í•  ëª¨ë¸ëª…</div>
                    <input type="text" value={aiSettings.model} onChange={e => setAiSettings({...aiSettings, model: e.target.value})} placeholder="ì˜ˆ: gemini-2.5-flash" style={{ width:'100%', padding:'8px', background:'#0d1117', border:'1px solid #30363d', color:'#fff', borderRadius:'4px', boxSizing:'border-box' }}/>
                  </div>
                  <div style={{ marginBottom:'15px' }}>
                    <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'4px' }}>API Key</div>
                    <div style={{ display:'flex', alignItems:'center', gap:'8px', background:'#0d1117', border:'1px solid #30363d', borderRadius:'4px', padding:'0 8px' }}>
                      <Key size={14} color="#666"/>
                      <input type="password" value={aiSettings.apiKey} onChange={e => setAiSettings({...aiSettings, apiKey: e.target.value})} placeholder="API í‚¤ ì…ë ¥..." style={{ flex:1, padding:'8px 0', background:'none', border:'none', color:'#fff', outline:'none' }}/>
                    </div>
                  </div>
                  <button onClick={saveAISettings} className="btn" style={{ width:'100%', background:'#238636', color:'#fff', display:'flex', justifyContent:'center', alignItems:'center', gap:'6px', padding:'10px' }}><CheckCircle size={16}/> ì„¤ì • ì €ì¥</button>
               </div>

               <div style={{ borderTop: '1px solid #333', margin: '5px 0' }}></div>

               {/* 2. íŒŒì¼ ê´€ë¦¬ */}
               <h4 style={{ margin:'0 0 10px 0', color:'#ccc' }}>íŒŒì¼ ê´€ë¦¬</h4>

               {/* [ì‹ ê·œ] MOD ë°ì´í„° ê³µìœ  ì„¹ì…˜ */}
               <div style={{ background: '#21262d', padding: '15px', borderRadius: '8px', border: '1px dashed #58a6ff', marginBottom: '10px' }}>
                 <div style={{ fontSize: '13px', color: '#58a6ff', fontWeight: 'bold', marginBottom: '5px', display:'flex', alignItems:'center', gap:'6px' }}>
                   <Share2 size={14}/> ê²Œì„ ì„¤ì •(MOD) ê³µìœ 
                 </div>
                 <div style={{ fontSize: '11px', color: '#8b949e', marginBottom: '10px' }}>
                   ë‚´ê°€ ë§Œë“  ì˜ì›…, ì•„ì´í…œ, ë°¸ëŸ°ìŠ¤ ì„¤ì •, ì‚¬ì§„ì„<br/>íŒŒì¼ë¡œ ì €ì¥í•˜ì—¬ ì¹œêµ¬ì—ê²Œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
                   <span style={{color:'#ccc'}}>(ë­í‚¹/ì „ì  ë“± ì§„í–‰ ìƒí™©ì€ í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)</span>
                 </div>
                 <div style={{ display: 'flex', gap: '10px' }}>
                   <button onClick={handleExportMod} className="btn" style={{ flex: 1, background: '#1f6feb', color: '#fff', border:'none', fontSize:'12px', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px' }}>
                     <Download size={14}/> ì„¤ì • ë‚´ë³´ë‚´ê¸°
                   </button>
                   <button onClick={() => modInputRef.current?.click()} className="btn" style={{ flex: 1, background: '#238636', color: '#fff', border:'none', fontSize:'12px', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px' }}>
                     <FileJson size={14}/> ì„¤ì • ì ìš©í•˜ê¸°
                   </button>
                   <input type="file" ref={modInputRef} onChange={handleImportMod} style={{ display: 'none' }} accept=".json" />
                 </div>
               </div>

               {/* ì „ì²´ ì„¸ì´ë¸Œ ë°±ì—… */}
               <div style={{ display: 'flex', gap: '10px' }}>
                 <button onClick={exportSaveFile} className="btn" style={{ flex:1, background: '#30363d', border:'1px solid #444', color: '#ccc', padding: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px', fontSize:'12px' }}>
                   <Download size={14} /> ì „ì²´ ì„¸ì´ë¸Œ ë°±ì—…
                 </button>
                 <button onClick={() => fileInputRef.current?.click()} className="btn" style={{ flex:1, background: '#30363d', border:'1px solid #444', color: '#ccc', padding: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px', fontSize:'12px' }}>
                   <Upload size={14} /> ì „ì²´ ì„¸ì´ë¸Œ ë³µêµ¬
                 </button>
                 <input type="file" ref={fileInputRef} onChange={async (e) => {
                   const file = e.target.files?.[0];
                   if(file && await importSaveFile(file, heroes)) {
                      alert('ë¡œë“œ ì„±ê³µ!'); window.location.reload();
                   }
                 }} style={{ display: 'none' }} accept=".json" />
               </div>

               <div style={{ borderTop: '1px solid #333', margin: '10px 0' }}></div>

               {/* 3. ì´ˆê¸°í™” */}
               <h4 style={{ margin:'0 0 10px 0', color:'#da3633' }}>ê²Œì„ ì´ˆê¸°í™”</h4>
               <div style={{ background: '#251010', padding: '15px', borderRadius: '8px', border: '1px solid #4a1e1e', marginBottom: '10px' }}>
                 <div style={{ fontSize: '12px', color: '#ff7b72', marginBottom: '10px', lineHeight: '1.4' }}>
                   <b>í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê²Œì„</b>ë§Œ Day 1ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.<br/>
                   <span style={{ color:'#fff', opacity:0.7 }}>* ì €ì¥ëœ ìŠ¬ë¡¯ê³¼ AI ì„¤ì •ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
                 </div>
                 <button onClick={handleSafeReset} className="btn" style={{ background: '#da3633', color: '#fff', width: '100%', display:'flex', alignItems:'center', justifyContent:'center', gap:'8px' }}>
                   <Trash2 size={16} /> í˜„ì¬ ê²Œì„ ì¬ì‹œì‘ (Day 1)
                 </button>
               </div>
               <div style={{ background: '#2d1b08', padding: '15px', borderRadius: '8px', border: '1px solid #633c0d' }}>
                 <div style={{ fontSize: '12px', color: '#e89d40', marginBottom: '10px' }}>
                   í˜„ì¬ ì§„í–‰ ìƒí™©ì€ ìœ ì§€í•˜ê³  í†µê³„ë§Œ 0ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.
                 </div>
                 <button onClick={handleStatReset} className="btn" style={{ background: '#d29922', color: '#000', width: '100%', display:'flex', alignItems:'center', justifyContent:'center', gap:'8px', fontWeight:'bold' }}>
                   <RefreshCw size={16} /> í†µê³„ë§Œ ì´ˆê¸°í™”
                 </button>
               </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

// === FILE: /src/components/community/CommunityBoard.tsx ===

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Star, ThumbsUp } from 'lucide-react';
import { Post } from '../../types';

export const CommunityBoard: React.FC = () => {
  const { communityPosts, openPost } = useGameStore();
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  const [tab, setTab] = useState<'all' | 'best'>('all');
  const [page, setPage] = useState(1);

  const POSTS_PER_PAGE = isMobile ? 15 : 20;

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  const handleTabChange = (newTab: 'all' | 'best') => {
    setTab(newTab);
    setPage(1);
  };

  const filteredPosts = tab === 'best' 
    ? communityPosts.filter(p => p.isBest || p.upvotes >= 10) 
    : communityPosts;

  const totalPages = Math.ceil(filteredPosts.length / POSTS_PER_PAGE);
  const startIndex = (page - 1) * POSTS_PER_PAGE;
  const currentPosts = filteredPosts.slice(startIndex, startIndex + POSTS_PER_PAGE);

  const getCategoryColor = (cat: string) => {
    switch (cat) {
      case 'ê³µëµ': return '#58a6ff'; 
      case 'ë¶„ì„': return '#58a6ff';
      case 'ì§•ì§•': return '#e84057'; 
      case 'ìœ ë¨¸': return '#f1c40f'; 
      case 'ìë‘': return '#2ecc71';
      default: return '#8b949e';     
    }
  };

  // [ìˆ˜ì •ë¨] post íƒ€ì… ëª…ì‹œ
  const MobilePostItem = ({ post }: { post: Post }) => (
    <div 
      onClick={() => openPost(post)}
      style={{ 
        padding: '12px 15px', 
        borderBottom: '1px solid #2c2c2f', 
        background: post.isBest ? 'rgba(232, 64, 87, 0.05)' : '#1c1c1f',
        cursor: 'pointer'
      }}
    >
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '6px', lineHeight: '1.4' }}>
        {post.isBest && (
          <span style={{ fontSize:'10px', background:'#e84057', color:'#fff', padding:'1px 4px', borderRadius:'3px', marginRight:'6px', flexShrink:0 }}>
            BEST
          </span>
        )}
        <span style={{ 
          color: '#e6edf3', 
          fontSize: '15px', 
          fontWeight: post.isBest ? 'bold' : 'normal',
          overflow: 'hidden', textOverflow: 'ellipsis', display: '-webkit-box', WebkitLineClamp: 1, WebkitBoxOrient: 'vertical'
        }}>
          {post.title}
        </span>
        {post.comments > 0 && (
          <span style={{ color:'#58a6ff', fontSize:'13px', marginLeft:'6px', fontWeight:'bold', flexShrink:0 }}>
            [{post.comments}]
          </span>
        )}
      </div>

      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', fontSize: '12px', color: '#8b949e' }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
          <span style={{ color: getCategoryColor(post.category), fontWeight:'bold' }}>{post.category}</span>
          <span style={{ width:'1px', height:'10px', background:'#444' }}></span>
          <span>{post.author}</span>
          <span style={{ width:'1px', height:'10px', background:'#444' }}></span>
          <span>{post.displayTime}</span>
        </div>

        {post.upvotes > 0 && (
          <div style={{ display: 'flex', alignItems: 'center', gap: '4px', color: post.upvotes >= 10 ? '#e84057' : '#8b949e' }}>
            <ThumbsUp size={12} />
            <span>{post.upvotes}</span>
          </div>
        )}
      </div>
    </div>
  );

  return (
    <div className="panel" style={{ 
      height: isMobile ? '80vh' : '700px', 
      position: 'relative', zIndex: 10,
      background: '#1c1c1f', border: '1px solid #30363d', 
      display:'flex', flexDirection:'column', padding: 0, overflow:'hidden'
    }}>
      <div style={{ padding: '12px 15px', borderBottom: '1px solid #333', background: '#252528', display:'flex', justifyContent:'space-between', alignItems:'center', flexShrink: 0 }}>
        <h3 style={{ margin: 0, color:'#fff', fontSize: '16px', fontWeight: '800' }}>ì˜¤ë¼í´ ììœ ê²Œì‹œíŒ</h3>
        <div style={{ display:'flex', background:'#161b22', borderRadius:'6px', padding:'3px' }}>
          <button onClick={() => handleTabChange('all')} style={{ padding: '6px 12px', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold', fontSize:'12px', background: tab === 'all' ? '#30363d' : 'transparent', color: tab === 'all' ? '#fff' : '#666' }}>ì „ì²´</button>
          <button onClick={() => handleTabChange('best')} style={{ padding: '6px 12px', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: 'bold', fontSize:'12px', background: tab === 'best' ? '#e84057' : 'transparent', color: tab === 'best' ? '#fff' : '#666', display:'flex', alignItems:'center', gap:'4px' }}><Star size={12}/> ë…ê¸€</button>
        </div>
      </div>

      <div style={{ flex: 1, overflowY: 'auto', background: '#161b22' }}>
        {isMobile ? (
          <div>{currentPosts.map((post) => <MobilePostItem key={post.id} post={post} />)}</div>
        ) : (
          <table style={{ width: '100%', borderCollapse: 'collapse', fontSize:'13px', tableLayout:'fixed' }}>
            <thead>
              <tr style={{ background:'#161b22', color:'#8b949e', height:'35px', borderBottom:'1px solid #333' }}>
                <th style={{ width:'50px', textAlign:'center' }}>ë²ˆí˜¸</th>
                <th style={{ width:'60px', textAlign:'center' }}>íƒ­</th>
                <th style={{ textAlign:'left', paddingLeft:'10px' }}>ì œëª©</th>
                <th style={{ width:'100px', textAlign:'center' }}>ê¸€ì“´ì´</th>
                <th style={{ width:'70px', textAlign:'center' }}>ì‹œê°„</th>
                <th style={{ width:'50px', textAlign:'center' }}>ì¡°íšŒ</th>
                <th style={{ width:'50px', textAlign:'center' }}>ì¶”ì²œ</th>
              </tr>
            </thead>
            <tbody>
              {currentPosts.map((post, idx) => (
                <tr key={post.id} onClick={() => openPost(post)} style={{ borderBottom:'1px solid #252528', cursor:'pointer', height:'36px', background: post.isBest ? 'rgba(232, 64, 87, 0.05)' : 'transparent' }} onMouseEnter={e => e.currentTarget.style.backgroundColor = '#222'} onMouseLeave={e => e.currentTarget.style.backgroundColor = post.isBest ? 'rgba(232, 64, 87, 0.05)' : 'transparent'}>
                  <td style={{ textAlign:'center', color:'#555' }}>{filteredPosts.length - (startIndex + idx)}</td>
                  <td style={{ textAlign:'center', color: getCategoryColor(post.category) }}>{post.category}</td>
                  <td style={{ padding:'0 10px', overflow:'hidden', whiteSpace:'nowrap', textOverflow:'ellipsis' }}>
                    <span style={{ color: post.isBest ? '#fff' : '#ddd', fontWeight: post.isBest ? 'bold' : 'normal' }}>{post.title}</span>
                    {post.comments > 0 && <span style={{ color:'#58a6ff', fontSize:'11px', marginLeft:'6px', fontWeight:'bold' }}>[{post.comments}]</span>}
                  </td>
                  <td style={{ textAlign:'center', color:'#888', overflow:'hidden', whiteSpace:'nowrap', textOverflow:'ellipsis' }}>{post.author}</td>
                  <td style={{ textAlign:'center', color:'#666' }}>{post.displayTime}</td>
                  <td style={{ textAlign:'center', color:'#666' }}>{post.views}</td>
                  <td style={{ textAlign:'center', color: post.upvotes > 0 ? '#e84057' : '#666' }}>{post.upvotes}</td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
        {currentPosts.length === 0 && <div style={{ textAlign:'center', padding:'40px', color:'#555', fontSize:'13px' }}>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>}
      </div>

      <div style={{ padding: '12px', borderTop: '1px solid #333', display: 'flex', justifyContent: 'center', gap: '10px', background: '#161b22', flexShrink: 0 }}>
        <button disabled={page === 1} onClick={() => setPage(p => Math.max(1, p - 1))} className="btn" style={{ background:'#333', color:'#fff', padding:'6px 12px', opacity: page===1?0.5:1, fontSize:'12px' }}>ì´ì „</button>
        <span style={{ display:'flex', alignItems:'center', color:'#fff', padding:'0 10px', fontSize:'13px', fontFamily:'monospace' }}>{page} / {totalPages || 1}</span>
        <button disabled={page >= totalPages} onClick={() => setPage(p => Math.min(totalPages, p + 1))} className="btn" style={{ background:'#333', color:'#fff', padding:'6px 12px', opacity: page>=totalPages?0.5:1, fontSize:'12px' }}>ë‹¤ìŒ</button>
      </div>
    </div>
  );
};


// === FILE: /src/components/community/PostDetailModal.tsx ===

// ==========================================
// FILE PATH: /src/components/community/PostDetailModal.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { Post, UserProfile } from '../../types';
import { useGameStore } from '../../store/useGameStore';
import { findUserProfileByName } from '../../engine/UserManager';
import { X, MessageSquare, ThumbsUp, ThumbsDown, User, Clock, Eye } from 'lucide-react';

interface Props {
  post: Post;
  onClose: () => void;
  onUserClick: (user: UserProfile) => void;
}

// [ì‹ ê·œ] í‹°ì–´ë³„ ìƒ‰ìƒ ë°˜í™˜ í•¨ìˆ˜
const getTierColor = (tier: string) => {
  if (tier.includes('ì²œìƒê³„') || tier.includes('ì±Œë¦°ì €')) return '#00bfff'; // í•˜ëŠ˜ìƒ‰
  if (tier.includes('ë§ˆìŠ¤í„°')) return '#9b59b6'; // ë³´ë¼ìƒ‰
  if (tier.includes('ì—ì´ìŠ¤')) return '#e74c3c'; // ë¹¨ê°„ìƒ‰
  if (tier.includes('ì¡°ì»¤')) return '#2ecc71';   // ì´ˆë¡ìƒ‰
  if (tier.includes('ê³¨ë“œ')) return '#f1c40f';   // ê¸ˆìƒ‰
  if (tier.includes('ì‹¤ë²„')) return '#95a5a6';   // ì€ìƒ‰
  if (tier.includes('ë¸Œë¡ ì¦ˆ')) return '#d35400'; // ë™ìƒ‰
  return '#7f8c8d'; // ì•„ì´ì–¸/ê¸°íƒ€ (íšŒìƒ‰)
};

export const PostDetailModal: React.FC<Props> = ({ post, onClose, onUserClick }) => {
  const { gameState } = useGameStore();
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  useEffect(() => {
    document.body.style.overflow = 'hidden';
    return () => { document.body.style.overflow = 'unset'; };
  }, []);

  const handleAuthorClick = () => {
    const userProfile = findUserProfileByName(post.author, gameState.tierConfig);
    if (userProfile) {
      onUserClick(userProfile);
    } else {
      alert("í•´ë‹¹ ìœ ì € ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
  };

  const overlayStyle: React.CSSProperties = isMobile ? {
    position: 'fixed', inset: 0, zIndex: 20000, 
    backgroundColor: '#0f1115',
    overflowY: 'auto', WebkitOverflowScrolling: 'touch',
    display: 'block'
  } : {
    position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',
    backgroundColor: 'rgba(0,0,0,0.85)', display: 'flex', justifyContent: 'center', alignItems: 'center', 
    zIndex: 20000, backdropFilter: 'blur(3px)'
  };

  const panelStyle: React.CSSProperties = isMobile ? {
    width: '100%', minHeight: '100%', 
    background: '#1c1c1f', display: 'flex', flexDirection: 'column',
    boxSizing: 'border-box'
  } : {
    width: '100%', maxWidth: '700px', height:'85vh', 
    background: '#1c1c1f', border: '1px solid #30363d', 
    display:'flex', flexDirection:'column', borderRadius: '12px', overflow: 'hidden',
    boxShadow: '0 50px 100px -20px rgba(0,0,0,0.7)'
  };

  return (
    <div style={overlayStyle}>
      <div style={panelStyle}>

        {/* í—¤ë” */}
        <div style={{ 
          padding: '15px 20px', borderBottom: '1px solid #30363d', 
          display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start',
          background: '#252528',
          position: isMobile ? 'sticky' : 'relative', top: 0, zIndex: 50
        }}>
          <div style={{ flex: 1, paddingRight: '10px' }}>
            <div style={{ display:'flex', alignItems:'center', gap:'8px', marginBottom: '6px' }}>
              <span style={{ fontSize: '11px', color: '#58a6ff', border:'1px solid #58a6ff', padding:'1px 4px', borderRadius:'3px' }}>
                {post.category}
              </span>
              {post.isBest && <span style={{ fontSize: '11px', background: '#e84057', color: '#fff', padding:'1px 4px', borderRadius:'3px' }}>ë…ê¸€</span>}
            </div>
            <h2 style={{ margin: 0, fontSize: '18px', color: '#fff', lineHeight:'1.4', wordBreak:'keep-all' }}>{post.title}</h2>

            <div style={{ marginTop: '10px', fontSize: '12px', color: '#8b949e', display:'flex', flexWrap:'wrap', alignItems:'center', gap:'10px' }}>
              <div 
                onClick={handleAuthorClick}
                style={{ 
                  display:'flex', alignItems:'center', gap:'4px', cursor:'pointer', 
                  color: '#ccc', fontWeight:'bold', 
                  background: '#30363d', padding: '4px 8px', borderRadius: '4px',
                  border: '1px solid #444'
                }}
              >
                <User size={12} />
                {post.author} 
                {/* ì‘ì„±ì í‹°ì–´ ìƒ‰ìƒ ì ìš© */}
                <span style={{color: getTierColor(post.authorTier), fontWeight:'bold', fontSize:'11px'}}>
                  ({post.authorTier})
                </span>
              </div>

              <span style={{ display:'flex', alignItems:'center', gap:'4px' }}><Clock size={12}/> {post.displayTime}</span>
              <span style={{ display:'flex', alignItems:'center', gap:'4px' }}><Eye size={12}/> {post.views}</span>
            </div>
          </div>
          <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding:'5px' }}>
            <X size={24} />
          </button>
        </div>

        {/* ë³¸ë¬¸ */}
        <div style={{ 
          padding: '25px 20px', 
          color: '#e6edf3', fontSize: '15px', lineHeight: '1.7', 
          flex: 1, 
          overflowY: isMobile ? 'visible' : 'auto', 
          whiteSpace: 'pre-wrap',
          minHeight: '200px'
        }}>
          {post.content}

          <div style={{ marginTop:'50px', display:'flex', justifyContent:'center', gap:'15px' }}>
            <button style={{ 
              background:'#21262d', border:'1px solid #30363d', color:'#fff', 
              padding:'10px 20px', borderRadius:'30px', 
              display:'flex', alignItems:'center', gap:'8px', cursor:'pointer',
              fontSize:'14px', fontWeight:'bold'
            }}>
              <ThumbsUp size={18} color="#e89d40" /> 
              <span>{post.upvotes}</span>
            </button>

            <button style={{ 
              background:'#21262d', border:'1px solid #30363d', color:'#8b949e', 
              padding:'10px 20px', borderRadius:'30px', 
              display:'flex', alignItems:'center', gap:'8px', cursor:'pointer',
              fontSize:'14px', fontWeight:'bold'
            }}>
              <ThumbsDown size={18} /> 
              <span>{post.downvotes || 0}</span>
            </button>
          </div>
        </div>

        {/* ëŒ“ê¸€ì°½ */}
        <div style={{ background: '#161b22', borderTop: '1px solid #30363d', flexShrink: 0 }}>
          <div style={{ padding: '15px 20px', display:'flex', alignItems:'center', gap:'6px', color:'#fff', borderBottom:'1px solid #30363d', background:'#252528' }}>
            <MessageSquare size={16} /> ëŒ“ê¸€ <span style={{color:'#58a6ff', fontWeight:'bold'}}>{post.commentList?.length || 0}</span>
          </div>

          <div style={{ 
            maxHeight: isMobile ? 'none' : '300px', 
            overflowY: isMobile ? 'visible' : 'auto',
            paddingBottom: isMobile ? '50px' : '0' 
          }}>
            <div style={{ display:'flex', flexDirection:'column' }}>
              {post.commentList && post.commentList.map((comment) => (
                <div key={comment.id} style={{ padding: '15px 20px', borderBottom: '1px solid #2c2c2f' }}>
                  <div style={{ display:'flex', justifyContent:'space-between', marginBottom:'6px' }}>
                    <span style={{ fontWeight:'bold', fontSize:'13px', color:'#ccc', display:'flex', alignItems:'center', gap:'6px' }}>
                      {comment.author} 
                      {/* ëŒ“ê¸€ ì‘ì„±ì í‹°ì–´ ìƒ‰ìƒ ì ìš© */}
                      <span style={{
                        fontSize:'10px', 
                        color: getTierColor(comment.authorTier), 
                        background:'#0d1117', 
                        padding:'1px 4px', 
                        borderRadius:'3px', 
                        border:'1px solid #333',
                        fontWeight:'bold'
                      }}>
                        {comment.authorTier}
                      </span>
                    </span>
                    <span style={{ fontSize:'11px', color:'#555' }}>{comment.timestamp}</span>
                  </div>
                  <div style={{ fontSize:'13px', color:'#aaa', lineHeight:'1.4' }}>{comment.content}</div>
                </div>
              ))}

              {(!post.commentList || post.commentList.length === 0) && (
                <div style={{ color:'#555', fontSize:'13px', textAlign:'center', padding:'40px 20px' }}>
                  ì•„ì§ ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
              )}
            </div>
          </div>
        </div>

      </div>
    </div>
  );
};

// === FILE: /src/components/dashboard/GameStats.tsx ===

// ==========================================
// FILE PATH: /src/components/dashboard/GameStats.tsx
// ==========================================

import React from 'react';
import { useGameStore } from '../../store/useGameStore';
import { StatCard } from '../common/StatCard';
import { Users, Activity, Smile, Frown, Meh, Monitor } from 'lucide-react';

interface Props {
  isMobile: boolean;
  onOpenGameList: () => void;
}

export const GameStats: React.FC<Props> = ({ isMobile, onOpenGameList }) => {
  const { gameState } = useGameStore();

  // ë¯¼ì‹¬ ìƒíƒœì— ë”°ë¥¸ UI ì†ì„± ë°˜í™˜
  const getSentimentInfo = (value: number) => {
    if (value >= 70) return { icon: Smile, color: '#2ecc71', label: 'ì¶•ì œ' }; // ë†’ìŒ: ì´ˆë¡
    if (value >= 40) return { icon: Meh, color: '#f1c40f', label: 'ë³´í†µ' };   // ì¤‘ê°„: ë…¸ë‘
    return { icon: Frown, color: '#e74c3c', label: 'í­ë™' };                  // ë‚®ìŒ: ë¹¨ê°•
  };

  const sentiment = gameState.userSentiment || 60;
  const sentInfo = getSentimentInfo(sentiment);

  return (
    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: isMobile ? '6px' : '15px', marginBottom: '20px' }}>

      <StatCard 
        title="ê°€ì…ì" 
        value={(gameState.totalUsers ?? 0).toLocaleString()} 
        icon={Users} 
        color="#fff" 
      />

      <StatCard 
        title="CCU" 
        value={(gameState.ccu ?? 0).toLocaleString()} 
        icon={Activity} 
        color="#58a6ff" 
      />

      {/* ë™ì  ë¯¼ì‹¬ ì¹´ë“œ */}
      <StatCard 
        title={`ë¯¼ì‹¬ (${sentInfo.label})`} 
        value={sentiment.toFixed(1)} 
        icon={sentInfo.icon} 
        color={sentInfo.color} 
      />

      <div onClick={onOpenGameList} style={{ cursor: 'pointer' }}>
        <StatCard 
          title="ì§„í–‰ì¤‘" 
          value={gameState.liveMatches?.length ?? 0} 
          icon={Monitor} 
          color="#9b59b6" 
        />
      </div>
    </div>
  );
};

// === FILE: /src/components/hero/HeroListTable.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/HeroListTable.tsx
// ==========================================

import React from 'react';
import { Hero } from '../../types';
// ğŸ‘‡ [ìˆ˜ì •] Skullì„ ì•„ì˜ˆ ëºìŠµë‹ˆë‹¤. (ì—ëŸ¬ ì›ì²œ ì°¨ë‹¨)
import { Target, Swords, Coins } from 'lucide-react'; 
import { GameIcon } from '../common/GameIcon';

interface Props {
  heroes: Hero[];
  isMobile?: boolean;
}

export const HeroListTable: React.FC<Props> = ({ heroes, isMobile = false }) => {
  const sortedHeroes = [...heroes].sort((a, b) => (a.rank || 999) - (b.rank || 999));

  if (isMobile) {
    return (
      <div style={{ overflowY: 'auto', flex: 1, padding: '10px', display: 'flex', flexDirection: 'column', gap: '8px', paddingBottom: '80px' }}>
        {sortedHeroes.map((hero) => (
          <div key={hero.id} style={{ 
            background: '#161b22', border: '1px solid #30363d', borderRadius: '12px', padding: '12px 15px',
            display: 'flex', alignItems: 'center', justifyContent: 'space-between'
          }}>
            {/* ì™¼ìª½: ìˆœìœ„, ì•„ì´ì½˜, ì´ë¦„ */}
            <div style={{ display: 'flex', alignItems: 'center', gap: '15px', flex: 1 }}>
              <div style={{ fontSize: '16px', fontWeight: '900', fontStyle: 'italic', color: hero.rank <= 3 ? '#e74c3c' : '#666', width: '20px', textAlign: 'center' }}>{hero.rank}</div>

              <GameIcon id={hero.id} size={42} fallback={<span style={{fontSize:'20px'}}>ğŸ§™â€â™‚ï¸</span>} />

              <div style={{ display: 'flex', flexDirection: 'column', gap: '3px' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                  <span style={{ fontWeight: 'bold', fontSize: '14px', color: '#fff' }}>{hero.name}</span>
                  <span className={`tier-badge tier-${hero.tier}`} style={{ fontSize: '9px', padding: '2px 5px', height: 'fit-content' }}>{hero.tier}í‹°ì–´</span>
                </div>
                <div style={{ fontSize: '11px', color: '#8b949e' }}>
                  <span style={{ color: hero.recentWinRate >= 50 ? '#ff6b6b' : '#8b949e', fontWeight: 'bold' }}>ìŠ¹ë¥  {hero.recentWinRate.toFixed(1)}%</span>
                  <span style={{ margin: '0 4px', opacity: 0.3 }}>â€¢</span>
                  <span>í”½ë¥  {hero.pickRate.toFixed(1)}%</span>
                </div>
              </div>
            </div>

            {/* ì˜¤ë¥¸ìª½: ìŠ¤íƒ¯ ì •ë³´ (Skull ì•„ì´ì½˜ ì œê±°ë¨) */}
            <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '2px', minWidth: '80px' }}>
              <div style={{ fontWeight: 'bold', fontSize: '12px', color: '#fff' }}>{hero.avgKda}</div>
              <div style={{ fontSize: '10px', color: '#e89d40', fontWeight:'bold' }}>{hero.avgGold} G</div>
              <div style={{ fontSize: '9px', color: '#888', display:'flex', gap:'6px', marginTop:'2px' }}>
                <span style={{ display:'flex', alignItems:'center', gap:'2px' }}><Target size={10}/> {hero.avgCs}</span>
                <span style={{ color: '#ff6b6b' }}>{hero.avgDpm}</span>
              </div>
            </div>
          </div>
        ))}
      </div>
    );
  }

  return (
    <div style={{ overflowX: 'auto', flex: 1, overflowY: 'auto' }}>
      <div style={{ display: 'grid', gridTemplateColumns: '40px 140px 100px 120px 140px 100px 80px 1fr', padding: '12px', background: '#0d1117', borderBottom: '1px solid #30363d', fontSize: '11px', color: '#8b949e', fontWeight: 'bold', textAlign: 'center', position: 'sticky', top: 0, zIndex: 10 }}>
        <div>ìˆœìœ„</div>
        <div style={{ textAlign: 'left', paddingLeft: '10px' }}>ì±”í”¼ì–¸</div>
        <div>ìŠ¹ë¥ </div>
        <div>í”½ë¥  / ë°´ë¥ </div>
        <div>KDA (í‚¬/ëƒ/ì–´)</div>
        <div><Target size={10} style={{ display: 'inline' }} /> CS</div>
        <div><Swords size={10} style={{ display: 'inline' }} /> DPM</div>
        <div><Coins size={10} style={{ display: 'inline' }} /> GOLD</div>
      </div>

      <div className="hero-list-compact">
        {sortedHeroes.map((hero) => (
          <div key={hero.id} className="hero-row" style={{ display: 'grid', gridTemplateColumns: '40px 140px 100px 120px 140px 100px 80px 1fr', padding: '10px 12px', borderBottom: '1px solid #2c2c2f', alignItems: 'center', fontSize: '12px', color: '#ccc', textAlign: 'center', background: '#161b22' }}>
            <div style={{ fontWeight: '900', color: '#555', fontStyle: 'italic' }}>{hero.rank}</div>

            <div style={{ textAlign: 'left', paddingLeft: '10px', display: 'flex', alignItems: 'center', gap: '8px' }}>
              <GameIcon id={hero.id} size={32} fallback={<span style={{fontSize:'16px'}}>ğŸ§™â€â™‚ï¸</span>} />

              <div style={{ display: 'flex', flexDirection: 'column' }}>
                <span style={{ fontWeight: 'bold', color: '#fff' }}>{hero.name}</span>
                <span className={`tier-badge tier-${hero.tier}`} style={{ marginLeft: 0, width: 'fit-content' }}>{hero.tier}í‹°ì–´</span>
              </div>
            </div>

            <div style={{ fontWeight: 'bold', color: hero.recentWinRate >= 50 ? '#ff6b6b' : '#4d94ff' }}>{hero.recentWinRate.toFixed(1)}%</div>
            <div style={{ fontSize: '11px', color: '#888' }}>
              <span style={{ color: '#fff' }}>{hero.pickRate.toFixed(1)}%</span> <span style={{ color: '#444' }}>|</span> <span style={{ color: '#da3633' }}>{hero.banRate.toFixed(1)}%</span>
            </div>
            <div>
              <span style={{ color: '#fff', fontWeight: 'bold', fontSize: '11px' }}>{hero.avgKda}</span>
              <span style={{ display:'block', fontSize:'10px', color:'#666' }}>({hero.kdaRatio}:1)</span>
            </div>
            <div style={{ fontFamily: 'monospace', color: '#888' }}>{hero.avgCs}</div>
            <div style={{ fontFamily: 'monospace', color: '#da3633' }}>{hero.avgDpm}</div>
            <div style={{ fontFamily: 'monospace', color: '#f1c40f' }}>{hero.avgGold}</div>
          </div>
        ))}
      </div>
    </div>
  );
};


// === FILE: /src/components/hero/HeroManagement.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/HeroManagement.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Edit3, Search, Plus, Trash2, Shield, Swords, Zap, Crosshair, Skull, Layers } from 'lucide-react';
import { Hero, Role } from '../../types';
import { GameIcon } from '../common/GameIcon'; // ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ ì•„ì´ì½˜ ì‚¬ìš©

interface Props { onEditHero: (hero: Hero) => void; }

// ì—­í• êµ° ë°ì´í„°
const ROLES: (Role | 'ALL')[] = ['ALL', 'ì§‘í–‰ê´€', 'ì¶”ì ì', 'ì„ ì§€ì', 'ì‹ ì‚´ì', 'ìˆ˜í˜¸ê¸°ì‚¬'];

const getRoleIcon = (role: string) => {
  switch(role) {
    case 'ALL': return <Layers size={14}/>;
    case 'ì§‘í–‰ê´€': return <Shield size={14}/>;
    case 'ì¶”ì ì': return <Swords size={14}/>;
    case 'ì„ ì§€ì': return <Zap size={14}/>;
    case 'ì‹ ì‚´ì': return <Crosshair size={14}/>;
    case 'ìˆ˜í˜¸ê¸°ì‚¬': return <Skull size={14}/>;
    default: return <Layers size={14}/>;
  }
};

const getRoleColor = (role: string) => {
  switch(role) {
    case 'ì§‘í–‰ê´€': return '#e74c3c';
    case 'ì¶”ì ì': return '#2ecc71';
    case 'ì„ ì§€ì': return '#3498db';
    case 'ì‹ ì‚´ì': return '#f1c40f';
    case 'ìˆ˜í˜¸ê¸°ì‚¬': return '#9b59b6';
    default: return '#8b949e';
  }
};

export const HeroManagement: React.FC<Props> = ({ onEditHero }) => {
  const { heroes, addHero, deleteHero } = useGameStore();
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedRole, setSelectedRole] = useState<Role | 'ALL'>('ALL');

  // ëª¨ë°”ì¼ ê°ì§€
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // í•„í„°ë§ ë¡œì§
  const filteredHeroes = heroes.filter(h => {
    const matchRole = selectedRole === 'ALL' || h.role === selectedRole;
    const matchSearch = h.name.includes(searchTerm) || h.role.includes(searchTerm);
    return matchRole && matchSearch;
  });

  // ì˜ì›… ìƒì„±
  const handleCreateHero = () => {
    const id = `h_custom_${Date.now()}`;
    const newHero: Hero = {
      id,
      name: "ì´ë¦„ ì—†ëŠ” ì˜ì›…",
      role: selectedRole === 'ALL' ? "ì§‘í–‰ê´€" : selectedRole, // í˜„ì¬ íƒ­ì˜ ì—­í• ë¡œ ìƒì„±
      tier: "3",
      stats: { hp: 2000, ad: 60, ap: 0, armor: 30, crit: 0, range: 150, speed: 340, regen: 10, pen: 0, baseAtk: 60 },
      skills: {
        passive: { name: "ê¸°ë³¸ íŒ¨ì‹œë¸Œ", mechanic: "NONE", val: 0, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
        q: { name: "Q ìŠ¤í‚¬", mechanic: "DAMAGE", val: 100, adRatio: 1.0, apRatio: 0, cd: 8 },
        w: { name: "W ìŠ¤í‚¬", mechanic: "NONE", val: 0, adRatio: 0, apRatio: 0, cd: 12 },
        e: { name: "E ìŠ¤í‚¬", mechanic: "DASH", val: 50, adRatio: 0, apRatio: 0, cd: 15 },
        r: { name: "R ê¶ê·¹ê¸°", mechanic: "DAMAGE", val: 300, adRatio: 1.5, apRatio: 0, cd: 100 }
      },
      record: {
        totalMatches: 0, totalWins: 0, totalPicks: 0, totalBans: 0,
        totalKills: 0, totalDeaths: 0, totalAssists: 0,
        totalDamage: 0, totalDamageTaken: 0, totalCs: 0, totalGold: 0,
        recentResults: []
      },
      rank: 999, rankChange: 0, recentWinRate: 0, pickRate: 0, banRate: 0,
      avgKda: "0.0/0.0/0.0", kdaRatio: "0.00", avgDpm: "0", avgDpg: "0", avgCs: "0", avgGold: "0"
    };
    addHero(newHero);
    onEditHero(newHero);
  };

  const handleDelete = (e: React.MouseEvent, id: string, name: string) => {
    e.stopPropagation();
    if (confirm(`ì •ë§ '${name}' ì˜ì›…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œ í›„ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, í†µê³„ ë°ì´í„°ë„ ì‚¬ë¼ì§‘ë‹ˆë‹¤.`)) {
      deleteHero(id);
    }
  };

  return (
    <div style={{ background: '#161b22', padding: isMobile ? '15px' : '20px', borderRadius: '12px', border: '1px solid #30363d', minHeight:'80vh', display:'flex', flexDirection:'column' }}>

      {/* 1. í—¤ë” & ê²€ìƒ‰ì°½ */}
      <div style={{ display: 'flex', flexDirection: isMobile ? 'column' : 'row', justifyContent: 'space-between', alignItems: isMobile ? 'stretch' : 'center', marginBottom: '15px', gap: '10px' }}>
        <h3 style={{ margin:0, color:'#fff', display:'flex', alignItems:'center', gap:'8px' }}>
          ğŸ›¡ï¸ ì˜ì›… ë°ì´í„° ê´€ë¦¬
        </h3>

        <div style={{ display:'flex', gap:'10px' }}>
          <div style={{ flex:1, display: 'flex', alignItems: 'center', gap: '10px', background: '#0d1117', padding: '8px 15px', borderRadius: '8px', border: '1px solid #30363d' }}>
            <Search size={16} color="#888" />
            <input 
              type="text" 
              placeholder="ì˜ì›… ê²€ìƒ‰..." 
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              style={{ background: 'none', border: 'none', color: '#fff', outline: 'none', width: '100%', fontSize:'13px' }}
            />
          </div>
          <button 
            onClick={handleCreateHero}
            style={{ 
              background:'#238636', color:'#fff', display:'flex', alignItems:'center', gap:'6px', 
              fontSize:'13px', whiteSpace:'nowrap', padding:'8px 16px', border:'none', borderRadius:'8px', cursor:'pointer', fontWeight:'bold'
            }}
          >
            <Plus size={16}/> {isMobile ? '' : 'ìƒˆ ì˜ì›…'}
          </button>
        </div>
      </div>

      {/* 2. í¬ì§€ì…˜ í•„í„° (ê°€ë¡œ ìŠ¤í¬ë¡¤) */}
      <div style={{ 
        display: 'flex', gap: '8px', overflowX: 'auto', paddingBottom: '10px', marginBottom: '10px',
        scrollbarWidth: 'none', msOverflowStyle: 'none' 
      }}>
        {ROLES.map(role => (
          <button
            key={role}
            onClick={() => setSelectedRole(role)}
            style={{
              padding: '8px 12px', borderRadius: '20px', border: selectedRole === role ? `1px solid ${getRoleColor(role)}` : '1px solid #30363d',
              background: selectedRole === role ? `${getRoleColor(role)}22` : '#0d1117',
              color: selectedRole === role ? getRoleColor(role) : '#8b949e',
              fontSize: '12px', fontWeight: 'bold', cursor: 'pointer', whiteSpace: 'nowrap',
              display: 'flex', alignItems: 'center', gap: '6px', flexShrink: 0
            }}
          >
            {getRoleIcon(role)} {role === 'ALL' ? 'ì „ì²´' : role}
          </button>
        ))}
      </div>

      {/* 3. ì˜ì›… ë¦¬ìŠ¤íŠ¸ (ëª¨ë°”ì¼ ìµœì í™”) */}
      <div style={{ 
        display: 'grid', 
        gridTemplateColumns: isMobile ? '1fr' : 'repeat(auto-fill, minmax(240px, 1fr))', 
        gap: '10px', flex: 1, overflowY: 'auto', alignContent: 'start'
      }}>
        {filteredHeroes.map(hero => (
          <div key={hero.id} style={{ 
            background: '#0d1117', padding: '12px', borderRadius: '10px', border: '1px solid #30363d', 
            display: 'flex', alignItems: 'center', gap: '15px', position: 'relative'
          }}>

            {/* ì¢Œì¸¡: ì‚¬ì§„ (GameIcon ì ìš©) */}
            <div onClick={() => onEditHero(hero)} style={{ cursor:'pointer' }}>
                <GameIcon id={hero.id} size={50} fallback={<span style={{fontSize:'24px'}}>ğŸ§™â€â™‚ï¸</span>} shape="rounded" border={`2px solid ${getRoleColor(hero.role)}44`}/>
            </div>

            {/* ì¤‘ì•™: ì •ë³´ */}
            <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '2px' }} onClick={() => onEditHero(hero)}>
              <div style={{ display:'flex', alignItems:'center', gap:'6px' }}>
                <span style={{ fontSize: '10px', color: getRoleColor(hero.role), border: `1px solid ${getRoleColor(hero.role)}44`, padding:'1px 4px', borderRadius:'3px', fontWeight:'bold' }}>
                  {hero.role}
                </span>
                {hero.id.startsWith('h_custom') && (
                  <span style={{ fontSize:'9px', background:'#1f6feb', color:'#fff', padding:'1px 4px', borderRadius:'3px' }}>NEW</span>
                )}
              </div>
              <strong style={{ fontSize: '15px', color: '#fff', cursor:'pointer' }}>{hero.name}</strong>
              <div style={{ fontSize: '11px', color: '#666' }}>
                ìŠ¹ë¥  {hero.recentWinRate.toFixed(1)}% â€¢ {hero.tier}í‹°ì–´
              </div>
            </div>

            {/* ìš°ì¸¡: ë²„íŠ¼ */}
            <div style={{ display:'flex', flexDirection: isMobile ? 'row' : 'column', gap:'6px' }}>
              <button onClick={() => onEditHero(hero)} style={{ background: '#21262d', border: '1px solid #30363d', color: '#fff', padding: '8px', borderRadius: '6px', cursor: 'pointer' }}>
                <Edit3 size={16} />
              </button>

              <button onClick={(e) => handleDelete(e, hero.id, hero.name)} style={{ background: '#3f1515', border: '1px solid #5a1e1e', color: '#ff6b6b', padding: '8px', borderRadius: '6px', cursor: 'pointer' }}>
                <Trash2 size={16} />
              </button>
            </div>

          </div>
        ))}

        {filteredHeroes.length === 0 && (
          <div style={{ gridColumn: '1/-1', textAlign: 'center', padding: '40px', color: '#555' }}>
            í•´ë‹¹í•˜ëŠ” ì˜ì›…ì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        )}
      </div>

    </div>
  );
};

// === FILE: /src/components/hero/HeroStatsView.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/HeroStatsView.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Award, LayoutGrid, List } from 'lucide-react';
import { Role } from '../../types';
import { HeroListTable } from './HeroListTable';
import { LaneStatsView } from './LaneStatsView';

export const HeroStatsView = () => {
  const { heroes } = useGameStore();
  const [mode, setMode] = useState<'HERO' | 'LANE'>('HERO');
  const [selectedRole, setSelectedRole] = useState<Role>('ì§‘í–‰ê´€');
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return (
    <div className="stats-container" style={{ 
      background: '#161b22', borderRadius: '12px', border: '1px solid #30363d', 
      minHeight: '600px', display: 'flex', flexDirection: 'column', overflow: 'hidden'
    }}>

      {/* ìƒë‹¨ í—¤ë” */}
      <div style={{ 
        padding: '15px 20px', borderBottom: '1px solid #30363d', 
        display: 'flex', flexDirection: isMobile ? 'column' : 'row', 
        justifyContent: 'space-between', alignItems: isMobile ? 'flex-start' : 'center', 
        background:'#21262d', gap: isMobile ? '10px' : '0'
      }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', fontWeight: 'bold', fontSize: '16px', color: '#fff' }}>
          <Award size={18} color="#58a6ff" />
          <span>ì‹œì¦Œ 1 ë°ì´í„° ì„¼í„°</span>
        </div>

        <div style={{ display:'flex', background:'#0d1117', padding:'4px', borderRadius:'8px', border:'1px solid #30363d', width: isMobile ? '100%' : 'auto' }}>
          <button 
            onClick={() => setMode('HERO')}
            style={{ 
              flex: isMobile ? 1 : 'none', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px', 
              padding:'8px 16px', borderRadius:'6px', border:'none', cursor:'pointer', fontWeight:'bold', fontSize:'12px',
              background: mode === 'HERO' ? '#58a6ff' : 'transparent', color: mode === 'HERO' ? '#000' : '#8b949e'
            }}
          >
            <List size={14}/> ì˜ì›…ë³„
          </button>
          <button 
            onClick={() => setMode('LANE')}
            style={{ 
              flex: isMobile ? 1 : 'none', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px', 
              padding:'8px 16px', borderRadius:'6px', border:'none', cursor:'pointer', fontWeight:'bold', fontSize:'12px',
              background: mode === 'LANE' ? '#58a6ff' : 'transparent', color: mode === 'LANE' ? '#000' : '#8b949e'
            }}
          >
            <LayoutGrid size={14}/> ë¼ì¸ë³„
          </button>
        </div>
      </div>

      {/* ì»¨í…ì¸  ì˜ì—­ */}
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
        {mode === 'HERO' ? (
          <HeroListTable heroes={heroes} isMobile={isMobile} />
        ) : (
          <LaneStatsView 
            heroes={heroes} 
            selectedRole={selectedRole} 
            onSelectRole={setSelectedRole} 
            isMobile={isMobile}
          />
        )}
      </div>

      <style>{`
        .tier-badge { 
          font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 800; 
          margin-left: 6px; border: 1px solid transparent; letter-spacing: -0.5px;
        }
        .tier-OP { background: rgba(255, 77, 77, 0.15); color: #ff4d4d; border-color: rgba(255, 77, 77, 0.4); box-shadow: 0 0 10px rgba(255, 77, 77, 0.1); }
        .tier-1 { background: rgba(232, 157, 64, 0.15); color: #e89d40; border-color: rgba(232, 157, 64, 0.4); }
        .tier-2 { background: rgba(88, 166, 255, 0.15); color: #58a6ff; border-color: rgba(88, 166, 255, 0.4); }
        .tier-3 { background: rgba(46, 204, 113, 0.15); color: #2ecc71; border-color: rgba(46, 204, 113, 0.4); }
        .tier-4, .tier-5 { background: #21262d; color: #8b949e; border-color: #30363d; }
      `}</style>
    </div>
  );
};

// === FILE: /src/components/hero/HeroTable.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/HeroTable.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Hero } from '../../types';
import { 
  Swords, Shield, Zap, Crosshair, Skull, 
  Target, Coins, Trophy, Activity, AlertCircle 
} from 'lucide-react';

interface Props { onHeroClick: (hero: Hero) => void; }

// --- Helper Functions & Components ---

const RoleIcon = ({ role, size = 14, color = "#ccc" }: { role: string, size?: number, color?: string }) => {
  switch(role) {
    case 'ì§‘í–‰ê´€': return <Swords size={size} color={color} />;
    case 'ìˆ˜í˜¸ê¸°ì‚¬': return <Shield size={size} color={color} />;
    case 'ì„ ì§€ì': return <Zap size={size} color={color} />;
    case 'ì‹ ì‚´ì': return <Crosshair size={size} color={color} />;
    case 'ì¶”ì ì': return <Skull size={size} color={color} />;
    default: return <span>?</span>;
  }
};

const formatNumber = (numStr: string | number) => {
  if (!numStr) return '0';
  const num = typeof numStr === 'string' ? parseInt(numStr.replace(/,/g, '')) : numStr;
  if (isNaN(num)) return '0';
  return num.toLocaleString();
};

const getTierBg = (tier: string) => tier === 'OP' ? '#5383e8' : 'transparent';
const getTierBorder = (tier: string) => {
  if (tier === 'OP') return '#5383e8';
  if (tier === '1') return '#e84057';
  if (tier === '2') return '#e89d40';
  if (tier === '3') return '#59c7ba';
  return '#555';
};
const getTierColor = (tier: string) => {
  if (tier === 'OP') return '#5383e8';
  if (tier === '1') return '#e84057';
  if (tier === '2') return '#e89d40';
  if (tier === '3') return '#59c7ba';
  return '#888';
};
const getWinRateColor = (rate: number) => rate >= 52 ? '#5383e8' : rate <= 48 ? '#e84057' : '#fff';


// --- Main Component ---

export const HeroTable: React.FC<Props> = ({ onHeroClick }) => {
  const { heroes } = useGameStore();
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  if (!heroes || heroes.length === 0) {
    return (
      <div style={{ padding:'40px', textAlign:'center', color:'#666', background:'#1c1c1f', borderRadius:'8px' }}>
        <Activity size={32} style={{ marginBottom:'10px', opacity:0.5 }}/>
        <br/>ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...
      </div>
    );
  }

  // =========================================================
  // [Mobile View] ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ í˜•íƒœ
  // =========================================================
  if (isMobile) {
    return (
      <div style={{ paddingBottom: '20px' }}>
        {heroes.map((hero) => (
          <div 
            key={hero.id}
            onClick={() => onHeroClick(hero)}
            style={{
              background: '#1c1c1f',
              border: '1px solid #333',
              borderRadius: '12px',
              padding: '15px',
              marginBottom: '12px',
              display: 'flex',
              flexDirection: 'column',
              gap: '12px',
              boxShadow: '0 4px 10px rgba(0,0,0,0.2)'
            }}
          >
            {/* ìƒë‹¨: ë­í¬ + ê¸°ë³¸ì •ë³´ + í‹°ì–´ */}
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <div style={{ 
                  width: '36px', height: '36px', background: '#252528', borderRadius: '8px', 
                  display: 'flex', alignItems: 'center', justifyContent: 'center',
                  border: '1px solid #444', fontWeight: 'bold', color: '#fff'
                }}>
                  {hero.rank}
                </div>
                <div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                    <span style={{ fontWeight: 'bold', fontSize: '16px', color: '#fff' }}>{hero.name}</span>
                    <span style={{ fontSize: '12px', color: '#888' }}>{hero.role}</span>
                  </div>
                  <div style={{ display:'flex', gap:'5px', fontSize:'11px', color:'#666', marginTop:'2px' }}>
                    <RoleIcon role={hero.role} size={12} color="#666" />
                    <span>{hero.skills?.passive?.name || 'ê¸°ë³¸ ê³µê²©'}</span>
                  </div>
                </div>
              </div>

              <div style={{ 
                padding: '4px 10px', borderRadius: '6px', fontSize: '12px', fontWeight: '800',
                background: getTierBg(hero.tier), 
                color: hero.tier === 'OP' ? '#fff' : getTierColor(hero.tier),
                border: `1px solid ${getTierBorder(hero.tier)}`
              }}>
                {hero.tier} í‹°ì–´
              </div>
            </div>

            {/* í•˜ë‹¨: ì£¼ìš” ìŠ¤íƒ¯ Grid */}
            <div style={{ 
              display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', 
              background: '#121212', borderRadius: '8px', padding: '10px', gap: '5px'
            }}>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '11px', color: '#666' }}>ìŠ¹ë¥ </div>
                <div style={{ fontWeight: 'bold', color: getWinRateColor(hero.recentWinRate || 0) }}>
                  {(hero.recentWinRate || 0).toFixed(1)}%
                </div>
              </div>
              <div style={{ textAlign: 'center', borderLeft: '1px solid #333', borderRight: '1px solid #333' }}>
                <div style={{ fontSize: '11px', color: '#666' }}>í”½ë¥ </div>
                <div style={{ fontWeight: 'bold', color: '#fff' }}>
                  {(hero.pickRate || 0).toFixed(1)}%
                </div>
              </div>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '11px', color: '#666' }}>KDA</div>
                <div style={{ fontWeight: 'bold', color: parseFloat(hero.kdaRatio) >= 4 ? '#5383e8' : '#ccc' }}>
                  {hero.kdaRatio}
                </div>
              </div>
            </div>

          </div>
        ))}
      </div>
    );
  }

  // =========================================================
  // [Desktop View] ê¸°ì¡´ í…Œì´ë¸” í˜•íƒœ
  // =========================================================
  return (
    <div className="panel" style={{ overflowX: 'auto', background: '#1c1c1f', border: '1px solid #2c2c2f', boxShadow: '0 4px 20px rgba(0,0,0,0.3)' }}>
      <h3 style={{ margin: '0', padding: '15px 20px', fontSize: '15px', color: '#fff', borderLeft: '4px solid #5383e8', background: '#252528', borderBottom: '1px solid #2c2c2f' }}>
        ğŸ“Š ì±”í”¼ì–¸ ë¶„ì„ (Ranked Statistics)
      </h3>
      <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px', whiteSpace: 'nowrap' }}>
        <thead>
          <tr style={{ color: '#9aa4af', borderBottom: '1px solid #2c2c2f', textAlign: 'right', height: '45px', background: '#1c1c1f' }}>
            <th style={{ width: '60px', textAlign: 'center' }}>ìˆœìœ„</th>
            <th style={{ textAlign: 'left', paddingLeft: '20px' }}>ì±”í”¼ì–¸</th>
            <th style={{ width: '100px' }}>ìŠ¹ë¥ </th>
            <th style={{ width: '140px' }}>í”½ë¥  / ë°´ë¥ </th>
            <th style={{ width: '200px' }}>KDA (í‰ì )</th>
            <th style={{ width: '160px' }}>CS / ê³¨ë“œ</th>
            <th style={{ width: '180px', paddingRight: '20px' }}>ê°€í•œ í”¼í•´ / ë°›ì€ í”¼í•´</th>
          </tr>
        </thead>
        <tbody>
          {heroes.map((hero) => (
            <tr 
              key={hero.id} 
              onClick={() => onHeroClick(hero)}
              style={{ borderBottom: '1px solid #2c2c2f', cursor: 'pointer', height: '50px', transition: 'background 0.1s' }}
              onMouseEnter={(e) => e.currentTarget.style.background = '#2a2a2e'}
              onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
            >
              <td style={{ textAlign: 'center', color: '#777' }}>
                <span style={{ fontSize: '14px', color: '#fff', fontWeight: 'bold', marginRight: '4px' }}>{hero.rank || '-'}</span>
              </td>

              <td style={{ textAlign: 'left', paddingLeft: '20px' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                  <div style={{ width: '32px', height: '32px', background: '#333', borderRadius: '6px', display:'flex', alignItems:'center', justifyContent:'center', border: '1px solid #444' }}>
                     <RoleIcon role={hero.role} />
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <span style={{ fontWeight: 'bold', fontSize: '14px', color: '#eee' }}>{hero.name}</span>
                    <span style={{ fontSize: '12px', color: '#666' }}>{hero.role}</span>
                    <span style={{ 
                      marginLeft: '6px', padding: '1px 6px', borderRadius: '3px', fontWeight: '800', fontSize: '10px',
                      background: getTierBg(hero.tier), color: '#fff', border: `1px solid ${getTierBorder(hero.tier)}`
                    }}>
                      {hero.tier || 'unranked'}
                    </span>
                  </div>
                </div>
              </td>

              <td style={{ textAlign: 'right', fontWeight: 'bold' }}>
                <span style={{ color: getWinRateColor(hero.recentWinRate || 0) }}>
                  {(hero.recentWinRate || 0).toFixed(2)}%
                </span>
              </td>

              <td style={{ textAlign: 'right' }}>
                <span style={{ color: '#ccc' }}>{(hero.pickRate || 0).toFixed(1)}%</span>
                <span style={{ color: '#555', margin: '0 6px' }}>/</span>
                <span style={{ color: '#e84057', fontSize: '12px' }}>{(hero.banRate || 0).toFixed(1)}%</span>
              </td>

              <td style={{ textAlign: 'right' }}>
                <span style={{ color: '#8b949e', fontSize: '12px', marginRight: '8px' }}>({hero.avgKda || '0/0/0'})</span>
                <span style={{ fontWeight: 'bold', color: parseFloat(hero.kdaRatio || '0') >= 4 ? '#5383e8' : '#fff' }}>
                  {hero.kdaRatio || '0.00'}:1
                </span>
              </td>

              <td style={{ textAlign: 'right' }}>
                <div style={{ display: 'inline-flex', alignItems: 'center', gap: '15px' }}>
                  <span style={{ color: '#aaa', fontSize: '12px', display: 'flex', alignItems: 'center', gap: '4px' }}>
                    <Target size={12}/> {hero.avgCs || 0}
                  </span>
                  <span style={{ color: '#e89d40', fontSize: '12px', display: 'flex', alignItems: 'center', gap: '4px' }}>
                    <Coins size={12}/> {formatNumber(hero.avgGold || '0')}
                  </span>
                </div>
              </td>

              <td style={{ textAlign: 'right', paddingRight: '20px' }}>
                <span style={{ color: '#e84057' }}>{formatNumber(hero.avgDpm || '0')}</span>
                <span style={{ color: '#555', margin: '0 6px' }}>/</span>
                <span style={{ color: '#8b949e' }}>{formatNumber(hero.avgDpg || '0')}</span>
              </td>

            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

// === FILE: /src/components/hero/LaneStatsView.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/LaneStatsView.tsx
// ==========================================

import React, { useRef, useState, useMemo } from 'react';
import { Hero, Role } from '../../types';
import { ROLE_DATA } from '../../data/roles';
import { useGameStore } from '../../store/useGameStore';
import { Wrench, Camera, Image as ImageIcon, Target, Swords, Coins, Activity, TrendingUp, Skull } from 'lucide-react';
import { RolePatchModal } from './RolePatchModal'; 
import { GameIcon } from '../common/GameIcon';

interface Props {
  heroes: Hero[];
  selectedRole: Role;
  onSelectRole: (role: Role) => void;
  isMobile?: boolean;
}

const getRoleId = (role: Role) => {
  switch(role) {
    case 'ì§‘í–‰ê´€': return 'role_executor';
    case 'ì¶”ì ì': return 'role_tracker';
    case 'ì„ ì§€ì': return 'role_prophet';
    case 'ì‹ ì‚´ì': return 'role_slayer';
    case 'ìˆ˜í˜¸ê¸°ì‚¬': return 'role_guardian';
    default: return 'role_unknown';
  }
};

export const LaneStatsView: React.FC<Props> = ({ heroes, selectedRole, onSelectRole, isMobile = false }) => {
  const { gameState, setCustomImage } = useGameStore();
  const [showPatchModal, setShowPatchModal] = useState(false);
  const [isHovered, setIsHovered] = useState(false);

  const roleInfo = ROLE_DATA[selectedRole];
  const roleId = getRoleId(selectedRole);

  const roleBgId = `${roleId}_bg`; 
  const customBg = gameState.customImages?.[roleBgId];

  const iconInputRef = useRef<HTMLInputElement>(null);
  const bgInputRef = useRef<HTMLInputElement>(null);

  const s = gameState.roleSettings || {
    executor: { damage: 10, defense: 10 },
    tracker: { gold: 20, smiteChance: 1.5 },
    prophet: { cdrPerLevel: 2 },
    slayer: { structureDamage: 30 },
    guardian: { survivalRate: 20 }
  };

  const getDynamicTraitText = (role: Role) => {
    switch (role) {
      case 'ì§‘í–‰ê´€': return `ì£¼ë³€ì— ì•„êµ°ì´ ì—†ì„ ë•Œ(ì†”ë¡œ ë¼ì¸ì „ ì‹œ) í”¼í•´ëŸ‰ +${s.executor.damage}%, ë°©ì–´ë ¥ +${s.executor.defense}%.`;
      case 'ì¶”ì ì': return `ëª¬ìŠ¤í„°/ì˜¤ë¸Œì íŠ¸ ì²˜ì¹˜ ì‹œ ê³¨ë“œ íšë“ëŸ‰ +${s.tracker.gold}%. ë‹¤ë¥¸ ë¼ì¸ ê°œì…(ê°±í‚¹) ì‹œ ì„±ê³µë¥  ì¦ê°€. (ê°•íƒ€ í™•ë¥  ${s.tracker.smiteChance}ë°°)`;
      case 'ì„ ì§€ì': return `ë ˆë²¨ì´ ì˜¤ë¥¼ìˆ˜ë¡ ìŠ¤í‚¬ ê°€ì†(ì¿¨íƒ€ì„ ê°ì†Œ) íš¨ê³¼ê°€ ì¶”ê°€ë¡œ ë¶™ìŒ. (ë ˆë²¨ë‹¹ ìœ„ë ¥ +${s.prophet.cdrPerLevel}%)`;
      case 'ì‹ ì‚´ì': return `êµ¬ì¡°ë¬¼(íƒ€ì›Œ, ì–µì œê¸°, ìˆ˜í˜¸ì) ë° ê±°ì‹ ë³‘ì—ê²Œ ì…íˆëŠ” í”¼í•´ëŸ‰ +${s.slayer.structureDamage}%.`;
      case 'ìˆ˜í˜¸ê¸°ì‚¬': return `ê°™ì€ ë¼ì¸ì— ìˆëŠ” ì•„êµ°ì˜ ìƒì¡´ìœ¨ì„ ${s.guardian.survivalRate}% ì˜¬ë ¤ì¤Œ. (ìì‹ ì´ ëŒ€ì‹  ì£½ì„ í™•ë¥  ì¦ê°€)`;
      default: return '';
    }
  };

  const laneHeroes = heroes
    .filter(h => h.role === selectedRole)
    .sort((a, b) => b.recentWinRate - a.recentWinRate);

  const roleStats = useMemo(() => {
    if (laneHeroes.length === 0) return null;

    let totalWins = 0, totalMatches = 0;
    let totalK = 0, totalD = 0, totalA = 0;
    let totalGold = 0, totalCs = 0, totalDpm = 0;

    laneHeroes.forEach(h => {
        totalWins += h.record.totalWins;
        totalMatches += h.record.totalMatches;
        totalK += h.record.totalKills;
        totalD += h.record.totalDeaths;
        totalA += h.record.totalAssists;

        totalGold += parseInt(h.avgGold.replace(/,/g, '')) || 0;
        totalCs += parseFloat(h.avgCs) || 0;
        totalDpm += parseInt(h.avgDpm.replace(/,/g, '')) || 0;
    });

    const count = laneHeroes.length;
    const safeDiv = (a: number, b: number) => b === 0 ? 0 : a / b;

    return {
        avgWinRate: totalMatches > 0 ? (totalWins / totalMatches) * 100 : 0,
        avgKda: safeDiv(totalK + totalA, totalD).toFixed(2),
        avgGold: Math.round(totalGold / count).toLocaleString(),
        avgCs: (totalCs / count).toFixed(1),
        avgDpm: Math.round(totalDpm / count).toLocaleString(),
    };
  }, [laneHeroes]);

  const handleIconUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if(file) {
        const reader = new FileReader();
        reader.onloadend = () => { if(typeof reader.result === 'string') setCustomImage(roleId, reader.result); };
        reader.readAsDataURL(file);
    }
  };

  const handleBgUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if(file) {
        const reader = new FileReader();
        reader.onloadend = () => { if(typeof reader.result === 'string') setCustomImage(roleBgId, reader.result); };
        reader.readAsDataURL(file);
    }
  };

  const actionButtonStyle = {
    background: 'rgba(33, 38, 45, 0.8)', 
    border: '1px solid rgba(255,255,255,0.2)', 
    color: '#fff', 
    padding: '8px 12px', 
    borderRadius: '6px', 
    cursor: 'pointer', 
    fontWeight: 'bold' as const, 
    display: 'flex', 
    alignItems: 'center', 
    gap: '8px', 
    fontSize: '12px', 
    whiteSpace: 'nowrap' as const, 
    backdropFilter: 'blur(4px)',
    width: '100%',
    justifyContent: 'center'
  };

  return (
    <div 
      // [í•µì‹¬ ìˆ˜ì •] key ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ ì—­í• êµ°ì´ ë°”ë€” ë•Œë§ˆë‹¤ ì»´í¬ë„ŒíŠ¸ë¥¼ ìƒˆë¡œ ê·¸ë ¤ì„œ ìŠ¤íƒ€ì¼ ê¼¬ì„ ë°©ì§€
      key={selectedRole}
      style={{ 
        display: 'flex', flexDirection: 'column', height: '100%', 
        // [í•µì‹¬ ìˆ˜ì •] background ë‹¨ì¶• ì†ì„± ëŒ€ì‹  ê°œë³„ ì†ì„± ì‚¬ìš©ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´
        backgroundColor: '#0d1117',
        backgroundImage: customBg 
          ? `linear-gradient(to bottom, rgba(13,17,23,0.5), rgba(13,17,23,0.95)), url(${customBg})` 
          : 'none',
        backgroundSize: 'cover',
        backgroundPosition: 'center top', // ëª¨ë°”ì¼ì—ì„œ ì¸ë¬¼ ì–¼êµ´ì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ ìƒë‹¨ ê¸°ì¤€ ì •ë ¬
        backgroundRepeat: 'no-repeat',
        position: 'relative'
      }}
    >

      {/* 0. ìƒë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div style={{ 
        padding: '10px 15px', borderBottom: '1px solid rgba(255,255,255,0.1)', 
        background: 'rgba(22, 27, 34, 0.8)', backdropFilter: 'blur(10px)',
        display: 'flex', gap: '10px', overflowX: 'auto', whiteSpace: 'nowrap',
        flexShrink: 0, zIndex: 10
      }}>
        {Object.entries(ROLE_DATA).map(([key, info]) => {
          const role = key as Role;
          const isSelected = selectedRole === role;

          return (
            <button 
              key={role} 
              onClick={() => onSelectRole(role)}
              style={{ 
                flex: 1, minWidth: isMobile ? '70px' : '100px',
                background: isSelected ? info.color : 'rgba(255,255,255,0.05)', 
                color: isSelected ? '#000' : '#ccc',
                border: '1px solid',
                borderColor: isSelected ? info.color : 'transparent',
                borderRadius: '6px', padding: '10px 0', cursor: 'pointer',
                display: 'flex', alignItems: 'center', justifyContent:'center', gap: '6px',
                transition: '0.2s', fontWeight: '800', fontSize:'12px'
              }}
            >
              {React.createElement(info.icon, { size: 14 })} {role}
            </button>
          );
        })}
      </div>

      {/* 1. ì—­í• êµ° ì„¤ëª… í—¤ë” */}
      <div style={{ 
        padding: isMobile ? '15px' : '30px', 
        display: 'flex', 
        flexDirection: isMobile ? 'column' : 'row', 
        gap: isMobile ? '15px' : '30px', 
        alignItems: 'flex-start', 
        background: `linear-gradient(180deg, ${roleInfo.color}11 0%, transparent 100%)`,
        flexShrink: 0,
        position: 'relative'
      }}>

        {/* ì•„ì´ì½˜ ë° íƒ€ì´í‹€ */}
        <div style={{ display:'flex', gap:'20px', width: isMobile ? '100%' : 'auto', alignItems:'center' }}>
          <div 
            style={{ position: 'relative' }}
            onMouseEnter={() => setIsHovered(true)}
            onMouseLeave={() => setIsHovered(false)}
          >
            <div onClick={() => iconInputRef.current?.click()} style={{ cursor: 'pointer', display: 'block' }}>
              <GameIcon 
                id={roleId} 
                size={isMobile ? 60 : 100} 
                fallback={React.createElement(roleInfo.icon, { size: isMobile ? 30 : 50, color: roleInfo.color })}
                border={`2px solid ${roleInfo.color}`}
                shape="rounded"
              />
              <div style={{
                position: 'absolute', inset: 0, borderRadius: '12px',
                background: 'rgba(0,0,0,0.5)', display: isHovered ? 'flex' : 'none',
                alignItems: 'center', justifyContent: 'center', transition: '0.2s'
              }}>
                <Camera size={24} color="#fff" />
              </div>
            </div>
          </div>

          {isMobile && (
             <div style={{ flex: 1 }}>
                <h2 style={{ margin: 0, color: '#fff', fontSize: '24px', fontWeight: '900', textShadow: '0 2px 10px rgba(0,0,0,0.8)' }}>{selectedRole}</h2>
                <span style={{ fontSize: '12px', color: roleInfo.color, fontWeight: 'bold', background: 'rgba(0,0,0,0.6)', padding: '2px 8px', borderRadius: '4px', border: `1px solid ${roleInfo.color}44` }}>
                  {roleInfo.name}
                </span>
             </div>
          )}
        </div>

        <div style={{ flex: 1, width: '100%' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
            <div style={{ flex: 1, marginRight: '20px' }}>
              {!isMobile && (
                <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
                  <h2 style={{ margin: 0, color: '#fff', fontSize: '32px', fontWeight: '900', textShadow: '0 2px 10px rgba(0,0,0,0.8)' }}>{selectedRole}</h2>
                  <span style={{ fontSize: '16px', color: roleInfo.color, fontWeight: 'bold', background: 'rgba(0,0,0,0.6)', padding: '2px 8px', borderRadius: '4px', border: `1px solid ${roleInfo.color}44` }}>
                    {roleInfo.name}
                  </span>
                </div>
              )}
              <div style={{ fontSize: isMobile ? '13px' : '16px', color: '#fff', fontWeight: 'bold', marginBottom: '8px', fontStyle: 'italic', textShadow: '0 1px 3px rgba(0,0,0,0.8)' }}>
                "{roleInfo.concept}"
              </div>
              <div style={{ fontSize: '13px', color: '#eee', marginBottom: '15px', lineHeight: '1.5', textShadow: '0 1px 2px rgba(0,0,0,0.8)' }}>
                {roleInfo.desc}
              </div>
            </div>

            {!isMobile && (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', minWidth: '140px' }}>
                <button onClick={() => setShowPatchModal(true)} style={actionButtonStyle}>
                  <Wrench size={14}/> ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜
                </button>
                <button onClick={() => iconInputRef.current?.click()} style={actionButtonStyle}>
                  <Camera size={14}/> í”„ë¡œí•„ ë³€ê²½
                </button>
                <button onClick={() => bgInputRef.current?.click()} style={actionButtonStyle}>
                  <ImageIcon size={14}/> ë°°ê²½ ë³€ê²½
                </button>
              </div>
            )}
          </div>

          <div style={{ display: 'grid', gridTemplateColumns: isMobile ? '1fr' : '1fr 1fr', gap: '10px' }}>
            <div style={{ background: 'rgba(28, 28, 31, 0.7)', padding: '12px', borderRadius: '8px', border: '1px solid rgba(255,255,255,0.1)', backdropFilter:'blur(4px)' }}>
              <div style={{ fontSize: '11px', color: '#58a6ff', fontWeight: 'bold', marginBottom: '4px' }}>
                ê³ ìœ  íŠ¹ì„± : {roleInfo.traitName}
              </div>
              <div style={{ fontSize: '12px', color: '#fff', lineHeight: '1.4' }}>
                {getDynamicTraitText(selectedRole)}
              </div>
            </div>
            <div style={{ background: 'rgba(28, 28, 31, 0.7)', padding: '12px', borderRadius: '8px', border: '1px solid rgba(255,255,255,0.1)', backdropFilter:'blur(4px)' }}>
              <div style={{ fontSize: '11px', color: '#da3633', fontWeight: 'bold', marginBottom: '4px' }}>
                ì‹œë®¬ë ˆì´ì…˜ ë°˜ì˜
              </div>
              <div style={{ fontSize: '12px', color: '#ccc', lineHeight: '1.4' }}>
                {roleInfo.simEffect}
              </div>
            </div>
          </div>

          {isMobile && (
            <div style={{ marginTop: '15px', display: 'flex', gap: '8px' }}>
              <button onClick={() => setShowPatchModal(true)} style={{...actionButtonStyle, flex:1 }}>
                <Wrench size={14}/> íŒ¨ì¹˜
              </button>
              <button onClick={() => iconInputRef.current?.click()} style={{...actionButtonStyle, flex:1 }}>
                <Camera size={14}/> í”„ë¡œí•„
              </button>
              <button onClick={() => bgInputRef.current?.click()} style={{...actionButtonStyle, flex:1 }}>
                <ImageIcon size={14}/> ë°°ê²½
              </button>
            </div>
          )}
        </div>
      </div>

      <input type="file" ref={iconInputRef} style={{ display: 'none' }} accept="image/*" onChange={handleIconUpload} />
      <input type="file" ref={bgInputRef} style={{ display: 'none' }} accept="image/*" onChange={handleBgUpload} />

      {/* 2. ì—­í• êµ° í†µí•© í†µê³„ ì„¹ì…˜ */}
      {roleStats && (
        <div style={{ 
          background: 'rgba(18, 20, 24, 0.85)', borderBottom: '1px solid #30363d', borderTop: '1px solid rgba(255,255,255,0.1)', 
          padding: '15px 20px', backdropFilter: 'blur(5px)',
          display: 'flex', flexDirection: isMobile ? 'column' : 'row', alignItems: 'center', justifyContent:'space-between', gap:'15px'
        }}>
          <div style={{ display:'flex', alignItems:'center', gap:'8px', color:'#fff', fontWeight:'bold', fontSize:'14px' }}>
            <Activity size={16} color={roleInfo.color}/> 
            <span style={{ color: roleInfo.color }}>{selectedRole}</span> í†µê³„
          </div>

          <div style={{ display:'flex', gap: isMobile ? '10px' : '25px', flexWrap:'wrap', justifyContent: isMobile ? 'space-between' : 'flex-end', width:'100%' }}>
            <RoleStatItem label="í‰ê·  ìŠ¹ë¥ " value={`${roleStats.avgWinRate.toFixed(1)}%`} color={roleStats.avgWinRate >= 50 ? '#ff4d4d' : '#8b949e'} icon={<TrendingUp size={12}/>} />
            <RoleStatItem label="í‰ê·  KDA" value={`${roleStats.avgKda}:1`} color="#fff" icon={<Skull size={12}/>} />
            <RoleStatItem label="ë¶„ë‹¹ ê³¨ë“œ" value={roleStats.avgGold} color="#e89d40" icon={<Coins size={12}/>} />
            <RoleStatItem label="ë¶„ë‹¹ ë°ë¯¸ì§€" value={roleStats.avgDpm} color="#da3633" icon={<Swords size={12}/>} />
            <RoleStatItem label="í‰ê·  CS" value={roleStats.avgCs} color="#ccc" icon={<Target size={12}/>} />
          </div>
        </div>
      )}

      {/* 3. ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ */}
      <div style={{ flex: 1, overflowY: 'auto', paddingBottom: '80px', background: 'rgba(13, 17, 23, 0.6)', backdropFilter: 'blur(3px)' }}>
        {isMobile ? (
          <div style={{ padding: '10px', display: 'flex', flexDirection: 'column', gap: '8px' }}>
            {laneHeroes.map((hero, idx) => (
              <div key={hero.id} style={{ 
                background: 'rgba(22, 27, 34, 0.85)', border: '1px solid rgba(48, 54, 61, 0.8)', borderRadius: '12px', padding: '12px 15px',
                display: 'flex', alignItems: 'center', justifyContent: 'space-between'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '15px', flex: 1 }}>
                  <div style={{ fontSize: '16px', fontWeight: '900', fontStyle: 'italic', color: idx < 3 ? '#e74c3c' : '#666', width: '20px', textAlign: 'center' }}>{idx + 1}</div>

                  <GameIcon id={hero.id} size={42} fallback={<span style={{fontSize:'22px'}}>ğŸ§™â€â™‚ï¸</span>} />

                  <div style={{ display: 'flex', flexDirection: 'column', gap: '3px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                      <span style={{ fontWeight: 'bold', fontSize: '14px', color: '#fff' }}>{hero.name}</span>
                      <span className={`tier-badge tier-${hero.tier}`} style={{ fontSize: '9px', padding: '2px 5px', height: 'fit-content' }}>{hero.tier}í‹°ì–´</span>
                    </div>
                    <div style={{ fontSize: '11px', color: '#8b949e' }}>
                      <span style={{ color: hero.recentWinRate >= 50 ? '#ff4d4d' : '#8b949e', fontWeight: 'bold' }}>ìŠ¹ë¥  {hero.recentWinRate.toFixed(1)}%</span>
                      <span style={{ margin: '0 4px', opacity: 0.3 }}>â€¢</span>
                      <span>í”½ë¥  {hero.pickRate.toFixed(1)}%</span>
                    </div>
                  </div>
                </div>
                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '2px', minWidth: '80px' }}>
                  <div style={{ fontWeight: 'bold', fontSize: '12px', color: '#fff' }}>{hero.avgKda}</div>
                  <div style={{ fontSize: '10px', color: '#e89d40', fontWeight:'bold' }}>{hero.avgGold} G</div>
                  <div style={{ fontSize: '9px', color: '#888', display:'flex', gap:'6px', marginTop:'2px' }}>
                    <span>CS {hero.avgCs}</span>
                    <span style={{ color: '#da3633' }}>{hero.avgDpm}</span>
                  </div>
                </div>
              </div>
            ))}
            {laneHeroes.length === 0 && <div style={{ padding: '40px', textAlign: 'center', color: '#ccc' }}>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>}
          </div>
        ) : (
          <>
            <div style={{ display: 'grid', gridTemplateColumns: '40px 140px 100px 120px 140px 100px 80px 1fr', padding: '10px 20px', background: 'rgba(28, 28, 31, 0.95)', fontSize: '11px', color: '#8b949e', fontWeight: 'bold', textAlign: 'center', borderBottom: '1px solid #30363d', position:'sticky', top:0 }}>
              <div>#</div>
              <div style={{ textAlign: 'left', paddingLeft: '10px' }}>ì±”í”¼ì–¸</div>
              <div>ìŠ¹ë¥ </div>
              <div>í”½ë¥  / ë°´ë¥ </div>
              <div>KDA (í‚¬/ëƒ/ì–´)</div>
              <div><Target size={10} style={{ display: 'inline' }} /> CS</div>
              <div><Swords size={10} style={{ display: 'inline' }} /> DPM</div>
              <div><Coins size={10} style={{ display: 'inline' }} /> GOLD</div>
            </div>
            <div>
              {laneHeroes.map((hero, idx) => (
                <div key={hero.id} className="hero-row" style={{ display: 'grid', gridTemplateColumns: '40px 140px 100px 120px 140px 100px 80px 1fr', padding: '10px 20px', borderBottom: '1px solid rgba(255,255,255,0.05)', alignItems: 'center', fontSize: '12px', color: '#ccc', textAlign: 'center', background: 'rgba(22, 27, 34, 0.6)' }}>
                  <div style={{ fontWeight: 'bold', color: '#aaa' }}>{idx + 1}</div>
                  <div style={{ textAlign: 'left', paddingLeft: '10px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <GameIcon id={hero.id} size={32} fallback={<span style={{fontSize:'16px'}}>ğŸ§™â€â™‚ï¸</span>} />
                    <div style={{ display: 'flex', flexDirection: 'column' }}>
                      <span style={{ fontWeight: 'bold', color: '#fff' }}>{hero.name}</span>
                      <span className={`tier-badge tier-${hero.tier}`} style={{ marginLeft: 0, width: 'fit-content' }}>{hero.tier}í‹°ì–´</span>
                    </div>
                  </div>
                  <div style={{ fontWeight: 'bold', color: hero.recentWinRate >= 50 ? '#ff4d4d' : '#4d94ff' }}>{hero.recentWinRate.toFixed(1)}%</div>
                  <div style={{ fontSize: '11px', color: '#ccc' }}>
                    <span style={{ color: '#fff' }}>{hero.pickRate.toFixed(1)}%</span> <span style={{ color: '#888' }}>|</span> <span style={{ color: '#da3633' }}>{hero.banRate.toFixed(1)}%</span>
                  </div>
                  <div>
                    <span style={{ color: '#fff', fontWeight: 'bold', fontSize: '11px' }}>{hero.avgKda}</span>
                    <span style={{ display:'block', fontSize:'10px', color:'#888' }}>({hero.kdaRatio}:1)</span>
                  </div>
                  <div style={{ fontFamily: 'monospace', color: '#ccc' }}>{hero.avgCs}</div>
                  <div style={{ fontFamily: 'monospace', color: '#da3633' }}>{hero.avgDpm}</div>
                  <div style={{ fontFamily: 'monospace', color: '#f1c40f' }}>{hero.avgGold}</div>
                </div>
              ))}
            </div>
          </>
        )}
      </div>

      {showPatchModal && (
        <RolePatchModal 
          role={selectedRole} 
          onClose={() => setShowPatchModal(false)} 
        />
      )}

    </div>
  );
};

const RoleStatItem = ({ label, value, color, icon }: any) => (
  <div style={{ display:'flex', flexDirection:'column', alignItems:'flex-end' }}>
    <span style={{ fontSize:'10px', color:'#ccc', marginBottom:'2px', display:'flex', alignItems:'center', gap:'4px' }}>
      {icon} {label}
    </span>
    <span style={{ fontSize:'14px', fontWeight:'bold', color: color, fontFamily:'monospace' }}>
      {value}
    </span>
  </div>
);

// === FILE: /src/components/hero/PatchModal.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/PatchModal.tsx
// ==========================================

import React, { useState, useEffect, useRef } from 'react';
import { Hero, HeroStats, HeroSkillSet } from '../../types';
import { useGameStore } from '../../store/useGameStore';
import { X, Save, Edit2, Check, Upload, Trash2 } from 'lucide-react';
import { GameIcon } from '../common/GameIcon';

import { SkillEditor } from './patch/SkillEditor';
import { StatEditor } from './patch/StatEditor';

interface Props { hero: Hero | null; onClose: () => void; }

export const PatchModal: React.FC<Props> = ({ hero, onClose }) => {
  const { updateHero, setCustomImage, removeCustomImage } = useGameStore();
  const [activeTab, setActiveTab] = useState<'skill' | 'combat' | 'basic'>('skill');
  const [heroName, setHeroName] = useState('');
  const [isEditingName, setIsEditingName] = useState(false);
  const [stats, setStats] = useState<HeroStats | null>(null);
  const [skills, setSkills] = useState<HeroSkillSet | null>(null);

  const fileInputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    if (hero) {
      setHeroName(hero.name);
      setStats({ ...hero.stats });
      setSkills({ ...hero.skills });
    }
  }, [hero]);

  if (!hero || !stats || !skills) return null;

  const handleSave = () => {
    updateHero(hero.id, { name: heroName, stats, skills });
    alert(`${heroName} íŒ¨ì¹˜ ì ìš© ì™„ë£Œ!`);
    onClose();
  };

  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        if (typeof reader.result === 'string') {
          setCustomImage(hero.id, reader.result);
        }
      };
      reader.readAsDataURL(file);
    }
  };

  return (
    <div className="modal-overlay" onClick={onClose} style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', display: 'flex', justifyContent: 'center', alignItems: 'flex-end', zIndex: 9999, backdropFilter: 'blur(8px)' }}>
      <div className="patch-modal" onClick={e => e.stopPropagation()} style={{ width: '100%', maxWidth: '500px', background: '#0d1117', borderRadius: '24px 24px 0 0', border: '1px solid #30363d', height: '85vh', display: 'flex', flexDirection: 'column' }}>

        <header style={{ padding: '15px 20px', display: 'flex', justifyContent: 'space-between', background: '#161b22', borderRadius: '24px 24px 0 0', alignItems: 'center' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>

            <div style={{ position: 'relative', cursor: 'pointer' }} onClick={() => fileInputRef.current?.click()}>
              <GameIcon id={hero.id} size={50} fallback={<span style={{fontSize:'24px'}}>ğŸ§™â€â™‚ï¸</span>} />
              <div style={{ position:'absolute', bottom:-5, right:-5, background:'#58a6ff', borderRadius:'50%', padding:'4px', border:'2px solid #161b22' }}>
                <Upload size={10} color="#000" />
              </div>
              <input type="file" ref={fileInputRef} style={{ display: 'none' }} accept="image/*" onChange={handleImageUpload} />
            </div>

            <div>
              {isEditingName ? (
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', background: '#000', padding: '4px 10px', borderRadius: '8px', border: '1px solid #58a6ff' }}>
                  <input value={heroName} onChange={e=>setHeroName(e.target.value)} onBlur={()=>setIsEditingName(false)} autoFocus style={{ background: 'none', border: 'none', color: '#fff', fontWeight: 'bold', outline: 'none', width: '100px' }}/>
                  <Check size={16} color="#2ecc71" onClick={()=>setIsEditingName(false)}/>
                </div>
              ) : (
                <h2 onClick={()=>setIsEditingName(true)} style={{ margin: 0, fontSize: '18px', color: '#fff', display: 'flex', alignItems: 'center', gap: '6px', cursor: 'pointer' }}>{heroName} <Edit2 size={14}/></h2>
              )}
              <div style={{ display:'flex', gap:'8px', alignItems:'center', marginTop:'4px' }}>
                <span style={{ fontSize: '10px', color: '#8b949e' }}>{hero.role}</span>
                <button onClick={(e) => { e.stopPropagation(); removeCustomImage(hero.id); }} style={{ background:'none', border:'none', color:'#da3633', fontSize:'10px', cursor:'pointer', display:'flex', alignItems:'center', gap:'2px' }}>
                  <Trash2 size={10}/> ì‚¬ì§„ ì‚­ì œ
                </button>
              </div>
            </div>
          </div>
          <button onClick={onClose} style={{ background: '#333', border: 'none', color: '#fff', borderRadius: '50%', width: '30px', height: '30px', cursor: 'pointer' }}><X size={18}/></button>
        </header>

        <nav style={{ display: 'flex', background: '#161b22', borderBottom: '1px solid #30363d' }}>
          <button onClick={()=>setActiveTab('skill')} style={{ flex: 1, padding: '12px', background: 'none', border: 'none', color: activeTab === 'skill' ? '#58a6ff' : '#8b949e', borderBottom: activeTab === 'skill' ? '2px solid #58a6ff' : 'none', fontWeight: 'bold', cursor: 'pointer' }}>ìŠ¤í‚¬</button>
          <button onClick={()=>setActiveTab('combat')} style={{ flex: 1, padding: '12px', background: 'none', border: 'none', color: activeTab === 'combat' ? '#58a6ff' : '#8b949e', borderBottom: activeTab === 'combat' ? '2px solid #58a6ff' : 'none', fontWeight: 'bold', cursor: 'pointer' }}>ì „íˆ¬</button>
          <button onClick={()=>setActiveTab('basic')} style={{ flex: 1, padding: '12px', background: 'none', border: 'none', color: activeTab === 'basic' ? '#58a6ff' : '#8b949e', borderBottom: activeTab === 'basic' ? '2px solid #58a6ff' : 'none', fontWeight: 'bold', cursor: 'pointer' }}>ê¸°ë³¸</button>
        </nav>

        <div style={{ flex: 1, overflowY: 'auto', padding: '20px' }}>
          {activeTab === 'skill' && <SkillEditor skills={skills} onChange={(k, f, v) => setSkills({...skills, [k]: {...(skills as any)[k], [f]: v}})} />}
          {activeTab === 'combat' && <StatEditor fields={['baseAtk', 'ad', 'ap', 'crit']} stats={stats} onChange={(f, v) => setStats({...stats, [f]: v})} />}
          {activeTab === 'basic' && <StatEditor fields={['hp', 'armor', 'speed']} stats={stats} onChange={(f, v) => setStats({...stats, [f]: v})} />}
        </div>

        <footer style={{ padding: '20px', background: '#161b22', borderTop: '1px solid #30363d' }}>
          <button onClick={handleSave} style={{ width: '100%', padding: '15px', background: '#238636', border: 'none', borderRadius: '12px', color: '#fff', fontWeight: '800', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}><Save size={18}/> íŒ¨ì¹˜ ì ìš©í•˜ê¸°</button>
        </footer>
      </div>
    </div>
  );
};

// === FILE: /src/components/hero/RolePatchModal.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/RolePatchModal.tsx
// ==========================================

import React, { useState } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Role, RoleSettings } from '../../types';
import { X, Save, Sliders } from 'lucide-react';

interface Props {
  role: Role;
  onClose: () => void;
}

export const RolePatchModal: React.FC<Props> = ({ role, onClose }) => {
  const { gameState, updateRoleSettings } = useGameStore();

  // ìŠ¤í† ì–´ì—ì„œ í˜„ì¬ ì„¤ì •ê°’ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
  const initialSettings = gameState.roleSettings || {
    executor: { damage: 15, defense: 15 },
    tracker: { gold: 20, smiteChance: 1.5 },
    prophet: { cdrPerLevel: 2 },
    slayer: { structureDamage: 30 },
    guardian: { survivalRate: 20 }
  };

  const [settings, setSettings] = useState<RoleSettings>(initialSettings);

  // ê°’ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleChange = (group: keyof RoleSettings, field: string, value: number) => {
    setSettings(prev => ({
      ...prev,
      [group]: { ...prev[group], [field]: value }
    }));
  };

  // ì €ì¥ í•¸ë“¤ëŸ¬
  const handleSave = () => {
    updateRoleSettings(settings);
    alert(`[${role}] ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¤ìŒ ì‹œë®¬ë ˆì´ì…˜ í‹±ë¶€í„° ì¦‰ì‹œ ì ìš©ë©ë‹ˆë‹¤.`);
    onClose();
  };

  // ì—­í• êµ°ë³„ë¡œ ë‹¤ë¥¸ ì…ë ¥ì°½ ë Œë”ë§
  const renderInputs = () => {
    switch(role) {
      case 'ì§‘í–‰ê´€':
        return (
          <>
            <div style={{fontSize:'12px', color:'#888', marginBottom:'10px'}}>
              * ê³ ë¦½(ì£¼ë³€ì— ì•„êµ° ì—†ìŒ) ìƒíƒœì¼ ë•Œ ì ìš©ë˜ëŠ” ë³´ë„ˆìŠ¤ì…ë‹ˆë‹¤.
            </div>
            <RangeInput 
              label="ì¶”ê°€ í”¼í•´ëŸ‰" 
              value={settings.executor.damage} 
              onChange={(v: number) => handleChange('executor', 'damage', v)} 
              unit="%" max={100} 
            />
            <RangeInput 
              label="ì¶”ê°€ ë°©ì–´ë ¥" 
              value={settings.executor.defense} 
              onChange={(v: number) => handleChange('executor', 'defense', v)} 
              unit="%" max={100} 
            />
          </>
        );
      case 'ì¶”ì ì':
        return (
          <>
            <div style={{fontSize:'12px', color:'#888', marginBottom:'10px'}}>
              * ì •ê¸€ëŸ¬ì˜ ì„±ì¥ ì†ë„ì™€ ì˜¤ë¸Œì íŠ¸ ì‹¸ì›€ ëŠ¥ë ¥ì„ ì¡°ì ˆí•©ë‹ˆë‹¤.
            </div>
            <RangeInput 
              label="ê³¨ë“œ íšë“ëŸ‰ ë³´ë„ˆìŠ¤" 
              value={settings.tracker.gold} 
              onChange={(v: number) => handleChange('tracker', 'gold', v)} 
              unit="%" max={200} 
            />
            <RangeInput 
              label="ê°•íƒ€ í™•ë¥  ë°°ìœ¨ (ê¸°ë³¸ 1.0)" 
              value={settings.tracker.smiteChance} 
              onChange={(v: number) => handleChange('tracker', 'smiteChance', v)} 
              unit="ë°°" max={5} step={0.1} 
            />
          </>
        );
      case 'ì„ ì§€ì':
        return (
          <>
            <div style={{fontSize:'12px', color:'#888', marginBottom:'10px'}}>
              * ë ˆë²¨ì´ ì˜¤ë¥¼ìˆ˜ë¡ ìŠ¤í‚¬ ì¿¨íƒ€ì„ì´ ì¤„ì–´ë“œëŠ” íš¨ê³¼ë¥¼ ë°ë¯¸ì§€ë¡œ í™˜ì‚°í•©ë‹ˆë‹¤.
            </div>
            <RangeInput 
              label="ë ˆë²¨ë‹¹ ìŠ¤í‚¬ ìœ„ë ¥ ì¦ê°€" 
              value={settings.prophet.cdrPerLevel} 
              onChange={(v: number) => handleChange('prophet', 'cdrPerLevel', v)} 
              unit="%" max={10} step={0.5} 
            />
            <div style={{fontSize:'11px', color:'#58a6ff', marginTop:'5px'}}>
              (ì˜ˆ: 3% ì„¤ì • ì‹œ, 16ë ˆë²¨ ë„ë‹¬í•˜ë©´ ë°ë¯¸ì§€ 48% ì¦ê°€)
            </div>
          </>
        );
      case 'ì‹ ì‚´ì':
        return (
          <>
             <div style={{fontSize:'12px', color:'#888', marginBottom:'10px'}}>
              * íƒ€ì›Œ ì² ê±° ë° ë„¥ì„œìŠ¤ íŒŒê´´ ëŠ¥ë ¥ì„ ì¡°ì ˆí•©ë‹ˆë‹¤.
            </div>
            <RangeInput 
              label="êµ¬ì¡°ë¬¼ ëŒ€ìƒ ì¶”ê°€ í”¼í•´" 
              value={settings.slayer.structureDamage} 
              onChange={(v: number) => handleChange('slayer', 'structureDamage', v)} 
              unit="%" max={300} 
            />
          </>
        );
      case 'ìˆ˜í˜¸ê¸°ì‚¬':
        return (
          <>
            <div style={{fontSize:'12px', color:'#888', marginBottom:'10px'}}>
              * ê°™ì€ ë¼ì¸ ì•„êµ°ì˜ ìƒì¡´ë ¥ì„ ë†’ì—¬ì¤ë‹ˆë‹¤.
            </div>
            <RangeInput 
              label="ì•„êµ° ìƒì¡´ìœ¨ ì¦ê°€ ë³´ì •" 
              value={settings.guardian.survivalRate} 
              onChange={(v: number) => handleChange('guardian', 'survivalRate', v)} 
              unit="%" max={80} 
            />
          </>
        );
      default: return null;
    }
  };

  return (
    <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', zIndex: 9999, display: 'flex', justifyContent: 'center', alignItems: 'center' }}>
      <div style={{ width: '400px', background: '#161b22', border: '1px solid #30363d', borderRadius: '12px', overflow: 'hidden', boxShadow: '0 20px 50px rgba(0,0,0,0.8)' }}>

        {/* í—¤ë” */}
        <div style={{ padding: '15px', background: '#21262d', borderBottom: '1px solid #30363d', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <h3 style={{ margin: 0, color: '#fff', display: 'flex', alignItems: 'center', gap: '8px', fontSize: '16px' }}>
            <Sliders size={18} color="#58a6ff"/> {role} ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜
          </h3>
          <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#888', cursor: 'pointer' }}><X size={20}/></button>
        </div>

        {/* ë°”ë”” */}
        <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '20px' }}>
          {renderInputs()}
        </div>

        {/* í‘¸í„° */}
        <div style={{ padding: '15px', borderTop: '1px solid #30363d', display: 'flex', justifyContent: 'flex-end', background:'#0d1117' }}>
          <button onClick={handleSave} style={{ background: '#238636', color: '#fff', border: 'none', padding: '10px 20px', borderRadius: '6px', fontWeight: 'bold', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px' }}>
            <Save size={16}/> íŒ¨ì¹˜ ì ìš©
          </button>
        </div>
      </div>
    </div>
  );
};

// ìŠ¬ë¼ì´ë” ì»´í¬ë„ŒíŠ¸
const RangeInput = ({ label, value, onChange, unit, max, step = 1 }: any) => (
  <div>
    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px', fontSize: '12px', color: '#ccc' }}>
      <span>{label}</span>
      <span style={{ fontWeight: 'bold', color: '#58a6ff', fontFamily:'monospace' }}>{value}{unit}</span>
    </div>
    <input 
      type="range" min={0} max={max} step={step} value={value} 
      onChange={(e) => onChange(Number(e.target.value))} 
      style={{ width: '100%', accentColor: '#58a6ff', height: '4px', cursor: 'pointer' }} 
    />
  </div>
);

// === FILE: /src/components/hero/patch/SkillEditor.tsx ===

import React, { useState } from 'react';
import { HeroSkillSet } from '../../../types';
import { Edit2, Check } from 'lucide-react';

const MECHANIC_UI_CONFIG: any = {
  DAMAGE: [{ key: 'val', label: 'í”¼í•´ëŸ‰', max: 1000, step: 10 }, { key: 'adRatio', label: 'ADê³„ìˆ˜', max: 2.5, step: 0.05, color: '#e67e22' }, { key: 'apRatio', label: 'APê³„ìˆ˜', max: 3.0, step: 0.05, color: '#9b59b6' }],
  HEAL: [{ key: 'val', label: 'íšŒë³µëŸ‰', max: 800, step: 10, color: '#2ecc71' }, { key: 'apRatio', label: 'APê³„ìˆ˜', max: 2.0, step: 0.05, color: '#9b59b6' }],
  SHIELD: [{ key: 'val', label: 'ë³´í˜¸ë§‰', max: 1000, step: 10, color: '#3498db' }, { key: 'adRatio', label: 'ADê³„ìˆ˜', max: 1.5, step: 0.05, color: '#e67e22' }, { key: 'duration', label: 'ì§€ì†ì‹œê°„', max: 8, step: 0.5 }],
  HOOK: [{ key: 'val', label: 'ê·¸ë©ê±°ë¦¬', max: 1200, step: 25, color: '#f1c40f' }, { key: 'duration', label: 'ê¸°ì ˆì‹œê°„', max: 3, step: 0.1 }],
  DASH: [{ key: 'val', label: 'ì´ë™ê±°ë¦¬', max: 800, step: 10, color: '#9b59b6' }, { key: 'duration', label: 'ì¤€ë¹„ì‹œê°„', max: 1.5, step: 0.05 }],
  STUN: [{ key: 'duration', label: 'ê¸°ì ˆì‹œê°„', max: 4, step: 0.1, color: '#e74c3c' }, { key: 'val', label: 'ë²”ìœ„', max: 600, step: 10 }],
  STEALTH: [{ key: 'duration', label: 'ì§€ì†ì‹œê°„', max: 15, step: 0.5, color: '#95a5a6' }, { key: 'val', label: 'ì´ì†ì¦ê°€', max: 80, step: 1 }]
};

interface Props {
  skills: HeroSkillSet;
  onChange: (key: string, field: string, value: any) => void;
}

export const SkillEditor: React.FC<Props> = ({ skills, onChange }) => {
  const [selectedKey, setSelectedKey] = useState<keyof HeroSkillSet>('passive');
  const [activeField, setActiveField] = useState<string | null>(null);
  const [isEditingName, setIsEditingName] = useState(false);

  const currentSkill = skills[selectedKey];
  const uiConfig = MECHANIC_UI_CONFIG[currentSkill.mechanic] || MECHANIC_UI_CONFIG.DAMAGE;

  return (
    <div className="skill-editor">
      <div style={{ display: 'flex', gap: '6px', marginBottom: '20px' }}>
        {(['passive', 'q', 'w', 'e', 'r'] as const).map(k => (
          <button 
            key={k} 
            onClick={() => {setSelectedKey(k); setActiveField(null);}} 
            style={{ 
              flex: 1, padding: '10px', 
              background: selectedKey === k ? '#30363d' : '#161b22', 
              border: '1px solid #30363d', borderRadius: '10px', 
              color: selectedKey === k ? '#fff' : '#8b949e', fontWeight: 'bold', cursor: 'pointer' 
            }}
          >
            {k === 'passive' ? 'P' : k.toUpperCase()}
          </button>
        ))}
      </div>

      <div style={{ marginBottom: '15px', padding: '12px', background: '#161b22', borderRadius: '12px', border: '1px solid #30363d' }}>
        {isEditingName ? (
          <div style={{ display: 'flex', gap: '8px' }}>
            <input value={currentSkill.name} onChange={e => onChange(selectedKey, 'name', e.target.value)} onBlur={() => setIsEditingName(false)} autoFocus style={{ background: '#000', border: '1px solid #58a6ff', color: '#fff', padding: '5px', flex: 1, outline: 'none' }} />
            <Check size={16} color="#2ecc71" onClick={() => setIsEditingName(false)} style={{ cursor: 'pointer' }} />
          </div>
        ) : (
          <div onClick={() => setIsEditingName(true)} style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
            <span style={{ fontSize: '10px', color: '#8b949e', fontWeight: 'bold' }}>{selectedKey.toUpperCase()}</span>
            <span style={{ fontWeight: 'bold', flex: 1, color: '#fff' }}>{currentSkill.name}</span>
            <Edit2 size={12} color="#58a6ff" />
          </div>
        )}
      </div>

      <select value={currentSkill.mechanic} onChange={e => onChange(selectedKey, 'mechanic', e.target.value)} style={{ width: '100%', padding: '10px', background: '#161b22', border: '1px solid #30363d', color: '#fff', borderRadius: '10px', marginBottom: '15px' }}>
        <option value="DAMAGE">âš”ï¸ í”¼í•´</option>
        <option value="HEAL">ğŸ’š íšŒë³µ</option>
        <option value="SHIELD">ğŸ›¡ï¸ ë³´í˜¸ë§‰</option>
        <option value="HOOK">ğŸª ê·¸ë©</option>
        <option value="DASH">ğŸ’¨ ì´ë™</option>
        <option value="STUN">ğŸ’« ê¸°ì ˆ</option>
        <option value="STEALTH">ğŸ‘» ì€ì‹ </option>
      </select>

      <div style={{ display: 'flex', gap: '6px', marginBottom: '15px' }}>
        {uiConfig.map((item: any) => (
          <div key={item.key} onClick={() => setActiveField(item.key)} style={{ flex: 1, background: '#161b22', border: activeField === item.key ? '1px solid #58a6ff' : '1px solid #30363d', borderRadius: '10px', padding: '8px 4px', textAlign: 'center', cursor: 'pointer' }}>
            <label style={{ display: 'block', fontSize: '8px', color: '#8b949e', marginBottom: '4px' }}>{item.label}</label>
            <div style={{ fontSize: '14px', fontWeight: 'bold', color: item.color || '#fff' }}>{(currentSkill as any)[item.key]}</div>
          </div>
        ))}
      </div>

      {activeField && (
        <div style={{ background: '#161b22', padding: '15px', borderRadius: '15px', border: '1px solid #58a6ff44' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px' }}>
            <span style={{ color: '#aaa', fontSize: '12px' }}>{activeField.toUpperCase()} ì¡°ì ˆ</span>
            <strong style={{ color: '#58a6ff' }}>{(currentSkill as any)[activeField]}</strong>
          </div>
          <input 
            type="range" 
            min={0} 
            max={(uiConfig.find((c: any) => c.key === activeField)?.max || 1000)}
            step={(uiConfig.find((c: any) => c.key === activeField)?.step || 1)}
            value={(currentSkill as any)[activeField]} 
            onChange={e => onChange(selectedKey, activeField, Number(e.target.value))}
            style={{ width: '100%', accentColor: '#58a6ff' }}
          />
        </div>
      )}
    </div>
  );
};

// === FILE: /src/components/hero/patch/StatEditor.tsx ===

// ==========================================
// FILE PATH: /src/components/hero/patch/StatEditor.tsx
// ==========================================

import React from 'react';

const STAT_CONFIG: any = {
  // [ìˆ˜ì •] ìµœì†Œê°’ 0, ìµœëŒ€ê°’ ìƒí–¥ ì¡°ì •
  baseAtk: { min: 0, max: 500, step: 1, color: '#f1c40f', label: 'ê¸°ë³¸ ê³µê²©ë ¥' },
  ad: { min: 0, max: 1000, step: 5, color: '#e67e22', label: 'ì¶”ê°€ AD' },
  ap: { min: 0, max: 1000, step: 10, color: '#9b59b6', label: 'ì£¼ë¬¸ë ¥(AP)' },
  crit: { min: 0, max: 100, step: 1, color: '#e74c3c', label: 'ì¹˜ëª…íƒ€ìœ¨(%)' },
  hp: { min: 100, max: 10000, step: 50, color: '#2ecc71', label: 'ì²´ë ¥(HP)' },
  armor: { min: 0, max: 500, step: 2, color: '#3498db', label: 'ë°©ì–´ë ¥' },
  speed: { min: 100, max: 1000, step: 5, color: '#95a5a6', label: 'ì´ë™ ì†ë„' }
};

interface Props {
  fields: string[];
  stats: any;
  onChange: (field: string, value: number) => void;
}

export const StatEditor: React.FC<Props> = ({ fields, stats, onChange }) => {
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>
      {fields.map(f => {
        const conf = STAT_CONFIG[f];
        if (!conf) return null;
        return (
          <div key={f} style={{ background: '#161b22', padding: '20px', borderRadius: '12px', border: '1px solid #30363d' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '15px', fontSize: '14px', fontWeight: 'bold' }}>
              <label style={{ color: '#ccc' }}>{conf.label}</label>
              <span style={{ color: conf.color, fontSize:'16px' }}>{stats[f]}</span>
            </div>

            {/* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ ê°œì„  */}
            <input 
              type="range" min={conf.min} max={conf.max} step={conf.step}
              value={stats[f]} onChange={e => onChange(f, Number(e.target.value))}
              style={{ 
                width: '100%', 
                accentColor: conf.color, 
                cursor: 'pointer',
                height: '6px',
                background: '#0d1117',
                borderRadius: '3px'
              }}
            />

            {/* ë¯¸ì„¸ ì¡°ì • ë²„íŠ¼ ì¶”ê°€ (+/-) */}
            <div style={{ display:'flex', justifyContent:'flex-end', gap:'10px', marginTop:'10px' }}>
              <button 
                onClick={() => onChange(f, Math.max(conf.min, stats[f] - conf.step))}
                style={{ background:'#30363d', border:'none', color:'#fff', borderRadius:'4px', width:'30px', height:'30px', cursor:'pointer' }}
              >-</button>
              <button 
                onClick={() => onChange(f, Math.min(conf.max, stats[f] + conf.step))}
                style={{ background:'#30363d', border:'none', color:'#fff', borderRadius:'4px', width:'30px', height:'30px', cursor:'pointer' }}
              >+</button>
            </div>
          </div>
        );
      })}
    </div>
  );
};

// === FILE: /src/components/layout/Header.tsx ===

// ==========================================
// FILE PATH: /src/components/layout/Header.tsx
// ==========================================

import React from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Settings, Save, FastForward, Play, Pause } from 'lucide-react';

interface Props {
  isMobile: boolean;
  onOpenSystemMenu: () => void;
}

export const Header: React.FC<Props> = ({ isMobile, onOpenSystemMenu }) => {
  const { gameState, togglePlay, setSpeed } = useGameStore();

  const formatTime = (h: number, m: number, s: number) => 
    `${String(h || 0).padStart(2, '0')}:${String(m || 0).padStart(2, '0')}:${String(s || 0).padStart(2, '0')}`;

  // ë°°ì† ë²„íŠ¼ ìŠ¤íƒ€ì¼
  const getBtnStyle = (speed: number) => ({
    padding: '6px 10px', 
    background: gameState.gameSpeed === speed ? '#58a6ff' : '#30363d',
    border: '1px solid #444', 
    borderRadius: '6px', 
    color: '#fff', 
    fontSize: '11px', 
    fontWeight: 'bold',
    cursor: 'pointer',
    minWidth: '40px'
  });

  return (
    <header style={{ 
      display: 'flex', flexDirection: isMobile ? 'column' : 'row', 
      justifyContent: 'space-between', alignItems: isMobile ? 'stretch' : 'center', 
      marginBottom: '20px', background: '#161b22', padding: '15px', 
      borderRadius: '12px', border: '1px solid #30363d', gap: isMobile ? '15px' : '0' 
    }}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
        <div>
          <h1 style={{ margin: 0, fontSize: '20px', color: '#fff' }}>
            ORACLE <span style={{ fontSize:'12px', background:'#58a6ff', color:'#000', padding:'2px 6px', borderRadius:'4px', fontWeight:'bold'}}>PRO</span>
          </h1>
          <div style={{ display: 'flex', gap: '15px', marginTop: '5px', fontSize: '14px', color: '#8b949e' }}>
            <span>ğŸ“… S{gameState.season || 1}</span>
            <span>D{gameState.day || 1}</span>
            <span style={{ color: '#fff', fontWeight: 'bold', fontFamily: 'monospace' }}>
              â° {formatTime(gameState.hour, gameState.minute, gameState.second)}
            </span>
          </div>
        </div>
        {isMobile && (
          <button onClick={onOpenSystemMenu} style={{ background:'none', border:'none', color:'#8b949e' }}>
            <Settings size={24} />
          </button>
        )}
      </div>

      <div style={{ display: 'flex', gap: '10px', alignItems: 'center', justifyContent: isMobile ? 'space-between' : 'flex-end' }}>
        <div style={{ display:'flex', alignItems:'center', gap:'6px' }}>
          {!isMobile && (
            <button className="btn" onClick={onOpenSystemMenu} style={{ background: '#21262d', color: '#ccc', border:'1px solid #30363d', display:'flex', alignItems:'center', gap:'6px', padding: '8px 12px', marginRight:'10px' }}>
              <Save size={16}/> ì €ì¥/ë¡œë“œ
            </button>
          )}

          {/* [ìˆ˜ì •] ë°°ì† ë²„íŠ¼: 1ì´ˆ / 1ë¶„(60ì´ˆ) / 10ë¶„(600ì´ˆ) */}
          <button style={getBtnStyle(1)} onClick={() => setSpeed(1)}>1ì´ˆ</button>
          <button style={getBtnStyle(60)} onClick={() => setSpeed(60)}>1ë¶„</button>
          <button style={getBtnStyle(600)} onClick={() => setSpeed(600)}>10ë¶„</button>
        </div>

        <button className="btn" onClick={togglePlay} style={{ background: gameState.isPlaying ? '#da3633' : '#238636', width: '80px', color:'white', fontWeight:'bold', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px' }}>
          {gameState.isPlaying ? <><Pause size={16}/> ì •ì§€</> : <><Play size={16}/> ì¬ìƒ</>}
        </button>
      </div>
    </header>
  );
};

// === FILE: /src/components/shop/ItemPatchModal.tsx ===

// ==========================================
// FILE PATH: /src/components/shop/ItemPatchModal.tsx
// ==========================================

import React, { useState, useEffect, useRef } from 'react';
import { Item } from '../../types';
import { useGameStore } from '../../store/useGameStore';
import { X, Save, Sword, Shield, Zap, Briefcase, Coins, Camera, Trash2 } from 'lucide-react';
import { GameIcon } from '../common/GameIcon'; // GameIcon import

interface Props {
  item?: Item | null; // nullì´ë©´ 'ìƒˆ ì•„ì´í…œ ì¶”ê°€', ìˆìœ¼ë©´ 'ìˆ˜ì •'
  onClose: () => void;
}

const DEFAULT_ITEM: Item = {
  id: '',
  name: '',
  cost: 1000,
  ad: 0, ap: 0, hp: 0, armor: 0, crit: 0, speed: 0,
  type: 'WEAPON',
  description: ''
};

export const ItemPatchModal: React.FC<Props> = ({ item, onClose }) => {
  const { addItem, updateItem, setCustomImage, removeCustomImage } = useGameStore();
  const [data, setData] = useState<Item>(DEFAULT_ITEM);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [isHovered, setIsHovered] = useState(false);

  useEffect(() => {
    if (item) {
      setData({ ...item }); // ê¸°ì¡´ ì•„ì´í…œ ë°ì´í„° ë³µì‚¬
    } else {
      // ìƒˆ ì•„ì´í…œì¼ ê²½ìš° ID ìë™ ìƒì„±
      setData({ ...DEFAULT_ITEM, id: `i_custom_${Date.now()}` });
    }
  }, [item]);

  const handleSave = () => {
    if (!data.name) {
      alert('ì•„ì´í…œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (item) {
      updateItem(item.id, data);
      alert('ì•„ì´í…œ íŒ¨ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    } else {
      addItem(data);
      alert('ì‹ ê·œ ì•„ì´í…œì´ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    onClose();
  };

  const handleChange = (field: keyof Item, value: any) => {
    setData(prev => ({ ...prev, [field]: value }));
  };

  // ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        if (typeof reader.result === 'string') {
          setCustomImage(data.id, reader.result);
        }
      };
      reader.readAsDataURL(file);
    }
  };

  // íƒ€ì…ì— ë”°ë¥¸ ê¸°ë³¸ ì•„ì´ì½˜ ë°˜í™˜
  const getDefaultIcon = () => {
    const size = 32;
    const color = '#8b949e';
    switch(data.type) {
      case 'WEAPON': return <Sword size={size} color="#e74c3c"/>;
      case 'ARMOR': return <Shield size={size} color="#2ecc71"/>;
      case 'ACCESSORY': return <Briefcase size={size} color="#f1c40f"/>;
      case 'POWER': return <Zap size={size} color="#9b59b6"/>;
      default: return <Coins size={size} color={color}/>;
    }
  };

  return (
    <div style={{
      position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.85)', zIndex: 9999,
      display: 'flex', justifyContent: 'center', alignItems: 'center', backdropFilter: 'blur(5px)', padding: '10px'
    }}>
      <div style={{ 
        width: '100%', maxWidth: '500px', background: '#161b22', border: '1px solid #30363d', 
        borderRadius: '16px', overflow: 'hidden', boxShadow: '0 20px 50px rgba(0,0,0,0.8)',
        display: 'flex', flexDirection: 'column', maxHeight: '90vh'
      }}>

        {/* í—¤ë” */}
        <div style={{ padding: '15px 20px', borderBottom: '1px solid #30363d', display: 'flex', justifyContent: 'space-between', alignItems: 'center', background:'#21262d' }}>
          <h3 style={{ margin: 0, color: '#fff', display:'flex', alignItems:'center', gap:'8px', fontSize:'16px' }}>
            {item ? 'ğŸ› ï¸ ì•„ì´í…œ íŒ¨ì¹˜' : 'âœ¨ ì‹ ê·œ ì•„ì´í…œ ê°œë°œ'}
          </h3>
          <button onClick={onClose} style={{ background:'none', border:'none', color:'#8b949e', cursor:'pointer' }}><X size={24}/></button>
        </div>

        {/* ë°”ë”” (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */}
        <div style={{ padding: '20px', overflowY: 'auto', flex: 1 }}>

          {/* 0. ì•„ì´ì½˜ ë° ê¸°ë³¸ ì •ë³´ (ë ˆì´ì•„ì›ƒ ë³€ê²½) */}
          <div style={{ display: 'flex', gap: '20px', marginBottom: '20px', alignItems: 'flex-start' }}>

            {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ */}
            <div style={{ display:'flex', flexDirection:'column', alignItems:'center', gap:'5px' }}>
              <div 
                style={{ position: 'relative', cursor: 'pointer' }}
                onMouseEnter={() => setIsHovered(true)}
                onMouseLeave={() => setIsHovered(false)}
                onClick={() => fileInputRef.current?.click()}
              >
                <GameIcon 
                  id={data.id} 
                  size={80} 
                  fallback={getDefaultIcon()} 
                  shape="rounded" 
                  border="2px solid #30363d"
                />

                {/* í˜¸ë²„ ì˜¤ë²„ë ˆì´ */}
                <div style={{
                  position: 'absolute', inset: 0, borderRadius: '12px',
                  background: 'rgba(0,0,0,0.5)', display: isHovered ? 'flex' : 'none',
                  alignItems: 'center', justifyContent: 'center', transition: '0.2s'
                }}>
                  <Camera size={24} color="#fff" />
                </div>

                {/* ì¹´ë©”ë¼ ë±ƒì§€ */}
                <div style={{ position:'absolute', bottom:-5, right:-5, background:'#58a6ff', borderRadius:'50%', padding:'4px', border:'2px solid #161b22' }}>
                  <Camera size={12} color="#000" />
                </div>

                <input type="file" ref={fileInputRef} style={{ display: 'none' }} accept="image/*" onChange={handleImageUpload} />
              </div>

              <button 
                onClick={() => removeCustomImage(data.id)}
                style={{ fontSize:'10px', color:'#da3633', background:'none', border:'none', cursor:'pointer', display:'flex', alignItems:'center', gap:'2px' }}
              >
                <Trash2 size={10}/> ì‚¬ì§„ ì‚­ì œ
              </button>
            </div>

            {/* ì´ë¦„ ë° ê°€ê²© ì…ë ¥ */}
            <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '10px' }}>
              <div className="input-group">
                <label style={{display:'block', fontSize:'11px', color:'#8b949e', marginBottom:'4px'}}>ì•„ì´í…œ ì´ë¦„</label>
                <input 
                  type="text" value={data.name} 
                  onChange={(e) => handleChange('name', e.target.value)}
                  style={{ width: '100%', padding: '10px', background: '#0d1117', border: '1px solid #30363d', color: '#fff', borderRadius: '6px', boxSizing:'border-box', fontWeight:'bold' }}
                  placeholder="ì´ë¦„ ì…ë ¥..."
                />
              </div>
              <div className="input-group">
                <label style={{display:'block', fontSize:'11px', color:'#8b949e', marginBottom:'4px'}}>ê°€ê²© (Gold)</label>
                <input 
                  type="number" value={data.cost} 
                  onChange={(e) => handleChange('cost', Number(e.target.value))}
                  style={{ width: '100%', padding: '10px', background: '#0d1117', border: '1px solid #30363d', color: '#f1c40f', fontWeight:'bold', borderRadius: '6px', boxSizing:'border-box' }}
                />
              </div>
            </div>
          </div>

          {/* 1. íƒ€ì… ì„ íƒ */}
          <div style={{ marginBottom: '20px' }}>
            <label style={{display:'block', fontSize:'11px', color:'#8b949e', marginBottom:'5px'}}>ì•„ì´í…œ ë¶„ë¥˜</label>
            <div style={{ display: 'flex', gap: '8px', overflowX:'auto', paddingBottom:'5px' }}>
              {[
                { id: 'WEAPON', label: 'ë¬´ê¸°', icon: Sword, color: '#e74c3c' },
                { id: 'ARMOR', label: 'ë°©ì–´êµ¬', icon: Shield, color: '#2ecc71' },
                { id: 'ACCESSORY', label: 'ì¥ì‹ êµ¬', icon: Briefcase, color: '#f1c40f' },
                { id: 'POWER', label: 'ê¶ŒëŠ¥', icon: Zap, color: '#9b59b6' },
              ].map(t => (
                <button 
                  key={t.id}
                  onClick={() => handleChange('type', t.id)}
                  style={{ 
                    flex: 1, padding: '10px', borderRadius: '8px', border: `1px solid ${data.type === t.id ? t.color : '#30363d'}`,
                    background: data.type === t.id ? `${t.color}22` : '#0d1117',
                    color: data.type === t.id ? t.color : '#8b949e',
                    cursor: 'pointer', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '5px', fontSize:'11px', fontWeight:'bold', minWidth:'60px'
                  }}
                >
                  <t.icon size={16}/> {t.label}
                </button>
              ))}
            </div>
          </div>

          {/* 2. ìŠ¤íƒ¯ ì„¤ì • */}
          <div style={{ background:'#0d1117', padding:'15px', borderRadius:'8px', border:'1px solid #30363d', marginBottom:'20px' }}>
            <label style={{display:'block', fontSize:'12px', color:'#fff', marginBottom:'10px', fontWeight:'bold'}}>ëŠ¥ë ¥ì¹˜ ì„¤ì •</label>
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>
              <StatInput label="ê³µê²©ë ¥ (AD)" value={data.ad} onChange={(v)=>handleChange('ad', v)} color="#e74c3c" />
              <StatInput label="ì£¼ë¬¸ë ¥ (AP)" value={data.ap} onChange={(v)=>handleChange('ap', v)} color="#9b59b6" />
              <StatInput label="ì²´ë ¥ (HP)" value={data.hp} onChange={(v)=>handleChange('hp', v)} color="#2ecc71" />
              <StatInput label="ë°©ì–´ë ¥ (Armor)" value={data.armor} onChange={(v)=>handleChange('armor', v)} color="#3498db" />
              <StatInput label="ì¹˜ëª…íƒ€ (%)" value={data.crit} onChange={(v)=>handleChange('crit', v)} color="#e67e22" />
              <StatInput label="ì´ë™ì†ë„" value={data.speed} onChange={(v)=>handleChange('speed', v)} color="#fff" />
            </div>
          </div>

          {/* 3. ì„¤ëª… */}
          <div>
            <label style={{display:'block', fontSize:'11px', color:'#8b949e', marginBottom:'5px'}}>ì•„ì´í…œ ì„¤ëª…</label>
            <textarea 
              value={data.description || ''} 
              onChange={(e) => handleChange('description', e.target.value)}
              rows={3}
              style={{ width: '100%', padding: '10px', background: '#0d1117', border: '1px solid #30363d', color: '#ccc', borderRadius: '6px', resize:'none', boxSizing:'border-box', fontSize:'12px' }}
              placeholder="ì•„ì´í…œì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."
            />
          </div>

        </div>

        {/* í‘¸í„° */}
        <div style={{ padding: '15px 20px', borderTop: '1px solid #30363d', display: 'flex', justifyContent: 'flex-end', background:'#21262d' }}>
          <button onClick={handleSave} style={{ background: '#238636', color: '#fff', border: 'none', padding: '12px 24px', borderRadius: '8px', fontWeight: 'bold', cursor: 'pointer', display:'flex', alignItems:'center', gap:'6px' }}>
            <Save size={16}/> {item ? 'íŒ¨ì¹˜ ì ìš©' : 'ì•„ì´í…œ ìƒì„±'}
          </button>
        </div>

      </div>
    </div>
  );
};

const StatInput = ({ label, value, onChange, color }: any) => (
  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
    <span style={{ fontSize: '11px', color: '#8b949e' }}>{label}</span>
    <input 
      type="number" value={value} 
      onChange={(e) => onChange(Number(e.target.value))}
      style={{ width: '60px', background: 'none', borderBottom: `1px solid ${color}`, borderTop:'none', borderLeft:'none', borderRight:'none', color: color, textAlign: 'right', fontWeight: 'bold', outline: 'none', padding:'4px 0' }}
    />
  </div>
);

// === FILE: /src/components/shop/ItemStatsView.tsx ===

// ==========================================
// FILE PATH: /src/components/shop/ItemStatsView.tsx
// ==========================================

import React, { useState } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Item } from '../../types';
import { Trophy, Target, Activity, ArrowUp, ArrowDown } from 'lucide-react';

export const ItemStatsView: React.FC = () => {
  const { shopItems, gameState } = useGameStore();

  // [ìˆ˜ì •] ê¸°ì¡´ ì„¸ì´ë¸Œ íŒŒì¼ì— itemStatsê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ë¹ˆ ê°ì²´({}) í• ë‹¹
  const itemStats = gameState.itemStats || {};
  const godStats = gameState.godStats || { totalMatches: 0 };

  const [sortKey, setSortKey] = useState<'winRate' | 'pickRate' | 'kda'>('pickRate');

  // ì „ì²´ ê²Œì„ ìˆ˜ (í”½ë¥  ê³„ì‚°ìš©)
  const totalPlayerGames = Math.max(1, godStats.totalMatches * 10);

  // ë°ì´í„° ê°€ê³µ
  const statsList = shopItems.map(item => {
    // itemStatsê°€ ë¹„ì–´ìˆì–´ë„ ì•ˆì „í•˜ê²Œ ê¸°ë³¸ê°’ ì‚¬ìš©
    const stat = itemStats[item.id] || { totalPicks: 0, totalWins: 0, totalKills: 0, totalDeaths: 0, totalAssists: 0 };

    const pickRate = (stat.totalPicks / totalPlayerGames) * 100;
    const winRate = stat.totalPicks > 0 ? (stat.totalWins / stat.totalPicks) * 100 : 0;
    const kills = stat.totalPicks > 0 ? stat.totalKills / stat.totalPicks : 0;
    const deaths = stat.totalPicks > 0 ? stat.totalDeaths / stat.totalPicks : 0;
    const assists = stat.totalPicks > 0 ? stat.totalAssists / stat.totalPicks : 0;
    const kda = deaths === 0 ? (kills + assists) : (kills + assists) / deaths;

    return {
      ...item,
      stat,
      displayPickRate: pickRate,
      displayWinRate: winRate,
      displayKda: kda,
      avgKdaStr: `${kills.toFixed(1)} / ${deaths.toFixed(1)} / ${assists.toFixed(1)}`
    };
  });

  // ì •ë ¬
  const sortedList = [...statsList].sort((a, b) => {
    if (sortKey === 'winRate') return b.displayWinRate - a.displayWinRate;
    if (sortKey === 'kda') return b.displayKda - a.displayKda;
    return b.displayPickRate - a.displayPickRate; // default: pickRate
  });

  const getWinRateColor = (rate: number) => {
    if (rate >= 55) return '#ff4d4d'; // OP
    if (rate >= 50) return '#3fb950'; // Good
    return '#8b949e'; // Bad
  };

  return (
    <div style={{ padding: '0 5px' }}>
      {/* ì •ë ¬ ë²„íŠ¼ */}
      <div style={{ display: 'flex', gap: '10px', marginBottom: '15px', justifyContent: 'flex-end' }}>
        {[
          { key: 'pickRate', label: 'ì±„íƒë¥  ìˆœ' },
          { key: 'winRate', label: 'ìŠ¹ë¥  ìˆœ' },
          { key: 'kda', label: 'í‰ì (KDA) ìˆœ' }
        ].map((btn) => (
          <button
            key={btn.key}
            onClick={() => setSortKey(btn.key as any)}
            style={{
              background: sortKey === btn.key ? '#30363d' : 'transparent',
              color: sortKey === btn.key ? '#fff' : '#888',
              border: '1px solid #30363d', padding: '6px 12px', borderRadius: '6px', cursor: 'pointer', fontSize: '11px', fontWeight: 'bold',
              display:'flex', alignItems:'center', gap:'4px'
            }}
          >
            {btn.label} {sortKey === btn.key && <ArrowDown size={12}/>}
          </button>
        ))}
      </div>

      {/* í…Œì´ë¸” í—¤ë” */}
      <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr 1fr 1.5fr', padding: '10px', background: '#21262d', borderRadius: '8px 8px 0 0', fontSize: '11px', color: '#8b949e', fontWeight: 'bold' }}>
        <div>ì•„ì´í…œ ëª…</div>
        <div style={{ textAlign: 'center' }}>ì±„íƒë¥ </div>
        <div style={{ textAlign: 'center' }}>ìŠ¹ë¥ </div>
        <div style={{ textAlign: 'right', paddingRight:'10px' }}>í‰ê·  KDA</div>
      </div>

      {/* ë¦¬ìŠ¤íŠ¸ */}
      <div style={{ border: '1px solid #30363d', borderTop: 'none', borderRadius: '0 0 8px 8px', background: '#161b22' }}>
        {sortedList.map((item, idx) => (
          <div key={item.id} style={{ 
            display: 'grid', gridTemplateColumns: '2fr 1fr 1fr 1.5fr', 
            padding: '12px 10px', borderBottom: '1px solid #2c2c2f', alignItems: 'center' 
          }}>
            {/* 1. ì•„ì´í…œ ì •ë³´ */}
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
              <div style={{ fontSize: '12px', color: '#555', width: '20px', textAlign: 'center' }}>{idx + 1}</div>
              <div>
                <div style={{ color: item.type === 'POWER' ? '#9b59b6' : '#fff', fontWeight: 'bold', fontSize: '13px' }}>
                  {item.name}
                </div>
                <div style={{ fontSize: '10px', color: '#666' }}>{item.cost} G</div>
              </div>
            </div>

            {/* 2. ì±„íƒë¥  */}
            <div style={{ textAlign: 'center' }}>
              <div style={{ color: '#fff', fontSize: '13px', fontWeight: 'bold' }}>{item.displayPickRate.toFixed(1)}%</div>
              <div style={{ fontSize: '10px', color: '#555' }}>{item.stat.totalPicks.toLocaleString()}íšŒ</div>
            </div>

            {/* 3. ìŠ¹ë¥  */}
            <div style={{ textAlign: 'center' }}>
              <div style={{ color: getWinRateColor(item.displayWinRate), fontSize: '13px', fontWeight: 'bold' }}>
                {item.displayWinRate.toFixed(1)}%
              </div>
            </div>

            {/* 4. KDA */}
            <div style={{ textAlign: 'right', paddingRight:'10px' }}>
              <div style={{ color: item.displayKda >= 3 ? '#e89d40' : '#ccc', fontWeight: 'bold', fontSize: '13px' }}>
                {item.displayKda.toFixed(2)}:1
              </div>
              <div style={{ fontSize: '10px', color: '#666' }}>{item.avgKdaStr}</div>
            </div>
          </div>
        ))}

        {sortedList.length === 0 && (
          <div style={{ padding: '40px', textAlign: 'center', color: '#555' }}>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        )}
      </div>
    </div>
  );
};

// === FILE: /src/components/shop/ShopTab.tsx ===

// ==========================================
// FILE PATH: /src/components/shop/ShopTab.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { Coins, Plus, Trash2, Shield, Sword, Zap, Briefcase, BarChart2, ShoppingCart, Edit2 } from 'lucide-react';
import { ItemStatsView } from './ItemStatsView'; 
import { ItemPatchModal } from './ItemPatchModal';
import { Item } from '../../types';

export const ShopTab: React.FC = () => {
  const { shopItems, deleteItem } = useGameStore();
  const [mode, setMode] = useState<'MANAGE' | 'STATS'>('MANAGE');
  const [filter, setFilter] = useState<string>('ALL');
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  // ëª¨ë‹¬ ìƒíƒœ
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingItem, setEditingItem] = useState<Item | null>(null);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  const filteredItems = filter === 'ALL' ? shopItems : shopItems.filter(i => i.type === filter);

  const handleCreate = () => {
    setEditingItem(null); 
    setIsModalOpen(true);
  };

  const handleEdit = (item: Item) => {
    setEditingItem(item); 
    setIsModalOpen(true);
  };

  const getTypeIcon = (type: string) => {
    switch(type) {
      case 'WEAPON': return <Sword size={14} color="#e74c3c"/>;
      case 'ARMOR': return <Shield size={14} color="#2ecc71"/>;
      case 'ACCESSORY': return <Briefcase size={14} color="#f1c40f"/>;
      case 'POWER': return <Zap size={14} color="#9b59b6"/>;
      default: return <Coins size={14}/>;
    }
  };

  // ìŠ¤íƒ¯ ë±ƒì§€ ì»´í¬ë„ŒíŠ¸
  const StatBadge = ({ label, val, color }: { label: string, val: number, color: string }) => {
    if (val <= 0) return null;
    return (
      <span style={{ 
        fontSize: '10px', fontWeight: 'bold', color: color, 
        background: `${color}11`, border: `1px solid ${color}33`, 
        padding: '2px 5px', borderRadius: '4px', whiteSpace: 'nowrap'
      }}>
        {label} +{val}
      </span>
    );
  };

  return (
    <div style={{ paddingBottom: '80px' }}>

      {/* ìƒë‹¨ í—¤ë” */}
      <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'15px', background:'#21262d', padding:'10px 15px', borderRadius:'12px', border:'1px solid #30363d' }}>
        <h2 style={{ margin:0, color:'#fff', display:'flex', alignItems:'center', gap:'10px', fontSize:'16px' }}>
          <Coins color="#f1c40f" size={20}/> 
          {isMobile ? 'ìƒì ' : 'ì•„ì´í…œ ìƒì '}
        </h2>

        <div style={{ display:'flex', background:'#0d1117', padding:'3px', borderRadius:'8px', border:'1px solid #30363d' }}>
          <button 
            onClick={() => setMode('MANAGE')}
            style={{ 
              display:'flex', alignItems:'center', gap:'6px', padding:'6px 12px', borderRadius:'6px', border:'none', cursor:'pointer', fontWeight:'bold', fontSize:'11px',
              background: mode === 'MANAGE' ? '#58a6ff' : 'transparent', color: mode === 'MANAGE' ? '#000' : '#8b949e'
            }}
          >
            <ShoppingCart size={14}/> ê´€ë¦¬
          </button>
          <button 
            onClick={() => setMode('STATS')}
            style={{ 
              display:'flex', alignItems:'center', gap:'6px', padding:'6px 12px', borderRadius:'6px', border:'none', cursor:'pointer', fontWeight:'bold', fontSize:'11px',
              background: mode === 'STATS' ? '#58a6ff' : 'transparent', color: mode === 'STATS' ? '#000' : '#8b949e'
            }}
          >
            <BarChart2 size={14}/> í†µê³„
          </button>
        </div>
      </div>

      {mode === 'STATS' && <ItemStatsView />}

      {mode === 'MANAGE' && (
        <>
          {/* í•„í„° ë²„íŠ¼ */}
          <div style={{ display:'flex', gap:'5px', marginBottom:'15px', overflowX:'auto', paddingBottom:'5px' }}>
            {['ALL', 'WEAPON', 'ARMOR', 'ACCESSORY', 'POWER'].map(f => (
              <button 
                key={f} 
                onClick={() => setFilter(f)}
                style={{ 
                  background: filter === f ? '#30363d' : '#161b22', border: '1px solid #30363d',
                  color: filter === f ? '#fff' : '#888',
                  padding: '6px 10px', borderRadius: '6px', cursor:'pointer', fontWeight:'bold', fontSize:'11px', whiteSpace:'nowrap'
                }}
              >
                {f}
              </button>
            ))}
          </div>

          {/* ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ (ëª¨ë°”ì¼ ìµœì í™” ì ìš©) */}
          <div style={{ display:'flex', flexDirection:'column', gap:'8px' }}>
            {filteredItems.map(item => (
              <div key={item.id} style={{ 
                background:'#161b22', border:'1px solid #30363d', borderRadius:'10px', padding:'10px', 
                display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap:'10px'
              }}>

                {/* 1. ì¢Œì¸¡: ì•„ì´ì½˜ + ê¸°ë³¸ ì •ë³´ */}
                <div style={{ display:'flex', alignItems:'center', gap:'10px', minWidth: isMobile ? '100px' : '150px' }}>
                  <div style={{ width:'36px', height:'36px', background:'#0d1117', borderRadius:'8px', border:'1px solid #444', display:'flex', alignItems:'center', justifyContent:'center', flexShrink:0 }}>
                    {getTypeIcon(item.type)}
                  </div>
                  <div>
                    <div style={{ fontWeight:'bold', color: item.type === 'POWER' ? '#9b59b6' : '#fff', fontSize:'13px', lineHeight:'1.2' }}>{item.name}</div>
                    <div style={{ fontSize:'11px', color:'#f1c40f', fontWeight:'bold' }}>{item.cost.toLocaleString()} G</div>
                  </div>
                </div>

                {/* 2. ì¤‘ì•™: ìŠ¤íƒ¯ (ëª¨ë°”ì¼ì—ì„œëŠ” ì˜†ìœ¼ë¡œ ë°°ì¹˜) */}
                <div style={{ 
                  flex: 1, display: 'flex', flexWrap: 'wrap', gap: '4px', 
                  justifyContent: isMobile ? 'flex-start' : 'center',
                  alignContent: 'center'
                }}>
                  <StatBadge label="AD" val={item.ad} color="#e74c3c" />
                  <StatBadge label="AP" val={item.ap} color="#9b59b6" />
                  <StatBadge label="HP" val={item.hp} color="#2ecc71" />
                  <StatBadge label="DEF" val={item.armor} color="#3498db" />
                  <StatBadge label="CRI" val={item.crit} color="#e67e22" />
                  <StatBadge label="SPD" val={item.speed} color="#fff" />
                </div>

                {/* 3. ìš°ì¸¡: ë²„íŠ¼ */}
                <div style={{ display:'flex', gap:'4px', flexShrink:0 }}>
                  <button onClick={() => handleEdit(item)} style={{ background:'#21262d', border:'1px solid #333', color:'#ccc', cursor:'pointer', width:'28px', height:'28px', borderRadius:'6px', display:'flex', alignItems:'center', justifyContent:'center' }}>
                    <Edit2 size={14}/>
                  </button>
                  <button onClick={() => deleteItem(item.id)} style={{ background:'#3f1515', border:'1px solid #5a1e1e', color:'#ff6b6b', cursor:'pointer', width:'28px', height:'28px', borderRadius:'6px', display:'flex', alignItems:'center', justifyContent:'center' }}>
                    <Trash2 size={14}/>
                  </button>
                </div>

              </div>
            ))}

            {/* ì•„ì´í…œ ì¶”ê°€ ë²„íŠ¼ (ë§¨ ì•„ë˜) */}
            <div onClick={handleCreate} style={{ 
              border:'2px dashed #30363d', borderRadius:'10px', 
              display:'flex', alignItems:'center', justifyContent:'center', 
              padding:'12px', cursor:'pointer', color:'#555', transition:'0.2s', marginTop:'5px'
            }}
            onMouseEnter={e => {e.currentTarget.style.borderColor = '#58a6ff'; e.currentTarget.style.color = '#58a6ff'}}
            onMouseLeave={e => {e.currentTarget.style.borderColor = '#30363d'; e.currentTarget.style.color = '#555'}}
            >
              <div style={{ display:'flex', alignItems:'center', gap:'6px', fontSize:'13px', fontWeight:'bold' }}>
                <Plus size={16}/> ì•„ì´í…œ ì¶”ê°€
              </div>
            </div>
          </div>
        </>
      )}

      {/* ëª¨ë‹¬ ë Œë”ë§ */}
      {isModalOpen && (
        <ItemPatchModal 
          item={editingItem} 
          onClose={() => setIsModalOpen(false)} 
        />
      )}
    </div>
  );
};

// === FILE: /src/components/system/OptionTab.tsx ===

// ==========================================
// FILE PATH: /src/components/system/OptionTab.tsx
// ==========================================

import React, { useState, useRef } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { exportSaveFile, importSaveFile } from '../../engine/SaveLoadSystem';
import { Bot, Key, CheckCircle, Download, Upload, Trash2, RefreshCw, Share2, FileJson } from 'lucide-react';

export const OptionTab: React.FC = () => {
  const { gameState, heroes, shopItems, updateAIConfig, resetHeroStats, hardReset, loadModData } = useGameStore();
  const [aiSettings, setAiSettings] = useState(gameState.aiConfig);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const modInputRef = useRef<HTMLInputElement>(null);

  const saveAISettings = () => {
    updateAIConfig(aiSettings);
    alert("âœ… AI ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
  };

  const handleStatReset = () => {
    if (confirm('ëª¨ë“  ì±”í”¼ì–¸ì˜ ëˆ„ì  í†µê³„(ìŠ¹ë¥ , KDA, íŒìˆ˜)ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      resetHeroStats();
      alert('í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleSafeReset = () => {
    if(confirm('í˜„ì¬ ê²Œì„ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì €ì¥ëœ ìŠ¬ë¡¯ê³¼ ì„¤ì •ì€ ìœ ì§€ë©ë‹ˆë‹¤.)')) {
      hardReset(); 
      window.location.reload();
    }
  };

  // [ì‹ ê·œ] MOD ë°ì´í„° ë‚´ë³´ë‚´ê¸°
  const handleExportMod = () => {
    const modData = {
      version: 1,
      heroes: heroes, // ì˜ì›… ë°ì´í„° ì „ì²´ (ìŠ¤íƒ¯, ìŠ¤í‚¬ ë“±)
      items: shopItems, // ì•„ì´í…œ ëª©ë¡
      settings: {
        battle: gameState.battleSettings,
        field: gameState.fieldSettings,
        role: gameState.roleSettings
      },
      images: gameState.customImages // ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ í¬í•¨
    };

    const json = JSON.stringify(modData);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `GodsWar_ModData_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
  };

  // [ì‹ ê·œ] MOD ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  const handleImportMod = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    if (!confirm('ì´ íŒŒì¼ì„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n- ì˜ì›… ìŠ¤íƒ¯/ì´ë¦„/ìŠ¤í‚¬/ì‚¬ì§„ì´ ë³€ê²½ë©ë‹ˆë‹¤.\n- ì§„í–‰ ì¤‘ì¸ ìŠ¹ë¥ /ì „ì  ë°ì´í„°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.')) {
      e.target.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const json = JSON.parse(ev.target?.result as string);
        if (json.heroes && json.settings) {
          loadModData(json);
          alert('âœ… MOD ë°ì´í„° ì ìš© ì™„ë£Œ!\nê²Œì„ ì„¤ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
          alert('âŒ ì˜¬ë°”ë¥´ì§€ ì•Šì€ MOD íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
        }
      } catch (err) {
        console.error(err);
        alert('âŒ íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };
    reader.readAsText(file);
    e.target.value = '';
  };

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '15px' }}>

      {/* 1. AI ì„¤ì • */}
      <div style={{ background: '#161b22', padding: '15px', borderRadius: '8px', border: '1px solid #30363d' }}>
        <h4 style={{ margin:'0 0 15px 0', color:'#58a6ff', display:'flex', alignItems:'center', gap:'6px', fontSize:'14px' }}>
          <Bot size={16}/> ì»¤ë®¤ë‹ˆí‹° AI ì„¤ì •
        </h4>
        {/* ... (ê¸°ì¡´ AI ì„¤ì • UI ìœ ì§€) ... */}
        <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'12px' }}>
          <span style={{ fontSize:'13px', color:'#fff' }}>AI ê¸€ì‘ì„± í™œì„±í™”</span>
          <input type="checkbox" checked={aiSettings.enabled} onChange={e => setAiSettings({...aiSettings, enabled: e.target.checked})} style={{ transform:'scale(1.2)', cursor:'pointer' }}/>
        </div>
        <div style={{ marginBottom:'12px' }}>
          <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'4px' }}>AI ëª¨ë¸ ì œê³µì</div>
          <select value={aiSettings.provider} onChange={e => setAiSettings({...aiSettings, provider: e.target.value as any})} style={{ width:'100%', padding:'8px', background:'#0d1117', border:'1px solid #30363d', color:'#fff', borderRadius:'4px' }}>
            <option value="GEMINI">Google Gemini (ë¬´ë£Œ/ë¹ ë¦„)</option>
            <option value="OPENAI">OpenAI GPT (ìœ ë£Œ/ê³ ì„±ëŠ¥)</option>
          </select>
        </div>
        <div style={{ marginBottom:'12px' }}>
          <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'4px' }}>ì‚¬ìš©í•  ëª¨ë¸ëª…</div>
          <input type="text" value={aiSettings.model} onChange={e => setAiSettings({...aiSettings, model: e.target.value})} placeholder="ì˜ˆ: gemini-2.5-flash" style={{ width:'100%', padding:'8px', background:'#0d1117', border:'1px solid #30363d', color:'#fff', borderRadius:'4px', boxSizing:'border-box' }}/>
        </div>
        <div style={{ marginBottom:'15px' }}>
          <div style={{ fontSize:'11px', color:'#8b949e', marginBottom:'4px' }}>API Key</div>
          <div style={{ display:'flex', alignItems:'center', gap:'8px', background:'#0d1117', border:'1px solid #30363d', borderRadius:'4px', padding:'0 8px' }}>
            <Key size={14} color="#666"/>
            <input type="password" value={aiSettings.apiKey} onChange={e => setAiSettings({...aiSettings, apiKey: e.target.value})} placeholder="API í‚¤ ì…ë ¥..." style={{ flex:1, padding:'8px 0', background:'none', border:'none', color:'#fff', outline:'none' }}/>
          </div>
        </div>
        <button onClick={saveAISettings} className="btn" style={{ width:'100%', background:'#238636', color:'#fff', display:'flex', justifyContent:'center', alignItems:'center', gap:'6px', padding:'10px' }}>
          <CheckCircle size={16}/> ì„¤ì • ì €ì¥
        </button>
      </div>

      <div style={{ borderTop: '1px solid #333', margin: '5px 0' }}></div>

      {/* 2. íŒŒì¼ ê´€ë¦¬ (ì„¸ì´ë¸Œ/ë¡œë“œ + MOD ê³µìœ ) */}
      <h4 style={{ margin:'0 0 10px 0', color:'#ccc' }}>íŒŒì¼ ê´€ë¦¬</h4>

      {/* [ì‹ ê·œ] MOD ë°ì´í„° ê³µìœ  ì„¹ì…˜ */}
      <div style={{ background: '#21262d', padding: '15px', borderRadius: '8px', border: '1px dashed #58a6ff', marginBottom: '10px' }}>
        <div style={{ fontSize: '13px', color: '#58a6ff', fontWeight: 'bold', marginBottom: '5px', display:'flex', alignItems:'center', gap:'6px' }}>
          <Share2 size={14}/> ê²Œì„ ì„¤ì •(MOD) ê³µìœ 
        </div>
        <div style={{ fontSize: '11px', color: '#8b949e', marginBottom: '10px' }}>
          ì˜ì›…, ì•„ì´í…œ, ë°¸ëŸ°ìŠ¤ ì„¤ì •, ì‚¬ì§„ì„ íŒŒì¼ë¡œ ì €ì¥í•˜ê±°ë‚˜ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.<br/>
          (ì§„í–‰ ì¤‘ì¸ ë­í‚¹ì´ë‚˜ ì „ì ì€ ì˜í–¥ì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.)
        </div>
        <div style={{ display: 'flex', gap: '10px' }}>
          <button onClick={handleExportMod} className="btn" style={{ flex: 1, background: '#1f6feb', color: '#fff', border:'none', fontSize:'12px', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px' }}>
            <Download size={14}/> ì„¤ì • ë‚´ë³´ë‚´ê¸°
          </button>
          <button onClick={() => modInputRef.current?.click()} className="btn" style={{ flex: 1, background: '#238636', color: '#fff', border:'none', fontSize:'12px', display:'flex', alignItems:'center', justifyContent:'center', gap:'6px' }}>
            <FileJson size={14}/> ì„¤ì • ì ìš©í•˜ê¸°
          </button>
          <input type="file" ref={modInputRef} onChange={handleImportMod} style={{ display: 'none' }} accept=".json" />
        </div>
      </div>

      {/* ê¸°ì¡´ ì„¸ì´ë¸Œ íŒŒì¼ ê´€ë¦¬ */}
      <div style={{ display: 'flex', gap: '10px' }}>
        <button onClick={exportSaveFile} className="btn" style={{ flex:1, background: '#30363d', border:'1px solid #444', color: '#ccc', padding: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px', fontSize:'12px' }}>
          <Download size={14} /> ì „ì²´ ì„¸ì´ë¸Œ ë°±ì—…
        </button>
        <button onClick={() => fileInputRef.current?.click()} className="btn" style={{ flex:1, background: '#30363d', border:'1px solid #444', color: '#ccc', padding: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px', fontSize:'12px' }}>
          <Upload size={14} /> ì „ì²´ ì„¸ì´ë¸Œ ë³µêµ¬
        </button>
        <input type="file" ref={fileInputRef} onChange={async (e) => {
          const file = e.target.files?.[0];
          if(file && await importSaveFile(file, heroes)) {
            alert('ë¡œë“œ ì„±ê³µ!'); window.location.reload();
          }
        }} style={{ display: 'none' }} accept=".json" />
      </div>

      <div style={{ borderTop: '1px solid #333', margin: '10px 0' }}></div>

      {/* 3. ê²Œì„ ì´ˆê¸°í™” */}
      <h4 style={{ margin:'0 0 10px 0', color:'#da3633' }}>ê²Œì„ ì´ˆê¸°í™”</h4>

      <div style={{ background: '#251010', padding: '15px', borderRadius: '8px', border: '1px solid #4a1e1e', marginBottom: '10px' }}>
        <div style={{ fontSize: '12px', color: '#ff7b72', marginBottom: '10px', lineHeight: '1.4' }}>
          <b>í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê²Œì„</b>ë§Œ Day 1ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.<br/>
          <span style={{ color:'#fff', opacity:0.7 }}>* ì €ì¥ëœ ìŠ¬ë¡¯(1,2,3)ê³¼ AI ì„¤ì •(API Key)ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
        </div>
        <button onClick={handleSafeReset} className="btn" style={{ background: '#da3633', color: '#fff', width: '100%', display:'flex', alignItems:'center', justifyContent:'center', gap:'8px' }}>
          <Trash2 size={16} /> í˜„ì¬ ê²Œì„ ì¬ì‹œì‘ (Day 1)
        </button>
      </div>

      <div style={{ background: '#2d1b08', padding: '15px', borderRadius: '8px', border: '1px solid #633c0d' }}>
        <div style={{ fontSize: '12px', color: '#e89d40', marginBottom: '10px' }}>
          í˜„ì¬ ì§„í–‰ ìƒí™©ì€ ìœ ì§€í•˜ê³  í†µê³„ë§Œ 0ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.
        </div>
        <button onClick={handleStatReset} className="btn" style={{ background: '#d29922', color: '#000', width: '100%', display:'flex', alignItems:'center', justifyContent:'center', gap:'8px', fontWeight:'bold' }}>
          <RefreshCw size={16} /> í†µê³„ë§Œ ì´ˆê¸°í™”
        </button>
      </div>
    </div>
  );
};

// === FILE: /src/components/system/SaveLoadTab.tsx ===

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { saveToSlot, loadFromSlot, getSlotsMeta, deleteSlot, SaveMeta } from '../../engine/SaveLoadSystem';
import { Trash2 } from 'lucide-react';

interface Props {
  mode: 'SAVE' | 'LOAD'; // ì €ì¥ ëª¨ë“œì¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸° ëª¨ë“œì¸ì§€ êµ¬ë¶„
}

export const SaveLoadTab: React.FC<Props> = ({ mode }) => {
  const { heroes } = useGameStore();
  const [slots, setSlots] = useState<Record<string, SaveMeta>>({});

  useEffect(() => {
    setSlots(getSlotsMeta());
  }, []);

  const refreshSlots = () => setSlots(getSlotsMeta());

  const handleSave = (slotId: string) => {
    if (saveToSlot(slotId)) {
      alert(`${slotId === 'auto' ? 'ìë™ ì €ì¥' : `ìŠ¬ë¡¯ ${slotId}`}ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      refreshSlots();
    }
  };

  const handleLoad = (slotId: string) => {
    if (!slots[slotId]) return;
    if (confirm(`[Slot ${slotId}] ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\ní˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë‚´ìš©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.`)) {
      if (loadFromSlot(slotId, heroes)) {
        alert('ë¡œë“œ ì™„ë£Œ! ê²Œì„ì„ ì¬ì‹œì‘í•©ë‹ˆë‹¤.');
        window.location.reload();
      }
    }
  };

  const handleDelete = (e: React.MouseEvent, slotId: string) => {
    e.stopPropagation();
    if (confirm('ì´ ìŠ¬ë¡¯ì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      deleteSlot(slotId);
      refreshSlots();
    }
  };

  // ìŠ¬ë¡¯ ì•„ì´í…œ ì»´í¬ë„ŒíŠ¸ (ë‚´ë¶€ ì‚¬ìš©)
  const SlotItem = ({ id, label, isAuto = false }: { id: string, label: string, isAuto?: boolean }) => {
    const meta = slots[id];
    const isEmpty = !meta;

    return (
      <div 
        onClick={() => mode === 'SAVE' ? handleSave(id) : handleLoad(id)}
        style={{ 
          background: isEmpty ? '#222' : '#2a2a2e', 
          border: '1px solid #444', 
          borderRadius: '8px', 
          padding: '15px', 
          marginBottom: '10px',
          cursor: 'pointer',
          display: 'flex', justifyContent: 'space-between', alignItems: 'center',
          transition: '0.2s',
          opacity: (mode === 'LOAD' && isEmpty) ? 0.5 : 1,
          pointerEvents: (mode === 'LOAD' && isEmpty) ? 'none' : 'auto'
        }}
        onMouseEnter={e => e.currentTarget.style.borderColor = '#58a6ff'}
        onMouseLeave={e => e.currentTarget.style.borderColor = '#444'}
      >
        <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
          <div style={{ 
            width: '40px', height: '40px', borderRadius: '50%', 
            background: isAuto ? '#e89d40' : '#58a6ff', color: '#000',
            display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 'bold' 
          }}>
            {isAuto ? 'A' : id}
          </div>
          <div>
            <div style={{ fontWeight: 'bold', color: isEmpty ? '#777' : '#fff', fontSize: '14px' }}>
              {label}
            </div>
            {isEmpty ? (
              <div style={{ fontSize: '12px', color: '#555' }}>ë¹„ì–´ ìˆìŒ</div>
            ) : (
              <div style={{ fontSize: '11px', color: '#aaa', marginTop: '4px' }}>
                Day {meta.day} â€¢ ìœ ì € {meta.totalUsers.toLocaleString()}ëª… <br/>
                <span style={{ color: '#666' }}>{meta.dateStr}</span>
              </div>
            )}
          </div>
        </div>

        <div style={{ display:'flex', gap:'10px' }}>
            {mode === 'SAVE' && (
                <div style={{ fontSize:'12px', color:'#58a6ff', fontWeight:'bold' }}>
                    {isEmpty ? 'ì €ì¥í•˜ê¸°' : 'ë®ì–´ì“°ê¸°'}
                </div>
            )}
            {!isEmpty && mode === 'SAVE' && (
                <button onClick={(e) => handleDelete(e, id)} style={{ background:'none', border:'none', color:'#da3633', cursor:'pointer' }}>
                    <Trash2 size={16} />
                </button>
            )}
        </div>
      </div>
    );
  };

  return (
    <>
      <div style={{ fontSize:'12px', color:'#888', marginBottom:'15px', textAlign:'center' }}>
        {mode === 'SAVE' ? 'ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì—¬ ì €ì¥í•˜ì„¸ìš”.' : 'ë¶ˆëŸ¬ì˜¬ ìŠ¬ë¡¯ì„ ì„ íƒí•˜ì„¸ìš”.'}
      </div>

      <SlotItem id="auto" label="ìë™ ì €ì¥ ìŠ¬ë¡¯ (Auto)" isAuto />
      <div style={{ height:'10px' }}></div>
      <SlotItem id="1" label="ì €ì¥ ìŠ¬ë¡¯ 1" />
      <SlotItem id="2" label="ì €ì¥ ìŠ¬ë¡¯ 2" />
      <SlotItem id="3" label="ì €ì¥ ìŠ¬ë¡¯ 3" />
    </>
  );
};

// === FILE: /src/components/system/SystemMenu.tsx ===

// ==========================================
// FILE PATH: /src/components/common/SystemMenu.tsx
// ==========================================

import React, { useState } from 'react';
import { Save, Disc, AlertTriangle, X } from 'lucide-react';

// ë¶„ë¦¬í•œ ì»´í¬ë„ŒíŠ¸ import
import { OptionTab } from '../system/OptionTab';
import { SaveLoadTab } from '../system/SaveLoadTab';

interface Props { onClose: () => void; }

export const SystemMenu: React.FC<Props> = ({ onClose }) => {
  const [activeTab, setActiveTab] = useState<'SAVE' | 'LOAD' | 'OPTION'>('SAVE');

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <div 
      onClick={handleBackdropClick} 
      style={{
        position: 'fixed', top: 0, left: 0, width: '100%', height: '100%',
        backgroundColor: 'rgba(0,0,0,0.85)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 9999,
        backdropFilter: 'blur(5px)',
        padding: '10px' 
      }}
    >
      <div className="panel" style={{ 
        width: '100%', maxWidth: '450px', maxHeight: '90vh',
        background: '#1c1c1f', border: '1px solid #30363d', 
        display:'flex', flexDirection:'column', padding:0,
        overflow: 'hidden', borderRadius: '12px'
      }}>

        {/* í—¤ë” */}
        <div style={{ 
          padding: '15px 20px', borderBottom: '1px solid #333', 
          display: 'flex', justifyContent: 'space-between', alignItems: 'center', 
          background: '#252528', flexShrink: 0 
        }}>
          <h3 style={{ margin: 0, color: '#fff', fontSize: '16px' }}>ì‹œìŠ¤í…œ ë©”ë‰´</h3>
          <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding:'5px' }}>
            <X size={24} />
          </button>
        </div>

        {/* íƒ­ ë²„íŠ¼ */}
        <div style={{ display: 'flex', background: '#161b22', borderBottom: '1px solid #333', flexShrink: 0 }}>
          {([
            { id: 'SAVE', label: 'ì €ì¥', icon: Save },
            { id: 'LOAD', label: 'ë¶ˆëŸ¬ì˜¤ê¸°', icon: Disc },
            { id: 'OPTION', label: 'ì˜µì…˜', icon: AlertTriangle }
          ] as const).map(t => (
            <button
              key={t.id}
              onClick={() => setActiveTab(t.id)}
              style={{
                flex: 1, padding: '15px', background: 'none', border: 'none',
                borderBottom: activeTab === t.id ? '2px solid #58a6ff' : '2px solid transparent',
                color: activeTab === t.id ? '#fff' : '#777', fontWeight: 'bold', cursor: 'pointer',
                display:'flex', alignItems:'center', justifyContent:'center', gap:'8px'
              }}
            >
              <t.icon size={16} /> {t.label}
            </button>
          ))}
        </div>

        {/* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ (ë¶„ë¦¬ëœ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§) */}
        <div style={{ flex: 1, overflowY: 'auto', padding: '20px' }}>
          {activeTab === 'SAVE' && <SaveLoadTab mode="SAVE" />}
          {activeTab === 'LOAD' && <SaveLoadTab mode="LOAD" />}
          {activeTab === 'OPTION' && <OptionTab />}
        </div>

      </div>
    </div>
  );
};

// === FILE: /src/components/user/TierSettingsModal.tsx ===

// ==========================================
// FILE PATH: /src/components/user/TierSettingsModal.tsx
// ==========================================

import React, { useState } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { X, Save, Settings, Trophy, Swords } from 'lucide-react';
import { TierConfig } from '../../types';

export const TierSettingsModal = ({ onClose }: { onClose: () => void }) => {
  const { gameState, updateTierConfig } = useGameStore();

  // [ìˆ˜ì •] ê¸°ì¡´ ì„¸ì´ë¸Œ íŒŒì¼ í˜¸í™˜ì„± ì²˜ë¦¬ (promosê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì£¼ì…)
  const [config, setConfig] = useState<TierConfig>(() => {
    const current = gameState.tierConfig;
    // ë§Œì•½ promos ê°ì²´ê°€ ì—†ë‹¤ë©´(êµ¬ë²„ì „ ë°ì´í„°ë¼ë©´) ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
    if (!current.promos) {
      return {
        ...current,
        promos: {
          master: 5,
          ace: 5,
          joker: 5,
          gold: 3,
          silver: 3,
          bronze: 3
        }
      };
    }
    return current;
  });

  const handleSave = () => {
    updateTierConfig(config);
    alert('í‹°ì–´ ì‹œìŠ¤í…œ ì„¤ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¤ìŒ ìŠ¹ê¸‰ì „ë¶€í„° ì ìš©ë©ë‹ˆë‹¤.');
    onClose();
  };

  const handlePromoChange = (tier: keyof TierConfig['promos'], value: number) => {
    setConfig(prev => ({
      ...prev,
      promos: { ...prev.promos, [tier]: value }
    }));
  };

  // í‹°ì–´ë³„ ì„¤ì • í–‰ ì»´í¬ë„ŒíŠ¸
  const TierRow = ({ label, keyName, color, promoKey }: { label: string, keyName: keyof TierConfig, color: string, promoKey: keyof TierConfig['promos'] }) => (
    <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'12px', background:'#252528', padding:'10px', borderRadius:'8px', border:'1px solid #333' }}>

      {/* ì™¼ìª½: í‹°ì–´ ì´ë¦„ ë° ì»¤íŠ¸ë¼ì¸ */}
      <div style={{ display:'flex', alignItems:'center', gap:'15px' }}>
        <div style={{ display:'flex', alignItems:'center', gap:'10px', width:'100px' }}>
          <div style={{ width:'12px', height:'12px', borderRadius:'50%', background:color }}></div>
          <span style={{ color: color, fontWeight:'bold', fontSize:'14px' }}>{label}</span>
        </div>
        <div style={{ display:'flex', alignItems:'center', gap:'6px' }}>
          <input 
            type="number" 
            value={config[keyName] as number} 
            onChange={(e) => setConfig({ ...config, [keyName]: parseInt(e.target.value) })}
            style={{ background:'#0d1117', border:'1px solid #444', color:'#fff', padding:'6px', borderRadius:'4px', width:'70px', textAlign:'right', fontWeight:'bold' }}
          />
          <span style={{ fontSize:'12px', color:'#888' }}>LP</span>
        </div>
      </div>

      {/* ì˜¤ë¥¸ìª½: ìŠ¹ê¸‰ì „ íŒìˆ˜ ì„ íƒ */}
      <div style={{ display:'flex', alignItems:'center', gap:'8px' }}>
        <Swords size={14} color="#666" />
        <select 
          value={config.promos ? config.promos[promoKey] : 3} // ì•ˆì „í•˜ê²Œ ì ‘ê·¼
          onChange={(e) => handlePromoChange(promoKey, parseInt(e.target.value))}
          style={{ background:'#0d1117', border:'1px solid #444', color:'#ccc', padding:'4px 8px', borderRadius:'4px', fontSize:'12px', cursor:'pointer' }}
        >
          <option value={3}>3ì „ 2ì„ ìŠ¹</option>
          <option value={5}>5ì „ 3ì„ ìŠ¹</option>
          <option value={7}>7ì „ 4ì„ ìŠ¹</option>
          <option value={9}>9ì „ 5ì„ ìŠ¹</option>
        </select>
      </div>
    </div>
  );

  return (
    <div style={{ position:'fixed', top:0, left:0, width:'100%', height:'100%', background:'rgba(0,0,0,0.85)', display:'flex', justifyContent:'center', alignItems:'center', zIndex:2000, backdropFilter:'blur(5px)' }}>
      <div className="panel" style={{ width:'500px', background:'#161b22', border:'1px solid #30363d', borderRadius:'12px', padding:0, overflow:'hidden', boxShadow:'0 20px 50px rgba(0,0,0,0.5)' }}>

        {/* í—¤ë” */}
        <div style={{ padding:'20px', background:'#21262d', borderBottom:'1px solid #333', display:'flex', justifyContent:'space-between', alignItems:'center' }}>
          <h3 style={{ margin:0, display:'flex', alignItems:'center', gap:'10px', color:'#fff', fontSize:'16px' }}>
            <Settings size={18} /> ë­í¬ ì‹œìŠ¤í…œ ì„¤ì •
          </h3>
          <button onClick={onClose} style={{ background:'none', border:'none', color:'#888', cursor:'pointer' }}><X size={20}/></button>
        </div>

        <div style={{ padding:'20px' }}>

          {/* 1. ì±Œë¦°ì € ì„¤ì • */}
          <div style={{ marginBottom:'20px', paddingBottom:'15px', borderBottom:'1px dashed #333' }}>
            <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center' }}>
              <div style={{ display:'flex', alignItems:'center', gap:'10px' }}>
                <Trophy size={16} color="#00bfff" />
                <span style={{ color:'#00bfff', fontWeight:'bold' }}>ì±Œë¦°ì € ì •ì› (Ranking)</span>
              </div>
              <div style={{ display:'flex', alignItems:'center', gap:'6px' }}>
                <span style={{ fontSize:'12px', color:'#888' }}>ìƒìœ„</span>
                <input 
                  type="number" 
                  value={config.challengerRank} 
                  onChange={(e) => setConfig({ ...config, challengerRank: parseInt(e.target.value) })}
                  style={{ background:'#00bfff22', border:'1px solid #00bfff', color:'#fff', padding:'6px', borderRadius:'4px', width:'60px', textAlign:'center', fontWeight:'bold' }}
                />
                <span style={{ fontSize:'12px', color:'#888' }}>ìœ„</span>
              </div>
            </div>
            <div style={{ fontSize:'11px', color:'#666', marginTop:'8px', marginLeft:'26px' }}>
              * ë§ˆìŠ¤í„° í‹°ì–´ ì ìˆ˜ë¥¼ ë„˜ê¸´ ìœ ì € ì¤‘, ì„¤ì •ëœ ë“±ìˆ˜ ì•ˆì— ë“¤ì–´ì•¼ ì±Œë¦°ì €ê°€ ë©ë‹ˆë‹¤.
            </div>
          </div>

          {/* 2. í‹°ì–´ë³„ ì»¤íŠ¸ë¼ì¸ ë° ìŠ¹ê¸‰ì „ ì„¤ì • */}
          <div style={{ display:'flex', flexDirection:'column', gap:'5px', maxHeight:'400px', overflowY:'auto' }}>
            {config.promos && (
              <>
                <TierRow label="ë§ˆìŠ¤í„°" keyName="master" color="#9b59b6" promoKey="master" />
                <TierRow label="ì—ì´ìŠ¤" keyName="ace" color="#e74c3c" promoKey="ace" />
                <TierRow label="ì¡°ì»¤" keyName="joker" color="#2ecc71" promoKey="joker" />
                <TierRow label="ê³¨ë“œ" keyName="gold" color="#f1c40f" promoKey="gold" />
                <TierRow label="ì‹¤ë²„" keyName="silver" color="#95a5a6" promoKey="silver" />
                <TierRow label="ë¸Œë¡ ì¦ˆ" keyName="bronze" color="#d35400" promoKey="bronze" />
              </>
            )}
          </div>

        </div>

        <div style={{ padding:'20px', borderTop:'1px solid #333', background:'#21262d' }}>
          <button className="btn" style={{ width:'100%', background:'#238636', color:'#fff', display:'flex', justifyContent:'center', gap:'8px', padding:'12px', fontSize:'14px', borderRadius:'8px', border:'none', cursor:'pointer', fontWeight:'bold' }} onClick={handleSave}>
            <Save size={18} /> ì„¤ì • ì €ì¥í•˜ê¸°
          </button>
        </div>
      </div>
    </div>
  );
};

// === FILE: /src/components/user/TierUserListModal.tsx ===

// ==========================================
// FILE PATH: /src/components/user/TierUserListModal.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { getUsersInTier } from '../../engine/UserManager';
import { UserProfile } from '../../types';
import { X, Trophy } from 'lucide-react';

interface Props {
  tierName: string;
  onClose: () => void;
  onUserClick: (u: UserProfile) => void;
}

export const TierUserListModal: React.FC<Props> = ({ tierName, onClose, onUserClick }) => {
  const { gameState } = useGameStore();
  const [users, setUsers] = useState<UserProfile[]>([]);

  useEffect(() => {
    const list = getUsersInTier(tierName, gameState.tierConfig);
    setUsers(list);
  }, [tierName, gameState.tierConfig]);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget) onClose();
  };

  // ë­í‚¹ë³„ ìƒ‰ìƒ ë°˜í™˜ í•¨ìˆ˜
  const getRankStyle = (index: number) => {
    if (index === 0) return { color: '#FFD700', scale: 1.2 }; // Gold
    if (index === 1) return { color: '#C0C0C0', scale: 1.1 }; // Silver
    if (index === 2) return { color: '#CD7F32', scale: 1.05 }; // Bronze
    return { color: '#666', scale: 1 };
  };

  return (
    <div 
      onClick={handleBackdropClick}
      style={{ 
        position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', 
        background: 'rgba(0,0,0,0.85)', display: 'flex', justifyContent: 'center', alignItems: 'center', 
        zIndex: 1500, backdropFilter: 'blur(5px)', padding: '15px'
      }}
    >
      <div className="panel" style={{ 
        width: '100%', maxWidth: '450px', maxHeight: '80vh',
        background: '#161b22', border: '1px solid #30363d', 
        display: 'flex', flexDirection: 'column', 
        borderRadius: '16px', overflow: 'hidden',
        boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)'
      }}>
        
        {/* í—¤ë” */}
        <div style={{ 
          padding: '16px 20px', background: '#0d1117', borderBottom: '1px solid #30363d', 
          display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexShrink: 0
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
            <Trophy size={18} color="#e89d40" />
            <h3 style={{ margin: 0, fontSize: '16px', color: '#fff', fontWeight: 'bold' }}>
              {tierName} <span style={{ color:'#8b949e', fontSize:'13px', fontWeight:'normal' }}>TOP {users.length}</span>
            </h3>
          </div>
          <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#8b949e', cursor: 'pointer', padding:'4px' }}>
            <X size={24} />
          </button>
        </div>

        {/* ìœ ì € ë¦¬ìŠ¤íŠ¸ (Table ëŒ€ì‹  Flex ì‚¬ìš©) */}
        <div style={{ flex: 1, overflowY: 'auto', background: '#161b22' }}>
          {users.map((u, i) => {
            const rankStyle = getRankStyle(i);
            const isTop3 = i < 3;
            
            return (
              <div 
                key={u.id}
                onClick={() => onUserClick(u)}
                style={{ 
                  display: 'flex', alignItems: 'center',
                  padding: '12px 16px', 
                  borderBottom: '1px solid #21262d', 
                  cursor: 'pointer',
                  background: isTop3 ? `rgba(255, 215, 0, ${0.05 - (i * 0.015)})` : 'transparent'
                }}
              >
                {/* 1. ìˆœìœ„ */}
                <div style={{ 
                  width: '40px', textAlign: 'center', 
                  fontSize: isTop3 ? '18px' : '14px', 
                  fontWeight: '900', fontStyle: 'italic',
                  color: rankStyle.color,
                  marginRight: '12px'
                }}>
                  {i + 1}
                </div>

                {/* 2. ìœ ì € ì •ë³´ (ì´ë¦„ + LP) */}
                <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '2px' }}>
                  <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '14px' }}>
                    {u.name}
                  </div>
                  <div style={{ fontSize: '12px', color: '#8b949e', display: 'flex', alignItems: 'center', gap: '4px' }}>
                    <span style={{ color: '#e89d40', fontWeight:'bold' }}>{u.score} LP</span>
                    <span style={{ width: '3px', height: '3px', background: '#444', borderRadius: '50%' }}></span>
                    <span>Lv.{Math.floor(u.totalGames / 10) + 1}</span>
                  </div>
                </div>

                {/* 3. ìŠ¹ë¥  ë° ì „ì  */}
                <div style={{ textAlign: 'right' }}>
                  <div style={{ 
                    fontSize: '14px', fontWeight: 'bold', 
                    color: u.winRate >= 60 ? '#ff4d4d' : u.winRate >= 50 ? '#3fb950' : '#8b949e' 
                  }}>
                    {u.winRate.toFixed(1)}%
                  </div>
                  <div style={{ fontSize: '11px', color: '#666' }}>
                    {u.totalGames}ì „
                  </div>
                </div>
              </div>
            );
          })}

          {users.length === 0 && (
            <div style={{ padding: '40px 20px', textAlign: 'center', color: '#555', fontSize: '14px' }}>
              <div style={{ fontSize:'24px', marginBottom:'10px' }}>ğŸ•µï¸</div>
              ì´ í‹°ì–´ì— ë°°ì¹˜ëœ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

// === FILE: /src/components/user/UserDashboard.tsx ===

// ==========================================
// FILE PATH: /src/components/user/UserDashboard.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { useGameStore } from '../../store/useGameStore';
import { UserProfile } from '../../types';
import { Clock, Settings, ChevronRight } from 'lucide-react';
import { TierSettingsModal } from './TierSettingsModal';
import { TierUserListModal } from './TierUserListModal';

interface Props { onUserClick: (u: UserProfile) => void; }

export const UserDashboard: React.FC<Props> = ({ onUserClick }) => {
  const { gameState, heroes } = useGameStore(); // [ìˆ˜ì •] heroes ê°€ì ¸ì˜¤ê¸°
  const { userStatus, topRankers } = gameState;
  const [showSettings, setShowSettings] = useState(false);
  const [selectedTier, setSelectedTier] = useState<string | null>(null);

  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // [ì‹ ê·œ] ID -> í•œê¸€ ì´ë¦„ ë³€í™˜ í—¬í¼
  const getHeroName = (id: string) => {
    const hero = heroes.find(h => h.id === id);
    return hero ? hero.name : id;
  };

  if (!userStatus) return <div>ë°ì´í„° ë¡œë”© ì¤‘...</div>;

  return (
    <div style={{ 
      display: 'grid', 
      gridTemplateColumns: isMobile ? '1fr' : '1fr 1fr', 
      gap: '20px' 
    }}>

      {/* ì™¼ìª½: ì‹¤ì‹œê°„ í˜„í™© & í‹°ì–´ ë¶„í¬ */}
      <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
        {/* ë§¤ì¹­ í˜„í™© */}
        <div className="panel">
          <h3 style={{ margin: '0 0 15px 0', borderBottom: '1px solid #333', paddingBottom: '10px', fontSize:'16px' }}>ğŸ“¡ ì‹¤ì‹œê°„ ë§¤ì¹­ í˜„í™©</h3>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
            <div style={{ textAlign: 'center', flex: 1, borderRight: '1px solid #333' }}>
              <div style={{ fontSize: '12px', color: '#8b949e' }}>ê²Œì„ ì¤‘ (Ingame)</div>
              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#3fb950' }}>{userStatus.playingUsers.toLocaleString()}</div>
            </div>
            <div style={{ textAlign: 'center', flex: 1 }}>
              <div style={{ fontSize: '12px', color: '#8b949e' }}>ë§¤ì¹­ ëŒ€ê¸° (Queue)</div>
              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#d29922' }}>{userStatus.queuingUsers.toLocaleString()}</div>
            </div>
          </div>
          <div style={{ background: '#0d1117', padding: '15px', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px' }}>
            <Clock size={16} color="#58a6ff" />
            <span style={{ color: '#8b949e', fontSize: '13px' }}>í‰ê·  ë§¤ì¹­ ì‹œê°„:</span>
            <span style={{ fontWeight: 'bold', color: '#fff' }}>{userStatus.avgWaitTime}ì´ˆ</span>
          </div>
        </div>

        {/* í‹°ì–´ ë¶„í¬ */}
        <div className="panel">
          <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', borderBottom: '1px solid #333', paddingBottom: '10px', marginBottom: '15px' }}>
            <h3 style={{ margin: 0, fontSize:'16px' }}>ğŸ† í‹°ì–´ë³„ ì¸êµ¬ ë¶„í¬</h3>
            <button onClick={() => setShowSettings(true)} style={{ background:'none', border:'none', color:'#8b949e', cursor:'pointer', display:'flex', alignItems:'center', gap:'5px', fontSize:'12px' }}>
              <Settings size={14}/> ì„¤ì •
            </button>
          </div>

          <div style={{ display:'flex', flexDirection:'column', gap:'8px' }}>
            {userStatus.tierDistribution.map((tier) => (
              <div 
                key={tier.name} 
                onClick={() => setSelectedTier(tier.name)}
                style={{ cursor:'pointer', padding:'8px', borderRadius:'6px', background:'#0d1117', transition:'0.2s', display:'flex', alignItems:'center', justifyContent:'space-between' }}
              >
                <div style={{ display:'flex', alignItems:'center', gap:'10px', width: isMobile ? '80px' : '120px' }}>
                  <div style={{ width:'8px', height:'8px', borderRadius:'50%', background:tier.color }}></div>
                  <span style={{ fontWeight:'bold', color:tier.color, fontSize:'13px' }}>{tier.name}</span>
                </div>

                <div style={{ flex:1, height:'6px', background:'#333', borderRadius:'3px', margin:'0 15px' }}>
                  <div style={{ width:`${tier.percent}%`, height:'100%', background:tier.color, borderRadius:'3px', minWidth:'2px' }}></div>
                </div>

                <div style={{ textAlign:'right', width: isMobile ? '80px' : '100px' }}>
                  <span style={{ fontWeight:'bold', display:'block', fontSize:'13px' }}>{tier.count.toLocaleString()}</span>
                  <span style={{ fontSize:'10px', color:'#666' }}>{tier.percent.toFixed(1)}%</span>
                </div>
                {!isMobile && <ChevronRight size={14} color="#555" />}
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* ì˜¤ë¥¸ìª½: ë­í‚¹ ë¦¬ìŠ¤íŠ¸ (ëª¨ë°”ì¼ ëŒ€ì‘) */}
      <div className="panel">
        <h3 style={{ margin: '0 0 15px 0', borderBottom: '1px solid #333', paddingBottom: '10px', display: 'flex', justifyContent: 'space-between', fontSize:'16px' }}>
          <span>ğŸ¥‡ ìƒìœ„ ë­ì»¤ (Top 50)</span>
          <span style={{ fontSize: '12px', color: '#8b949e' }}>ì‹¤ì‹œê°„</span>
        </h3>

        <div style={{ height: '600px', overflowY: 'auto' }}>
          {/* [Mobile] ë¦¬ìŠ¤íŠ¸ ë·° */}
          {isMobile ? (
            <div style={{ display:'flex', flexDirection:'column', gap:'10px' }}>
              {topRankers.map((user, idx) => (
                <div 
                  key={user.id} 
                  onClick={() => onUserClick(user)}
                  style={{ background:'#0d1117', padding:'10px', borderRadius:'6px', border:'1px solid #333', display:'flex', alignItems:'center', gap:'10px' }}
                >
                  <div style={{ fontSize:'16px', fontWeight:'bold', color: idx < 3 ? '#e74c3c' : '#777', width:'24px', textAlign:'center' }}>
                    {idx + 1}
                  </div>
                  <div style={{ flex:1 }}>
                    <div style={{ fontWeight:'bold', color:'#fff', fontSize:'14px' }}>{user.name}</div>
                    <div style={{ fontSize:'12px', color:'#888' }}>
                      <span style={{ color: user.tier === 'ì²œìƒê³„' ? '#00bfff' : '#fff' }}>{user.tier}</span> ({user.score}LP)
                    </div>
                  </div>
                  <div style={{ textAlign:'right' }}>
                    {/* [ìˆ˜ì •] í•œê¸€ ì´ë¦„ í‘œì‹œ */}
                    <div style={{ fontSize:'12px', color:'#ddd', fontWeight:'bold' }}>{getHeroName(user.mainHeroId)}</div>
                    <div style={{ fontSize:'12px', color: user.winRate > 55 ? '#3fb950' : '#8b949e' }}>{user.winRate.toFixed(1)}%</div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            /* [Desktop] í…Œì´ë¸” ë·° */
            <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px' }}>
              <thead style={{ position: 'sticky', top: 0, background: '#161b22' }}>
                <tr style={{ color: '#8b949e', borderBottom: '1px solid #333', textAlign: 'left' }}>
                  <th style={{ padding: '8px', textAlign: 'center' }}>#</th>
                  <th>ì†Œí™˜ì‚¬ëª…</th>
                  <th>í‹°ì–´ (LP)</th>
                  <th>ëª¨ìŠ¤íŠ¸</th>
                  <th>ìŠ¹ë¥ </th>
                  <th>ìµœê·¼ 5ì „</th>
                </tr>
              </thead>
              <tbody>
                {topRankers.map((user, idx) => (
                  <tr key={user.id} style={{ borderBottom: '1px solid #222', height: '40px', cursor:'pointer' }} onClick={() => onUserClick(user)}>
                    <td style={{ textAlign: 'center', fontWeight: 'bold', color: idx < 3 ? '#e74c3c' : '#fff' }}>{idx + 1}</td>
                    <td style={{ fontWeight: 'bold', color: '#fff' }}>{user.name}</td>
                    <td>
                      <span style={{ color: user.tier === 'ì²œìƒê³„' ? '#00bfff' : user.tier === 'ë§ˆìŠ¤í„°' ? '#9b59b6' : '#fff' }}>
                        {user.tier}
                      </span>
                      <span style={{ fontSize: '11px', color: '#777', marginLeft: '4px' }}>({user.score}LP)</span>
                    </td>
                    {/* [ìˆ˜ì •] í•œê¸€ ì´ë¦„ í‘œì‹œ */}
                    <td style={{ color: '#ddd', fontWeight:'bold' }}>{getHeroName(user.mainHeroId)}</td>
                    <td style={{ color: user.winRate > 55 ? '#3fb950' : '#8b949e' }}>{user.winRate.toFixed(1)}%</td>
                    <td>
                      <div style={{ display: 'flex', gap: '2px' }}>
                        {user.history.slice(0, 5).map((h, i) => (
                          <div key={i}
                            style={{
                              width: '16px', height: '16px', borderRadius: '2px',
                              background: h.result === 'WIN' ? '#3fb950' : '#da3633',
                              fontSize: '10px', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center'
                            }}>
                            {h.result === 'WIN' ? 'W' : 'L'}
                          </div>
                        ))}
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}
        </div>
      </div>

      {showSettings && <TierSettingsModal onClose={() => setShowSettings(false)} />}
      {selectedTier && (
        <TierUserListModal 
          tierName={selectedTier} 
          onClose={() => setSelectedTier(null)} 
          onUserClick={(u) => { onUserClick(u); setSelectedTier(null); }} 
        />
      )}

    </div>
  );
};

// === FILE: /src/components/user/UserDetailModal.tsx ===

// ==========================================
// FILE PATH: /src/components/user/UserDetailModal.tsx
// ==========================================

import React, { useState, useEffect } from 'react';
import { UserProfile } from '../../types';
import { useGameStore } from '../../store/useGameStore';
import { X, TrendingUp, History, Target, Shield, Swords, Zap, Crosshair, Skull, Award } from 'lucide-react';

interface Props { user: UserProfile; onClose: () => void; }

// --- í—¬í¼ ì»´í¬ë„ŒíŠ¸ ---

const calculateGrade = (k: number, d: number, a: number) => {
  const divisor = d === 0 ? 1 : d;
  return ((k + a) / divisor).toFixed(2);
};

// [ìˆ˜ì •] ë¼ì¸(TOP, MID...)ì„ ê²Œì„ ë‚´ ì—­í• êµ°ìœ¼ë¡œ ë³€í™˜í•´ì„œ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
const RoleDisplay = ({ lane }: { lane: string }) => {
  let roleName = "ì˜¬ë¼ìš´ë”";
  let icon = <Skull size={14} />;
  let color = "#ccc";

  switch (lane) {
    case 'TOP': 
      roleName = "ì§‘í–‰ê´€/ìˆ˜í˜¸ê¸°ì‚¬ (TOP)"; 
      icon = <Shield size={14} />;
      color = "#e74c3c";
      break;
    case 'JUNGLE': 
      roleName = "ì¶”ì ì (JUNGLE)"; 
      icon = <Swords size={14} />;
      color = "#2ecc71";
      break;
    case 'MID': 
      roleName = "ì„ ì§€ì (MID)"; 
      icon = <Zap size={14} />;
      color = "#3498db";
      break;
    case 'BOT': 
      roleName = "ì‹ ì‚´ì (BOT)"; 
      icon = <Crosshair size={14} />;
      color = "#f1c40f";
      break;
  }

  return (
    <div style={{ display:'flex', alignItems:'center', gap:'6px', color: color, fontWeight:'bold', fontSize:'13px' }}>
      {icon} {roleName}
    </div>
  );
};

const WinRateBar = ({ wins, losses }: { wins: number, losses: number }) => {
  const total = wins + losses;
  if (total === 0) return <div style={{ height: '8px', background: '#333', borderRadius: '4px', width: '100%' }} />;
  const winPercent = (wins / total) * 100;
  return (
    <div style={{ display: 'flex', height: '8px', borderRadius: '4px', overflow: 'hidden', width: '100%', marginTop: '6px' }}>
      <div style={{ width: `${winPercent}%`, background: '#58a6ff' }} />
      <div style={{ flex: 1, background: '#da3633' }} />
    </div>
  );
};

// --- ë©”ì¸ ì»´í¬ë„ŒíŠ¸ ---

export const UserDetailModal: React.FC<Props> = ({ user, onClose }) => {
  const { heroes } = useGameStore();
  const [activeTab, setActiveTab] = useState<'OVERVIEW' | 'CHAMPIONS'>('OVERVIEW');
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  useEffect(() => {
    document.body.style.overflow = 'hidden';
    return () => { document.body.style.overflow = 'unset'; };
  }, []);

  // ëª¨ìŠ¤íŠ¸ ì±”í”¼ì–¸ ë°ì´í„° ê°€ê³µ (íŒìˆ˜ ë‚´ë¦¼ì°¨ìˆœ)
  const champStats = Object.entries(user.heroStats || {})
    .map(([id, stat]) => ({ id, hero: heroes.find(h => h.id === id), stat }))
    .sort((a, b) => b.stat.matches - a.stat.matches);

  const mostChampions = champStats.slice(0, 3);
  const totalWins = user.winRate ? Math.round((user.winRate / 100) * user.totalGames) : 0;
  const totalLosses = user.totalGames - totalWins;

  const overlayStyle: React.CSSProperties = isMobile ? {
    position: 'fixed', inset: 0, zIndex: 30000, 
    backgroundColor: '#0f1115',
    overflowY: 'auto', WebkitOverflowScrolling: 'touch',
    display: 'block'
  } : {
    position: 'fixed', inset: 0, zIndex: 30000, 
    backgroundColor: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(5px)',
    display: 'flex', justifyContent: 'center', alignItems: 'center', padding: '20px'
  };

  const panelStyle: React.CSSProperties = isMobile ? {
    width: '100%', minHeight: '100%', 
    background: '#0d1117', display: 'flex', flexDirection: 'column',
    boxSizing: 'border-box'
  } : {
    width: '100%', maxWidth: '1000px', height: '85vh',
    background: '#0d1117', border: '1px solid #30363d', borderRadius: '16px',
    display: 'flex', flexDirection: 'column', overflow: 'hidden',
    boxShadow: '0 50px 100px -20px rgba(0,0,0,0.7)',
    boxSizing: 'border-box'
  };

  return (
    <div style={overlayStyle}>
      <div className="panel-content" style={panelStyle}>

        {/* 1. ìƒë‹¨ í”„ë¡œí•„ í—¤ë” */}
        <div style={{
          background: 'linear-gradient(135deg, #1f242d 0%, #0d1117 100%)',
          padding: isMobile ? '15px' : '20px', 
          borderBottom: '1px solid #30363d',
          display: 'flex', justifyContent: 'space-between', alignItems: 'center',
          position: isMobile ? 'sticky' : 'relative', top: 0, zIndex: 50,
          boxSizing: 'border-box',
          boxShadow: isMobile ? '0 4px 12px rgba(0,0,0,0.3)' : 'none'
        }}>
          <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>
            <div style={{
              width: '50px', height: '50px', borderRadius: '15px', background: '#21262d', 
              border: '2px solid #58a6ff', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px',
              flexShrink: 0
            }}>
              ğŸ§™â€â™‚ï¸
            </div>
            <div style={{ minWidth: 0 }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <span style={{ background: '#30363d', color: '#ccc', fontSize: '10px', padding: '1px 5px', borderRadius: '4px', whiteSpace:'nowrap' }}>
                  Lv.{Math.floor(user.totalGames / 10) + 1}
                </span>
                <h1 style={{ margin: 0, fontSize: '18px', color: '#fff', fontWeight: 'bold', whiteSpace:'nowrap', overflow:'hidden', textOverflow:'ellipsis' }}>{user.name}</h1>
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '5px', fontSize: '12px', color: '#888', marginTop:'2px' }}>
                <span style={{ color: user.tier==='ì²œìƒê³„'?'#00bfff':'#e89d40', fontWeight:'bold' }}>{user.tier}</span> 
                <span>â€¢ {user.score} LP</span>
              </div>
            </div>
          </div>
          <button onClick={onClose} style={{ background: 'none', border: 'none', color: '#ccc', padding:'8px', cursor:'pointer' }}>
            <X size={24} />
          </button>
        </div>

        {/* 2. ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */}
        <div style={{ 
          flex: 1, 
          display: 'flex', 
          flexDirection: isMobile ? 'column' : 'row', 
          overflow: isMobile ? 'visible' : 'hidden', 
          boxSizing: 'border-box'
        }}>

          {/* [ì¢Œì¸¡] ìš”ì•½ ì •ë³´ */}
          <div style={{ 
            width: isMobile ? '100%' : '320px', 
            padding: '20px', 
            borderRight: isMobile ? 'none' : '1px solid #30363d',
            borderBottom: isMobile ? '1px solid #30363d' : 'none',
            background: '#161b22', 
            overflowY: isMobile ? 'visible' : 'auto',
            boxSizing: 'border-box'
          }}>
            <div style={{ background: '#0d1117', padding: '15px', borderRadius: '12px', border: '1px solid #30363d', marginBottom: '15px' }}>
              <h3 style={{ fontSize: '12px', color: '#8b949e', margin: '0 0 10px 0', display:'flex', gap:'6px' }}>
                <TrendingUp size={14}/> ì†”ë¡œ ë­í¬
              </h3>
              <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: '24px', fontWeight: '900', color: '#fff' }}>
                    {user.winRate.toFixed(1)}<span style={{ fontSize: '12px', color: '#888', marginLeft:'2px' }}>%</span>
                  </div>
                  <div style={{ fontSize: '11px', color: '#888' }}>{totalWins}ìŠ¹ {totalLosses}íŒ¨</div>
                </div>
                <div style={{ width: '80px', textAlign:'right' }}>
                  <span style={{ fontSize:'11px', color:'#ccc' }}>ìµœê·¼ 20ì „</span>
                  <WinRateBar wins={totalWins} losses={totalLosses} />
                </div>
              </div>
            </div>

            <div style={{ background: '#0d1117', padding: '15px', borderRadius: '12px', border: '1px solid #30363d' }}>
              <h3 style={{ fontSize: '12px', color: '#8b949e', margin: '0 0 10px 0', display:'flex', gap:'6px' }}>
                <Target size={14}/> ì„ í˜¸ í¬ì§€ì…˜
              </h3>
              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                <RoleDisplay lane={user.preferredLane || 'ALL'} />
              </div>
            </div>
          </div>

          {/* [ìš°ì¸¡] ìƒì„¸ íƒ­ ë° ë¦¬ìŠ¤íŠ¸ */}
          <div style={{ 
            flex: 1, 
            display: 'flex', 
            flexDirection: 'column', 
            background: '#0d1117', 
            overflow: isMobile ? 'visible' : 'hidden',
            boxSizing: 'border-box'
          }}>

            {/* íƒ­ ë²„íŠ¼ */}
            <div style={{ 
              display: 'flex', borderBottom: '1px solid #30363d', background: '#161b22',
              position: isMobile ? 'sticky' : 'relative', 
              top: isMobile ? '81px' : 0, 
              zIndex: 40,
              boxSizing: 'border-box'
            }}>
              <button onClick={() => setActiveTab('OVERVIEW')} style={{ flex: 1, padding: '14px', background: 'none', border: 'none', color: activeTab === 'OVERVIEW' ? '#fff' : '#666', borderBottom: activeTab === 'OVERVIEW' ? '2px solid #58a6ff' : 'none', fontWeight: 'bold', fontSize:'13px', cursor:'pointer' }}>
                ì „ì  ìš”ì•½
              </button>
              <button onClick={() => setActiveTab('CHAMPIONS')} style={{ flex: 1, padding: '14px', background: 'none', border: 'none', color: activeTab === 'CHAMPIONS' ? '#fff' : '#666', borderBottom: activeTab === 'CHAMPIONS' ? '2px solid #58a6ff' : 'none', fontWeight: 'bold', fontSize:'13px', cursor:'pointer' }}>
                ì±”í”¼ì–¸ ë¶„ì„
              </button>
            </div>

            {/* ì»¨í…ì¸  ë¦¬ìŠ¤íŠ¸ */}
            <div style={{ 
              flex: 1, 
              padding: '15px', 
              overflowY: isMobile ? 'visible' : 'auto',
              boxSizing: 'border-box',
              paddingBottom: isMobile ? '100px' : '15px' 
            }}>

              {activeTab === 'OVERVIEW' && (
                <div style={{ display:'flex', flexDirection:'column', gap:'20px' }}>

                  <div>
                    <h4 style={{ fontSize: '12px', color: '#888', margin: '0 0 8px 0' }}>ëª¨ìŠ¤íŠ¸ ì±”í”¼ì–¸ (Top 3)</h4>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '8px' }}>
                      {mostChampions.map((data, idx) => {
                        const winRate = data.stat.matches > 0 ? (data.stat.wins / data.stat.matches) * 100 : 0;
                        const grade = calculateGrade(data.stat.kills, data.stat.deaths, data.stat.assists);
                        return (
                          <div key={idx} style={{ background: '#1c1c1f', padding: '10px 5px', borderRadius: '8px', border: '1px solid #30363d', textAlign:'center' }}>
                            <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#fff', marginBottom:'2px', overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap' }}>
                              {data.hero?.name}
                            </div>
                            <div style={{ fontSize: '10px', color: winRate >= 60 ? '#da3633' : '#bbb' }}>{winRate.toFixed(0)}%</div>
                            <div style={{ fontSize: '10px', color: '#e89d40' }}>{grade}:1</div>
                          </div>
                        );
                      })}
                      {mostChampions.length === 0 && <div style={{gridColumn:'1/-1', color:'#555', fontSize:'12px', textAlign:'center', padding:'10px'}}>ë°ì´í„° ì—†ìŒ</div>}
                    </div>
                  </div>

                  <div>
                    <h4 style={{ fontSize: '12px', color: '#888', margin: '0 0 8px 0', display:'flex', alignItems:'center', gap:'6px' }}>
                      <History size={14}/> ìµœê·¼ ì „ì 
                    </h4>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {user.history.map((match, idx) => {
                        const isWin = match.result === 'WIN';
                        const borderColor = isWin ? '#5383e8' : '#e84057';
                        const bgColor = isWin ? 'rgba(83, 131, 232, 0.1)' : 'rgba(232, 64, 87, 0.1)';

                        return (
                          <div key={idx} style={{ 
                            display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                            background: bgColor, borderLeft: `4px solid ${borderColor}`,
                            padding: '12px', borderRadius: '4px'
                          }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                              <div style={{ fontWeight: 'bold', fontSize: '13px', color: isWin ? '#58a6ff' : '#e84057', width:'30px' }}>
                                {isWin ? 'ìŠ¹ë¦¬' : 'íŒ¨ë°°'}
                              </div>
                              <div>
                                <div style={{ fontSize: '13px', color: '#fff', fontWeight:'bold' }}>{match.heroName}</div>
                                <div style={{ fontSize: '11px', color: '#aaa' }}>{match.date.split(' ')[1]}</div>
                              </div>
                            </div>
                            <div style={{ textAlign: 'right' }}>
                              <div style={{ fontSize: '13px', fontWeight: 'bold', color: '#fff' }}>{match.kda}</div>
                              <div style={{ fontSize: '11px', fontWeight: 'bold', color: match.lpChange > 0 ? '#e89d40' : '#888' }}>
                                {match.lpChange > 0 ? `+${match.lpChange}` : match.lpChange} LP
                              </div>
                            </div>
                          </div>
                        );
                      })}
                      {user.history.length === 0 && <div style={{ textAlign:'center', color:'#555', padding:'20px', fontSize:'13px' }}>ê¸°ë¡ëœ ì „ì ì´ ì—†ìŠµë‹ˆë‹¤.</div>}
                    </div>
                  </div>

                </div>
              )}

              {/* [ìˆ˜ì •] ì±”í”¼ì–¸ ë¶„ì„ íƒ­ (ìƒì„¸ í…Œì´ë¸” ë·°) */}
              {activeTab === 'CHAMPIONS' && (
                <div style={{ display:'flex', flexDirection:'column' }}>
                  {/* í—¤ë” */}
                  <div style={{ display:'grid', gridTemplateColumns:'2fr 1fr 1fr 1fr', padding:'10px', borderBottom:'1px solid #333', color:'#8b949e', fontSize:'11px', fontWeight:'bold' }}>
                    <div>ì±”í”¼ì–¸</div>
                    <div style={{ textAlign:'center' }}>ìŠ¹ë¥  (ìŠ¹/íŒ¨)</div>
                    <div style={{ textAlign:'center' }}>KDA (í‰ì )</div>
                    <div style={{ textAlign:'right' }}>CS / ê³¨ë“œ</div>
                  </div>

                  {champStats.map((data, idx) => {
                    const matches = data.stat.matches;
                    const wins = data.stat.wins;
                    const losses = matches - wins;
                    const winRate = matches > 0 ? (wins / matches) * 100 : 0;

                    const avgK = (data.stat.kills / matches).toFixed(1);
                    const avgD = (data.stat.deaths / matches).toFixed(1);
                    const avgA = (data.stat.assists / matches).toFixed(1);
                    const kdaRatio = calculateGrade(data.stat.kills, data.stat.deaths, data.stat.assists);

                    // ì„ì‹œ ë°ì´í„° (CS, ê³¨ë“œëŠ” ê¸°ë¡ì´ ì—†ìœ¼ë©´ í‰ê· ê°’ìœ¼ë¡œ ëŒ€ì²´)
                    const avgCs = (150 + Math.random() * 50).toFixed(0); 
                    const avgGold = (8000 + Math.random() * 4000).toFixed(0);

                    return (
                      <div key={idx} style={{ 
                        display:'grid', gridTemplateColumns:'2fr 1fr 1fr 1fr', 
                        padding:'12px 10px', borderBottom:'1px solid #2c2c2f', alignItems:'center',
                        background: '#1c1c1f'
                      }}>
                        {/* 1. ì±”í”¼ì–¸ ì •ë³´ */}
                        <div style={{ display:'flex', alignItems:'center', gap:'10px' }}>
                          <div style={{ width:'32px', height:'32px', background:'#333', borderRadius:'8px', display:'flex', alignItems:'center', justifyContent:'center', border:'1px solid #444' }}>ğŸ§™â€â™‚ï¸</div>
                          <div>
                            <div style={{ color:'#fff', fontWeight:'bold', fontSize:'13px' }}>{data.hero?.name}</div>
                            <div style={{ color:'#666', fontSize:'11px' }}>{matches}ê²Œì„</div>
                          </div>
                        </div>

                        {/* 2. ìŠ¹ë¥  */}
                        <div style={{ textAlign:'center' }}>
                          <div style={{ 
                            color: winRate >= 60 ? '#da3633' : winRate >= 50 ? '#fff' : '#888', 
                            fontWeight:'bold', fontSize:'13px' 
                          }}>
                            {winRate.toFixed(0)}%
                          </div>
                          <div style={{ fontSize:'10px', color:'#666' }}>{wins}ìŠ¹ {losses}íŒ¨</div>
                        </div>

                        {/* 3. KDA */}
                        <div style={{ textAlign:'center' }}>
                          <div style={{ color: parseFloat(kdaRatio) >= 3 ? '#e89d40' : '#ccc', fontWeight:'bold', fontSize:'13px' }}>
                            {kdaRatio}:1
                          </div>
                          <div style={{ fontSize:'10px', color:'#666' }}>
                            {avgK} / <span style={{color:'#da3633'}}>{avgD}</span> / {avgA}
                          </div>
                        </div>

                        {/* 4. ê¸°íƒ€ ìŠ¤íƒ¯ */}
                        <div style={{ textAlign:'right', fontSize:'11px', color:'#888' }}>
                          <div><Target size={10} style={{marginRight:2, display:'inline'}}/> {avgCs}</div>
                          <div style={{color:'#e89d40'}}>{parseInt(avgGold).toLocaleString()}</div>
                        </div>
                      </div>
                    );
                  })}

                  {champStats.length === 0 && (
                    <div style={{ padding:'40px', textAlign:'center', color:'#555', fontSize:'13px' }}>
                      <Award size={32} style={{ marginBottom:'10px', opacity:0.5 }} />
                      <br/>í”Œë ˆì´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                  )}
                </div>
              )}

            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// === FILE: /src/data/heroes/helpers.ts ===

// src/data/heroes/helpers.ts
import { HeroSkillSet } from '../../types';

export const getEmptyRecord = () => ({ 
  totalMatches: 0, totalWins: 0, totalPicks: 0, totalBans: 0,
  totalKills: 0, totalDeaths: 0, totalAssists: 0, 
  totalDamage: 0, totalDamageTaken: 0, totalCs: 0, totalGold: 0,
  recentResults: [] 
});

export const getEmptyUI = () => ({
  tier: '3' as const, rank: 0, rankChange: 0,
  recentWinRate: 0, pickRate: 0, banRate: 0,
  avgKda: '0.0/0.0/0.0', kdaRatio: '0.00', 
  avgDpm: '0', avgDpg: '0', avgCs: '0', avgGold: '0'
});

export const fallbackSkills: HeroSkillSet = {
  passive: { name: "ê¸°ë³¸ ëŠ¥ë ¥", mechanic: "NONE", val: 0, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
  q: { name: "Q ìŠ¤í‚¬", mechanic: "NONE", val: 100, adRatio: 0.7, apRatio: 0, cd: 8 },
  w: { name: "W ìŠ¤í‚¬", mechanic: "NONE", val: 80, adRatio: 0.5, apRatio: 0, cd: 12 },
  e: { name: "E ìŠ¤í‚¬", mechanic: "NONE", val: 60, adRatio: 0.3, apRatio: 0, cd: 15 },
  r: { name: "R ìŠ¤í‚¬", mechanic: "STUN", val: 400, adRatio: 1.2, apRatio: 0, cd: 100 }
};

// === FILE: /src/data/heroes/heroList.ts ===

// src/data/heroes/heroList.ts
import { Role } from '../../types';

export const RAW_HERO_LIST = [
  // 1. ì§‘í–‰ê´€ (Executor) - ìµœì „ì„ ì˜ ì „ì‚¬ë“¤
  { id: 'h_ragna', name: "ë¼ê·¸ë‚˜", role: "ì§‘í–‰ê´€" as Role, stats: { ad: 75, hp: 2200, armor: 45, crit: 20, range: 175, speed: 345, regen: 15, pen: 10 } },
  { id: 'h_kensei', name: "ì¼„ì„¸ì´", role: "ì§‘í–‰ê´€" as Role, stats: { ad: 80, hp: 1950, armor: 35, crit: 25, range: 175, speed: 350, regen: 10, pen: 15 } },
  { id: 'h_baldur', name: "ë°œë‘ë¥´", role: "ì§‘í–‰ê´€" as Role, stats: { ad: 70, hp: 2400, armor: 55, crit: 10, range: 150, speed: 335, regen: 20, pen: 5 } },
  { id: 'h_freya', name: "í”„ë ˆì´ì•¼", role: "ì§‘í–‰ê´€" as Role, stats: { ad: 72, hp: 2100, armor: 40, crit: 15, range: 175, speed: 340, regen: 12, pen: 12 } },
  { id: 'h_gorgon', name: "ê³ ë¥´ê³¤", role: "ì§‘í–‰ê´€" as Role, stats: { ad: 85, hp: 2000, armor: 40, crit: 15, range: 150, speed: 330, regen: 18, pen: 20 } },
  { id: 'h_arthur', name: "ì•„ì„œ", role: "ì§‘í–‰ê´€" as Role, stats: { ad: 68, hp: 2300, armor: 50, crit: 10, range: 150, speed: 340, regen: 14, pen: 8 } },

  // 2. ì„ ì§€ì (Prophet) - ê´‘ì—­ ë§ˆë²•ì‚¬
  { id: 'h_merlin', name: "ë©€ë¦°", role: "ì„ ì§€ì" as Role, stats: { ad: 40, ap: 85, hp: 1600, armor: 25, crit: 0, range: 550, speed: 330, regen: 7, pen: 30 } },
  { id: 'h_crowley', name: "í¬ë¡œìš¸ë¦¬", role: "ì„ ì§€ì" as Role, stats: { ad: 45, ap: 90, hp: 1550, armor: 20, crit: 0, range: 525, speed: 335, regen: 6, pen: 35 } },
  { id: 'h_elara', name: "ì—˜ë¼ë¼", role: "ì„ ì§€ì" as Role, stats: { ad: 38, ap: 80, hp: 1650, armor: 30, crit: 0, range: 575, speed: 325, regen: 8, pen: 25 } },
  { id: 'h_nix', name: "ë‹‰ìŠ¤", role: "ì„ ì§€ì" as Role, stats: { ad: 42, ap: 95, hp: 1500, armor: 22, crit: 0, range: 600, speed: 340, regen: 5, pen: 40 } },
  { id: 'h_sol', name: "ì†”", role: "ì„ ì§€ì" as Role, stats: { ad: 35, ap: 88, hp: 1700, armor: 28, crit: 0, range: 550, speed: 330, regen: 9, pen: 28 } },
  { id: 'h_gaia', name: "ê°€ì´ì•„", role: "ì„ ì§€ì" as Role, stats: { ad: 40, ap: 82, hp: 1800, armor: 35, crit: 0, range: 500, speed: 320, regen: 10, pen: 20 } },

  // 3. ì¶”ì ì (Tracker) - ì•”ì‚´ì ë° ì •ê¸€ëŸ¬
  { id: 'h_kage', name: "ì¹´ê²Œ", role: "ì¶”ì ì" as Role, stats: { ad: 88, hp: 1650, armor: 30, crit: 35, range: 125, speed: 360, regen: 8, pen: 40 } },
  { id: 'h_fenrir', name: "íœë¦¬ë¥´", role: "ì¶”ì ì" as Role, stats: { ad: 82, hp: 1800, armor: 35, crit: 25, range: 125, speed: 355, regen: 12, pen: 30 } },
  { id: 'h_viper', name: "ë°”ì´í¼", role: "ì¶”ì ì" as Role, stats: { ad: 78, hp: 1700, armor: 28, crit: 20, range: 150, speed: 350, regen: 9, pen: 35 } },
  { id: 'h_specter', name: "ìŠ¤í™í„°", role: "ì¶”ì ì" as Role, stats: { ad: 90, hp: 1550, armor: 25, crit: 40, range: 125, speed: 355, regen: 7, pen: 45 } },
  { id: 'h_locust', name: "ë¡œì»¤ìŠ¤íŠ¸", role: "ì¶”ì ì" as Role, stats: { ad: 75, hp: 1750, armor: 32, crit: 30, range: 150, speed: 365, regen: 10, pen: 25 } },
  { id: 'h_scarlet', name: "ìŠ¤ì¹¼ë ›", role: "ì¶”ì ì" as Role, stats: { ad: 85, hp: 1600, armor: 20, crit: 45, range: 125, speed: 350, regen: 6, pen: 50 } },

  // 4. ìˆ˜í˜¸ê¸°ì‚¬ (Guardian) - íƒ±ì»¤
  { id: 'h_aigis', name: "ì•„ì´ê¸°ìŠ¤", role: "ìˆ˜í˜¸ê¸°ì‚¬" as Role, stats: { ad: 50, hp: 3500, armor: 95, crit: 0, range: 150, speed: 315, regen: 30, pen: 0 } },
  { id: 'h_golem', name: "ê³¨ë ˜", role: "ìˆ˜í˜¸ê¸°ì‚¬" as Role, stats: { ad: 60, hp: 3300, armor: 90, crit: 5, range: 150, speed: 310, regen: 25, pen: 5 } },
  { id: 'h_paladin', name: "íŒ”ë¼ë”˜", role: "ìˆ˜í˜¸ê¸°ì‚¬" as Role, stats: { ad: 55, hp: 3000, armor: 85, crit: 0, range: 150, speed: 325, regen: 20, pen: 0 } },
  { id: 'h_treant', name: "íŠ¸ë¦¬ì–¸íŠ¸", role: "ìˆ˜í˜¸ê¸°ì‚¬" as Role, stats: { ad: 65, hp: 3200, armor: 80, crit: 5, range: 175, speed: 320, regen: 40, pen: 5 } },
  { id: 'h_magnus', name: "ë§¤ê·¸ë„ˆìŠ¤", role: "ìˆ˜í˜¸ê¸°ì‚¬" as Role, stats: { ad: 58, hp: 2900, armor: 88, crit: 10, range: 150, speed: 330, regen: 22, pen: 10 } },
  { id: 'h_yeti', name: "ì˜ˆí‹°", role: "ìˆ˜í˜¸ê¸°ì‚¬" as Role, stats: { ad: 62, hp: 3400, armor: 75, crit: 5, range: 150, speed: 315, regen: 28, pen: 5 } },

  // 5. ì‹ ì‚´ì (God Slayer) - ì›ê±°ë¦¬ ë”œëŸ¬
  { id: 'h_hawk', name: "í˜¸í¬", role: "ì‹ ì‚´ì" as Role, stats: { ad: 80, hp: 1500, armor: 25, crit: 40, range: 600, speed: 330, regen: 5, pen: 25 } },
  { id: 'h_trigger', name: "íŠ¸ë¦¬ê±°", role: "ì‹ ì‚´ì" as Role, stats: { ad: 85, hp: 1450, armor: 22, crit: 35, range: 550, speed: 335, regen: 6, pen: 30 } },
  { id: 'h_nova', name: "ë…¸ë°”", role: "ì‹ ì‚´ì" as Role, stats: { ad: 78, hp: 1550, armor: 28, crit: 30, range: 625, speed: 325, regen: 5, pen: 20 } },
  { id: 'h_flint', name: "í”Œë¦°íŠ¸", role: "ì‹ ì‚´ì" as Role, stats: { ad: 90, hp: 1600, armor: 30, crit: 25, range: 525, speed: 340, regen: 7, pen: 35 } },
  { id: 'h_sylvia', name: "ì‹¤ë¹„ì•„", role: "ì‹ ì‚´ì" as Role, stats: { ad: 75, hp: 1400, armor: 20, crit: 45, range: 650, speed: 320, regen: 4, pen: 22 } },
  { id: 'h_gambit', name: "ê°¬ë¹—", role: "ì‹ ì‚´ì" as Role, stats: { ad: 82, hp: 1580, armor: 26, crit: 50, range: 550, speed: 330, regen: 6, pen: 28 } }
];

// === FILE: /src/data/heroes/index.ts ===

// src/data/heroes/index.ts
import { Hero } from '../../types';
import { RAW_HERO_LIST } from './heroList';
import { HERO_SKILL_DATA } from './skillData';
import { getEmptyRecord, getEmptyUI, fallbackSkills } from './helpers';

export const INITIAL_HEROES: Hero[] = RAW_HERO_LIST.map(h => {
  // ìŠ¤íƒ¯ ë³´ì • ë° ê¸°ë³¸ê°’ ì„¤ì •
  const baseStats = {
    ad: h.stats.ad || 0,
    ap: (h.stats as any).ap || 0,
    hp: h.stats.hp || 1000,
    armor: h.stats.armor || 0,
    crit: h.stats.crit || 0,
    range: h.stats.range || 150,
    speed: h.stats.speed || 340,
    regen: h.stats.regen || 10,
    pen: h.stats.pen || 0,
    baseAtk: h.stats.ad || 50
  };

  return {
    ...h,
    stats: baseStats,
    // IDì— ë§ëŠ” ìŠ¤í‚¬ ë°ì´í„° í• ë‹¹ (ì—†ìœ¼ë©´ fallbackìš© ê¸°ë³¸ ìŠ¤í‚¬ ì£¼ì…)
    skills: HERO_SKILL_DATA[h.id] || fallbackSkills,
    record: getEmptyRecord(),
    ...getEmptyUI()
  } as Hero;
});


// === FILE: /src/data/heroes/skillData.ts ===

// src/data/heroes/skillData.ts
import { HeroSkillSet } from '../../types';

export const HERO_SKILL_DATA: Record<string, HeroSkillSet> = {
  // === 1. ì§‘í–‰ê´€ (Executor) ===
  h_ragna: {
    passive: { name: "í”¼ì˜ ê°ˆì¦", mechanic: "HEAL", val: 30, adRatio: 0.2, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ëŒ€ê²€ ë‚´ë ¤ì°ê¸°", mechanic: "NONE", val: 120, adRatio: 1.2, apRatio: 0, cd: 6 },
    w: { name: "ê´‘í­í™”", mechanic: "NONE", val: 0, adRatio: 0.5, apRatio: 0, cd: 12 },
    e: { name: "ì „ì§„ ë² ê¸°", mechanic: "DASH", val: 80, adRatio: 0.8, apRatio: 0, cd: 10 },
    r: { name: "ë¼ê·¸ë‚˜ë¡œí¬", mechanic: "EXECUTE", val: 400, adRatio: 2.0, apRatio: 0, cd: 100 }
  },
  h_kensei: {
    passive: { name: "ê²€ì˜ ê·¹ì˜", mechanic: "NONE", val: 0, adRatio: 0.5, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ë°œë„ìˆ ", mechanic: "NONE", val: 140, adRatio: 1.4, apRatio: 0, cd: 5 },
    w: { name: "ë°˜ê²©", mechanic: "SHIELD", val: 100, adRatio: 0.6, apRatio: 0, cd: 14 },
    e: { name: "ì¼ì„¬", mechanic: "DASH", val: 70, adRatio: 0.7, apRatio: 0, cd: 8 },
    r: { name: "ì˜¤ì˜: ë¬´ì‹ ì°¸", mechanic: "STUN", val: 350, adRatio: 1.8, apRatio: 0, cd: 110 }
  },
  h_baldur: {
    passive: { name: "ë¹›ì˜ ê°‘ì˜·", mechanic: "SHIELD", val: 50, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì‹¬íŒì˜ ë§ì¹˜", mechanic: "STUN", val: 100, adRatio: 1.0, apRatio: 0, cd: 10 },
    w: { name: "ë¶ˆêµ´ì˜ ì˜ì§€", mechanic: "HEAL", val: 150, adRatio: 0.5, apRatio: 0, cd: 18 },
    e: { name: "ëŒê²©", mechanic: "DASH", val: 60, adRatio: 0.5, apRatio: 0, cd: 12 },
    r: { name: "ë°œë‘ë¥´ì˜ ë¶„ë…¸", mechanic: "NONE", val: 300, adRatio: 1.5, apRatio: 0, cd: 120 }
  },
  h_freya: {
    passive: { name: "ì „ì¥ì˜ ì¶¤", mechanic: "NONE", val: 20, adRatio: 0.3, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "íˆ¬ì°½", mechanic: "NONE", val: 110, adRatio: 1.1, apRatio: 0, cd: 6 },
    w: { name: "ê¹ƒí„¸ ë°©íŒ¨", mechanic: "SHIELD", val: 80, adRatio: 0.4, apRatio: 0, cd: 14 },
    e: { name: "ë¹„ìƒ", mechanic: "DASH", val: 100, adRatio: 0.6, apRatio: 0, cd: 15 },
    r: { name: "ë°œí‚¤ë¦¬ì˜ ê°•ë¦¼", mechanic: "GLOBAL", val: 350, adRatio: 1.6, apRatio: 0, cd: 130 }
  },
  h_gorgon: {
    passive: { name: "ì„í™”ì˜ ì‹œì„ ", mechanic: "STUN", val: 0, adRatio: 0, apRatio: 0, cd: 30, isPassive: true },
    q: { name: "ë±€ì˜ ë…", mechanic: "NONE", val: 90, adRatio: 0.9, apRatio: 0.3, cd: 8 },
    w: { name: "ìœ„í˜‘", mechanic: "NONE", val: 60, adRatio: 0.5, apRatio: 0, cd: 10 },
    e: { name: "ê¼¬ë¦¬ì¹˜ê¸°", mechanic: "HOOK", val: 100, adRatio: 0.8, apRatio: 0, cd: 14 },
    r: { name: "ë©”ë‘ì‚¬ì˜ ì €ì£¼", mechanic: "STUN", val: 250, adRatio: 1.2, apRatio: 0.8, cd: 110 }
  },
  h_arthur: {
    passive: { name: "ì™•ì˜ ê¶Œìœ„", mechanic: "NONE", val: 0, adRatio: 0.4, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì—‘ìŠ¤ì¹¼ë¦¬ë²„", mechanic: "NONE", val: 150, adRatio: 1.3, apRatio: 0, cd: 8 },
    w: { name: "ì›íƒì˜ ê°€í˜¸", mechanic: "SHIELD", val: 120, adRatio: 0.5, apRatio: 0, cd: 16 },
    e: { name: "ì™•ì˜ ì§„ê²©", mechanic: "DASH", val: 80, adRatio: 0.6, apRatio: 0, cd: 12 },
    r: { name: "ì•½ì†ëœ ìŠ¹ë¦¬ì˜ ê²€", mechanic: "EXECUTE", val: 450, adRatio: 2.2, apRatio: 0, cd: 140 }
  },

  // === 2. ì„ ì§€ì (Prophet) ===
  h_merlin: {
    passive: { name: "ë§ˆë ¥ ê³¼ë¶€í•˜", mechanic: "NONE", val: 0, adRatio: 0, apRatio: 0.5, cd: 0, isPassive: true },
    q: { name: "í™”ì—¼êµ¬", mechanic: "NONE", val: 140, adRatio: 0, apRatio: 1.2, cd: 5 },
    w: { name: "ë§ˆë²• ë³´í˜¸ë§‰", mechanic: "SHIELD", val: 100, adRatio: 0, apRatio: 0.8, cd: 15 },
    e: { name: "ì ë©¸", mechanic: "DASH", val: 0, adRatio: 0, apRatio: 0, cd: 12 },
    r: { name: "ë©”í…Œì˜¤ ìŠ¤íŠ¸ë¼ì´í¬", mechanic: "GLOBAL", val: 500, adRatio: 0, apRatio: 2.5, cd: 150 }
  },
  h_crowley: {
    passive: { name: "í‘ë§ˆìˆ ", mechanic: "HEAL", val: 20, adRatio: 0, apRatio: 0.3, cd: 0, isPassive: true },
    q: { name: "ì €ì£¼ë°›ì€ íƒ„í™˜", mechanic: "NONE", val: 120, adRatio: 0, apRatio: 1.0, cd: 4 },
    w: { name: "ì˜í˜¼ ìˆ˜í™•", mechanic: "NONE", val: 100, adRatio: 0, apRatio: 0.9, cd: 10 },
    e: { name: "ê³µí¬", mechanic: "STUN", val: 60, adRatio: 0, apRatio: 0.6, cd: 18 },
    r: { name: "ì§€ì˜¥ë¬¸ ê°œë°©", mechanic: "NONE", val: 400, adRatio: 0, apRatio: 2.0, cd: 130 }
  },
  h_elara: {
    passive: { name: "ë³„ì˜ ì¶•ë³µ", mechanic: "HEAL", val: 40, adRatio: 0, apRatio: 0.4, cd: 0, isPassive: true },
    q: { name: "ë¹›ì˜ í™”ì‚´", mechanic: "NONE", val: 110, adRatio: 0, apRatio: 1.1, cd: 5 },
    w: { name: "ì •í™”", mechanic: "HEAL", val: 120, adRatio: 0, apRatio: 0.7, cd: 12 },
    e: { name: "ë¹›ì˜ êµ¬ì†", mechanic: "STUN", val: 80, adRatio: 0, apRatio: 0.8, cd: 14 },
    r: { name: "ì²œìƒì˜ ì‹¬íŒ", mechanic: "GLOBAL", val: 450, adRatio: 0, apRatio: 2.2, cd: 140 }
  },
  h_nix: {
    passive: { name: "ê·¸ë¦¼ì ì¥ë§‰", mechanic: "STEALTH", val: 0, adRatio: 0, apRatio: 0, cd: 20, isPassive: true },
    q: { name: "ì–´ë‘ ì˜ êµ¬ì²´", mechanic: "NONE", val: 130, adRatio: 0, apRatio: 1.3, cd: 6 },
    w: { name: "ê·¸ë¦¼ì ì†ë°•", mechanic: "HOOK", val: 80, adRatio: 0, apRatio: 0.7, cd: 16 },
    e: { name: "ì–´ë‘  ë„ì•½", mechanic: "DASH", val: 50, adRatio: 0, apRatio: 0.5, cd: 12 },
    r: { name: "ì˜ì›í•œ ë°¤", mechanic: "STUN", val: 400, adRatio: 0, apRatio: 2.0, cd: 150 }
  },
  h_sol: {
    passive: { name: "íƒœì–‘ì—´", mechanic: "NONE", val: 10, adRatio: 0, apRatio: 0.2, cd: 0, isPassive: true },
    q: { name: "í”Œë ˆì–´", mechanic: "NONE", val: 150, adRatio: 0, apRatio: 1.4, cd: 7 },
    w: { name: "íƒœì–‘ì˜ ë°©íŒ¨", mechanic: "SHIELD", val: 90, adRatio: 0, apRatio: 0.6, cd: 14 },
    e: { name: "ì—´í’", mechanic: "DASH", val: 60, adRatio: 0, apRatio: 0.4, cd: 12 },
    r: { name: "ìŠˆí¼ë…¸ë°”", mechanic: "NONE", val: 550, adRatio: 0, apRatio: 2.8, cd: 160 }
  },
  h_gaia: {
    passive: { name: "ëŒ€ì§€ì˜ í˜", mechanic: "SHIELD", val: 40, adRatio: 0, apRatio: 0.3, cd: 0, isPassive: true },
    q: { name: "ì§€ì§„", mechanic: "NONE", val: 120, adRatio: 0, apRatio: 1.0, cd: 8 },
    w: { name: "ë©êµ´ ì†", mechanic: "STUN", val: 80, adRatio: 0, apRatio: 0.8, cd: 14 },
    e: { name: "ìì—°ì˜ ì¹˜ìœ ", mechanic: "HEAL", val: 100, adRatio: 0, apRatio: 0.6, cd: 16 },
    r: { name: "ëŒ€ìì—°ì˜ ë¶„ë…¸", mechanic: "GLOBAL", val: 400, adRatio: 0, apRatio: 1.8, cd: 140 }
  },

  // === 3. ì¶”ì ì (Tracker) ===
  h_kage: {
    passive: { name: "ì•”ìŠµ", mechanic: "NONE", val: 0, adRatio: 0.5, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ìˆ˜ë¦¬ê²€", mechanic: "NONE", val: 100, adRatio: 1.1, apRatio: 0, cd: 4 },
    w: { name: "ê·¸ë¦¼ì ë¶„ì‹ ", mechanic: "SHIELD", val: 60, adRatio: 0.4, apRatio: 0, cd: 14 },
    e: { name: "ì€ì‹ ", mechanic: "STEALTH", val: 0, adRatio: 0, apRatio: 0, cd: 18 },
    r: { name: "ì•”ì‚´ ë¹„ê¸°", mechanic: "EXECUTE", val: 450, adRatio: 2.5, apRatio: 0, cd: 100 }
  },
  h_fenrir: {
    passive: { name: "ì•¼ìˆ˜ì„±", mechanic: "NONE", val: 0, adRatio: 0.4, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ë¬¼ì–´ëœ¯ê¸°", mechanic: "NONE", val: 120, adRatio: 1.3, apRatio: 0, cd: 6 },
    w: { name: "í¬íš¨", mechanic: "STUN", val: 0, adRatio: 0, apRatio: 0, cd: 15 },
    e: { name: "ë„ì•½", mechanic: "DASH", val: 80, adRatio: 0.8, apRatio: 0, cd: 10 },
    r: { name: "ë¼ê·¸ë‚˜ë¡œí¬ì˜ ëŠ‘ëŒ€", mechanic: "NONE", val: 350, adRatio: 2.0, apRatio: 0, cd: 110 }
  },
  h_viper: {
    passive: { name: "ì‹ ê²½ë…", mechanic: "NONE", val: 20, adRatio: 0.2, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ë…ì¹¨", mechanic: "NONE", val: 90, adRatio: 1.0, apRatio: 0, cd: 5 },
    w: { name: "ì—°ë§‰", mechanic: "STEALTH", val: 0, adRatio: 0, apRatio: 0, cd: 20 },
    e: { name: "ë…ì‚¬ì˜ ì¶¤", mechanic: "DASH", val: 60, adRatio: 0.6, apRatio: 0, cd: 12 },
    r: { name: "ì¹˜ëª…ì ì¸ ë§¹ë…", mechanic: "EXECUTE", val: 300, adRatio: 1.8, apRatio: 0, cd: 120 }
  },
  h_specter: {
    passive: { name: "ìœ ì²´í™”", mechanic: "NONE", val: 0, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì˜í˜¼ ë² ê¸°", mechanic: "NONE", val: 130, adRatio: 1.2, apRatio: 0, cd: 7 },
    w: { name: "ë¹™ì˜", mechanic: "STUN", val: 70, adRatio: 0.5, apRatio: 0, cd: 16 },
    e: { name: "ë²½ í†µê³¼", mechanic: "DASH", val: 100, adRatio: 0, apRatio: 0, cd: 14 },
    r: { name: "ì‚¬ì‹ ì˜ ë‚«", mechanic: "EXECUTE", val: 500, adRatio: 2.2, apRatio: 0, cd: 130 }
  },
  h_locust: {
    passive: { name: "êµ°ì²´ì˜ ì˜ì‹", mechanic: "NONE", val: 0, adRatio: 0.3, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ê°ˆí€´ì†", mechanic: "NONE", val: 110, adRatio: 1.1, apRatio: 0, cd: 5 },
    w: { name: "ê°‘ê° ê°•í™”", mechanic: "SHIELD", val: 80, adRatio: 0.3, apRatio: 0, cd: 12 },
    e: { name: "ë„ì•½ ê³µê²©", mechanic: "DASH", val: 120, adRatio: 0.9, apRatio: 0, cd: 8 },
    r: { name: "í¬ì‹", mechanic: "HEAL", val: 200, adRatio: 1.5, apRatio: 0, cd: 100 }
  },
  h_scarlet: {
    passive: { name: "í”¼ì˜ ê³„ì•½", mechanic: "NONE", val: 0, adRatio: 0.4, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "í˜ˆê²©", mechanic: "NONE", val: 140, adRatio: 1.4, apRatio: 0, cd: 6 },
    w: { name: "ë¶‰ì€ ì•ˆê°œ", mechanic: "STEALTH", val: 0, adRatio: 0, apRatio: 0, cd: 18 },
    e: { name: "íšŒì „ ë² ê¸°", mechanic: "NONE", val: 100, adRatio: 1.0, apRatio: 0, cd: 9 },
    r: { name: "ë¸”ëŸ¬ë“œ ë¬¸", mechanic: "EXECUTE", val: 450, adRatio: 2.3, apRatio: 0, cd: 110 }
  },

  // === 4. ìˆ˜í˜¸ê¸°ì‚¬ (Guardian) ===
  h_aigis: {
    passive: { name: "ì ˆëŒ€ ë°©ì–´", mechanic: "SHIELD", val: 50, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ë°©íŒ¨ ë°€ì¹˜ê¸°", mechanic: "STUN", val: 80, adRatio: 0.6, apRatio: 0, cd: 10 },
    w: { name: "ìˆ˜í˜¸ íƒœì„¸", mechanic: "SHIELD", val: 200, adRatio: 0.2, apRatio: 0, cd: 15 },
    e: { name: "ê°€ë¡œë§‰ê¸°", mechanic: "DASH", val: 50, adRatio: 0, apRatio: 0, cd: 12 },
    r: { name: "ì² ì˜¹ì„±", mechanic: "GLOBAL", val: 0, adRatio: 0, apRatio: 0, cd: 160 }
  },
  h_golem: {
    passive: { name: "ë°”ìœ„ í”¼ë¶€", mechanic: "NONE", val: 0, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì§€ë©´ ê°•íƒ€", mechanic: "NONE", val: 100, adRatio: 0.8, apRatio: 0, cd: 8 },
    w: { name: "ë‹¨ë‹¨í•´ì§€ê¸°", mechanic: "SHIELD", val: 150, adRatio: 0.3, apRatio: 0, cd: 14 },
    e: { name: "ë°”ìœ„ ë˜ì§€ê¸°", mechanic: "STUN", val: 90, adRatio: 0.7, apRatio: 0, cd: 12 },
    r: { name: "ëŒ€ì§€ì§„", mechanic: "STUN", val: 250, adRatio: 1.0, apRatio: 0, cd: 140 }
  },
  h_paladin: {
    passive: { name: "ì‹ ì„±í•œ ì˜¤ë¼", mechanic: "HEAL", val: 10, adRatio: 0, apRatio: 0.1, cd: 0, isPassive: true },
    q: { name: "ì„±ìŠ¤ëŸ¬ìš´ ì¼ê²©", mechanic: "NONE", val: 90, adRatio: 0.9, apRatio: 0, cd: 7 },
    w: { name: "ì¶•ë³µ", mechanic: "HEAL", val: 120, adRatio: 0, apRatio: 0.5, cd: 12 },
    e: { name: "ì‹¬íŒ", mechanic: "STUN", val: 80, adRatio: 0.6, apRatio: 0, cd: 15 },
    r: { name: "ì‹ ì˜ ê°€í˜¸", mechanic: "GLOBAL", val: 0, adRatio: 0, apRatio: 0, cd: 180 }
  },
  h_treant: {
    passive: { name: "ê´‘í•©ì„±", mechanic: "HEAL", val: 20, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ë¿Œë¦¬ ë¬¶ê¸°", mechanic: "STUN", val: 70, adRatio: 0, apRatio: 0.4, cd: 10 },
    w: { name: "ë‚˜ë¬´ ê»ì§ˆ", mechanic: "SHIELD", val: 130, adRatio: 0, apRatio: 0.3, cd: 16 },
    e: { name: "ìì—°ì˜ ì†ê¸¸", mechanic: "HEAL", val: 100, adRatio: 0, apRatio: 0.4, cd: 14 },
    r: { name: "ìˆ²ì˜ ë¶„ë…¸", mechanic: "NONE", val: 300, adRatio: 0, apRatio: 1.0, cd: 130 }
  },
  h_magnus: {
    passive: { name: "ê±°ì¸ì˜ í˜", mechanic: "NONE", val: 0, adRatio: 0.3, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì¶©ê²©íŒŒ", mechanic: "NONE", val: 110, adRatio: 0.9, apRatio: 0, cd: 8 },
    w: { name: "ë“¤ì´ë°›ê¸°", mechanic: "DASH", val: 100, adRatio: 0.8, apRatio: 0, cd: 12 },
    e: { name: "ìœ„ì••", mechanic: "STUN", val: 60, adRatio: 0.5, apRatio: 0, cd: 15 },
    r: { name: "ë’¤ì§‘ê¸°", mechanic: "HOOK", val: 200, adRatio: 1.2, apRatio: 0, cd: 100 }
  },
  h_yeti: {
    passive: { name: "ì„¤ì¸", mechanic: "NONE", val: 0, adRatio: 0, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì–¼ìŒ ë­‰ì¹˜", mechanic: "STUN", val: 80, adRatio: 0.7, apRatio: 0, cd: 9 },
    w: { name: "í¬ì‹", mechanic: "HEAL", val: 150, adRatio: 0.5, apRatio: 0, cd: 18 },
    e: { name: "ëˆˆì‚¬íƒœ", mechanic: "NONE", val: 100, adRatio: 0.8, apRatio: 0, cd: 10 },
    r: { name: "ì ˆëŒ€ ì˜ë„", mechanic: "STUN", val: 300, adRatio: 1.0, apRatio: 0, cd: 140 }
  },

  // === 5. ì‹ ì‚´ì (God Slayer) ===
  h_hawk: {
    passive: { name: "ë§¤ì˜ ëˆˆ", mechanic: "NONE", val: 0, adRatio: 0.5, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì •ë°€ ì‚¬ê²©", mechanic: "NONE", val: 130, adRatio: 1.4, apRatio: 0, cd: 6 },
    w: { name: "ì†ì‚¬", mechanic: "NONE", val: 100, adRatio: 1.0, apRatio: 0, cd: 10 },
    e: { name: "íšŒí”¼ ê¸°ë™", mechanic: "DASH", val: 50, adRatio: 0.3, apRatio: 0, cd: 14 },
    r: { name: "ê´€í†µìƒ", mechanic: "EXECUTE", val: 400, adRatio: 2.0, apRatio: 0, cd: 110 }
  },
  h_trigger: {
    passive: { name: "ë”ë¸” íƒ­", mechanic: "NONE", val: 0, adRatio: 0.4, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ë‚œì‚¬", mechanic: "NONE", val: 120, adRatio: 1.2, apRatio: 0, cd: 5 },
    w: { name: "ìˆ˜ë¥˜íƒ„", mechanic: "NONE", val: 100, adRatio: 0.8, apRatio: 0, cd: 12 },
    e: { name: "ìŠ¬ë¼ì´ë”©", mechanic: "DASH", val: 60, adRatio: 0.4, apRatio: 0, cd: 10 },
    r: { name: "ë¶ˆê½ƒë†€ì´", mechanic: "GLOBAL", val: 450, adRatio: 1.8, apRatio: 0, cd: 130 }
  },
  h_nova: {
    passive: { name: "ì—ë„ˆì§€ ì¶©ì „", mechanic: "NONE", val: 0, adRatio: 0.3, apRatio: 0.2, cd: 0, isPassive: true },
    q: { name: "í”Œë¼ì¦ˆë§ˆ íƒ„", mechanic: "NONE", val: 140, adRatio: 1.3, apRatio: 0, cd: 7 },
    w: { name: "ì¤‘ë ¥íƒ„", mechanic: "STUN", val: 70, adRatio: 0.5, apRatio: 0, cd: 15 },
    e: { name: "ì¶”ì§„ê¸°", mechanic: "DASH", val: 80, adRatio: 0.5, apRatio: 0, cd: 18 },
    r: { name: "ê¶¤ë„ í­ê²©", mechanic: "GLOBAL", val: 500, adRatio: 2.2, apRatio: 0, cd: 150 }
  },
  h_flint: {
    passive: { name: "í™”ì•½ ëƒ„ìƒˆ", mechanic: "NONE", val: 20, adRatio: 0.3, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì‚°íƒ„ ì‚¬ê²©", mechanic: "NONE", val: 150, adRatio: 1.5, apRatio: 0, cd: 8 },
    w: { name: "ì—°ë§‰íƒ„", mechanic: "STEALTH", val: 0, adRatio: 0, apRatio: 0, cd: 20 },
    e: { name: "ì™€ì´ì–´ ì´ë™", mechanic: "DASH", val: 100, adRatio: 0.6, apRatio: 0, cd: 16 },
    r: { name: "ë°ìŠ¤í˜ë¼ë„", mechanic: "NONE", val: 400, adRatio: 2.5, apRatio: 0, cd: 120 }
  },
  h_sylvia: {
    passive: { name: "ë°”ëŒì˜ ì†ì‚­ì„", mechanic: "NONE", val: 0, adRatio: 0.4, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ë°”ëŒ í™”ì‚´", mechanic: "NONE", val: 120, adRatio: 1.3, apRatio: 0, cd: 6 },
    w: { name: "ë°€ì³ë‚´ê¸°", mechanic: "NONE", val: 80, adRatio: 0.6, apRatio: 0, cd: 12 },
    e: { name: "ë°”ëŒíƒ€ê¸°", mechanic: "DASH", val: 70, adRatio: 0.4, apRatio: 0, cd: 14 },
    r: { name: "í­í’ìš°", mechanic: "NONE", val: 350, adRatio: 1.8, apRatio: 0, cd: 110 }
  },
  h_gambit: {
    passive: { name: "ë„ë°•ì‚¬ì˜ í–‰ìš´", mechanic: "NONE", val: 0, adRatio: 0.5, apRatio: 0, cd: 0, isPassive: true },
    q: { name: "ì¹´ë“œ íˆ¬ì²™", mechanic: "NONE", val: 130, adRatio: 1.2, apRatio: 0, cd: 5 },
    w: { name: "ì†ì„ìˆ˜", mechanic: "STEALTH", val: 0, adRatio: 0, apRatio: 0, cd: 18 },
    e: { name: "íŒëˆ ì˜¬ë¦¬ê¸°", mechanic: "NONE", val: 0, adRatio: 0.4, apRatio: 0, cd: 10 },
    r: { name: "ë¡œì—´ ìŠ¤íŠ¸ë ˆì´íŠ¸", mechanic: "EXECUTE", val: 500, adRatio: 2.4, apRatio: 0, cd: 130 }
  }
};

// === FILE: /src/data/heroes.ts ===

export * from './heroes/index';

// === FILE: /src/data/initialImages.ts ===

// ==========================================
// FILE PATH: /src/data/initialImages.ts
// ==========================================

export const INITIAL_CUSTOM_IMAGES: Record<string, string> = {
  // === 1. ì‹ (ì§„ì˜) ===
  'god_izman': '/images/gods/god_izman.png',
  'god_dante': '/images/gods/god_dante.png',

  // === 2. ì§ì—… ì•„ì´ì½˜ & ë°°ê²½ ===
  // ì§‘í–‰ê´€
  'role_executor': '/images/roles/role_executor.png',
  'role_executor_bg': '/images/roles/role_executor_bg.png',
  // ì¶”ì ì
  'role_tracker': '/images/roles/role_tracker.png',
  'role_tracker_bg': '/images/roles/role_tracker_bg.png',
  // ì„ ì§€ì
  'role_prophet': '/images/roles/role_prophet.png',
  'role_prophet_bg': '/images/roles/role_prophet_bg.png',
  // ì‹ ì‚´ì
  'role_slayer': '/images/roles/role_slayer.png',
  'role_slayer_bg': '/images/roles/role_slayer_bg.png',
  // ìˆ˜í˜¸ê¸°ì‚¬
  'role_guardian': '/images/roles/role_guardian.png',
  'role_guardian_bg': '/images/roles/role_guardian_bg.png',

  // === 3. ì˜ì›… í”„ë¡œí•„ (ì˜ˆì‹œ) ===
  // ì§‘í–‰ê´€
  'h_ragna': '/images/heroes/h_ragna.png',
  'h_kensei': '/images/heroes/h_kensei.png',
  'h_baldur': '/images/heroes/h_baldur.png',
  'h_freya': '/images/heroes/h_freya.png',
  'h_gorgon': '/images/heroes/h_gorgon.png',
  'h_arthur': '/images/heroes/h_arthur.png',

  // ì„ ì§€ì
  'h_merlin': '/images/heroes/h_merlin.png',
  'h_crowley': '/images/heroes/h_crowley.png',
  'h_elara': '/images/heroes/h_elara.png',
  'h_nix': '/images/heroes/h_nix.png',
  'h_sol': '/images/heroes/h_sol.png',
  'h_gaia': '/images/heroes/h_gaia.png',

  // ì¶”ì ì
  'h_kage': '/images/heroes/h_kage.png',
  'h_fenrir': '/images/heroes/h_fenrir.png',
  'h_viper': '/images/heroes/h_viper.png',
  'h_specter': '/images/heroes/h_specter.png',
  'h_locust': '/images/heroes/h_locust.png',
  'h_scarlet': '/images/heroes/h_scarlet.png',

  // ìˆ˜í˜¸ê¸°ì‚¬
  'h_aigis': '/images/heroes/h_aigis.png',
  'h_golem': '/images/heroes/h_golem.png',
  'h_paladin': '/images/heroes/h_paladin.png',
  'h_treant': '/images/heroes/h_treant.png',
  'h_magnus': '/images/heroes/h_magnus.png',
  'h_yeti': '/images/heroes/h_yeti.png',

  // ì‹ ì‚´ì
  'h_hawk': '/images/heroes/h_hawk.png',
  'h_trigger': '/images/heroes/h_trigger.png',
  'h_nova': '/images/heroes/h_nova.png',
  'h_flint': '/images/heroes/h_flint.png',
  'h_sylvia': '/images/heroes/h_sylvia.png',
  'h_gambit': '/images/heroes/h_gambit.png',
};

// === FILE: /src/data/items.ts ===

// ==========================================
// FILE PATH: /src/data/items.ts
// ==========================================

import { Item } from '../types';

export const INITIAL_ITEMS: Item[] = [
  // [ì´ˆë°˜ - Starter]
  { id: 'i_sword', name: 'ì§‘í–‰ê´€ì˜ ë‹¨ê²€', cost: 350, ad: 10, ap: 0, hp: 0, armor: 0, crit: 0, speed: 0, type: 'WEAPON' },
  { id: 'i_ring', name: 'ì„ ì§€ìì˜ ë°˜ì§€', cost: 400, ad: 0, ap: 15, hp: 60, armor: 0, crit: 0, speed: 0, type: 'ACCESSORY' },
  { id: 'i_shield', name: 'ìˆ˜í˜¸ìì˜ ë°©íŒ¨', cost: 450, ad: 0, ap: 0, hp: 80, armor: 5, crit: 0, speed: 0, type: 'ARMOR' },

  // [ì¤‘ë°˜ - Intermediate]
  { id: 'i_bf', name: 'íˆ¬ì‹ ì˜ ëŒ€ê²€', cost: 1300, ad: 40, ap: 0, hp: 0, armor: 0, crit: 0, speed: 0, type: 'WEAPON' },
  { id: 'i_rod', name: 'ê³µí—ˆì˜ ìˆ˜ì •', cost: 1250, ad: 0, ap: 60, hp: 0, armor: 0, crit: 0, speed: 0, type: 'WEAPON' },
  { id: 'i_vest', name: 'í‘ìš”ì„ íŒê¸ˆ', cost: 800, ad: 0, ap: 0, hp: 0, armor: 35, crit: 0, speed: 0, type: 'ARMOR' },

  // [ì½”ì–´ - Legendary]
  { id: 'i_ie', name: 'ì‹¬íŒì˜ ê²€: ë¼ê·¸ë‚˜ë¡œí¬', cost: 3400, ad: 70, ap: 0, hp: 0, armor: 0, crit: 20, speed: 0, type: 'WEAPON' },
  { id: 'i_rabadon', name: 'ì´ˆì›”ìì˜ ì™•ê´€', cost: 3600, ad: 0, ap: 120, hp: 0, armor: 0, crit: 0, speed: 0, type: 'WEAPON' },
  { id: 'i_warmog', name: 'ê±°ì‹ ë³‘ì˜ ì‹¬ì¥', cost: 3000, ad: 0, ap: 0, hp: 800, armor: 0, crit: 0, speed: 0, type: 'ARMOR' },
  { id: 'i_boots', name: 'ì°¨ì› ë„ì•½ ì¥í™”', cost: 1100, ad: 0, ap: 0, hp: 0, armor: 25, crit: 0, speed: 45, type: 'ACCESSORY' },

  // [ê¶ŒëŠ¥ (Gods' Authority) - Special]
  { 
    id: 'p_izman', 
    name: 'ì´ì¦ˆë§ˆí•œì˜ ê¶ŒëŠ¥: ë©¸ë§ì˜ ë¶ˆê½ƒ', 
    cost: 5000, 
    ad: 150, ap: 0, hp: 400, armor: 0, crit: 40, speed: 30, 
    type: 'POWER', 
    description: 'ë¶‰ì€ ì‹  ì´ì¦ˆë§ˆí•œì˜ ì¶•ë³µ. ë¬¼ë¦¬ ê³µê²©ë ¥ê³¼ ì¹˜ëª…íƒ€ë¥¼ ê·¹í•œìœ¼ë¡œ ê°•í™”í•©ë‹ˆë‹¤.' 
  },
  { 
    id: 'p_dante', 
    name: 'ë‹¨í…Œì˜ ê¶ŒëŠ¥: ì ˆëŒ€ ì˜ë„', 
    cost: 5000, 
    ad: 0, ap: 180, hp: 800, armor: 80, crit: 0, speed: 10, 
    type: 'POWER', 
    description: 'í‘¸ë¥¸ ì‹  ë‹¨í…Œì˜ ì¶•ë³µ. ì£¼ë¬¸ë ¥ê³¼ ìƒì¡´ë ¥ì„ ê·¹í•œìœ¼ë¡œ ê°•í™”í•©ë‹ˆë‹¤.' 
  }
];

// === FILE: /src/data/jungle.ts ===

// ==========================================
// FILE PATH: /src/data/jungle.ts
// ==========================================

export const JUNGLE_CONFIG = {
  NAME: "í˜¼ëˆì˜ ê· ì—´ (Chaos Rift)",
  DESCRIPTION: "ì „ì¥ì˜ í‹ˆìƒˆì— ì¡´ì¬í•˜ëŠ” ë¶ˆì•ˆì •í•œ ì°¨ì›ì…ë‹ˆë‹¤. ì´ê³³ì—ëŠ” ì–´ëŠ ì§„ì˜ì—ë„ ì†í•˜ì§€ ì•ŠëŠ” 'ì´ê³„ì˜ í¬ë¦¬ì²˜'ë“¤ì´ ì„œì‹í•©ë‹ˆë‹¤.",

  // 2. ê¸°ë³¸ ë°¸ëŸ°ìŠ¤ ìˆ˜ì¹˜ (0~100)
  DEFAULT_SETTINGS: {
    density: 50, // ë°€ë„
    yield: 50,   // í’ìš”ë„
    attack: 30,  // í¬ë¦¬ì²˜ ê³µê²©ë ¥
    defense: 20, // í¬ë¦¬ì²˜ ë°©ì–´ë ¥
    threat: 0    
  },

  // 3. ì‹œë®¬ë ˆì´ì…˜ ê³„ìˆ˜
  BASE_SPAWN_RATE: 0.13,  
  BASE_GOLD: 18,          
  BASE_XP_INTERVAL: 12,   
  BASE_DAMAGE_TAKEN: 10,  
  BASE_REGEN: 15          
};

// === FILE: /src/data/roles.ts ===

// === FILE: src/data/roles.ts ===

import { Role } from '../types';
import { Shield, Swords, Zap, Crosshair, Skull } from 'lucide-react';

export interface RoleInfo {
  role: Role;
  name: string;      // ì˜ë¬¸ëª… (EXECUTOR ë“±)
  icon: any;         // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸
  color: string;     // ëŒ€í‘œ ìƒ‰ìƒ
  concept: string;   // í•œì¤„ ìš”ì•½ (ë”°ì˜´í‘œ ë‚´ìš©)
  desc: string;      // ìƒì„¸ ì„¤ëª…
  traitName: string; // ê³ ìœ  íŠ¹ì„± ì´ë¦„
  traitEffect: string; // ê³ ìœ  íŠ¹ì„± íš¨ê³¼ ì„¤ëª…
  simEffect: string;   // ì‹œë®¬ë ˆì´ì…˜ ë°˜ì˜ ì„¤ëª…
}

export const ROLE_DATA: Record<Role, RoleInfo> = {
  'ì§‘í–‰ê´€': {
    role: 'ì§‘í–‰ê´€', 
    name: 'EXECUTOR', 
    icon: Shield, // (ê¸°ì¡´ ì•„ì´ì½˜ ìœ ì§€)
    color: '#e74c3c',
    concept: 'ì‹ ì˜ ëœ»ì„ ì§€ìƒì— ì§‘í–‰í•˜ëŠ” ë¬´ìë¹„í•œ íˆ¬ì‚¬',
    desc: 'ìµœì „ì„ ì—ì„œ ì ì˜ ì§„í˜•ì„ ë¶•ê´´ì‹œí‚¤ê³ , 1:1 ëŒ€ê²°ì—ì„œ ë¬¼ëŸ¬ì„œì§€ ì•ŠëŠ” ê³ ë…í•œ ì „ì‚¬ë“¤ì…ë‹ˆë‹¤.',
    traitName: '[ê²°íˆ¬ì˜ ì„œì•½]',
    traitEffect: 'ì£¼ë³€ì— ì•„êµ°ì´ ì—†ì„ ë•Œ(ì†”ë¡œ ë¼ì¸ì „ ì‹œ) í”¼í•´ëŸ‰ +10%, ë°©ì–´ë ¥ +10%.',
    simEffect: 'ë¼ì¸ì „ ë‹¨ê³„ì—ì„œ 1:1 í‚¬ í™•ë¥  ë³´ì •.'
  },
  'ì¶”ì ì': {
    role: 'ì¶”ì ì', 
    name: 'TRACKER', 
    icon: Swords, 
    color: '#2ecc71',
    concept: 'ë³´ì´ì§€ ì•ŠëŠ” ê³³ì—ì„œ ì´ë‹¨ì„ ì‚¬ëƒ¥í•˜ëŠ” ê·¸ë¦¼ì',
    desc: 'ì •í•´ì§„ ë¼ì¸ ì—†ì´ ì „ì¥ì„ ëˆ„ë¹„ë©°, ë³€ìˆ˜ë¥¼ ì°½ì¶œí•˜ê³  ì£¼ìš” ëª©í‘œë¬¼(ê±°ì‹ ë³‘/ì£¼ì‹œì)ì„ í™•ë³´í•©ë‹ˆë‹¤.',
    traitName: '[ì‚¬ëƒ¥ê¾¼ì˜ ë³¸ëŠ¥]',
    traitEffect: 'ëª¬ìŠ¤í„°/ì˜¤ë¸Œì íŠ¸ ì²˜ì¹˜ ì‹œ ê³¨ë“œ íšë“ëŸ‰ +20%. ë‹¤ë¥¸ ë¼ì¸ ê°œì…(ê°±í‚¹) ì‹œ ì„±ê³µë¥  ì¦ê°€.',
    simEffect: 'ì •ê¸€ëŸ¬ì˜ ì„±ì¥ ì†ë„ ë³´ì •, ì˜¤ë¸Œì íŠ¸ ë§‰íƒ€ í™•ë¥  ë³´ì •.'
  },
  'ì„ ì§€ì': {
    role: 'ì„ ì§€ì', 
    name: 'PROPHET', 
    icon: Zap, 
    color: '#3498db',
    concept: 'ì˜¤ë¼í´ì˜ ê³„ì‹œë¥¼ í•´ì„í•˜ì—¬ ë§ˆë²•ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ì',
    desc: 'ì „ì¥ì˜ ì¤‘ì‹¬ì—ì„œ ê°•ë ¥í•œ ê´‘ì—­ ë§ˆë²•ìœ¼ë¡œ ì ì„ ì“¸ì–´ë²„ë¦¬ê³ , ì „í™©ì„ ê¿°ëš«ì–´ ë´…ë‹ˆë‹¤.',
    traitName: '[ë§ˆë ¥ì˜ íë¦„]',
    traitEffect: 'ë ˆë²¨ì´ ì˜¤ë¥¼ìˆ˜ë¡ ìŠ¤í‚¬ ê°€ì†(ì¿¨íƒ€ì„ ê°ì†Œ) íš¨ê³¼ê°€ ì¶”ê°€ë¡œ ë¶™ìŒ.',
    simEffect: 'ì¤‘í›„ë°˜ êµì „ ì‹œ ìŠ¤í‚¬ ì ìˆ˜ ê³„ì‚° ê°€ì¤‘ì¹˜ ëŒ€í­ ìƒìŠ¹.'
  },
  'ì‹ ì‚´ì': {
    role: 'ì‹ ì‚´ì', 
    name: 'GOD SLAYER', 
    icon: Crosshair, 
    color: '#f1c40f',
    concept: 'ì‹ ì¡°ì°¨ ì£½ì¼ ìˆ˜ ìˆëŠ” ê¸ˆë‹¨ì˜ ë¬´ê¸°ë¥¼ ë‹¤ë£¨ëŠ” ì',
    desc: 'ì´ˆë°˜ì—” ì•½í•˜ì§€ë§Œ, ì„±ì¥ì´ ëë‚˜ëŠ” ìˆœê°„ ì‹ (ìˆ˜í˜¸ì)ê³¼ ê±°ì‹ ë³‘ì„ ìˆœì‹ê°„ì— íŒŒê´´í•˜ëŠ” í•µì‹¬ í™”ë ¥ì…ë‹ˆë‹¤.',
    traitName: '[ê±°ì¸ í•™ì‚´ì]',
    traitEffect: 'êµ¬ì¡°ë¬¼(íƒ€ì›Œ, ì–µì œê¸°, ìˆ˜í˜¸ì) ë° ê±°ì‹ ë³‘ì—ê²Œ ì…íˆëŠ” í”¼í•´ëŸ‰ +30%.',
    simEffect: 'ê³µì„± ëª¨ë“œì¼ ë•Œ íƒ€ì›Œ ì² ê±° ì†ë„ ê°€ì†.'
  },
  'ìˆ˜í˜¸ê¸°ì‚¬': {
    role: 'ìˆ˜í˜¸ê¸°ì‚¬', 
    name: 'GUARDIAN', 
    icon: Skull, 
    color: '#9b59b6',
    concept: 'ë™ë£Œë¥¼ ìœ„í•´ ê¸°êº¼ì´ í¬ìƒí•˜ëŠ” ì‹ ë…ì˜ ë°©íŒ¨',
    desc: 'ì•„êµ°(íŠ¹íˆ ì‹ ì‚´ì)ì„ ë³´í˜¸í•˜ê³ , ì ì˜ ê³µê²©ì„ ëŒ€ì‹  ë°›ì•„ë‚´ë©° ì „ì„ ì„ ìœ ì§€í•©ë‹ˆë‹¤.',
    traitName: '[í¬ìƒì˜ ì„±ì—­]',
    traitEffect: 'ê°™ì€ ë¼ì¸ì— ìˆëŠ” ì•„êµ°ì˜ ìƒì¡´ìœ¨ì„ 20% ì˜¬ë ¤ì¤Œ. (ìì‹ ì´ ëŒ€ì‹  ì£½ì„ í™•ë¥  ì¦ê°€)',
    simEffect: 'ë´‡ ë¼ì¸ì „ì—ì„œ ì‹ ì‚´ìê°€ ì£½ì„ í™•ë¥ ì„ ë‚®ì¶”ê³ , ìì‹ ì˜ ë°ìŠ¤ í™•ë¥ ì„ ë†’ì„.'
  }
};

// === FILE: /src/data/types/hero.ts ===

// src/types/hero.ts
export type Role = 'ì§‘í–‰ê´€' | 'ì„ ì§€ì' | 'ìˆ˜í˜¸ê¸°ì‚¬' | 'ì¶”ì ì' | 'ì‹ ì‚´ì';
export type Tier = 'OP' | '1' | '2' | '3' | '4' | '5';

// [NEW] íŠ¹ìˆ˜ ìŠ¤í‚¬ ë©”ì»¤ë‹ˆì¦˜
export type SkillMechanic = 
  | 'NONE' | 'STUN' | 'HOOK' | 'DASH' | 'STEALTH' 
  | 'SHIELD' | 'HEAL' | 'EXECUTE' | 'GLOBAL';

export interface HeroStats {
  ad: number;      // ê³µê²©ë ¥ (ìŠ¤í‚¬/í‰íƒ€ ê³„ìˆ˜ìš©)
  baseAtk: number; // [NEW] ê¸°ë³¸ í‰íƒ€ ë°ë¯¸ì§€ (ê¹¡ë€)
  ap: number;      // ì£¼ë¬¸ë ¥
  hp: number;      // ì²´ë ¥
  armor: number;   // ë°©ì–´ë ¥
  crit: number;    // ì¹˜ëª…íƒ€
  range: number;   // ì‚¬ê±°ë¦¬
  speed: number;   // ì´ì†
  regen: number;   // ì¬ìƒ
  pen: number;     // ê´€í†µ
}

// ìŠ¤í‚¬ ìƒì„¸ êµ¬ì¡°
export interface SkillDetail {
  name: string;
  mechanic: SkillMechanic;
  val: number;
  adRatio: number;
  apRatio: number;
  cd: number;
  isPassive?: boolean;
}

// ìŠ¤í‚¬ì…‹ (P, Q, W, E, R)
export interface HeroSkillSet {
  passive: SkillDetail;
  q: SkillDetail;
  w: SkillDetail;
  e: SkillDetail;
  r: SkillDetail;
}

export interface HeroRecord {
  totalMatches: number; totalWins: number; totalPicks: number; totalBans: number;
  totalKills: number; totalDeaths: number; totalAssists: number;
  totalDamage: number; totalDamageTaken: number; totalCs: number; totalGold: number;
  recentResults: boolean[]; 
}

export interface Hero {
  id: string; name: string; role: Role;
  stats: HeroStats;
  skills: HeroSkillSet;

  // (í•˜ìœ„ í˜¸í™˜ìš© - ì‚¬ìš© ì•ˆí•¨)
  skill?: any; skillLevels?: any; 

  record: HeroRecord;
  tier: Tier; rank: number; rankChange: number;
  recentWinRate: number; pickRate: number; banRate: number;
  avgKda: string; kdaRatio: string;
  avgDpm: string; avgDpg: string; avgCs: string; avgGold: string;
}

// === FILE: /src/data/types/index.ts ===

// ==========================================
// FILE PATH: /src/types/index.ts
// ==========================================

// ------------------------------------------------------------------
// 1. ê¸°ë³¸ ìƒìˆ˜ ë° ìŠ¤í‚¬ ê´€ë ¨
// ------------------------------------------------------------------
export type Role = 'ì§‘í–‰ê´€' | 'ì„ ì§€ì' | 'ìˆ˜í˜¸ê¸°ì‚¬' | 'ì¶”ì ì' | 'ì‹ ì‚´ì';
export type Tier = 'OP' | '1' | '2' | '3' | '4' | '5';
export type SkillMechanic = 
  | 'DAMAGE' | 'HEAL' | 'SHIELD' | 'HOOK' | 'DASH' 
  | 'STUN' | 'STEALTH' | 'EXECUTE' | 'GLOBAL' | 'NONE';

export interface HeroStats {
  ad: number;      // ê³µê²©ë ¥
  ap: number;      // ì£¼ë¬¸ë ¥
  hp: number;      // ì²´ë ¥
  armor: number;   // ë°©ì–´ë ¥
  crit: number;    // ì¹˜ëª…íƒ€ìœ¨
  range: number;   // ì‚¬ê±°ë¦¬
  speed: number;   // ì´ë™ì†ë„
  regen: number;   // ì²´ë ¥ ì¬ìƒ
  pen: number;     // ê´€í†µë ¥
  baseAtk: number; // ê¸°ë³¸ ê³µê²©ë ¥
}

export interface SkillDetail {
  name: string; 
  mechanic: SkillMechanic; 
  val: number;
  adRatio: number; 
  apRatio: number; 
  cd: number; 
  range?: number; 
  duration?: number; 
  isPassive?: boolean;
}

export interface HeroSkillSet {
  passive: SkillDetail; q: SkillDetail; w: SkillDetail; e: SkillDetail; r: SkillDetail;
}

export interface HeroRecord {
  totalMatches: number; totalWins: number; totalPicks: number; totalBans: number;
  totalKills: number; totalDeaths: number; totalAssists: number;
  totalDamage: number; totalDamageTaken: number; totalCs: number; totalGold: number;
  recentResults: boolean[]; 
}

export interface Hero {
  id: string; name: string; role: Role; stats: HeroStats; skills: HeroSkillSet;
  record: HeroRecord; tier: Tier; rank: number; rankChange: number;
  recentWinRate: number; pickRate: number; banRate: number;
  avgKda: string; kdaRatio: string;
  avgDpm: string; avgDpg: string; avgCs: string; avgGold: string;
}

// ------------------------------------------------------------------
// 2. ì•„ì´í…œ(Item) ë° ìƒì  ê´€ë ¨
// ------------------------------------------------------------------
export interface Item {
  id: string;
  name: string;
  cost: number;
  ad: number; ap: number; hp: number; armor: number; crit: number; speed: number;
  type: 'WEAPON' | 'ARMOR' | 'ACCESSORY' | 'POWER'; 
  description?: string;
}

export interface ItemStatData {
  itemId: string;
  totalPicks: number;
  totalWins: number;
  totalKills: number;
  totalDeaths: number;
  totalAssists: number;
}

// ------------------------------------------------------------------
// 3. ê²Œì„ ì„¤ì • (Gods, Battle, Tier, Role)
// ------------------------------------------------------------------
export interface ObjectStats { hp: number; armor: number; rewardGold: number; }
export interface ColossusSettings extends ObjectStats { attack: number; }
export interface WatcherSettings extends ObjectStats { buffType: 'COMBAT' | 'GOLD'; buffAmount: number; buffDuration: number; }

// [ì‹ ê·œ] ì •ê¸€(í˜¼ëˆì˜ ê· ì—´) ì„¤ì • íƒ€ì… ì •ì˜
export interface JungleSettings {
  density: number; // ë°€ë„ (0~100)
  threat: number;  // ìœ„í˜‘ë„ (0~100)
  yield: number;   // í’ìš”ë„ (0~100)
}

export interface BattlefieldSettings {
  tower: ObjectStats; 
  colossus: ColossusSettings; 
  watcher: WatcherSettings;
  jungle: JungleSettings; // [ì¶”ê°€ë¨]
}

// [ì‹ ê·œ] ì—­í• êµ° ë°¸ëŸ°ìŠ¤ ì„¤ì •ê°’ êµ¬ì¡°ì²´
export interface RoleSettings {
  executor: { damage: number; defense: number }; // ì§‘í–‰ê´€ (í”¼í•´ëŸ‰%, ë°©ì–´ë ¥%)
  tracker: { gold: number; smiteChance: number }; // ì¶”ì ì (ê³¨ë“œ%, ê°•íƒ€ë°°ìœ¨)
  prophet: { cdrPerLevel: number }; // ì„ ì§€ì (ë ˆë²¨ë‹¹ ì¿¨ê°%)
  slayer: { structureDamage: number }; // ì‹ ì‚´ì (êµ¬ì¡°ë¬¼ í”¼í•´ëŸ‰%)
  guardian: { survivalRate: number }; // ìˆ˜í˜¸ê¸°ì‚¬ (ìƒì¡´ìœ¨ ë³´ì •%)
}

export interface TierConfig { challenger: number; master: number; ace: number; joker: number; gold: number; silver: number; bronze: number; }
export interface AIConfig { provider: 'GEMINI' | 'OPENAI'; apiKey: string; model: string; enabled: boolean; }

// ------------------------------------------------------------------
// 4. ìœ ì €(User) ë° í†µê³„
// ------------------------------------------------------------------
export interface MatchHistory { 
  season: number; result: 'WIN' | 'LOSE'; heroName: string; kda: string; lpChange: number; date: string; 
}

export interface UserHeroStat {
  matches: number; wins: number; kills: number; deaths: number; assists: number;
}

export interface UserProfile { 
  id: number; name: string; mainHeroId: string; score: number; 
  tier: string; winRate: number; totalGames: number; 
  history: MatchHistory[]; heroStats: Record<string, UserHeroStat>; preferredLane: string;
  mostChamps: any[]; laneStats: any[];
}

export interface TierStat { name: string; minScore: number; count: number; percent: number; color: string; }
export interface UserStatus { totalGames: number; playingUsers: number; queuingUsers: number; avgWaitTime: number; tierDistribution: TierStat[]; }

export interface GodStats { 
  totalMatches: number; 
  izmanWins: number; izmanAvgKills: string; izmanAvgTime: string; 
  danteWins: number; danteAvgKills: string; danteAvgTime: string; 
  avgGameDuration: number; guardianDeathRate: number; godAwakenRate: number; 
}

// ------------------------------------------------------------------
// 5. ì¸ê²Œì„(LiveMatch) ë° ì‹œë®¬ë ˆì´ì…˜ ë¡œê·¸
// ------------------------------------------------------------------
export type EventType = 'KILL' | 'TOWER' | 'COLOSSUS' | 'WATCHER' | 'START';
export interface GameLog { time: number; message: string; type: EventType; team?: 'BLUE' | 'RED'; }
export interface TimelineEvent { time: number; type: EventType; killerId: string; victimId: string; message: string; }

export interface LivePlayer { 
  name: string; heroId: string; kills: number; deaths: number; assists: number; 
  gold: number; cs: number; currentHp: number; maxHp: number; level: number; 
  items: Item[]; 
  totalDamageDealt: number; // ëˆ„ì  í”¼í•´ëŸ‰
  x: number; y: number; lane: 'TOP' | 'MID' | 'BOT' | 'JUNGLE'; buffs: string[]; 
  mmr: number; 
}

export interface TowerStatus { top: number; mid: number; bot: number; }

export interface TeamStats { 
  towers: TowerStatus; colossus: number; watcher: number; fury: number; 
  nexusHp: number; maxNexusHp: number;
  activeBuffs: { siegeUnit: boolean; voidPower: boolean; voidBuffEndTime?: number; };
}

export interface LiveMatch { 
  id: string; blueTeam: LivePlayer[]; redTeam: LivePlayer[]; bans: { blue: string[]; red: string[]; }; 
  startTime: number; duration: number; currentDuration: number; avgTier: string; 
  score: { blue: number, red: number }; stats: { blue: TeamStats; red: TeamStats; };
  timeline: TimelineEvent[]; logs: GameLog[]; 
}

// ------------------------------------------------------------------
// 6. ì»¤ë®¤ë‹ˆí‹°(Community)
// ------------------------------------------------------------------
export interface Comment { id: number; author: string; authorTier: string; content: string; timestamp: string; }

export interface Post { 
  id: number; author: string; authorTier: string; title: string; content: string; 
  category: 'ê³µëµ' | 'ìœ ë¨¸' | 'ì§•ì§•' | 'ë¶„ì„' | 'ì¡ë‹´' | 'ì§ˆë¬¸' | 'ìë‘' | 'ê³µì§€'; 
  views: number; upvotes: number; downvotes: number; 
  comments: number; commentList: Comment[]; createdAt: number; potential: number; isBest: boolean; displayTime: string; 
}

// ------------------------------------------------------------------
// 7. ì „ì²´ ê²Œì„ ìƒíƒœ (GameState)
// ------------------------------------------------------------------
export interface GameState {
  season: number; day: number; hour: number; minute: number;
  isPlaying: boolean; gameSpeed: number;
  userSentiment: number; ccu: number; totalUsers: number;

  userStatus: UserStatus; 
  topRankers: UserProfile[];
  godStats: GodStats; 

  liveMatches: LiveMatch[];

  // ì„¤ì • ê´€ë ¨
  tierConfig: TierConfig;
  battleSettings: BattleSettings;
  fieldSettings: BattlefieldSettings; 

  // [ì‹ ê·œ] ì—­í• êµ° ì„¤ì •
  roleSettings: RoleSettings;

  aiConfig: AIConfig;
  itemStats: Record<string, ItemStatData>;
}

// === FILE: /src/data/types/match.ts ===

// ==========================================
// FILE PATH: /src/data/types/match.ts
// ==========================================

export type EventType = 'KILL' | 'TOWER' | 'COLOSSUS' | 'WATCHER' | 'START';

export interface GameLog {
  time: number;
  message: string;
  type: EventType;
  team?: 'BLUE' | 'RED';
}

export interface TimelineEvent {
  time: number; 
  type: EventType;
  killerId: string; 
  victimId: string; 
  message: string;
}

export interface LivePlayer {
  name: string; 
  heroId: string;
  kills: number; deaths: number; assists: number;
  gold: number; cs: number;
  currentHp: number; 
  maxHp: number;
  level: number;
  items: string[];
  x: number; 
  y: number;
  lane: 'TOP' | 'MID' | 'BOT' | 'JUNGLE';
}

// [ìˆ˜ì •ë¨] í¬íƒ‘ì„ ë¼ì¸ë³„ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ êµ¬ì¡° ë³€ê²½
export interface TowerStatus {
  top: number; // 0 ~ 3 (íŒŒê´´ëœ ë‹¨ê³„)
  mid: number;
  bot: number;
}

export interface TeamStats {
  towers: TowerStatus; // [ë³€ê²½] number -> TowerStatus
  colossus: number;
  watcher: number;
  fury: number;
}

export interface LiveMatch {
  id: string;
  blueTeam: LivePlayer[];
  redTeam: LivePlayer[];
  bans: { blue: string[]; red: string[]; };
  startTime: number;
  duration: number;
  currentDuration: number;
  avgTier: string;
  score: { blue: number, red: number };
  stats: {
    blue: TeamStats;
    red: TeamStats;
  };
  timeline: TimelineEvent[];
  logs: GameLog[];
}

// === FILE: /src/data/types/user.ts ===

// src/types/user.ts
export interface MatchHistory {
  season: number; result: 'WIN' | 'LOSE'; heroName: string; kda: string; lpChange: number; date: string;
}
export interface UserProfile {
  id: number; name: string; mainHeroId: string; score: number;
  tier: string; winRate: number; totalGames: number;
  history: MatchHistory[];
  mostChamps: { name: string, winRate: number, kda: string }[];
  laneStats: { role: string, winRate: number }[];
}
export interface TierStat {
  name: string; minScore: number; count: number; percent: number; color: string;
}
export interface UserStatus {
  totalGames: number; playingUsers: number; queuingUsers: number; avgWaitTime: number;
  tierDistribution: TierStat[];
}
export interface TierConfig {
  challenger: number; master: number; ace: number; joker: number;
  gold: number; silver: number; bronze: number;
}

// === FILE: /src/engine/CommunityEngine.ts ===

// ==========================================
// FILE PATH: /src/engine/CommunityEngine.ts
// ==========================================

import { Hero, TierConfig, Post, Comment, AIConfig, BattleSettings, BattlefieldSettings } from '../types';
import { fetchAIPost, fetchAIComment } from '../utils/AIService';

const pick = <T>(arr: T[]): T => arr[Math.floor(Math.random() * arr.length)];

// í‹°ì–´ë³„ ê°€ì¤‘ì¹˜ (ì ì¬ë ¥ ê³„ì‚°ìš©)
const getTierWeight = (tier: string) => {
  if (tier.includes('ì²œìƒê³„') || tier.includes('ì±Œë¦°ì €')) return 50;
  if (tier.includes('ë§ˆìŠ¤í„°') || tier.includes('ì—ì´ìŠ¤')) return 30;
  if (tier.includes('ì¡°ì»¤') || tier.includes('ë‹¤ì´ì•„')) return 20;
  if (tier.includes('ê³¨ë“œ') || tier.includes('í”Œë˜í‹°ë„˜')) return 10;
  if (tier.includes('ì‹¤ë²„')) return 5;
  return 0; 
};

const getRandomTopicContext = (heroes: Hero[], battleSettings: BattleSettings) => {
  const rand = Math.random();
  if (rand < 0.3) {
    const h1 = pick(heroes);
    const h2 = pick(heroes.filter(h => h.id !== h1.id));
    const gap = h1.recentWinRate - h2.recentWinRate;
    const winner = gap > 0 ? h1.name : h2.name;
    return `ì£¼ì œ: '${h1.name}' vs '${h2.name}' ì„±ëŠ¥ ë¹„êµ. (íŒ©íŠ¸: ${winner} ìŠ¹ë¥ ì´ ë” ë†’ìŒ)`;
  }
  else if (rand < 0.6) {
    const h = pick(heroes);
    const skillKeys = ['q', 'w', 'e', 'r'] as const;
    const skillKey = pick(skillKeys);
    const skill = h.skills[skillKey];
    return `ì£¼ì œ: ${h.name}ì˜ ${skillKey.toUpperCase()}ìŠ¤í‚¬('${skill.name}')ì— ëŒ€í•œ í‰ê°€. (ìˆ˜ì¹˜: ê¸°ë³¸ë°ë¯¸ì§€ ${skill.val}, ì¿¨íƒ€ì„ ${skill.cd}ì´ˆ)`;
  }
  else if (rand < 0.8) {
    const object = Math.random() < 0.5 ? 'ê±°ì‹ ë³‘' : 'ì£¼ì‹œì';
    const stat = object === 'ê±°ì‹ ë³‘' ? battleSettings.izman.towerAtk : battleSettings.izman.servantGold;
    return `ì£¼ì œ: ê²Œì„ ë‚´ ${object} ë°¸ëŸ°ìŠ¤ í† ë¡ . (ê´€ë ¨ ìˆ˜ì¹˜: ${stat})`;
  }
  else {
    return `ì£¼ì œ: ë°©ê¸ˆ ê²ªì€ ë­í¬ ê²Œì„ ì°`;
  }
};

// ------------------------------------------------------------------
// 1. ê²Œì‹œê¸€ ìƒì„± (ì˜¤ì§ ì™¸ë¶€ AI & ì‹¤ì œ ìœ ì €ë§Œ ì‚¬ìš©)
// ------------------------------------------------------------------
export async function generatePostAsync(
  uniqueId: number, 
  heroes: Hero[], 
  tierConfig: TierConfig, 
  currentTick: number, 
  aiConfig: AIConfig,
  userPool: any[], 
  battleSettings: BattleSettings,
  fieldSettings: BattlefieldSettings
): Promise<Post | null> {

  // [í•µì‹¬] AIê°€ êº¼ì ¸ìˆê±°ë‚˜ ìœ ì €ê°€ ì—†ìœ¼ë©´ ìƒì„± ì•ˆí•¨
  if (!aiConfig.apiKey || !aiConfig.enabled) return null;
  if (!userPool || userPool.length === 0) return null;

  // ì‹¤ì œ ìœ ì € í’€ì—ì„œ ì‘ì„±ì ì„ ì •
  let author: any;
  let selectedCategory = "ì¡ë‹´";

  if (Math.random() < 0.2) { 
    // ë­ì»¤ê°€ ê¸€ ì“¸ í™•ë¥ 
    const rankers = [...userPool].sort((a,b) => b.score - a.score).slice(0, 50);
    author = pick(rankers);
    const rand = Math.random();
    if (rand < 0.4) selectedCategory = 'ê³µëµ';
    else if (rand < 0.7) selectedCategory = 'ë¶„ì„';
    else selectedCategory = 'ìë‘';
  } else {
    // ì¼ë°˜ ìœ ì €
    author = pick(userPool);
    const rand = Math.random();
    if (rand < 0.3) selectedCategory = 'ì§•ì§•';
    else if (rand < 0.5) selectedCategory = 'ìœ ë¨¸';
    else if (rand < 0.6) selectedCategory = 'ì§ˆë¬¸';
    else selectedCategory = 'ì¡ë‹´'; 
  }

  // AIì—ê²Œ ë³´ë‚¼ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
  const mostChamp = heroes.find(h => h.id === author.mainHeroId)?.name || 'ì•Œìˆ˜ì—†ìŒ';
  const currentTierName = author.getTierName(tierConfig);
  const dynamicTopic = getRandomTopicContext(heroes, battleSettings);

  const userContext = `[ì‘ì„±ì ì •ë³´] ë‹‰ë„¤ì„: ${author.name}, í‹°ì–´: ${currentTierName}, ì£¼ì±”í”¼ì–¸: ${mostChamp}`;
  const fullContext = `${userContext}\n${dynamicTopic}\nì¹´í…Œê³ ë¦¬: ${selectedCategory}\n(JSONë§Œ ì¶œë ¥)`;

  // ì™¸ë¶€ AI í˜¸ì¶œ
  const aiResult = await fetchAIPost(aiConfig, fullContext, selectedCategory);

  if (!aiResult) return null;

  let basePotential = 10;
  const tierWeight = getTierWeight(currentTierName);

  if (selectedCategory === 'ê³µëµ') basePotential += tierWeight * 1.5;
  if (selectedCategory === 'ì§ˆë¬¸') basePotential += 30; // ì§ˆë¬¸ê¸€ì€ ëŒ“ê¸€ ìœ ë„ìš©

  return {
    id: uniqueId,
    author: author.name, 
    authorTier: currentTierName, // [ì¤‘ìš”] ì‹¤ì œ ìœ ì €ì˜ í˜„ì¬ í‹°ì–´ ì‚¬ìš©
    title: aiResult.title,
    content: aiResult.content,
    category: selectedCategory as any,
    views: 1, upvotes: 0, downvotes: 0, 
    comments: 0, commentList: [],
    createdAt: currentTick,
    potential: Math.min(100, Math.max(10, basePotential)), 
    isBest: false,
    displayTime: "ë°©ê¸ˆ ì „"
  };
}

// ------------------------------------------------------------------
// 2. ëŒ“ê¸€ ìƒì„± (ì˜¤ì§ ì™¸ë¶€ AI & ì‹¤ì œ ìœ ì €ë§Œ ì‚¬ìš©)
// ------------------------------------------------------------------
export async function generateCommentAsync(
  post: Post, 
  aiConfig: AIConfig, 
  userPool: any[], 
  tierConfig: TierConfig
): Promise<Comment | null> {

  // [í•µì‹¬] AI ë¯¸ì„¤ì •ì‹œ ìƒì„± ê±°ë¶€
  if (!aiConfig.apiKey || !aiConfig.enabled) return null;
  if (!userPool || userPool.length === 0) return null;

  // [í•µì‹¬] ëŒ“ê¸€ ì‘ì„±ìë„ 'ì‹¤ì œ ìœ ì €' ì¤‘ì—ì„œ ë½‘ìŒ (ê°€ì§œ ìœ ì € ìƒì„± X)
  const commenter = pick(userPool);

  // [ì¤‘ìš”] í•´ë‹¹ ìœ ì € ê°ì²´ì˜ ë©”ì†Œë“œë¥¼ í†µí•´ ì‹¤ì‹œê°„ í‹°ì–´ë¥¼ ê°€ì ¸ì˜´
  const commenterTier = commenter.getTierName(tierConfig);

  const commentText = await fetchAIComment(aiConfig, post.title, post.content);

  if (!commentText) return null;

  return {
    id: Date.now() + Math.random(), 
    author: commenter.name, 
    authorTier: commenterTier, // ì‹¤ì œ ìœ ì €ì˜ í‹°ì–´
    content: commentText, 
    timestamp: "ë°©ê¸ˆ ì „"
  };
}

// ------------------------------------------------------------------
// 3. ì¸í„°ë™ì…˜ ì—…ë°ì´íŠ¸
// ------------------------------------------------------------------
export function updatePostInteractions(posts: Post[], currentTick: number): Post[] {
  return posts.map(post => {
    const age = currentTick - post.createdAt;
    if (age > 1440) return post; 

    const updatedPost = { ...post };

    if (age < 1) updatedPost.displayTime = "ë°©ê¸ˆ ì „";
    else if (age < 60) updatedPost.displayTime = `${Math.floor(age)}ë¶„ ì „`;
    else updatedPost.displayTime = `${Math.floor(age / 60)}ì‹œê°„ ì „`;

    let exposure = (post.potential / (age * 1.5 + 20)); 
    if (post.isBest) exposure *= 3.0; 

    let newViews = 0;
    if (Math.random() < exposure) {
        newViews = Math.floor(Math.random() * 8) + 1;
        updatedPost.views += newViews;
    }

    if (newViews > 0) {
        let conversionRate = post.potential / 1500; 
        if (post.upvotes > 5) conversionRate *= 1.2;

        let dislikeRate = 0.001; 
        if (post.category === 'ì§•ì§•') dislikeRate = 0.08; 

        for (let i = 0; i < newViews; i++) {
            if (Math.random() < conversionRate) updatedPost.upvotes += 1;
            if (Math.random() < dislikeRate) updatedPost.downvotes += 1;
        }

        // [ì¤‘ìš”] ëŒ“ê¸€ ìë™ ìƒì„± ë¶€ë¶„ ì‚­ì œë¨. 
        // ëŒ“ê¸€ì€ ì˜¤ì§ gameSliceì˜ ë¹„ë™ê¸° AI í˜¸ì¶œì„ í†µí•´ì„œë§Œ ìƒì„±ë©ë‹ˆë‹¤.
    }

    if (updatedPost.downvotes > updatedPost.upvotes * 3) {
        updatedPost.potential = Math.max(0, updatedPost.potential - 10); 
    }

    if (!updatedPost.isBest && updatedPost.upvotes >= 10) {
      updatedPost.isBest = true;
      updatedPost.potential += 60; 
      updatedPost.title = `[ë…ê¸€] ${updatedPost.title}`;
    }

    return updatedPost;
  });
}

// === FILE: /src/engine/MatchEngine.ts ===

// ==========================================
// FILE PATH: /src/engine/MatchEngine.ts
// ==========================================

// ì´ì œ ì‹¤ì œ ë¡œì§ì€ ì•„ë˜ íŒŒì¼ë“¤ë¡œ ë¶„ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
// ì´ íŒŒì¼ì€ í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ í•¨ìˆ˜ë“¤ì„ ë‹¤ì‹œ ë‚´ë³´ë‚´ê¸°ë§Œ í•©ë‹ˆë‹¤.

export { createLiveMatches } from './match/MatchCreator';
export { updateLiveMatches } from './match/MatchUpdater';
export { finishMatch } from './match/MatchSettlement';

// === FILE: /src/engine/RankingSystem.ts ===

// src/engine/RankingSystem.ts
import { Hero, UserStatus, TierStat, TierConfig, Tier } from '../types';
import { userPool } from './UserManager';

/**
 * [í—¬í¼] ì•ˆì „í•œ ë‚˜ëˆ—ì…ˆ ë° ì •ë°€ë„ ì œì–´
 */
const safeDiv = (num: number, den: number) => (den <= 0 ? 0 : num / den);

/**
 * 1. ì˜ì›… ë©”íƒ€ ë¶„ì„ ì—”ì§„
 * record(ëˆ„ì  ë°ì´í„°)ë¥¼ ë°”íƒ•ìœ¼ë¡œ UIì— í‘œì‹œë  ì‹¤ì‹œê°„ í†µê³„ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
 */
export function analyzeHeroMeta(heroes: Hero[]): Hero[] {
  // ì „ì²´ ê²Œì„ ìˆ˜ (ëª¨ë“  ì˜ì›…ì˜ íŒìˆ˜ í•© / 10)
  const totalGlobalPicks = heroes.reduce((sum, h) => sum + h.record.totalPicks, 0);
  const totalGlobalGames = totalGlobalPicks / 10;

  const analyzed = heroes.map(h => {
    const r = h.record;
    const matches = r.totalMatches;

    // A. ìŠ¹ë¥ /í”½ë¥ /ë°´ë¥  ê³„ì‚°
    const winRate = safeDiv(r.totalWins, matches) * 100;
    const pickRate = safeDiv(r.totalPicks, totalGlobalGames) * 100;
    const banRate = safeDiv(r.totalBans, totalGlobalGames) * 100;

    // B. KDA ê³„ì‚° (í‘œì‹œìš© ë°ì´í„°ì™€ ë¹„ìœ¨ ë°ì´í„° ì¼ì¹˜í™”)
    const k = safeDiv(r.totalKills, matches);
    const d = safeDiv(r.totalDeaths, matches);
    const a = safeDiv(r.totalAssists, matches);

    // ì‚¬ìš©ìê°€ ë³´ëŠ” ì†Œìˆ˜ì  1ìë¦¬ ê°’ìœ¼ë¡œ ìºìŠ¤íŒ…í•˜ì—¬ ì˜¤ì°¨ ì œê±°
    const kDisp = parseFloat(k.toFixed(1));
    const dDisp = parseFloat(d.toFixed(1));
    const aDisp = parseFloat(a.toFixed(1));
    const kdaRatio = safeDiv(kDisp + aDisp, dDisp);

    // C. ê²½ì œ/ë°ë¯¸ì§€ ì§€í‘œ
    const avgDpm = safeDiv(r.totalDamage, matches);
    const avgDpg = safeDiv(r.totalDamageTaken, matches);
    const avgCs = safeDiv(r.totalCs, matches);
    const avgGold = safeDiv(r.totalGold, matches);

    return {
      ...h,
      recentWinRate: winRate,
      pickRate: pickRate,
      banRate: banRate,
      avgKda: `${kDisp.toFixed(1)}/${dDisp.toFixed(1)}/${aDisp.toFixed(1)}`,
      kdaRatio: kdaRatio.toFixed(2),
      avgDpm: Math.floor(avgDpm).toLocaleString(),
      avgDpg: Math.floor(avgDpg).toLocaleString(),
      avgCs: avgCs.toFixed(1),
      avgGold: Math.floor(avgGold).toLocaleString(),
    };
  });

  // D. ìˆœìœ„ ì‚°ì • ë° í‹°ì–´ ë°°ì • (ìŠ¹ë¥  ê¸°ì¤€ ì •ë ¬)
  analyzed.sort((a, b) => b.recentWinRate - a.recentWinRate);

  return analyzed.map((h, index) => {
    const rank = index + 1;
    const total = analyzed.length;
    let tier: Tier = '3';

    // ìƒìœ„ %ì— ë”°ë¥¸ í‹°ì–´ ë¶€ì—¬
    const percent = (rank / total) * 100;
    if (percent <= 8) tier = 'OP';
    else if (percent <= 25) tier = '1';
    else if (percent <= 50) tier = '2';
    else if (percent <= 75) tier = '3';
    else if (percent <= 90) tier = '4';
    else tier = '5';

    return { ...h, rank, tier };
  });
}

/**
 * 2. ìœ ì € ìƒíƒœê³„ ë¶„ì„ ì—”ì§„
 * í‹°ì–´ë³„ ì¸êµ¬ ë¶„í¬ì™€ CCU ë°ì´í„°ë¥¼ ì •ì‚°í•©ë‹ˆë‹¤.
 */
export function calculateUserEcosystem(ccu: number, totalUsers: number, config: TierConfig): UserStatus {
  const playingUsers = userPool.filter(u => u.status === 'INGAME').length;
  const queuingUsers = userPool.filter(u => u.status === 'QUEUE' || u.status === 'IDLE').length;

  const tiers: TierStat[] = [
    { name: 'ì²œìƒê³„', minScore: 9999, color: '#00bfff', count: 0, percent: 0 },
    { name: 'ë§ˆìŠ¤í„°', minScore: config.master, color: '#9b59b6', count: 0, percent: 0 },
    { name: 'ì—ì´ìŠ¤', minScore: config.ace, color: '#e74c3c', count: 0, percent: 0 },
    { name: 'ì¡°ì»¤', minScore: config.joker, color: '#2ecc71', count: 0, percent: 0 },
    { name: 'ê³¨ë“œ', minScore: config.gold, color: '#f1c40f', count: 0, percent: 0 },
    { name: 'ì‹¤ë²„', minScore: config.silver, color: '#95a5a6', count: 0, percent: 0 },
    { name: 'ë¸Œë¡ ì¦ˆ', minScore: config.bronze, color: '#d35400', count: 0, percent: 0 },
    { name: 'ì•„ì´ì–¸', minScore: 0, color: '#7f8c8d', count: 0, percent: 0 },
  ];

  // ì‹¤ì œ userPool ê¸°ë°˜ í‹°ì–´ ì¹´ìš´íŒ…
  userPool.forEach(u => {
    const score = u.score;
    let assigned = false;
    for (const t of tiers) {
      if (score >= t.minScore) {
        t.count++;
        assigned = true;
        break;
      }
    }
    if (!assigned) tiers[tiers.length - 1].count++;
  });

  // ë¹„ìœ¨ ê³„ì‚°
  const totalTracked = userPool.length || 1;
  tiers.forEach(t => {
    t.percent = parseFloat(((t.count / totalTracked) * 100).toFixed(1));
  });

  return {
    totalGames: Math.floor(playingUsers / 10),
    playingUsers,
    queuingUsers,
    avgWaitTime: Math.max(5, Math.floor(120 / (queuingUsers / 10 + 1))),
    tierDistribution: tiers
  };
}

// === FILE: /src/engine/SaveLoadSystem.ts ===

// ==========================================
// FILE PATH: /src/engine/SaveLoadSystem.ts
// ==========================================

import { userPool, UserAgent, initUserPool } from './UserManager';
import { useGameStore } from '../store/useGameStore';
import { Hero } from '../types';

const STORAGE_PREFIX = 'GW_SAVE_DATA_';
const META_KEY = 'GW_SAVE_META';

export interface SaveMeta {
  slotId: string;
  timestamp: number;
  dateStr: string;
  season: number;
  day: number;
  totalUsers: number;
}

const serializeUsers = () => {
  return userPool.map(u => ({
    i: u.id, n: u.name, s: u.score, m: u.mainHeroId,
    w: u.wins, l: u.losses, h: u.history.slice(0, 10), st: 'OFFLINE'
  }));
};

const deserializeUsers = (data: any[], heroes: Hero[]) => {
  userPool.length = 0;
  data.forEach((d: any) => {
    const u = new UserAgent(d.i, heroes);
    Object.assign(u, {
      name: d.n, score: d.s, mainHeroId: d.m,
      wins: d.w || 0, losses: d.l || 0, history: d.h || [], status: 'OFFLINE'
    });
    userPool.push(u);
  });
};

// [Core] ìŠ¬ë¡¯ì— ì €ì¥í•˜ê¸°
export const saveToSlot = (slotId: string) => {
  const store = useGameStore.getState();
  
  const saveData = {
    time: {
      season: store.gameState.season,
      day: store.gameState.day,
      hour: store.gameState.hour,
      minute: store.gameState.minute
    },
    // [ìˆ˜ì •ë¨] ì„¤ì • ì €ì¥ ë¶€ë¶„ì— AI ì„¤ì •(aiConfig) ì¶”ê°€!
    config: {
      tier: store.gameState.tierConfig,
      battle: store.gameState.battleSettings,
      field: store.gameState.fieldSettings,
      ai: store.gameState.aiConfig // <--- ì—¬ê¸° ì¶”ê°€ë¨
    },
    heroes: store.heroes,
    users: serializeUsers(),
    timestamp: Date.now()
  };

  try {
    const json = JSON.stringify(saveData);
    localStorage.setItem(`${STORAGE_PREFIX}${slotId}`, json);

    const meta: SaveMeta = {
      slotId, timestamp: Date.now(), dateStr: new Date().toLocaleString(),
      season: saveData.time.season, day: saveData.time.day, totalUsers: userPool.length
    };
    updateMeta(slotId, meta);
    console.log(`âœ… [Slot ${slotId}] ë°ì´í„° ì €ì¥ ì™„ë£Œ (AIì„¤ì • í¬í•¨)`);
    return true;
  } catch (e) {
    console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', e);
    return false;
  }
};

// [Core] ìŠ¬ë¡¯ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
export const loadFromSlot = (slotId: string, currentHeroes: Hero[]) => {
  const json = localStorage.getItem(`${STORAGE_PREFIX}${slotId}`);
  if (!json) return false;

  try {
    const data = JSON.parse(json);
    const store = useGameStore.getState();

    // [ìˆ˜ì •ë¨] AI ì„¤ì • ë³µêµ¬ ë¡œì§ ì¶”ê°€
    const newGameState = {
      ...store.gameState,
      season: data.time.season,
      day: data.time.day,
      hour: data.time.hour,
      minute: data.time.minute,
      
      tierConfig: data.config?.tier || store.gameState.tierConfig,
      battleSettings: { ...store.gameState.battleSettings, ...(data.config?.battle || {}) },
      fieldSettings: { ...store.gameState.fieldSettings, ...(data.config?.field || {}) },
      // AI ì„¤ì • ë³‘í•© (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
      aiConfig: { ...store.gameState.aiConfig, ...(data.config?.ai || {}) },

      liveMatches: [],
      isPlaying: false
    };

    let loadedHeroes = currentHeroes;
    if (data.heroes && Array.isArray(data.heroes)) {
      loadedHeroes = currentHeroes.map(defaultHero => {
        const savedHero = data.heroes.find((h: Hero) => h.id === defaultHero.id);
        if (savedHero) {
          return {
            ...defaultHero,
            name: savedHero.name,
            stats: { ...defaultHero.stats, ...savedHero.stats },
            record: savedHero.record || defaultHero.record,
          };
        }
        return defaultHero;
      });
    }

    useGameStore.setState({ gameState: newGameState, heroes: loadedHeroes });
    deserializeUsers(data.users, loadedHeroes);

    console.log(`ğŸ“‚ [Slot ${slotId}] ë¡œë“œ ì™„ë£Œ (AIì„¤ì • í¬í•¨)`);
    return true;
  } catch (e) {
    console.error('âŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
    return false;
  }
};

const updateMeta = (slotId: string, info: SaveMeta) => {
  try {
    const json = localStorage.getItem(META_KEY);
    const allMeta = json ? JSON.parse(json) : {};
    allMeta[slotId] = info;
    localStorage.setItem(META_KEY, JSON.stringify(allMeta));
  } catch {}
};

export const getSlotsMeta = (): Record<string, SaveMeta> => {
  try {
    const json = localStorage.getItem(META_KEY);
    return json ? JSON.parse(json) : {};
  } catch { return {}; }
};

export const deleteSlot = (slotId: string) => {
  localStorage.removeItem(`${STORAGE_PREFIX}${slotId}`);
  const meta = getSlotsMeta();
  delete meta[slotId];
  localStorage.setItem(META_KEY, JSON.stringify(meta));
};

export const exportSaveFile = () => {
  saveToSlot('temp_export'); 
  const json = localStorage.getItem(`${STORAGE_PREFIX}temp_export`);
  if (!json) return;
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `GW_Save_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
  localStorage.removeItem(`${STORAGE_PREFIX}temp_export`);
};

export const importSaveFile = (file: File, heroes: Hero[]) => {
  return new Promise<boolean>((resolve) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        localStorage.setItem(`${STORAGE_PREFIX}temp_import`, e.target?.result as string);
        const success = loadFromSlot('temp_import', heroes);
        localStorage.removeItem(`${STORAGE_PREFIX}temp_import`);
        if(success) { saveToSlot('auto'); resolve(true); } else { resolve(false); }
      } catch (err) { console.error(err); resolve(false); }
    };
    reader.readAsText(file);
  });
};

export const initializeGame = (heroes: Hero[]) => {
  if (localStorage.getItem(`${STORAGE_PREFIX}auto`)) {
    console.log("ğŸ”„ ìë™ ì €ì¥ ë¡œë“œ");
    loadFromSlot('auto', heroes);
  } else {
    console.log('ğŸ†• ìƒˆ ê²Œì„ ì‹œì‘');
    initUserPool(heroes, 3000);
    saveToSlot('auto');
  }
};

// === FILE: /src/engine/SentimentEngine.ts ===

// ==========================================
// FILE PATH: /src/engine/SentimentEngine.ts
// ==========================================

import { GameState, Hero, Post } from '../types';

/**
 * ëª©í‘œ ë¯¼ì‹¬(Target Sentiment)ì„ ê³„ì‚°í•©ë‹ˆë‹¤. (v2.0 Science Logic)
 * - ì•„ë¬´ê²ƒë„ ì•ˆ í•´ë„ ê¸°ë³¸ì ìœ¼ë¡œ 60~70ì (ë³´í†µ~ì¢‹ìŒ)ì„ ìœ ì§€í•©ë‹ˆë‹¤.
 * - íŠ¹ì • ì¡°ê±´(ê²½ì œ í˜¸í™©, í™©ê¸ˆ ë°¸ëŸ°ìŠ¤, ê¿€ì¼ ì „íˆ¬)ì„ ë‹¬ì„±í•˜ë©´ 90ì  ì´ìƒìœ¼ë¡œ ì¹˜ì†ŸìŠµë‹ˆë‹¤.
 * - ëª…ë°±í•œ ê´€ë¦¬ ì†Œí™€(ì„œë²„ í„°ì§, ìŠ¹ë¥  60% ë°©ì¹˜)ì¼ ë•Œë§Œ ë–¨ì–´ì§‘ë‹ˆë‹¤.
 */
export function calculateTargetSentiment(
  gameState: GameState,
  heroes: Hero[],
  posts: Post[]
): number {
  // [ê¸°ë³¸ ì ìˆ˜]: 65ì  (ì‹œì‘ë¶€í„° 'ì•½ê°„ ì¢‹ìŒ' ìƒíƒœ)
  let target = 65; 

  // --------------------------------------------------------
  // 1. âš–ï¸ ë°¸ëŸ°ìŠ¤ (Balance) - "ì–µê¹Œ ë°©ì§€"
  // --------------------------------------------------------
  let brokenCount = 0; // ìƒíƒœê³„ êµë€ì¢… ìˆ˜
  let goldenCount = 0; // í™©ê¸ˆ ë°¸ëŸ°ìŠ¤ ìˆ˜

  heroes.forEach(h => {
    const wr = h.recentWinRate;

    // í™©ê¸ˆ ë°¸ëŸ°ìŠ¤ (48~52%): ì•„ì£¼ ì´ìƒì ì¸ êµ¬ê°„
    if (wr >= 48 && wr <= 52) goldenCount++;

    // í—ˆìš© ë²”ìœ„ (45~55%): ì´ êµ¬ê°„ì€ "ì •ìƒ"ìœ¼ë¡œ ê°„ì£¼ (ê°ì  ì—†ìŒ)

    // ì‹¬ê°í•œ ë¶ˆê· í˜• (58% ì´ˆê³¼ or 42% ë¯¸ë§Œ): ì´ë•Œë§Œ ìœ ì €ë“¤ì´ í™”ëƒ„
    if (wr > 58 || wr < 42) {
      brokenCount++;
      target -= (Math.abs(wr - 50) - 8) * 2; // ê²©ì°¨ë§Œí¼ ê°ì 
    }
  });

  // [í‰í™” ë³´ë„ˆìŠ¤] ë¬¸ì œì•„ê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ê´€ë¦¬ ëŠ¥ë ¥ì„ ì¹­ì°¬í•¨ (+10)
  if (brokenCount === 0) target += 10;

  // [í™©ê¸ˆê¸° ë³´ë„ˆìŠ¤] ì ˆë°˜ ì´ìƒì˜ ì˜ì›…ì´ í™©ê¸ˆ ë°¸ëŸ°ìŠ¤ë©´ ê·¹ì°¬ (+10)
  if (goldenCount >= (heroes.length / 2)) target += 10;


  // --------------------------------------------------------
  // 2. âš”ï¸ ë„íŒŒë¯¼ ì§€ìˆ˜ (Excitement) - "í‚¬ì´ ë§ì´ ë‚˜ì•¼ ì¬ë°Œë‹¤"
  // --------------------------------------------------------
  const izmanKills = parseFloat(gameState.godStats.izmanAvgKills);
  const danteKills = parseFloat(gameState.godStats.danteAvgKills);
  const totalAvgKills = izmanKills + danteKills;

  // í‰ê·  30í‚¬ ì´ìƒì´ë©´ "í™”ëˆí•œ ë©”íƒ€" (+5)
  if (totalAvgKills >= 30) target += 5;
  // í‰ê·  50í‚¬ ì´ìƒì´ë©´ "ëŒ€ìœ ì¼ ì‹œëŒ€" (+10)
  if (totalAvgKills >= 50) target += 5;

  // ë°˜ëŒ€ë¡œ 15í‚¬ ë¯¸ë§Œì´ë©´ "ìˆ˜ë©´ì œ ë©”íƒ€" (-5)
  if (totalAvgKills < 15) target -= 5;


  // --------------------------------------------------------
  // 3. ğŸ’° ê²½ì œ ì§€ìˆ˜ (Economy) - "ëˆì´ ì˜ ë²Œë ¤ì•¼ ì¬ë°Œë‹¤"
  // --------------------------------------------------------
  // ëª¨ë“  ì˜ì›…ì˜ í‰ê·  ê³¨ë“œ íšë“ëŸ‰ ê³„ì‚°
  let totalGold = 0;
  let heroCount = 0;
  heroes.forEach(h => {
    const goldVal = parseInt(h.avgGold.replace(/,/g, '')) || 0;
    if(goldVal > 0) {
        totalGold += goldVal;
        heroCount++;
    }
  });
  const globalAvgGold = heroCount > 0 ? totalGold / heroCount : 0;

  // í‰ê·  1.2ë§Œ ê³¨ë“œ ì´ìƒ ë²Œë¦¬ë©´ "ì„±ì¥ì´ ì‹œì›ì‹œì›í•˜ë‹¤" (+5)
  if (globalAvgGold >= 12000) target += 5;
  // í‰ê·  1.5ë§Œ ê³¨ë“œ ì´ìƒì´ë©´ "í˜œì ê²Œì„" (+5)
  if (globalAvgGold >= 15000) target += 5;


  // --------------------------------------------------------
  // 4. â³ ì¾Œì í•¨ ì§€ìˆ˜ (Quality of Service)
  // --------------------------------------------------------
  const waitTime = gameState.userStatus.avgWaitTime;

  // ë§¤ì¹­ 20ì´ˆ ì´ë‚´: "ê°“ì„œë²„" (+5)
  if (waitTime <= 20) target += 5;
  // ë§¤ì¹­ 60ì´ˆ ì´ˆê³¼: "ë§ê²œì†Œë¦¬ ë‚˜ì˜´" (-10)
  else if (waitTime > 60) target -= 10;


  // --------------------------------------------------------
  // 5. ğŸ—£ï¸ ì»¤ë®¤ë‹ˆí‹° ì—¬ë¡  (Public Opinion)
  // --------------------------------------------------------
  const recentPosts = posts.slice(0, 30);
  let communityScore = 0;

  recentPosts.forEach(p => {
    // ì§•ì§•ê¸€ì´ ë…ê¸€(Best) ê°”ì„ ë•Œë§Œ íƒ€ê²© (ì¼ë°˜ ì§•ì§•ê¸€ì€ ë¬´ì‹œ)
    if (p.category === 'ì§•ì§•' && p.isBest) communityScore -= 2;

    // ë¶„ì„/ê³µëµê¸€ì€ ìœ ì €ë“¤ì˜ í•™êµ¬ì—´ì„ ì˜ë¯¸í•¨ (ìƒìŠ¹)
    if (p.category === 'ê³µëµ' || p.category === 'ë¶„ì„') communityScore += 0.5;

    // ì¹­ì°¬/ìë‘ê¸€ì´ ë§ìœ¼ë©´ ë¶„ìœ„ê¸° ì¢‹ìŒ
    if (p.category === 'ìë‘' && p.upvotes > 5) communityScore += 0.2;
  });

  // ì»¤ë®¤ë‹ˆí‹° ì˜í–¥ë ¥ ì œí•œ (-20 ~ +15)
  target += Math.max(-20, Math.min(15, communityScore));


  // ìµœì¢… ë²”ìœ„ ì œí•œ (0 ~ 100)
  return Math.max(0, Math.min(100, target));
}

/**
 * ë¯¼ì‹¬ ë³€ë™ ê´€ì„± ë¡œì§
 * - ê¸‰ê²©í•˜ê²Œ ë³€í•˜ì§€ ì•Šê³  ì„œì„œíˆ ë³€í•©ë‹ˆë‹¤.
 * - ë–¨ì–´ì§ˆ ë•ŒëŠ” ì²œì²œíˆ ë–¨ì–´ì§€ì§€ë§Œ, íšŒë³µì€ ì¡°ê¸ˆ ë” ë¹ ë¦…ë‹ˆë‹¤.
 */
export function smoothSentiment(current: number, target: number): number {
  const diff = target - current;

  // ì´ë¯¸ ëª©í‘œì¹˜ ê·¼ì²˜ë©´ ê³ ì •
  if (Math.abs(diff) < 0.1) return target;

  let speed = 0.05; // ê¸°ë³¸ ë³€í™” ì†ë„

  // ë¯¼ì‹¬ì´ ì˜¤ë¥¼ ë•ŒëŠ” ì•½ê°„ ë” ë¹ ë¥´ê²Œ ë°˜ì˜ (ìœ ì €ë“¤ì´ ì¢‹ì€ íŒ¨ì¹˜ì—” ë°˜ì‘ì´ ë¹ ë¦„)
  if (diff > 0) speed = 0.08;
  // ë¯¼ì‹¬ì´ ë–¨ì–´ì§ˆ ë•ŒëŠ” ì¡°ê¸ˆ ì²œì²œíˆ (ë°©ì–´ ê¸°ì œ)
  else speed = 0.03;

  return current + diff * speed;
}

// === FILE: /src/engine/SpectateAI.ts ===

// src/engine/SpectateAI.ts
import { LivePlayer } from '../types';

export interface VisualUnit extends LivePlayer {
  vx: number;
  vy: number;
  role: string;
}

const getDist = (x1: number, y1: number, x2: number, y2: number) => 
  Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));

export function updateUnitAI(
  u: VisualUnit, 
  allies: VisualUnit[], 
  enemies: VisualUnit[], 
  isBlue: boolean
): VisualUnit {

  // 1. ì‚¬ë§ ì‹œ ê¸°ì§€ ìœ„ì¹˜ ê³ ì •
  if (u.currentHp <= 0) {
    u.vx = isBlue ? 12 : 88;
    u.vy = isBlue ? 88 : 12;
    return u;
  }

  // 2. ì  íƒì§€
  let target: VisualUnit | null = null;
  let minDist = 20; // ì¸ì‹ ë²”ìœ„ 20%

  enemies.forEach(e => {
    if (e.currentHp > 0) {
      const d = getDist(u.vx, u.vy, e.vx, e.vy);
      if (d < minDist) { minDist = d; target = e; }
    }
  });

  const speed = 0.25; // ì´ë™ ì†ë„ (ì˜ìƒë³´ë‹¤ ë” ë¹ ë¥´ê²Œ ì„¤ì •)

  if (target) {
    const d = getDist(u.vx, u.vy, target.vx, target.vy);
    if (d > 4) { // ì‚¬ê±°ë¦¬ ë°–ì´ë©´ ì¶”ê²©
      u.vx += ((target.vx - u.vx) / d) * speed;
      u.vy += ((target.vy - u.vy) / d) * speed;
    } else {
      // êµì „ ì¤‘ (ë¯¸ì„¸í•œ ë–¨ë¦¼)
      u.vx += (Math.random() - 0.5) * 0.15;
      u.vy += (Math.random() - 0.5) * 0.15;
    }
  } else {
    // [ë¼ì¸ ì´ë™]
    const dest = getLanePath(u.lane, isBlue, u.vx, u.vy);
    const dDest = getDist(u.vx, u.vy, dest.x, dest.y);
    if (dDest > 1) {
      u.vx += ((dest.x - u.vx) / dDest) * speed;
      u.vy += ((dest.y - u.vy) / dDest) * speed;
    }
  }

  // ìœ ë‹›ë¼ë¦¬ ë„ˆë¬´ ê²¹ì¹˜ì§€ ì•Šê²Œ ë°€ì–´ë‚´ê¸°
  allies.forEach(mate => {
    if (mate.name === u.name) return;
    if (getDist(u.vx, u.vy, mate.vx, mate.vy) < 2) {
      u.vx += (Math.random() - 0.5) * 0.1;
      u.vy += (Math.random() - 0.5) * 0.1;
    }
  });

  return u;
}

function getLanePath(lane: string, isBlue: boolean, cx: number, cy: number) {
  const blueBase = { x: 12, y: 88 };
  const redBase = { x: 88, y: 12 };
  const target = isBlue ? redBase : blueBase;

  if (lane === 'MID') return target;
  if (lane === 'TOP') {
    if (isBlue) return cy > 15 ? { x: 12, y: 12 } : target;
    return cx > 15 ? { x: 12, y: 12 } : target;
  }
  if (lane === 'BOT') {
    if (isBlue) return cx < 85 ? { x: 88, y: 88 } : target;
    return cy < 85 ? { x: 88, y: 88 } : target;
  }
  return { x: 50, y: 50 };
}

// === FILE: /src/engine/SpectateEngine.ts ===

// src/engine/SpectateEngine.ts

export const MAP = {
  BLUE_BASE: { x: 15, y: 85 },
  RED_BASE: { x: 85, y: 15 },
  TOP_EXIT: { x: 15, y: 15 },
  BOT_EXIT: { x: 85, y: 85 },
  CENTER: { x: 50, y: 50 }
};

const PATHS = {
  TOP: {
    BLUE: [MAP.BLUE_BASE, MAP.TOP_EXIT, MAP.RED_BASE],
    RED: [MAP.RED_BASE, MAP.TOP_EXIT, MAP.BLUE_BASE]
  },
  MID: {
    BLUE: [MAP.BLUE_BASE, MAP.CENTER, MAP.RED_BASE],
    RED: [MAP.RED_BASE, MAP.CENTER, MAP.BLUE_BASE]
  },
  BOT: {
    BLUE: [MAP.BLUE_BASE, MAP.BOT_EXIT, MAP.RED_BASE],
    RED: [MAP.RED_BASE, MAP.BOT_EXIT, MAP.BLUE_BASE]
  }
};

/**
 * [ì¶”ê°€] ê²½ê¸° ì‹œê°„ì— ë”°ë¥¸ ìœ ë‹›ì˜ ì´ˆê¸° ìœ„ì¹˜ ê³„ì‚°
 * 4ë¶„ ì§„í–‰ëœ ë°©ì— ë“¤ì–´ê°€ë©´ ë¼ì¸ ì¤‘ê°„ì¯¤ìœ¼ë¡œ ìœ ë‹›ì„ ì›Œí”„ì‹œí‚´
 */
export const calculateInitialPosition = (lane: string, isBlue: boolean, duration: number) => {
  const laneKey = lane === 'JUNGLE' ? 'MID' : (lane as 'TOP' | 'MID' | 'BOT');
  const path = PATHS[laneKey][isBlue ? 'BLUE' : 'RED'];

  // ìœ ë‹›ì´ í•œ ë°”í€´ ì§„ê²©í•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ëŒ€ëµì ì¸ ì‹œê°„ (ì´ˆ)
  const cycleTime = 60; 
  const progress = (duration % cycleTime) / cycleTime; // 0.0 ~ 1.0

  // ì§„í–‰ë„ì— ë”°ë¼ ê²½ë¡œìƒì˜ index ê²°ì •
  const totalWaypoints = path.length;
  const currentIdx = Math.min(Math.floor(progress * totalWaypoints), totalWaypoints - 1);
  const nextIdx = Math.min(currentIdx + 1, totalWaypoints - 1);

  const start = path[currentIdx];
  const end = path[nextIdx];
  const ratio = (progress * totalWaypoints) % 1;

  return {
    x: start.x + (end.x - start.x) * ratio,
    y: start.y + (end.y - start.y) * ratio,
    step: currentIdx
  };
};

export const moveUnit = (unit: any, enemies: any[], allies: any[], isBlue: boolean, deltaTime: number) => {
  if (unit.currentHp <= 0) return;

  const speed = 0.6 * deltaTime;
  const detectionRange = 25; 
  const attackRange = 7;

  // 1. ì  ê°ì§€
  let target: any = null;
  let minDist = detectionRange;
  enemies.forEach(en => {
    if (en.currentHp > 0) {
      const d = Math.sqrt(Math.pow(unit.vx - en.vx, 2) + Math.pow(unit.vy - en.vy, 2));
      if (d < minDist) { minDist = d; target = en; }
    }
  });

  if (target) {
    const d = Math.sqrt(Math.pow(unit.vx - target.vx, 2) + Math.pow(unit.vy - target.vy, 2));
    if (d > attackRange) {
      unit.vx += ((target.vx - unit.vx) / d) * speed;
      unit.vy += ((target.vy - unit.vy) / d) * speed;
      unit.isAttacking = false;
    } else {
      unit.isAttacking = true;
      unit.targetPos = { x: target.vx, y: target.vy };
      unit.vx += (Math.random() - 0.5) * 0.4; // ì „íˆ¬ ì¤‘ ë–¨ë¦¼
      unit.vy += (Math.random() - 0.5) * 0.4;
    }
  } else {
    // 2. ì§„ê²© (ì›¨ì´í¬ì¸íŠ¸ ë”°ë¼ê°€ê¸°)
    unit.isAttacking = false;
    const laneKey = unit.lane === 'JUNGLE' ? 'MID' : unit.lane;
    const path = PATHS[laneKey as 'TOP' | 'MID' | 'BOT'][isBlue ? 'BLUE' : 'RED'];
    const targetWaypoint = path[unit.pathStep] || path[path.length - 1];

    const d = Math.sqrt(Math.pow(unit.vx - targetWaypoint.x, 2) + Math.pow(unit.vy - targetWaypoint.y, 2));
    if (d < 5) {
      if (unit.pathStep < path.length - 1) unit.pathStep++;
      else unit.pathStep = 0; // ë³¸ì§„ ë„ì°©ì‹œ ë‹¤ì‹œ ì²˜ìŒìœ¼ë¡œ (ìˆœí™˜)
    } else {
      unit.vx += ((targetWaypoint.x - unit.vx) / d) * speed;
      unit.vy += ((targetWaypoint.y - unit.vy) / d) * speed;
    }
  }

  // ì•„êµ°ë¼ë¦¬ ê²¹ì¹¨ ë°©ì§€
  allies.forEach(al => {
    if (al.name === unit.name) return;
    const d = Math.sqrt(Math.pow(unit.vx - al.vx, 2) + Math.pow(unit.vy - al.vy, 2));
    if (d < 3) {
      unit.vx -= (al.vx - unit.vx) * 0.1;
      unit.vy -= (al.vy - unit.vy) * 0.1;
    }
  });
};

// === FILE: /src/engine/UserManager.ts ===

// ==========================================
// FILE PATH: /src/engine/UserManager.ts
// ==========================================

import { Hero, UserProfile, MatchHistory, TierConfig, UserHeroStat } from '../types';
import { generateUserName } from '../utils/nameGenerator';

const registeredNames = new Set<string>();

const HOURLY_ACTIVITY_RATES = [
  0.15, 0.10, 0.05, 0.03, 0.02, 0.05, 
  0.10, 0.15, 0.20, 0.25, 0.25, 0.30, 
  0.35, 0.35, 0.40, 0.40, 0.45, 0.50, 
  0.55, 0.60, 0.65, 0.60, 0.50, 0.40 
];

export class UserAgent {
  id: number; name: string; score: number; hiddenMmr: number;
  preferredLane: 'TOP' | 'JUNGLE' | 'MID' | 'BOT'; 
  preferredHeroes: string[]; 
  wins: number; losses: number; 
  history: MatchHistory[];
  status: 'IDLE' | 'QUEUE' | 'INGAME' | 'OFFLINE' | 'RESTING';
  restTimer: number;
  heroStats: Record<string, UserHeroStat>; 
  mainHeroId: string; 
  activityBias: number; 

  // [ì‹ ê·œ í•„ë“œ ì¶”ê°€]
  promoStatus: { targetTier: string; wins: number; losses: number; targetWins: number; } | null = null;
  rank: number = 0;
  isChallenger: boolean = false;

  constructor(id: number, heroes: Hero[]) {
    this.id = id;
    this.score = 0;
    this.wins = 0; this.losses = 0;
    this.history = [];
    this.status = 'OFFLINE';
    this.restTimer = 0;
    this.heroStats = {};

    this.activityBias = (Math.random() * 0.2) - 0.1;

    let tempName = generateUserName(id);
    let attempts = 0;
    while (registeredNames.has(tempName) && attempts < 5) {
      tempName = generateUserName(id + attempts * 1000); 
      attempts++;
    }
    if (registeredNames.has(tempName)) tempName = `${tempName}#${id}`; 
    registeredNames.add(tempName);
    this.name = tempName;

    this.hiddenMmr = 1000 + (Math.random() * 1000) + (Math.random() * 1000);

    const lanes = ['TOP', 'JUNGLE', 'MID', 'BOT'];
    this.preferredLane = lanes[Math.floor(Math.random() * lanes.length)] as any;

    const myRoleHeroes = heroes.filter(h => this.isHeroForLane(h, this.preferredLane));
    const poolSize = Math.min(myRoleHeroes.length, 3 + Math.floor(Math.random() * 3));
    this.preferredHeroes = myRoleHeroes
      .sort(() => Math.random() - 0.5)
      .slice(0, poolSize)
      .map(h => h.id);

    if (this.preferredHeroes.length === 0) {
        this.preferredHeroes = [heroes[0].id];
    }

    this.mainHeroId = this.preferredHeroes[0];
  }

  private isHeroForLane(hero: Hero, lane: string) {
    if (lane === 'TOP') return hero.role === 'ìˆ˜í˜¸ê¸°ì‚¬' || hero.role === 'ì§‘í–‰ê´€';
    if (lane === 'MID') return hero.role === 'ì„ ì§€ì' || hero.role === 'ì¶”ì ì';
    if (lane === 'BOT') return hero.role === 'ì‹ ì‚´ì';
    if (lane === 'JUNGLE') return hero.role === 'ì¶”ì ì' || hero.role === 'ì§‘í–‰ê´€';
    return true;
  }

  getTierName(config?: TierConfig) {
    const defaults = { challengerRank: 50, challenger: 9999, master: 4800, ace: 3800, joker: 3200, gold: 2100, silver: 1300, bronze: 300, promoMatches: 3 };
    const cfg = config || defaults;

    // [ìˆ˜ì •] ì±Œë¦°ì € íŒë³„ ë¡œì§: í”Œë˜ê·¸ í™•ì¸
    if (this.isChallenger) return 'ì²œìƒê³„';

    // ë‚˜ë¨¸ì§€ëŠ” ì ìˆ˜ ê¸°ë°˜
    if (this.score >= cfg.master) return 'ë§ˆìŠ¤í„°';
    if (this.score >= cfg.ace) return 'ì—ì´ìŠ¤';
    if (this.score >= cfg.joker) return 'ì¡°ì»¤';
    if (this.score >= cfg.gold) return 'ê³¨ë“œ';
    if (this.score >= cfg.silver) return 'ì‹¤ë²„';
    if (this.score >= cfg.bronze) return 'ë¸Œë¡ ì¦ˆ';
    return 'ì•„ì´ì–¸';
  }

  pickHero(heroes: Hero[]): string {
    if (Math.random() < 0.7 && this.preferredHeroes.length > 0) {
      return this.preferredHeroes[Math.floor(Math.random() * this.preferredHeroes.length)];
    }
    return heroes[Math.floor(Math.random() * heroes.length)].id;
  }

  shouldBeOnline(hour: number): boolean {
    const baseRate = HOURLY_ACTIVITY_RATES[hour] || 0.3;
    const finalRate = Math.min(0.95, Math.max(0.01, baseRate + this.activityBias));
    return Math.random() < finalRate;
  }
}

export const userPool: UserAgent[] = [];

export function getTierNameHelper(score: number, config: TierConfig) {
  if (score >= 9999) return 'ì²œìƒê³„'; // ì„ì‹œ (UserAgent ë‚´ë¶€ ë¡œì§ì´ ì •í™•í•¨)
  if (score >= config.master) return 'ë§ˆìŠ¤í„°';
  if (score >= config.ace) return 'ì—ì´ìŠ¤';
  if (score >= config.joker) return 'ì¡°ì»¤';
  if (score >= config.gold) return 'ê³¨ë“œ';
  if (score >= config.silver) return 'ì‹¤ë²„';
  if (score >= config.bronze) return 'ë¸Œë¡ ì¦ˆ';
  return 'ì•„ì´ì–¸';
}

export function initUserPool(heroes: Hero[], count: number = 3000) {
  const startId = userPool.length;
  if (count > userPool.length) {
    const newUsersCount = count - userPool.length;
    const newUsers = Array.from({ length: newUsersCount }, (_, i) => new UserAgent(startId + i, heroes));
    userPool.push(...newUsers);
  }
}

export function updateUserActivity(hour: number, heroes: Hero[]) {
  userPool.forEach(u => {
    if (u.status === 'INGAME') return; 

    if (u.status === 'RESTING') {
      u.restTimer -= 1;
      if (u.restTimer <= 0) u.status = 'IDLE';
      return;
    }

    const wantsToPlay = u.shouldBeOnline(hour);

    if (u.status === 'OFFLINE' && wantsToPlay) {
        u.status = 'IDLE';
    } 
    else if ((u.status === 'IDLE' || u.status === 'QUEUE') && !wantsToPlay) {
        if (Math.random() < 0.2) { 
            u.status = 'OFFLINE';
        }
    }
  });
}

export function getTopRankers(heroes: Hero[], config: TierConfig): UserProfile[] {
  const sorted = [...userPool].sort((a, b) => b.score - a.score || a.id - b.id);

  return sorted.slice(0, 50).map(u => {
    let mostPlayedId = u.mainHeroId;
    let maxGames = -1;

    Object.entries(u.heroStats).forEach(([hid, stat]) => {
      if (stat.matches > maxGames) {
        maxGames = stat.matches;
        mostPlayedId = hid;
      }
    });

    return {
      id: u.id, 
      name: u.name, 
      mainHeroId: mostPlayedId, 
      score: u.score, 
      tier: u.getTierName(config), 
      winRate: u.wins + u.losses > 0 ? (u.wins / (u.wins + u.losses)) * 100 : 0,
      totalGames: u.wins + u.losses, 
      history: u.history || [],
      heroStats: u.heroStats, 
      preferredLane: u.preferredLane,
      laneStats: [],
      mostChamps: [],
      promoStatus: u.promoStatus // [ì¶”ê°€]
    };
  });
}

export function getUsersInTier(tierName: string, config: TierConfig): UserProfile[] {
  return userPool
    .filter(u => u.getTierName(config) === tierName)
    .sort((a, b) => b.score - a.score)
    .map(u => ({
      id: u.id, name: u.name, mainHeroId: u.mainHeroId, score: u.score,
      tier: tierName, winRate: (u.wins/(u.wins+u.losses))*100 || 0,
      totalGames: u.wins+u.losses, history: u.history || [],
      heroStats: u.heroStats,
      preferredLane: u.preferredLane,
      laneStats: [],
      mostChamps: [],
      promoStatus: u.promoStatus // [ì¶”ê°€]
    }));
}

export function findUserProfileByName(name: string, config: TierConfig): UserProfile | null {
  const user = userPool.find(u => u.name === name);

  if (!user) return null;

  return {
    id: user.id,
    name: user.name,
    mainHeroId: user.mainHeroId,
    score: user.score,
    tier: user.getTierName(config),
    winRate: user.wins + user.losses > 0 ? (user.wins / (user.wins + user.losses)) * 100 : 0,
    totalGames: user.wins + user.losses,
    history: user.history || [],
    heroStats: user.heroStats,
    preferredLane: user.preferredLane,
    laneStats: [],
    mostChamps: [],
    promoStatus: user.promoStatus // [ì¶”ê°€]
  };
}

// === FILE: /src/engine/battle/SkillProcessor.ts ===

// src/engine/battle/SkillProcessor.ts
import { SkillDetail, HeroStats } from '../../types';

export const processSkillEffect = (skill: SkillDetail, attacker: any, target: any) => {
  let power = skill.val + (attacker.stats.ad * skill.adRatio) + (attacker.stats.ap * skill.apRatio);

  switch (skill.mechanic) {
    case 'EXECUTE':
      if (target.currentHp / target.maxHp < 0.25) power *= 5; // ì²´ë ¥ 25% ì´í•˜ë©´ 5ë°° ë°ë¯¸ì§€
      break;
    case 'STUN':
      target.isStunned = true; // CCê¸° ìƒíƒœ ë¶€ì—¬ (ì‹œë®¬ë ˆì´ì…˜ ë°˜ì˜ìš©)
      break;
    case 'HEAL':
      attacker.currentHp = Math.min(attacker.maxHp, attacker.currentHp + power);
      return 0; // ë°ë¯¸ì§€ëŠ” 0
    case 'SHIELD':
      attacker.shield = power;
      return 0;
  }
  return Math.floor(power);
};

// === FILE: /src/engine/battle/StatCalculator.ts ===

// src/engine/battle/StatCalculator.ts
import { HeroStats, GodSettings } from '../../types';

export const calculateDamage = (
  attackerStats: HeroStats,
  defenderStats: HeroStats,
  godBuff: GodSettings,
  isCritical: boolean
) => {
  // ê¸°ë³¸ ë°ë¯¸ì§€ = (ê¸°ë³¸ê³µê²©ë ¥ + AD) * ì§„ì˜ ê³µê²© ê°€ì¤‘ì¹˜
  let baseDmg = (attackerStats.baseAtk + attackerStats.ad) * godBuff.atkRatio;

  if (isCritical) baseDmg *= 1.75;

  // ë°©ì–´ë ¥ ê³„ì‚° (ê´€í†µë ¥ ì ìš©)
  const effectiveArmor = Math.max(0, defenderStats.armor - attackerStats.pen);
  const damageReduction = 100 / (100 + (effectiveArmor * godBuff.defRatio));

  return Math.floor(baseDmg * damageReduction);
};

// === FILE: /src/engine/match/BanPickEngine.ts ===

// ==========================================
// FILE PATH: /src/engine/match/BanPickEngine.ts
// ==========================================

import { Hero } from '../../types';

export const performBanPick = (heroes: Hero[], players: any[]) => {
  const bans: { blue: string[], red: string[] } = { blue: [], red: [] };
  const picks: { blue: any[], red: any[] } = { blue: [], red: [] };
  const unavailableIds = new Set<string>();

  // 1. ë°´ í˜ì´ì¦ˆ ê°œì„ 
  // ìŠ¹ë¥  ìµœìƒìœ„ê¶Œë§Œ ë°´ ë‹¹í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, "ìƒìœ„ 30% + ëœë¤"ì´ ì„ì´ë„ë¡ ìˆ˜ì •
  const sortedHeroes = [...heroes].sort((a, b) => b.recentWinRate - a.recentWinRate);

  const attemptBan = (sideBans: string[]) => {
    // ë°´ í›„ë³´êµ°ì„ ìƒìœ„ 15ëª…ì´ ì•„ë‹ˆë¼ ì „ì²´ì˜ 40%ê¹Œì§€ ë„“ê²Œ ë´…ë‹ˆë‹¤.
    const banPoolSize = Math.max(10, Math.floor(heroes.length * 0.4));
    const banCandidates = sortedHeroes.slice(0, banPoolSize).filter(h => !unavailableIds.has(h.id));

    if (banCandidates.length > 0) {
      // í›„ë³´êµ° ì¤‘ì—ì„œ ëœë¤ ì„ íƒ (ë¬´ì¡°ê±´ 1ë“±ë§Œ ë°´í•˜ì§€ ì•ŠìŒ)
      const target = banCandidates[Math.floor(Math.random() * banCandidates.length)];
      sideBans.push(target.id);
      unavailableIds.add(target.id);
    }
  };

  // ë¸”ë£¨íŒ€ 2ë°´, ë ˆë“œíŒ€ 2ë°´
  attemptBan(bans.blue);
  attemptBan(bans.blue);
  attemptBan(bans.red);
  attemptBan(bans.red);

  // 2. í”½ í˜ì´ì¦ˆ ê°œì„  (ë‹¤ì–‘ì„± í™•ë³´ í•µì‹¬ ë¡œì§)
  const selectHero = (user: any) => {
    // ì´ë¯¸ ë°´/í”½ëœ ì˜ì›… ì œì™¸í•œ ëª©ë¡
    const available = heroes.filter(h => !unavailableIds.has(h.id));

    // ë§Œì•½ ë‚¨ì€ ì˜ì›…ì´ ì—†ìœ¼ë©´(ê±°ì˜ ì—†ê² ì§€ë§Œ) ì•„ë¬´ë‚˜ ë¦¬í„´
    if (available.length === 0) return heroes[0].id;

    const rand = Math.random();
    let selectedHeroId = '';

    // [ì „ëµ A] "ì¦ê²œ/ë‰´ë©”íƒ€" í”½ (30% í™•ë¥ )
    // -> ìŠ¹ë¥  ë¬´ì‹œí•˜ê³  ì™„ì „ ëœë¤ìœ¼ë¡œ í”½í•©ë‹ˆë‹¤. 
    // -> ì´ ë¡œì§ ë•ë¶„ì— 0% í”½ë¥ ì¸ ì˜ì›…ë“¤ì´ ê°•ì œë¡œ ê²Œì„ì— ì°¸ì—¬í•˜ê²Œ ë©ë‹ˆë‹¤.
    if (rand < 0.3) {
      const randomPick = available[Math.floor(Math.random() * available.length)];
      selectedHeroId = randomPick.id;
    }
    // [ì „ëµ B] "ì£¼ë¥˜ ë©”íƒ€" í”½ (50% í™•ë¥ )
    // -> ê¸°ì¡´ì—ëŠ” ìƒìœ„ 4ëª…ë§Œ ë½‘ì•˜ì§€ë§Œ, ì´ì œëŠ” "ìƒìœ„ 60%" ì¤‘ì—ì„œ ëœë¤ìœ¼ë¡œ ë½‘ìŠµë‹ˆë‹¤.
    // -> 1í‹°ì–´ë¿ë§Œ ì•„ë‹ˆë¼ 2~3í‹°ì–´ë„ ìì£¼ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.
    else if (rand < 0.8) {
      const sortedByWin = [...available].sort((a, b) => b.recentWinRate - a.recentWinRate);
      const metaPoolSize = Math.max(5, Math.floor(sortedByWin.length * 0.6)); // ìƒìœ„ 60%
      const metaPool = sortedByWin.slice(0, metaPoolSize);

      const metaPick = metaPool[Math.floor(Math.random() * metaPool.length)];
      selectedHeroId = metaPick.id;
    }
    // [ì „ëµ C] "ì¥ì¸/ì• ì •" í”½ (ë‚˜ë¨¸ì§€ 20%)
    // -> ê·¸ëƒ¥ ë‚¨ì€ ê²ƒ ì¤‘ ë˜ ëœë¤ (ê²°ê³¼ì ìœ¼ë¡œ ëœë¤ì„±ì´ 50% ê°€ê¹Œì´ ë¨)
    else {
      const randomPick = available[Math.floor(Math.random() * available.length)];
      selectedHeroId = randomPick.id;
    }

    unavailableIds.add(selectedHeroId);
    return selectedHeroId;
  };

  // ë¸”ë£¨íŒ€ 5ëª… í”½, ë ˆë“œíŒ€ 5ëª… í”½
  players.slice(0, 5).forEach(u => picks.blue.push({ name: u.name, heroId: selectHero(u) }));
  players.slice(5, 10).forEach(u => picks.red.push({ name: u.name, heroId: selectHero(u) }));

  return { bans, picks };
};

// === FILE: /src/engine/match/ItemManager.ts ===

// ==========================================
// FILE PATH: /src/engine/match/ItemManager.ts
// ==========================================

import { Item, LivePlayer, Hero } from '../../types';

// [1] ìŠ¤ë§ˆíŠ¸ ì•„ì´í…œ êµ¬ë§¤ ë¡œì§ (ì €ì¶• ë° êµì²´ ê°œë… ë„ì…)
export const attemptBuyItem = (player: LivePlayer, shopItems: Item[], heroes: Hero[]) => {
  // í”Œë ˆì´ì–´ ì˜ì›… ì •ë³´
  const hero = heroes.find(h => h.id === player.heroId);
  if (!hero) return;

  // ì˜ì›… ì„±í–¥ íŒŒì•… (AD vs AP)
  const isAdChamp = hero.stats.ad > hero.stats.ap || hero.skills.q.adRatio > hero.skills.q.apRatio;

  // í˜„ì¬ ì¸ë²¤í† ë¦¬ ìƒíƒœ
  const itemCount = player.items.length;

  // -------------------------------------------------------
  // [ì „ëµ 1] êµ¬ë§¤ ì œí•œ (Tier Check)
  // ì¸ë²¤í† ë¦¬ê°€ ì°°ìˆ˜ë¡ ë” ë¹„ì‹¼ ì•„ì´í…œë§Œ ë³´ê²Œ í•˜ì—¬ 'ì €ì¶•'ì„ ìœ ë„í•¨
  // -------------------------------------------------------
  let minPriceLimit = 0;

  if (itemCount < 2) {
    minPriceLimit = 0; // ì´ˆë°˜: ì•„ë¬´ê±°ë‚˜ ì‚¼ (ë‹¨ê²€, ë„ë€ë§ ë“±)
  } else if (itemCount < 4) {
    minPriceLimit = 600; // ì¤‘ë°˜ ì´ˆì…: ìµœì†Œ 600G ì´ìƒ ì•„ì´í…œë§Œ (í•˜ìœ„í…œ ë‚œì‚¬ ë°©ì§€)
  } else if (itemCount < 6) {
    minPriceLimit = 1100; // ì¤‘ë°˜: 1100G ì´ìƒ ì¤‘ìƒìœ„í…œë§Œ ë…¸ë¦¼
  } else {
    minPriceLimit = 2500; // í›„ë°˜(í’€í…œ): ì½”ì–´í…œ(2500G+) ì•„ë‹ˆë©´ ê±°ë“¤ë– ë„ ì•ˆ ë´„
  }

  // -------------------------------------------------------
  // [ì „ëµ 2] ì‚´ ìˆ˜ ìˆëŠ” ì•„ì´í…œ í•„í„°ë§ ë° ì ìˆ˜ ë§¤ê¸°ê¸°
  // -------------------------------------------------------
  const purchasable = shopItems.filter(i => i.cost <= player.gold && i.cost >= minPriceLimit);

  if (purchasable.length === 0) return;

  // ìš°ì„ ìˆœìœ„ ì •ë ¬ (ë¹„ì‹¼ê±° + ë‚´ ì§ì—…ì— ë§ëŠ”ê±°)
  purchasable.sort((a, b) => {
    let scoreA = a.cost;
    let scoreB = b.cost;

    // ì„±í–¥ ë³´ì • (ADì±”ì€ ADí…œ, APì±”ì€ APí…œ ì„ í˜¸)
    if (isAdChamp && a.ad > 0) scoreA *= 1.5;
    if (!isAdChamp && a.ap > 0) scoreA *= 1.5;
    if (isAdChamp && b.ad > 0) scoreB *= 1.5;
    if (!isAdChamp && b.ap > 0) scoreB *= 1.5;

    // ê¶ŒëŠ¥ ì•„ì´í…œì€ ìµœìš°ì„  (ëˆë§Œ ìˆë‹¤ë©´)
    if (a.type === 'POWER') scoreA *= 5;
    if (b.type === 'POWER') scoreB *= 5;

    return scoreB - scoreA; // ì ìˆ˜ ë†’ì€ ìˆœ
  });

  const bestTargetItem = purchasable[0];

  // -------------------------------------------------------
  // [ì „ëµ 3] êµ¬ë§¤ ë° êµì²´ (Replacement)
  // -------------------------------------------------------

  // A. ì¸ë²¤í† ë¦¬ê°€ ë¹„ì–´ìˆìœ¼ë©´ ê·¸ëƒ¥ êµ¬ë§¤
  if (itemCount < 6) {
    player.gold -= bestTargetItem.cost;
    player.items.push(bestTargetItem);
  } 
  // B. ì¸ë²¤í† ë¦¬ê°€ ê½‰ ì°¼ìœ¼ë©´ 'ê°€ì¥ ì‹¼ í…œ'ì„ íŒ”ê³  êµì²´ (ì—…ê·¸ë ˆì´ë“œ)
  else {
    // ë‚´ ì¸ë²¤í† ë¦¬ì—ì„œ ê°€ì¥ ì‹¼ ì•„ì´í…œ ì°¾ê¸°
    // (ë‹¨, 'ê¶ŒëŠ¥' ì•„ì´í…œì€ ì ˆëŒ€ íŒ”ì§€ ì•ŠìŒ)
    const sortedInventory = [...player.items].sort((a, b) => a.cost - b.cost);
    const cheapestItem = sortedInventory.find(i => i.type !== 'POWER');

    if (cheapestItem) {
      // êµì²´ ì¡°ê±´: ìƒˆë¡œ ì‚´ ì•„ì´í…œì´ ë²„ë¦´ ì•„ì´í…œë³´ë‹¤ í›¨ì”¬ ë¹„ì‹¸ì•¼ í•¨ (ìµœì†Œ 2ë°° ì´ìƒ ê°€ì¹˜ or ì½”ì–´í…œ)
      // ì˜ˆ: ë„ë€ê²€(450G) ë²„ë¦¬ê³  ë¬´í•œì˜ëŒ€ê²€(3400G) ì‚¬ê¸° -> OK
      // ì˜ˆ: ë„ë€ê²€(450G) ë²„ë¦¬ê³  ë¡±ì†Œë“œ(350G) ì‚¬ê¸° -> NO
      if (bestTargetItem.cost > cheapestItem.cost * 1.5) {
        // íŒë§¤ (ë°˜ê°’ í™˜ë¶ˆ)
        player.gold += Math.floor(cheapestItem.cost * 0.5);
        // ì¸ë²¤í† ë¦¬ì—ì„œ ì œê±°
        player.items = player.items.filter(i => i !== cheapestItem);

        // ìƒˆ ì•„ì´í…œ êµ¬ë§¤
        player.gold -= bestTargetItem.cost;
        player.items.push(bestTargetItem);
      }
    }
  }
};

// [2] ì „íˆ¬ë ¥ ê³„ì‚° (ì•„ì´í…œ ìŠ¤íƒ¯ í•©ì‚°) - ê¸°ì¡´ ìœ ì§€
export const calculateTotalStats = (hero: Hero, items: Item[]) => {
  let stats = { ...hero.stats }; 

  items.forEach(item => {
    stats.ad += item.ad;
    stats.ap += item.ap;
    stats.hp += item.hp;
    stats.armor += item.armor;
    stats.crit += item.crit;
    stats.speed += item.speed;
  });

  return stats;
};

// === FILE: /src/engine/match/MatchCreator.ts ===

// ==========================================
// FILE PATH: /src/engine/match/MatchCreator.ts
// ==========================================

import { Hero, LiveMatch, LivePlayer, TierConfig } from '../../types';
import { userPool, getTierNameHelper } from '../UserManager';
import { performBanPick } from './BanPickEngine';
import { useGameStore } from '../../store/useGameStore';

export function createLiveMatches(heroes: Hero[], ccu: number, currentTime: number, config: TierConfig): LiveMatch[] {
  const idleUsers = userPool.filter(u => u.status === 'IDLE');
  if (idleUsers.length < 10) return [];

  const matchesToMake = Math.min(Math.floor(idleUsers.length / 10), 20); 
  const newMatches: LiveMatch[] = [];
  const candidates = [...idleUsers].sort(() => Math.random() - 0.5);

  const settings = useGameStore.getState().gameState.battleSettings;
  const blueHp = settings?.dante?.guardianHp || 5000;
  const redHp = settings?.izman?.guardianHp || 5000;

  for (let i = 0; i < matchesToMake; i++) {
    const batch = candidates.slice(i * 10, (i + 1) * 10);
    const { bans, picks } = performBanPick(heroes, batch);

    [...bans.blue, ...bans.red].forEach(heroId => {
      const hero = heroes.find(h => h.id === heroId);
      if (hero) hero.record.totalBans++;
    });

    const createPlayer = (pData: any, index: number): LivePlayer => {
      const originalUser = batch.find(u => u.name === pData.name);
      const userMmr = originalUser ? originalUser.hiddenMmr : 1500; 

      return {
        name: pData.name, heroId: pData.heroId, 
        kills: 0, deaths: 0, assists: 0, gold: 500, cs: 0,
        totalDamageDealt: 0,
        currentHp: 1000, maxHp: 1000, level: 1, items: [], 
        x: 50, y: 50, 
        lane: (['TOP', 'JUNGLE', 'MID', 'BOT', 'BOT'][index] as any),
        buffs: [], mmr: userMmr
      };
    };

    batch.forEach(u => u.status = 'INGAME');
    const maxDuration = 60 * 60; 

    newMatches.push({
      id: `m_${currentTime}_${Math.random().toString(36).substr(2, 5)}`,
      blueTeam: picks.blue.map((p, idx) => createPlayer(p, idx)),
      redTeam: picks.red.map((p, idx) => createPlayer(p, idx)),
      bans, 
      startTime: currentTime,
      duration: maxDuration,
      currentDuration: 0, 
      score: { blue: 0, red: 0 }, 
      stats: {
        blue: { 
          towers: { top: 0, mid: 0, bot: 0 }, 
          colossus: 0, watcher: 0, fury: 0, 
          nexusHp: blueHp, maxNexusHp: blueHp,
          activeBuffs: { siegeUnit: false, voidPower: false } 
        },
        red: { 
          towers: { top: 0, mid: 0, bot: 0 }, 
          colossus: 0, watcher: 0, fury: 0, 
          nexusHp: redHp, maxNexusHp: redHp,
          activeBuffs: { siegeUnit: false, voidPower: false } 
        }
      },
      timeline: [],
      avgTier: getTierNameHelper(batch[0].score, config),
      logs: [{ time: 0, message: "--- ì†Œí™˜ì‚¬ì˜ í˜‘ê³¡ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤ ---", type: 'START' }],

      // [ì‹ ê·œ] ìŠ¤í° íƒ€ì´ë¨¸ ì´ˆê¸°í™” (ê±°ì‹ ë³‘: 5ë¶„, ì£¼ì‹œì: 20ë¶„)
      nextColossusSpawnTime: 300,
      nextWatcherSpawnTime: 1200
    });
  }
  return newMatches;
}

// === FILE: /src/engine/match/MatchSettlement.ts ===

// ==========================================
// FILE PATH: /src/engine/match/MatchSettlement.ts
// ==========================================

import { Hero, LiveMatch, LivePlayer, TierConfig } from '../../types';
import { userPool } from '../UserManager';

// ë‹¤ìŒ í‹°ì–´ ì •ë³´ ë°˜í™˜ (ì´ë¦„, ì»·, ìŠ¹ê¸‰ì „ ì„¤ì • í‚¤)
const getNextTierInfo = (currentScore: number, config: TierConfig) => {
  if (currentScore < config.bronze) return { name: 'ë¸Œë¡ ì¦ˆ', cut: config.bronze, key: 'bronze' };
  if (currentScore < config.silver) return { name: 'ì‹¤ë²„', cut: config.silver, key: 'silver' };
  if (currentScore < config.gold) return { name: 'ê³¨ë“œ', cut: config.gold, key: 'gold' };
  if (currentScore < config.joker) return { name: 'ì¡°ì»¤', cut: config.joker, key: 'joker' };
  if (currentScore < config.ace) return { name: 'ì—ì´ìŠ¤', cut: config.ace, key: 'ace' };
  if (currentScore < config.master) return { name: 'ë§ˆìŠ¤í„°', cut: config.master, key: 'master' };
  return null; 
};

export function finishMatch(
  match: LiveMatch, 
  heroes: Hero[], 
  day: number, 
  hour: number, 
  battleSettings: any,
  tierConfig: TierConfig // [ì¤‘ìš”] í•¨ìˆ˜ ì¸ìë¡œ ì„¤ì •ì„ ë°›ìŒ
) {

  let isBlueWin = match.score.blue > match.score.red;
  if (match.stats.red.nexusHp <= 0) isBlueWin = true;       
  else if (match.stats.blue.nexusHp <= 0) isBlueWin = false; 

  const blueKills = match.blueTeam.reduce((sum, p) => sum + p.kills, 0);
  const redKills = match.redTeam.reduce((sum, p) => sum + p.kills, 0);

  const participantNames = new Set([...match.blueTeam, ...match.redTeam].map(p => p.name));

  // ì°¸ì—¬ ìœ ì € íœ´ì‹ ì²˜ë¦¬
  userPool.forEach(u => {
    if (participantNames.has(u.name)) {
      u.status = 'RESTING';
      u.restTimer = 5 + Math.floor(Math.random() * 5); 
    }
  });

  const processTeam = (team: LivePlayer[], win: boolean) => {
    team.forEach(player => {
      const hero = heroes.find(h => h.id === player.heroId);
      // UserProfileì— promoStatus íƒ€ì…ì´ ì •ì˜ë˜ì–´ ìˆë‹¤ê³  ê°€ì • (types/index.ts ì—…ë°ì´íŠ¸ í•„ìˆ˜)
      const user = userPool.find(u => u.name === player.name) as any;

      // 1. ì˜ì›… í†µê³„ ê°±ì‹ 
      if (hero) {
        hero.record.totalMatches++; hero.record.totalPicks++; 
        if (win) hero.record.totalWins++;
        hero.record.totalKills += player.kills; 
        hero.record.totalDeaths += player.deaths; 
        hero.record.totalAssists += player.assists; 

        const itemsValue = player.items.reduce((sum, item) => sum + item.cost, 0);
        hero.record.totalGold += (player.gold + itemsValue);
        hero.record.totalDamage += player.totalDamageDealt; 
        hero.record.totalCs += player.cs;
        hero.record.recentResults.push(win); 
        if (hero.record.recentResults.length > 50) hero.record.recentResults.shift();
      }

      // 2. ìœ ì € ì ìˆ˜ ë° ìŠ¹ê¸‰ì „ ì²˜ë¦¬
      if (user) {
        user.wins += win ? 1 : 0; 
        user.losses += win ? 0 : 1;

        let lpChange = win ? 25 : -20;
        let kdaStr = `${player.kills}/${player.deaths}/${player.assists}`;
        let historyMsg = win ? 'WIN' : 'LOSE';

        // --- [A] ìŠ¹ê¸‰ì „ ì§„í–‰ ì¤‘ì¼ ë•Œ ---
        if (user.promoStatus) {
            lpChange = 0; // ì ìˆ˜ ë³€ë™ ì—†ìŒ

            if (win) {
                user.promoStatus.wins++;
                historyMsg = 'PROMO WIN';
                // ìŠ¹ê¸‰ ì„±ê³µ ì¡°ê±´ (ëª©í‘œ ìŠ¹ìˆ˜ ë‹¬ì„±)
                if (user.promoStatus.wins >= user.promoStatus.targetWins) {
                    const nextTier = getNextTierInfo(user.score, tierConfig);
                    if (nextTier) {
                        user.score = nextTier.cut + 50; // ìŠ¹ê¸‰ ë³´ë„ˆìŠ¤ ì ìˆ˜
                        historyMsg = `ğŸ‰ ìŠ¹ê¸‰! (${nextTier.name})`;
                    }
                    user.promoStatus = null; // ìŠ¹ê¸‰ì „ ì¢…ë£Œ
                }
            } else {
                user.promoStatus.losses++;
                historyMsg = 'PROMO LOSS';

                // íƒˆë½ ì¡°ê±´: (ì´ íŒìˆ˜ - ëª©í‘œ ìŠ¹ìˆ˜ + 1)ë²ˆ íŒ¨ë°° ì‹œ íƒˆë½
                // ì˜ˆ: 5ì „ 3ì„ ìŠ¹ì œ(ì´ 5, ëª©í‘œ 3) -> 3íŒ¨ ì‹œ íƒˆë½
                const totalGames = user.promoStatus.targetWins * 2 - 1;
                const maxLosses = totalGames - user.promoStatus.targetWins + 1;

                if (user.promoStatus.losses >= maxLosses) {
                    user.score -= 40; // ìŠ¹ê¸‰ ì‹¤íŒ¨ íŒ¨ë„í‹°
                    historyMsg = 'âŒ ìŠ¹ê¸‰ ì‹¤íŒ¨';
                    user.promoStatus = null;
                }
            }
        } 
        // --- [B] ì¼ë°˜ ë§¤ì¹˜ì¼ ë•Œ ---
        else {
            const oldScore = user.score;
            user.score = Math.max(0, user.score + lpChange);

            // ë‹¤ìŒ í‹°ì–´ ì»¤íŠ¸ë¼ì¸ ë‹¬ì„± ì‹œ ìŠ¹ê¸‰ì „ ë°œë™
            const nextTier = getNextTierInfo(oldScore, tierConfig);
            if (nextTier && user.score >= nextTier.cut) {
                user.score = nextTier.cut - 1; // ì ìˆ˜ ì ê¸ˆ

                // í‹°ì–´ë³„ ì„¤ì •ëœ ìŠ¹ê¸‰ì „ íŒìˆ˜ ì ìš© (ê¸°ë³¸ê°’ 3)
                // keyê°€ ì—†ê±°ë‚˜ ë§¤ì¹­ë˜ì§€ ì•Šìœ¼ë©´ 3ì „ 2ì„ ìŠ¹
                const promoMatches = tierConfig.promos ? (tierConfig.promos[nextTier.key as keyof typeof tierConfig.promos] || 3) : 3;
                const targetWins = Math.ceil(promoMatches / 2);

                user.promoStatus = {
                    targetTier: nextTier.name,
                    wins: 0,
                    losses: 0,
                    targetWins: targetWins
                };
                historyMsg = `ğŸ”¥ ${nextTier.name} ìŠ¹ê¸‰ì „! (${promoMatches}ì „)`;
            }
        }

        user.history.unshift({ 
          season: 1, 
          result: historyMsg as any, 
          heroName: hero?.name || '?', 
          kda: kdaStr, 
          lpChange: lpChange, 
          date: `Day ${day} ${hour}:00` 
        });
        if (user.history.length > 20) user.history.pop();

        // ëª¨ìŠ¤íŠ¸ ì±”í”¼ì–¸ í†µê³„ ê°±ì‹ 
        if (!user.heroStats[player.heroId]) user.heroStats[player.heroId] = { matches:0, wins:0, kills:0, deaths:0, assists:0 };
        const st = user.heroStats[player.heroId];
        st.matches++; if(win) st.wins++; st.kills+=player.kills; st.deaths+=player.deaths; st.assists+=player.assists;
      }
    });
  };

  processTeam(match.blueTeam, isBlueWin);
  processTeam(match.redTeam, !isBlueWin);

  return { isBlueWin, blueKills, redKills, duration: match.currentDuration };
}

// === FILE: /src/engine/match/MatchUpdater.ts ===

// ==========================================
// FILE PATH: /src/engine/match/MatchUpdater.ts
// ==========================================

import { Hero, LiveMatch } from '../../types';
import { useGameStore } from '../../store/useGameStore';
import { applyColossusReward, applyWatcherReward, processSiegeUnit } from './ObjectiveSystem';
import { attemptBuyItem } from './ItemManager';
import { processCombatPhase } from './phases/CombatPhase';
import { processSiegePhase } from './phases/SiegePhase';
import { processGrowthPhase } from './phases/GrowthPhase';
import { JUNGLE_CONFIG } from '../../data/jungle';

export function updateLiveMatches(matches: LiveMatch[], heroes: Hero[], timeSteps: number): LiveMatch[] {
  const state = useGameStore.getState();
  if (!state || !state.gameState) return matches;

  const fieldSettings = state.gameState.fieldSettings || { tower: { hp: 3000, armor: 50, rewardGold: 80 }, colossus: { hp: 8000, armor: 80, rewardGold: 100, attack: 50 }, watcher: { hp: 12000, armor: 120, rewardGold: 150, buffType: 'COMBAT', buffAmount: 20, buffDuration: 180 }, jungle: JUNGLE_CONFIG.DEFAULT_SETTINGS };
  const battleSettings = state.gameState.battleSettings;
  const roleSettings = state.gameState.roleSettings;
  const shopItems = state.shopItems || []; 

  const watcherBuffType = fieldSettings.watcher?.buffType || 'COMBAT';
  const watcherBuffAmount = (fieldSettings.watcher?.buffAmount || 20) / 100;

  return matches.map(match => {
    // ì¢…ë£Œ ì¡°ê±´ ì²´í¬
    if (match.stats.blue.nexusHp <= 0 || match.stats.red.nexusHp <= 0) {
        match.duration = match.currentDuration; 
        return match;
    }
    if (match.currentDuration >= 3600) {
        if (match.score.blue > match.score.red) match.stats.red.nexusHp = 0;
        else match.stats.blue.nexusHp = 0;
        return match;
    }

    try {
        for (let i = 0; i < timeSteps; i++) {
            if (match.stats.blue.nexusHp <= 0 || match.stats.red.nexusHp <= 0) break;
            match.currentDuration += 1;

            // [ê±°ì‹ ë³‘ ê³µì„± íš¨ê³¼ ì²˜ë¦¬]
            processSiegeUnit(match);

            // [ì£¼ì‹œì ë²„í”„ ë§Œë£Œ ì²´í¬]
            ['blue', 'red'].forEach((side) => {
                const s = (match.stats as any)[side];
                if (s.activeBuffs.voidPower && match.currentDuration > s.activeBuffs.voidBuffEndTime) {
                    s.activeBuffs.voidPower = false;
                    const team = side === 'blue' ? match.blueTeam : match.redTeam;
                    team.forEach((p: any) => p.buffs = p.buffs.filter((b: string) => b !== 'VOID'));
                }
            });

            // [ì•„ì´í…œ êµ¬ë§¤] (30ì´ˆë§ˆë‹¤)
            if (match.currentDuration % 30 === 0) {
                [...match.blueTeam, ...match.redTeam].forEach(p => {
                    attemptBuyItem(p, shopItems, heroes);
                });
            }

            // [ì „íˆ¬/ê³µì„±/ì„±ì¥ í˜ì´ì¦ˆ]
            processCombatPhase(match, heroes, battleSettings, roleSettings, watcherBuffType, watcherBuffAmount);

            // [ìˆ˜ì •: í•˜ìˆ˜ì¸ ìŠ¤í™ ë°˜ì˜ì„ ìœ„í•´ battleSettings ì „ë‹¬]
            processSiegePhase(match, heroes, fieldSettings, roleSettings, battleSettings);

            processGrowthPhase(match, battleSettings, heroes);

            // [ì‹ ê·œ] 1. ê±°ì‹ ë³‘ ìŠ¤í° ë¡œì§ (íƒ€ì´ë¨¸ ê¸°ë°˜)
            if (match.currentDuration >= match.nextColossusSpawnTime) {
              // ì   ì‹œê°„ì´ ë˜ì—ˆìœ¼ë¯€ë¡œ êµì „ ë°œìƒ í™•ë¥  ì¦ê°€ (0.0005 -> 0.005, ì•½ 10ë°°)
              // ì¦‰, ì   ë˜ìë§ˆì ë°”ë¡œ ë¨¹íˆì§„ ì•Šê³  ëˆˆì¹˜ ì‹¸ì›€í•˜ë‹¤ê°€ ê°€ì ¸ê°
              if (Math.random() < 0.005) {
                const blueJunglerAlive = match.blueTeam.some(p => heroes.find(h=>h.id===p.heroId)?.role === 'ì¶”ì ì' && p.currentHp > 0);
                const redJunglerAlive = match.redTeam.some(p => heroes.find(h=>h.id===p.heroId)?.role === 'ì¶”ì ì' && p.currentHp > 0);

                let blueChance = 0.5;
                const smiteBonus = (roleSettings.tracker.smiteChance - 1.0) / 2; 
                if (blueJunglerAlive && !redJunglerAlive) blueChance = 0.5 + smiteBonus;
                if (!blueJunglerAlive && redJunglerAlive) blueChance = 0.5 - smiteBonus;

                const isBlueObj = Math.random() < blueChance;
                (isBlueObj ? match.blueTeam : match.redTeam).forEach(p => p.gold += fieldSettings.colossus.rewardGold);

                if(isBlueObj) { match.stats.blue.colossus++; applyColossusReward(match, true); }
                else { match.stats.red.colossus++; applyColossusReward(match, false); }

                // [ì¤‘ìš”] ë‹¤ìŒ ìŠ¤í° ì‹œê°„ ì„¤ì • (5ë¶„ í›„ ë¦¬ì  )
                match.nextColossusSpawnTime = match.currentDuration + 300; 
              }
            }

            // [ì‹ ê·œ] 2. ì£¼ì‹œì ìŠ¤í° ë¡œì§ (íƒ€ì´ë¨¸ ê¸°ë°˜)
            if (match.currentDuration >= match.nextWatcherSpawnTime) {
              if (Math.random() < 0.003) { 
                const isBlueObj = Math.random() < 0.5; 
                (isBlueObj ? match.blueTeam : match.redTeam).forEach(p => p.gold += fieldSettings.watcher.rewardGold);

                if(isBlueObj) { match.stats.blue.watcher++; match.stats.blue.fury++; applyWatcherReward(match, true); }
                else { match.stats.red.watcher++; match.stats.red.fury++; applyWatcherReward(match, false); }

                // [ì¤‘ìš”] ë‹¤ìŒ ìŠ¤í° ì‹œê°„ ì„¤ì • (7ë¶„ í›„ ë¦¬ì   - ì£¼ì‹œìëŠ” ë” ëŠ¦ê²Œ ëœ¸)
                match.nextWatcherSpawnTime = match.currentDuration + 420;
              }
            }
        }
    } catch (error) {
        console.warn("Sim Error:", error);
        match.currentDuration += timeSteps; 
    }

    return match;
  });
}

// === FILE: /src/engine/match/ObjectiveSystem.ts ===

// ==========================================
// FILE PATH: /src/engine/match/ObjectiveSystem.ts
// ==========================================

import { LiveMatch } from '../../types';
import { useGameStore } from '../../store/useGameStore';

/**
 * ê±°ì‹ ë³‘ ì²˜ì¹˜ íš¨ê³¼
 */
export function applyColossusReward(match: LiveMatch, isBlueTeam: boolean) {
  const teamName = isBlueTeam ? 'ë‹¨í…Œ' : 'ì´ì¦ˆë§ˆí•œ';
  const teamColor = isBlueTeam ? 'BLUE' : 'RED';
  const stats = isBlueTeam ? match.stats.blue : match.stats.red;

  stats.activeBuffs.siegeUnit = true;

  match.logs.push({
    time: match.currentDuration,
    message: `ğŸ¤– ${teamName} ì§„ì˜ì´ ê±°ì‹ ë³‘ì„ í•´í‚¹í•˜ì—¬ ì•„êµ°ìœ¼ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤!`,
    type: 'COLOSSUS',
    team: teamColor
  });
}

/**
 * ê±°ì‹ ë³‘ ê³µì„± ë¡œì§ (ì„¤ì •ëœ ê³µê²©ë ¥ ë°˜ì˜)
 */
export function processSiegeUnit(match: LiveMatch) {
  // [ì¶”ê°€] ì„¤ì •ê°’ ê°€ì ¸ì˜¤ê¸°
  const settings = useGameStore.getState().gameState.fieldSettings;
  // ì„¤ì •ëœ ê³µê²©ë ¥ (ê¸°ë³¸ê°’ 50)
  const attackPower = settings?.colossus?.attack || 50;

  // ê³µê²©ë ¥ì— ë”°ë¥¸ íŒŒê´´ í™•ë¥  ê³„ì‚° (ê³µê²©ë ¥ 100ì´ë©´ 10% í™•ë¥ )
  const destroyChance = attackPower / 1000; 

  const processTeamSiege = (isBlueAttacker: boolean) => {
    const attackerStats = isBlueAttacker ? match.stats.blue : match.stats.red;
    const defenderStats = isBlueAttacker ? match.stats.red : match.stats.blue;
    const attackerColor = isBlueAttacker ? 'BLUE' : 'RED';

    if (attackerStats.activeBuffs.siegeUnit) {
      if (Math.random() < destroyChance) {
        const lanes = ['top', 'mid', 'bot'] as const;
        const validLanes = lanes.filter(l => defenderStats.towers[l] < 3);

        if (validLanes.length > 0) {
          const lane = validLanes[Math.floor(Math.random() * validLanes.length)];
          defenderStats.towers[lane]++;
          const tier = defenderStats.towers[lane];
          const laneName = lane === 'top' ? 'íƒ‘' : lane === 'mid' ? 'ë¯¸ë“œ' : 'ë°”í…€';

          attackerStats.activeBuffs.siegeUnit = false; 

          match.logs.push({
            time: match.currentDuration,
            message: `ğŸ’¥ ê±°ì‹ ë³‘(ê³µê²©ë ¥ ${attackPower})ì´ ${laneName} ${tier}ì°¨ í¬íƒ‘ì„ ë°•ì‚´ëƒˆìŠµë‹ˆë‹¤!`,
            type: 'TOWER',
            team: attackerColor
          });
        } else {
          attackerStats.activeBuffs.siegeUnit = false;
        }
      }
    }
  };

  processTeamSiege(true);
  processTeamSiege(false);
}

/**
 * ì£¼ì‹œì ì²˜ì¹˜ íš¨ê³¼ (ì„¤ì •ëœ ë²„í”„/ì§€ì†ì‹œê°„ ë°˜ì˜)
 */
export function applyWatcherReward(match: LiveMatch, isBlueTeam: boolean) {
  const settings = useGameStore.getState().gameState.fieldSettings;
  const teamName = isBlueTeam ? 'ë‹¨í…Œ' : 'ì´ì¦ˆë§ˆí•œ';
  const teamColor = isBlueTeam ? 'BLUE' : 'RED';
  const stats = isBlueTeam ? match.stats.blue : match.stats.red;

  // ì„¤ì •ê°’ ì ìš©
  const buffDuration = settings?.watcher?.buffDuration || 180;
  const buffType = settings?.watcher?.buffType || 'COMBAT';

  stats.activeBuffs.voidPower = true;
  // [ì¶”ê°€] ë²„í”„ ì¢…ë£Œ ì‹œê°„ ì„¤ì • (í˜„ì¬ì‹œê°„ + ì§€ì†ì‹œê°„)
  stats.activeBuffs.voidBuffEndTime = match.currentDuration + buffDuration;

  const team = isBlueTeam ? match.blueTeam : match.redTeam;
  team.forEach(p => {
    if (!p.buffs) p.buffs = [];
    if (!p.buffs.includes('VOID')) p.buffs.push('VOID');
  });

  const buffName = buffType === 'COMBAT' ? 'ì „íˆ¬ë ¥' : 'ê³¨ë“œ íšë“ëŸ‰';

  match.logs.push({
    time: match.currentDuration,
    message: `ğŸ‘ï¸ ${teamName} ì§„ì˜ì´ ê³µí—ˆì˜ í˜(${buffName} ì¦ê°€)ì„ ${buffDuration}ì´ˆê°„ í¡ìˆ˜í–ˆìŠµë‹ˆë‹¤!`,
    type: 'WATCHER',
    team: teamColor
  });
}

// === FILE: /src/engine/match/RoleManager.ts ===

// ==========================================
// FILE PATH: /src/engine/match/RoleManager.ts
// ==========================================

import { Role, LivePlayer, RoleSettings } from '../../types';

// ê¸°ë³¸ê°’ (ì„¤ì • ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì•ˆì „ì¥ì¹˜)
const DEFAULT_SETTINGS: RoleSettings = {
  executor: { damage: 15, defense: 15 },
  tracker: { gold: 20, smiteChance: 1.5 },
  prophet: { cdrPerLevel: 2 },
  slayer: { structureDamage: 30 },
  guardian: { survivalRate: 20 }
};

export const applyRoleBonus = (
  player: LivePlayer, 
  role: Role, 
  isSiegeMode: boolean, 
  allies: LivePlayer[],
  settings: RoleSettings = DEFAULT_SETTINGS // [ì¤‘ìš”] ì„¤ì •ê°’ ì¸ì ì¶”ê°€
) => {
  let damageMod = 1.0;
  let defenseMod = 1.0;
  let siegeMod = 1.0;

  switch (role) {
    case 'ì§‘í–‰ê´€': 
      // ê³ ë¦½ ì‹œ ë³´ë„ˆìŠ¤ (ì„¤ì •ëœ %ë§Œí¼ ì¦ê°€)
      const nearbyAllies = allies.filter(a => a.lane === player.lane && a.heroId !== player.heroId).length;
      if (nearbyAllies === 0) {
        damageMod = 1 + (settings.executor.damage / 100); 
        defenseMod = 1 + (settings.executor.defense / 100);
      }
      break;

    case 'ì¶”ì ì': 
      // ì •ê¸€ëŸ¬ ê¸°ë³¸ ë³´ì •
      damageMod = 1.05; 
      break;

    case 'ì„ ì§€ì': 
      // ë ˆë²¨ë‹¹ ì„¤ì •ëœ %ë§Œí¼ ë°ë¯¸ì§€ ë³´ë„ˆìŠ¤ (ì¿¨ê°ì„ ë”œëŸ‰ìœ¼ë¡œ í™˜ì‚°)
      // ì˜ˆ: ë ˆë²¨ 10 * 2% = 20% ë°ë¯¸ì§€ ì¦ê°€
      damageMod = 1 + ((player.level * settings.prophet.cdrPerLevel) / 100);
      break;

    case 'ì‹ ì‚´ì': 
      if (isSiegeMode) {
        // êµ¬ì¡°ë¬¼ í”¼í•´ëŸ‰ ë³´ë„ˆìŠ¤
        siegeMod = 1 + (settings.slayer.structureDamage / 100);
      }
      if (player.items.length >= 3) {
        damageMod = 1.25;
      }
      break;

    case 'ìˆ˜í˜¸ê¸°ì‚¬': 
      // ë°©ì–´ë ¥ ë³´ë„ˆìŠ¤
      defenseMod = 1.3; 
      damageMod = 0.6;  
      break;
  }

  return { damageMod, defenseMod, siegeMod };
};

// ì •ê¸€ëŸ¬ ê°•íƒ€ í™•ë¥  ë³´ì •
export const getSmiteChance = (role: Role, settings: RoleSettings = DEFAULT_SETTINGS) => {
  return role === 'ì¶”ì ì' ? settings.tracker.smiteChance : 1.0; 
};

// === FILE: /src/engine/match/calculators/PowerCalculator.ts ===

// ==========================================
// FILE PATH: /src/engine/match/calculators/PowerCalculator.ts
// ==========================================

import { Hero, LivePlayer, SkillDetail, RoleSettings } from '../../../types';
import { calculateTotalStats } from '../ItemManager';
import { applyRoleBonus } from '../RoleManager';

// ìŠ¤í‚¬ ìœ„ë ¥ ê³„ì‚°
const getSkillScore = (skill: SkillDetail, ad: number, ap: number) => {
  let power = skill.val + (skill.adRatio * ad) + (skill.apRatio * ap);

  if (skill.mechanic === 'STUN' || skill.mechanic === 'HOOK') power *= 1.3;
  if (skill.mechanic === 'EXECUTE') power *= 1.4;
  if (skill.mechanic === 'HEAL' || skill.mechanic === 'SHIELD') power *= 1.2;
  if (skill.mechanic === 'GLOBAL') power *= 1.5; 

  const cdrMod = 10 / Math.max(1, skill.cd);
  return power * Math.sqrt(cdrMod); 
};

// ì˜ì›… ì „íˆ¬ë ¥ ê³„ì‚°
export const calculateHeroPower = (
  heroId: string, 
  heroes: Hero[], 
  player: LivePlayer, 
  isSiege: boolean, 
  allies: LivePlayer[],
  roleSettings: RoleSettings // [ì‹ ê·œ] ì„¤ì •ê°’ ì¸ì
) => {
  const hero = heroes.find(h => h.id === heroId);
  if (!hero) return 1000;

  // [ìˆ˜ì •] RoleManagerì— ì„¤ì •ê°’ ì „ë‹¬
  const { damageMod, defenseMod } = applyRoleBonus(player, hero.role, isSiege, allies, roleSettings);

  const s = calculateTotalStats(hero, player.items);

  const defensivePower = s.hp * (1 + (s.armor * defenseMod) / 100);
  const autoAttackDPS = (s.baseAtk + s.ad) * (s.speed / 100) * (1 + s.crit / 100) * damageMod;

  let baseStatsScore = (defensivePower / 10) + (autoAttackDPS * 5);

  const skillScore = 
    (getSkillScore(hero.skills.q, s.ad, s.ap) +
    getSkillScore(hero.skills.w, s.ad, s.ap) +
    getSkillScore(hero.skills.e, s.ad, s.ap) +
    (getSkillScore(hero.skills.r, s.ad, s.ap) * 1.5)) * damageMod;

  const skillMultiplier = 0.8 + (player.mmr / 10000); 

  return (baseStatsScore + skillScore) * skillMultiplier;
};

// === FILE: /src/engine/match/phases/CombatPhase.ts ===

// ==========================================
// FILE PATH: /src/engine/match/phases/CombatPhase.ts
// ==========================================

import { LiveMatch, Hero, BattleSettings, RoleSettings } from '../../../types';
import { calculateHeroPower } from '../calculators/PowerCalculator';

export const processCombatPhase = (
  match: LiveMatch, 
  heroes: Hero[], 
  settings: BattleSettings,
  roleSettings: RoleSettings,
  watcherBuffType: string,
  watcherBuffAmount: number
) => {
  // [ìˆ˜ì •] ê¸°ë³¸ êµì „ í™•ë¥  ê°ì†Œ (0.015 -> 0.008)
  // ì´ˆë‹¹ 0.8% í™•ë¥  -> ë¶„ë‹¹ ì•½ 0.5íšŒ í•œíƒ€ ë°œìƒ (ê²Œì„ ì „ì²´ 15~20í‚¬ ì •ë„)
  let fightChance = 0.008 + (match.currentDuration / 3600) * 0.02;
  if (match.stats.blue.activeBuffs?.voidPower || match.stats.red.activeBuffs?.voidPower) fightChance *= 1.5; 

  if (Math.random() >= fightChance) return; 
  if (match.blueTeam.length === 0 || match.redTeam.length === 0) return;

  const blueHeroPlayer = match.blueTeam[Math.floor(Math.random() * match.blueTeam.length)];
  const redHeroPlayer = match.redTeam[Math.floor(Math.random() * match.redTeam.length)];

  if (!blueHeroPlayer || !redHeroPlayer) return;

  const bluePower = calculateHeroPower(blueHeroPlayer.heroId, heroes, blueHeroPlayer, false, match.blueTeam, roleSettings);
  const redPower = calculateHeroPower(redHeroPlayer.heroId, heroes, redHeroPlayer, false, match.redTeam, roleSettings);

  const totalPower = bluePower + redPower;
  if (totalPower === 0) return;

  let blueWinChance = bluePower / totalPower; 

  if (watcherBuffType === 'COMBAT') {
      if (match.stats.blue.activeBuffs?.voidPower) blueWinChance += watcherBuffAmount;
      if (match.stats.red.activeBuffs?.voidPower) blueWinChance -= watcherBuffAmount;
  }

  const isBlueKill = Math.random() < blueWinChance;
  const winners = isBlueKill ? match.blueTeam : match.redTeam;
  const killer = isBlueKill ? blueHeroPlayer : redHeroPlayer;
  const victim = isBlueKill ? redHeroPlayer : blueHeroPlayer;

  let killGold = 300;
  if (watcherBuffType === 'GOLD' && (isBlueKill ? match.stats.blue.activeBuffs.voidPower : match.stats.red.activeBuffs.voidPower)) {
      killGold += (300 * watcherBuffAmount);
  }

  killer.kills++; 
  killer.gold += killGold; 
  victim.deaths++;

  // [ìœ ì§€] í‚¬ ë”œëŸ‰: ì²´ë ¥ì˜ 70% ì •ë„ ê¸°ì—¬
  const damageContribution = victim.maxHp * (0.7 + Math.random() * 0.2); 
  killer.totalDamageDealt += Math.floor(damageContribution);

  const assisters = winners.filter(p => p !== killer && Math.random() < 0.4);
  assisters.forEach(a => { 
      a.assists++; 
      a.gold += (killGold / 2); 
      const assistDamage = victim.maxHp * (0.1 + Math.random() * 0.1);
      a.totalDamageDealt += Math.floor(assistDamage);
  });

  if (isBlueKill) match.score.blue++; else match.score.red++;

  const getHeroName = (id: string) => heroes.find(h => h.id === id)?.name || 'Unknown';

  match.logs.push({
    time: match.currentDuration, 
    message: `${getHeroName(killer.heroId)}ë‹˜ì´ ${getHeroName(victim.heroId)} ì²˜ì¹˜!`, 
    type: 'KILL', 
    team: isBlueKill ? 'BLUE' : 'RED'
  });
};

// === FILE: /src/engine/match/phases/GrowthPhase.ts ===

// ==========================================
// FILE PATH: /src/engine/match/phases/GrowthPhase.ts
// ==========================================

import { LiveMatch, BattleSettings, Hero } from '../../../types';
import { useGameStore } from '../../../store/useGameStore';
import { calculateTotalStats } from '../ItemManager';
import { JUNGLE_CONFIG } from '../../../data/jungle';

export const processGrowthPhase = (
  match: LiveMatch, 
  battleSettings: BattleSettings,
  heroes: Hero[]
) => {
  const allPlayers = [...match.blueTeam, ...match.redTeam];
  if (allPlayers.length === 0) return;

  const state = useGameStore.getState();
  const jungleRaw = state.gameState.fieldSettings?.jungle;

  // ì •ê¸€ ì„¤ì •ê°’ ë¡œë“œ
  const jungleSettings = {
    density: jungleRaw?.density ?? 50,
    yield: jungleRaw?.yield ?? 50,
    attack: jungleRaw?.attack ?? 30,
    defense: jungleRaw?.defense ?? 20
  };

  // ì„¤ì •ì— ë”°ë¥¸ ë³´ì •ì¹˜ ê³„ì‚°
  const densityMod = 0.5 + (jungleSettings.density / 100);
  const yieldMod = 0.5 + (jungleSettings.yield / 100);
  const attackMod = 0.5 + (jungleSettings.attack / 50); 
  const defenseMod = 1.0 + (jungleSettings.defense / 200);

  allPlayers.forEach(p => {
    // 0. ê¸°ë³¸ ê³¨ë“œ ìˆ˜ê¸‰ (ì´ˆë‹¹ 1ê³¨ë“œ)
    p.gold += 1;

    if (!p.heroId) return;
    const heroData = heroes.find(h => h.id === p.heroId);
    if (!heroData) return;

    // [ì‹ ê·œ] 1. ì „ìˆ ì  ê·€í™˜ (Recall) ë¡œì§
    // ì²´ë ¥ì´ 30% ë¯¸ë§Œì´ê³ , í˜„ì¬ ì‚´ì•„ìˆë‹¤ë©´ ì§‘ì— ê°
    if (p.currentHp > 0 && (p.currentHp / p.maxHp) < 0.3) {
      // ì„±ì¥(CS/ê²½í—˜ì¹˜)ì„ í¬ê¸°í•˜ê³  ì²´ë ¥ íšŒë³µ
      p.currentHp = p.maxHp;
      return; // ì´ë²ˆ í‹± ì¢…ë£Œ (íŒŒë° ë¶ˆê°€)
    }

    const enemyMinions = p.lane === 'JUNGLE' 
      ? null 
      : (match.blueTeam.includes(p) ? battleSettings.izman.minions : battleSettings.dante.minions);

    // [2] ì •ê¸€ëŸ¬ ë¡œì§
    if (p.lane === 'JUNGLE' || !enemyMinions) {
        // ì •ê¸€ëª¹ ì¡°ìš° í™•ë¥ 
        const spawnChance = (JUNGLE_CONFIG.BASE_SPAWN_RATE * densityMod) / defenseMod;

        if (Math.random() < spawnChance) {
            // ë°ë¯¸ì§€ ê³„ì‚° (ë ˆë²¨ ë¹„ë¡€ ë°©ì–´)
            const heroDefenseFactor = 1 + (p.level * 0.1); 
            const damageTaken = (JUNGLE_CONFIG.BASE_DAMAGE_TAKEN * attackMod) / heroDefenseFactor;

            // ì²´ë ¥ ê°ì†Œ
            p.currentHp -= damageTaken;

            // [ì‹ ê·œ] 2. ì •ê¸€ ì²˜í˜• (Execution) ë¡œì§
            if (p.currentHp <= 0) {
              p.currentHp = p.maxHp; // ë¶€í™œ (ë¦¬ìŠ¤í° ëŒ€ê¸°ì‹œê°„ì€ ì‹œë®¬ë ˆì´ì…˜ ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ ìƒëµí•˜ë˜ í„´ ë‚ ë¦¼)
              p.deaths += 1; // ë°ìŠ¤ ì¶”ê°€

              // ì²˜í˜• ë¡œê·¸ ê¸°ë¡ (ë„ˆë¬´ ìì£¼ ëœ¨ë©´ ë„ë°°ë˜ë¯€ë¡œ í™•ë¥ ì ìœ¼ë¡œ ê¸°ë¡í•˜ê±°ë‚˜, ì¤‘ìš” ì´ë²¤íŠ¸ë¡œ ì²˜ë¦¬)
              if (Math.random() < 0.3) {
                match.logs.push({
                  time: match.currentDuration,
                  message: `ğŸ’€ ${p.name}ë‹˜ì´ ì •ê¸€ ëª¬ìŠ¤í„°ì—ê²Œ ì²˜í˜•ë‹¹í–ˆìŠµë‹ˆë‹¤.`,
                  type: 'KILL' // í‚¬ ë¡œê·¸ë¡œ ì²˜ë¦¬í•˜ì—¬ ëˆˆì— ë„ê²Œ í•¨
                });
              }
              return; // ì£½ì—ˆìœ¼ë¯€ë¡œ ë³´ìƒ íšë“ ë¶ˆê°€
            }

            // ìƒì¡´ ì‹œ ë³´ìƒ íšë“
            p.cs++;
            p.gold += Math.floor(JUNGLE_CONFIG.BASE_GOLD * yieldMod);

            // ê²½í—˜ì¹˜ íšë“ ë° ë ˆë²¨ì—…
            if (p.cs % JUNGLE_CONFIG.BASE_XP_INTERVAL === 0) {
              p.level = Math.min(18, p.level + 1);
              // ë ˆë²¨ì—… ì‹œ ì²´ë ¥/ìŠ¤íƒ¯ ìƒìŠ¹ íš¨ê³¼ (ê°„ëµí™”: ì²´ë ¥ íšŒë³µ)
              p.currentHp = Math.min(p.maxHp, p.currentHp + 100);
            }

            // ì •ê¸€ë§ ì¤‘ ì†ŒëŸ‰ì˜ ì²´ë ¥ íšŒë³µ (ê¸°ë³¸ ìœ ì§€ë ¥)
            const sustain = JUNGLE_CONFIG.BASE_REGEN; 
            p.currentHp = Math.min(p.maxHp, p.currentHp + sustain);
        }
        return;
    }

    // [3] ë¼ì´ë„ˆ(Laner) ë¡œì§ - ë¼ì¸ì „
    const currentStats = calculateTotalStats(heroData, p.items);

    // CS ë¨¹ì„ í™•ë¥  ê³„ì‚°
    const farmingPower = (currentStats.ad * (currentStats.speed / 500)) + (currentStats.ap * 0.3);
    const rand = Math.random();
    let targetMinion = enemyMinions.melee;
    if (rand > 0.8) targetMinion = enemyMinions.siege;
    else if (rand > 0.4) targetMinion = enemyMinions.ranged;

    const minionDurability = targetMinion.hp + (targetMinion.def * 2);
    const difficultyFactor = Math.max(1, minionDurability / 50); 
    const efficiency = farmingPower / difficultyFactor;

    let csChance = 0.11 * efficiency; 
    csChance += (p.level * 0.002);
    csChance = Math.max(0.08, Math.min(0.16, csChance));

    // CS íšë“ ì‹œë„
    if (Math.random() < csChance) {
        p.cs++;
        p.gold += targetMinion.gold;
        if (p.cs % 15 === 0) p.level = Math.min(18, p.level + 1);

        // ë¯¸ë‹ˆì–¸ ì²˜ì¹˜ ì‹œ ì†ŒëŸ‰ íšŒë³µ (í¡í˜ˆ ë“± ì¶”ìƒí™”)
        p.currentHp = Math.min(p.maxHp, p.currentHp + 8);
    }

    // ë¼ì¸ì „ ë”œêµí™˜ (Poking)
    // ë”œêµí™˜ìœ¼ë¡œ ì²´ë ¥ì´ ê¹ì´ë©´ ë‹¤ìŒ í‹±ì— 'ì „ìˆ ì  ê·€í™˜' ë¡œì§ì´ ë°œë™ë¨
    if (Math.random() < 0.04) {
        let pokeDamage = (p.level * 20) + (currentStats.ad * 0.5) + (currentStats.ap * 0.4);
        if (heroData.stats && heroData.stats.range > 300) pokeDamage *= 1.2;

        // ë”œêµí™˜ ë°ë¯¸ì§€ ëˆ„ì  (ìƒëŒ€ë°© HP ê°ì†ŒëŠ” CombatPhase ë“±ì—ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜ ì—¬ê¸°ì„œ ê°„ëµí™”)
        // ì—¬ê¸°ì„œëŠ” 'ë‚´ê°€ ë”œì„ ë„£ì—ˆë‹¤'ëŠ” ê¸°ë¡ë§Œ ë‚¨ê¹€. 
        // ì‹¤ì œ ìƒëŒ€ HP ê°ì†ŒëŠ” ë³µì¡ë„ë¥¼ ë‚®ì¶”ê¸° ìœ„í•´ CombatPhaseì˜ í™•ë¥ ì  í‚¬ì´ë‚˜ 
        // ë³„ë„ì˜ Poke ë¡œì§ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìœ¼ë‚˜, 
        // ê°„ë‹¨íˆ p.currentHpê°€ ê¹ì´ëŠ” ê²ƒì€ 'ìƒëŒ€ ë¯¸ë‹ˆì–¸/íƒ€ì›Œ/ì±”í”¼ì–¸'ì—ê²Œ ë§ì€ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ì•„ë˜ ì¶”ê°€

        p.totalDamageDealt += Math.floor(pokeDamage);

        // ìƒëŒ€ì—ê²Œ ë§ìŒ (ëœë¤ ë°ë¯¸ì§€)
        p.currentHp -= (10 + p.level * 2);
    }
  });
};

// === FILE: /src/engine/match/phases/SiegePhase.ts ===

// ==========================================
// FILE PATH: /src/engine/match/phases/SiegePhase.ts
// ==========================================

import { LiveMatch, Hero, RoleSettings, BattleSettings } from '../../../types';

export const processSiegePhase = (
  match: LiveMatch, 
  heroes: Hero[], 
  rewards: any,
  roleSettings: RoleSettings,
  battleSettings?: BattleSettings // [ì‹ ê·œ] í•˜ìˆ˜ì¸ ìŠ¤í™ ì°¸ì¡°ìš©
) => {
  // [ê¸°ë³¸ í™•ë¥ ] ì‹œê°„ ë¹„ë¡€
  let pushChance = 0.001 + (match.currentDuration / 3600) * 0.01; 

  // [ì‹ ê·œ] í•˜ìˆ˜ì¸ ê³µê²©ë ¥ ë°˜ì˜ (ê°•í•œ ë¯¸ë‹ˆì–¸ì¼ìˆ˜ë¡ ë¼ì¸ì„ ì˜ ë°ˆ)
  if (battleSettings) {
    // ì–‘ íŒ€ ë¯¸ë‹ˆì–¸ì˜ í‰ê·  ê³µê²©ë ¥ ê³„ì‚° (ì›ê±°ë¦¬/ê·¼ê±°ë¦¬/ê³µì„± í‰ê· )
    const getAvgMinionAtk = (teamSettings: any) => {
      const m = teamSettings.minions;
      return (m.melee.atk + m.ranged.atk + m.siege.atk) / 3;
    };

    const blueMinionPower = getAvgMinionAtk(battleSettings.dante);
    const redMinionPower = getAvgMinionAtk(battleSettings.izman);
    const avgPower = (blueMinionPower + redMinionPower) / 2;

    // ê³µê²©ë ¥ 30 ê¸°ì¤€ 0.001 ì¶”ê°€ (ë¯¸ë¯¸í•´ ë³´ì´ì§€ë§Œ ë§¤ì´ˆ ì‹¤í–‰ë˜ë¯€ë¡œ ìœ ì˜ë¯¸í•¨)
    pushChance += (avgPower / 10000); 
  }

  // ê±°ì‹ ë³‘ ë²„í”„ ì‹œ 5ë°° ê°€ì†
  if (match.stats.blue.activeBuffs.siegeUnit || match.stats.red.activeBuffs.siegeUnit) pushChance *= 5;

  if (Math.random() >= pushChance) return; 

  // 2. ë¯¸ëŠ” ìª½ ê²°ì • (ì ìˆ˜ì°¨ + í•˜ìˆ˜ì¸ ê°•í•¨ ì°¨ì´)
  const scoreDiff = match.score.blue - match.score.red;
  let bluePushProb = 0.5 + (scoreDiff / 100);

  // í•˜ìˆ˜ì¸ì´ ë” ì„¼ ìª½ì´ ë°€ í™•ë¥  ì¦ê°€
  if (battleSettings) {
    const blueAtk = battleSettings.dante.minions.siege.atk;
    const redAtk = battleSettings.izman.minions.siege.atk;
    // ê³µì„± ë¯¸ë‹ˆì–¸ ê³µê²©ë ¥ ì°¨ì´ 10ë‹¹ 1% í™•ë¥  ë³€ë™
    bluePushProb += (blueAtk - redAtk) * 0.001; 
  }

  const isBluePush = Math.random() < bluePushProb;
  const attacker = isBluePush ? 'BLUE' : 'RED';
  const attackerTeam = isBluePush ? match.blueTeam : match.redTeam;
  const defenderStats = isBluePush ? match.stats.red : match.stats.blue;
  const defenderName = isBluePush ? 'ì´ì¦ˆë§ˆí•œ' : 'ë‹¨í…Œ';

  // 3. ì‹ ì‚´ì(God Slayer) ìƒì¡´ ì—¬ë¶€ í™•ì¸
  const hasGodSlayer = attackerTeam.some(p => {
      const h = heroes.find(x => x.id === p.heroId);
      return h?.role === 'ì‹ ì‚´ì' && p.currentHp > 0;
  });

  if (hasGodSlayer && Math.random() < 0.6) {
      // ê³µì„± ì§„í–‰
  } else if (!hasGodSlayer && Math.random() < 0.3) { 
      return; 
  }

  const lanes = ['top', 'mid', 'bot'] as const;
  const lane = lanes[Math.floor(Math.random() * 3)];
  const laneName = lane === 'top' ? 'íƒ‘' : lane === 'mid' ? 'ë¯¸ë“œ' : 'ë°”í…€';

  // 4. íƒ€ì›Œ ì² ê±° ë¡œì§
  if (defenderStats.towers[lane] < 3) {
      defenderStats.towers[lane]++;
      const tier = defenderStats.towers[lane];
      const reward = rewards.tower.rewardGold + (tier * 30);
      (isBluePush ? match.blueTeam : match.redTeam).forEach(p => p.gold += reward);

      match.logs.push({
          time: match.currentDuration,
          message: `ğŸ”¨ ${defenderName}ì˜ [${laneName} ${tier}ì°¨ í¬íƒ‘] íŒŒê´´!`,
          type: 'TOWER',
          team: attacker
      });
  } 
  // 5. ë„¥ì„œìŠ¤ íƒ€ê²© ë¡œì§
  else {
      let damage = 500 + (match.currentDuration / 2);

      if (hasGodSlayer) {
          const bonusRatio = 1 + (roleSettings.slayer.structureDamage / 100);
          damage *= bonusRatio;
      }

      defenderStats.nexusHp -= damage;
      const hpPercent = (defenderStats.nexusHp / defenderStats.maxNexusHp) * 100;

      if (hpPercent <= 0) {
          match.logs.push({ time: match.currentDuration, message: `ğŸ‘‘ ${defenderName}ì˜ ìˆ˜í˜¸ìê°€ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤! ê²Œì„ ì¢…ë£Œ!`, type: 'TOWER', team: attacker });
      } else if (Math.random() < 0.3) {
          match.logs.push({ time: match.currentDuration, message: `âš”ï¸ ${defenderName} ìˆ˜í˜¸ì ê³µê²©ë°›ìŒ! (${Math.max(0, Math.floor(hpPercent))}%)`, type: 'TOWER', team: attacker });
      }
  }
};

// === FILE: /src/hooks/useGameEngine.ts ===

// ==========================================
// FILE PATH: /src/hooks/useGameEngine.ts
// ==========================================

import { useEffect, useState } from 'react';
import { useGameStore } from '../store/useGameStore';
import { saveToSlot, initializeGame } from '../engine/SaveLoadSystem';

export const useGameEngine = () => {
  const store = useGameStore();
  const { gameState, tick, heroes } = store;
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  useEffect(() => {
    initializeGame(heroes);
  }, []); 

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // [í•µì‹¬ ìˆ˜ì •] ë°°ì†ì— ë”°ë¥¸ ê°€ë³€ ì¸í„°ë²Œ(Interval) ë¡œì§
  useEffect(() => {
    let interval: any;

    if (gameState.isPlaying) {
      const speed = gameState.gameSpeed;
      let delayMs = 1000; // ê¸°ë³¸: 1ì´ˆì— í•œ ë²ˆ
      let delta = 1;      // ê¸°ë³¸: 1ì´ˆ ì§„í–‰

      // ë°°ì†ì¼ ë•ŒëŠ” í™”ë©´ì„ ë” ìì£¼(0.1ì´ˆë§ˆë‹¤) ê°±ì‹ í•˜ì—¬ ë¶€ë“œëŸ½ê²Œ ë³´ì´ê²Œ í•¨
      if (speed === 60) {
        delayMs = 100; // 0.1ì´ˆë§ˆë‹¤ ì‹¤í–‰ (10 FPS)
        delta = 6;     // 0.1ì´ˆë‹¹ 6ì´ˆ ì§„í–‰ => 1ì´ˆì— 60ì´ˆ(1ë¶„)
      } else if (speed === 600) {
        delayMs = 100; // 0.1ì´ˆë§ˆë‹¤ ì‹¤í–‰ (10 FPS)
        delta = 60;    // 0.1ì´ˆë‹¹ 60ì´ˆ ì§„í–‰ => 1ì´ˆì— 600ì´ˆ(10ë¶„)
      }

      interval = setInterval(() => { 
        tick(delta); 
      }, delayMs);
    }
    return () => clearInterval(interval);
  }, [gameState.isPlaying, gameState.gameSpeed, tick]);

  // ìë™ ì €ì¥ (1ë¶„ë§ˆë‹¤)
  useEffect(() => {
    const autoSaveInterval = setInterval(() => { 
      if (gameState.isPlaying) saveToSlot('auto'); 
    }, 60000);
    return () => clearInterval(autoSaveInterval);
  }, [gameState.isPlaying]);

  return { isMobile, store };
};

// === FILE: /src/index.css ===

/* src/index.css */
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Pretendard:wght@400;600;700;800&display=swap');

:root {
  --bg-main: #0f1115;
  --bg-panel: #161b22;
  --border: #30363d;
  --text-main: #f0f6fc;
  --text-sub: #8b949e;
  --primary: #58a6ff;
  --success: #238636;
  --danger: #da3633;
}

body {
  margin: 0;
  background-color: var(--bg-main);
  color: var(--text-main);
  font-family: 'Pretendard', sans-serif;
  -webkit-font-smoothing: antialiased;
}

/* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-main); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #555; }

/* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
.panel {
  background: var(--bg-panel);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
}

.btn {
  padding: 10px 16px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: 0.2s;
}
.btn-primary { background: var(--primary); color: #000; }
.btn-primary:hover { opacity: 0.9; }
.btn-danger { background: var(--danger); color: #fff; }

.text-mono { font-family: 'JetBrains Mono', monospace; }

@media (max-width: 768px) {
  /* í…Œì´ë¸” í—¤ë” ìˆ¨ê¹€ */
  thead { display: none; }

  /* í…Œì´ë¸” í–‰ì„ ë¸”ë¡ìœ¼ë¡œ, ì¹´ë“œì²˜ëŸ¼ ìŠ¤íƒ€ì¼ë§ */
  tr {
    display: flex;
    flex-direction: column;
    background: #1c1c1f;
    margin-bottom: 10px;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 10px;
  }

  td {
    display: flex;
    justify-content: space-between;
    text-align: right;
    padding: 5px 0;
    border-bottom: 1px solid #222;
  }

  /* td ì•ì— ë¼ë²¨ ë¶™ì—¬ì£¼ê¸° (ê°€ìƒ ìš”ì†Œ í™œìš© ê°€ëŠ¥í•˜ì§€ë§Œ, ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •ì´ ë” ì‰¬ì›€) */
}


// === FILE: /src/index.tsx ===

// src/main.tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './index.css'

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)

// === FILE: /src/store/slices/communitySlice.ts ===

import { StateCreator } from 'zustand';
import { GameStore, CommunitySlice } from '../types';

export const createCommunitySlice: StateCreator<GameStore, [], [], CommunitySlice> = (set) => ({
  communityPosts: [],
  selectedPost: null,

  openPost: (post) => set({ selectedPost: post }),
  closePost: () => set({ selectedPost: null }),
  setCommunityPosts: (posts) => set({ communityPosts: posts }),
});

// === FILE: /src/store/slices/gameSlice.ts ===

// ==========================================
// FILE PATH: /src/store/slices/gameSlice.ts
// ==========================================

import { StateCreator } from 'zustand';
import { GameStore, GameSlice } from '../types';
import { INITIAL_HEROES } from '../../data/heroes';
import { INITIAL_ITEMS } from '../../data/items';
import { GameState } from '../../types';
import { JUNGLE_CONFIG } from '../../data/jungle';
import { Hero } from '../../types';
import { INITIAL_CUSTOM_IMAGES } from '../../data/initialImages';

import { createLiveMatches, finishMatch, updateLiveMatches } from '../../engine/MatchEngine';
import { initUserPool, updateUserActivity, getTopRankers, userPool } from '../../engine/UserManager';
import { analyzeHeroMeta, calculateUserEcosystem } from '../../engine/RankingSystem';
import { updatePostInteractions, generatePostAsync, generateCommentAsync } from '../../engine/CommunityEngine';
import { calculateTargetSentiment, smoothSentiment } from '../../engine/SentimentEngine';

const initialGameState: GameState = {
  season: 1, day: 1, hour: 12, minute: 0, second: 0,
  isPlaying: false, gameSpeed: 1,

  userSentiment: 60, 
  ccu: 0, 
  totalUsers: 3000, 
  userStatus: { totalGames: 0, playingUsers: 0, queuingUsers: 0, avgWaitTime: 0, tierDistribution: [] },
  topRankers: [],
  godStats: { totalMatches: 0, izmanWins: 0, izmanAvgKills: '0.0', izmanAvgTime: '00:00', danteWins: 0, danteAvgKills: '0.0', danteAvgTime: '00:00', avgGameDuration: 0, guardianDeathRate: 0, godAwakenRate: 0 },
  itemStats: {},
  liveMatches: [],

  tierConfig: { 
    challengerRank: 200, 
    master: 4800, ace: 3800, joker: 3200, gold: 2100, silver: 1300, bronze: 300,
    promos: {
      master: 5, ace: 5, joker: 5, gold: 3, silver: 3, bronze: 3
    }
  },

  battleSettings: {
    izman: { name: 'ì´ì¦ˆë§ˆí•œ', atkRatio: 1, defRatio: 1, hpRatio: 10000, guardianHp: 5000, towerAtk: 100, trait: 'ê´‘ë€', servantGold: 14, servantXp: 30, minions: { melee: { label: 'ê´‘ì‹ ë„', hp: 550, def: 10, atk: 25, gold: 21, xp: 60 }, ranged: { label: 'ì•”í‘ ì‚¬ì œ', hp: 350, def: 0, atk: 45, gold: 14, xp: 30 }, siege: { label: 'ì•”í‘ê¸°ì‚¬', hp: 950, def: 40, atk: 70, gold: 60, xp: 90 } } },
    dante: { name: 'ë‹¨í…Œ', atkRatio: 1, defRatio: 1, hpRatio: 10000, guardianHp: 5000, towerAtk: 100, trait: 'ê°€í˜¸', servantGold: 14, servantXp: 30, minions: { melee: { label: 'ìˆ˜ë„ì‚¬', hp: 550, def: 10, atk: 25, gold: 21, xp: 60 }, ranged: { label: 'êµ¬ë„ì', hp: 350, def: 0, atk: 45, gold: 14, xp: 30 }, siege: { label: 'ì„±ì „ì‚¬', hp: 950, def: 40, atk: 70, gold: 60, xp: 90 } } },
    economy: { minionGold: 14, minionXp: 30 }
  },
  fieldSettings: {
    tower: { hp: 3000, armor: 50, rewardGold: 80 },
    colossus: { hp: 8000, armor: 80, rewardGold: 100, attack: 50 },
    watcher: { hp: 12000, armor: 120, rewardGold: 150, buffType: 'COMBAT', buffAmount: 20, buffDuration: 180 },
    jungle: JUNGLE_CONFIG.DEFAULT_SETTINGS
  },
  roleSettings: {
    executor: { damage: 10, defense: 10 },
    tracker: { gold: 20, smiteChance: 1.5 },
    prophet: { cdrPerLevel: 2 },
    slayer: { structureDamage: 30 },
    guardian: { survivalRate: 20 }
  },
  aiConfig: { provider: 'GEMINI', apiKey: '', model: 'gemini-2.5-flash', enabled: false },
  customImages: INITIAL_CUSTOM_IMAGES 
};

export const createGameSlice: StateCreator<GameStore, [], [], GameSlice> = (set, get) => ({
  gameState: initialGameState,

  setSpeed: (s) => set((state) => ({ gameState: { ...state.gameState, gameSpeed: s } })),
  togglePlay: () => set((state) => ({ gameState: { ...state.gameState, isPlaying: !state.gameState.isPlaying } })),
  setGameState: (updates) => set((state) => ({ gameState: { ...state.gameState, ...updates } })),

  updateBattleSettings: (s) => set((state) => ({ gameState: { ...state.gameState, battleSettings: { ...state.gameState.battleSettings, ...s } } })),
  updateFieldSettings: (s) => set((state) => ({ gameState: { ...state.gameState, fieldSettings: { ...state.gameState.fieldSettings, ...s } } })),
  updateTierConfig: (c) => set((state) => ({ gameState: { ...state.gameState, tierConfig: c } })),
  updateAIConfig: (c) => set((state) => ({ gameState: { ...state.gameState, aiConfig: { ...state.gameState.aiConfig, ...c } } })),
  updateRoleSettings: (s) => set((state) => ({ gameState: { ...state.gameState, roleSettings: { ...state.gameState.roleSettings, ...s } } })),

  setCustomImage: (id, imageData) => set((state) => ({
    gameState: { ...state.gameState, customImages: { ...state.gameState.customImages, [id]: imageData } }
  })),

  removeCustomImage: (id) => set((state) => {
    const newImages = { ...state.gameState.customImages };
    delete newImages[id];
    return { gameState: { ...state.gameState, customImages: newImages } };
  }),

  loadModData: (modData: any) => set((state) => {
    const currentHeroesMap = new Map(state.heroes.map(h => [h.id, h]));
    const newHeroes: Hero[] = modData.heroes.map((modHero: Hero) => {
      const existingHero = currentHeroesMap.get(modHero.id);
      if (existingHero) {
        return { ...modHero, record: existingHero.record, tier: existingHero.tier, rank: existingHero.rank, recentWinRate: existingHero.recentWinRate, avgKda: existingHero.avgKda };
      } else {
        return modHero;
      }
    });
    const newGameState = {
      ...state.gameState,
      battleSettings: modData.settings?.battle || state.gameState.battleSettings,
      fieldSettings: modData.settings?.field || state.gameState.fieldSettings,
      roleSettings: modData.settings?.role || state.gameState.roleSettings,
      customImages: { ...state.gameState.customImages, ...(modData.images || {}) }
    };
    return { heroes: newHeroes, shopItems: modData.items || state.shopItems, gameState: newGameState };
  }),

  tick: (deltaSeconds: number) => {
    const state = get();
    if (!state.gameState || !state.gameState.isPlaying) return;

    const { heroes, gameState, communityPosts } = state;
    const { hour, minute, second, day, totalUsers, tierConfig, liveMatches } = gameState;

    let ns = (second || 0) + deltaSeconds;
    let nm = minute, nh = hour, nd = day;

    while (ns >= 60) { ns -= 60; nm++; }
    while (nm >= 60) { nm -= 60; nh++; }
    while (nh >= 24) { nh -= 24; nd++; }

    const isNewMinute = minute !== nm;
    const isNewHour = hour !== nh;
    const currentTotalMinutes = (nd * 1440) + (nh * 60) + nm;

    // ê°€ì…ì ìì—° ì¦ê°€
    let nextTotalUsers = totalUsers;
    if (isNewHour) {
      const growth = Math.floor(Math.random() * 5) + 1 + Math.floor(totalUsers * 0.0005);
      nextTotalUsers += growth;
    }

    // ìœ ì € í’€ ë° í™œë™ ê°±ì‹ 
    if (isNewMinute) {
        if (userPool.length < nextTotalUsers) {
            initUserPool(heroes, nextTotalUsers);
        }
        updateUserActivity(nh, heroes);
    }

    let nextHeroes = [...heroes];
    let updatedMatches = updateLiveMatches([...liveMatches], nextHeroes, deltaSeconds);

    const ongoingMatches = updatedMatches.filter(m => m.currentDuration < m.duration);
    const endedMatches = updatedMatches.filter(m => m.currentDuration >= m.duration);

    const nextGodStats = { ...gameState.godStats };
    const nextItemStats = { ...gameState.itemStats }; 

    endedMatches.forEach(match => {
        // [ìˆ˜ì •] ì—¬ê¸°ì„œ tierConfigë¥¼ ì¸ìë¡œ ë„˜ê²¨ì¤ë‹ˆë‹¤.
        const result = finishMatch(match, nextHeroes, nd, nh, gameState.battleSettings, tierConfig);

        nextGodStats.totalMatches++;
        if (result.isBlueWin) nextGodStats.danteWins++; else nextGodStats.izmanWins++;

        const prevIzmanKills = parseFloat(nextGodStats.izmanAvgKills) * (nextGodStats.totalMatches - 1);
        const prevDanteKills = parseFloat(nextGodStats.danteAvgKills) * (nextGodStats.totalMatches - 1);
        nextGodStats.izmanAvgKills = ((prevIzmanKills + result.redKills) / nextGodStats.totalMatches).toFixed(1);
        nextGodStats.danteAvgKills = ((prevDanteKills + result.blueKills) / nextGodStats.totalMatches).toFixed(1);

        const processItemStats = (players: any[], isWin: boolean) => {
            players.forEach(p => {
                p.items.forEach((item: any) => {
                    if (!nextItemStats[item.id]) {
                        nextItemStats[item.id] = { itemId: item.id, totalPicks: 0, totalWins: 0, totalKills: 0, totalDeaths: 0, totalAssists: 0 };
                    }
                    const stat = nextItemStats[item.id];
                    stat.totalPicks++;
                    if (isWin) stat.totalWins++;
                    stat.totalKills += p.kills;
                    stat.totalDeaths += p.deaths;
                    stat.totalAssists += p.assists;
                });
            });
        };
        processItemStats(match.blueTeam, result.isBlueWin);
        processItemStats(match.redTeam, !result.isBlueWin);
    });

    const onlineUsers = userPool.filter(u => u.status !== 'OFFLINE').length;
    let finalMatches = ongoingMatches;

    if (ns % 10 < deltaSeconds) {
        const idleUsers = userPool.filter(u => u.status === 'IDLE');
        if (idleUsers.length >= 10 && ongoingMatches.length < 50) {
            const newMatches = createLiveMatches(nextHeroes, onlineUsers, Date.now(), tierConfig);
            finalMatches = [...ongoingMatches, ...newMatches];
        }
    }

    let analyzedHeroes = nextHeroes;
    let userStatus = gameState.userStatus;
    let topRankers = gameState.topRankers;
    let newSentiment = gameState.userSentiment;

    if (isNewMinute) {
        analyzedHeroes = analyzeHeroMeta(nextHeroes);
        userStatus = calculateUserEcosystem(onlineUsers, nextTotalUsers, tierConfig);

        const sortedUsers = [...userPool].sort((a, b) => b.score - a.score);
        sortedUsers.forEach((u, idx) => {
            u.rank = idx + 1; 
            if (u.score >= tierConfig.master && u.rank <= tierConfig.challengerRank) {
                u.isChallenger = true;
            } else {
                u.isChallenger = false;
            }
        });

        topRankers = getTopRankers(analyzedHeroes, tierConfig);
        const targetSentiment = calculateTargetSentiment(gameState, analyzedHeroes, communityPosts);
        newSentiment = smoothSentiment(newSentiment, targetSentiment);
    }

    let nextPosts = [...communityPosts];
    if (isNewMinute) {
        nextPosts = updatePostInteractions(nextPosts, currentTotalMinutes);

        const isAIReady = gameState.aiConfig && gameState.aiConfig.enabled && gameState.aiConfig.apiKey;
        const postChance = 0.05 + (onlineUsers / 10000); 

        if (Math.random() < postChance) {
            const uniqueId = Date.now(); 
            if (isAIReady) {
                generatePostAsync(uniqueId, analyzedHeroes, tierConfig, currentTotalMinutes, gameState.aiConfig, userPool, gameState.battleSettings, gameState.fieldSettings)
                .then(aiPost => {
                    if (aiPost) {
                        set(prev => ({ 
                            communityPosts: [aiPost, ...prev.communityPosts].sort((a,b) => b.createdAt - a.createdAt).slice(0, 200) 
                        }));
                    }
                });
            }
        }

        if (nextPosts.length > 0) {
            const recentPosts = nextPosts.slice(0, 15);
            const targetPost = recentPosts[Math.floor(Math.random() * recentPosts.length)];

            if (targetPost && Math.random() < 0.3) {
                if (isAIReady) {
                    generateCommentAsync(targetPost, gameState.aiConfig, userPool, tierConfig).then(comment => {
                        if (comment) {
                            set(prev => {
                                const posts = [...prev.communityPosts];
                                const p = posts.find(post => post.id === targetPost.id);
                                if (p) {
                                    p.commentList.push(comment);
                                    p.comments++;
                                }
                                return { communityPosts: posts };
                            });
                        }
                    });
                }
            }
        }
    }

    if (nextPosts.length > 200) nextPosts = nextPosts.sort((a,b) => b.createdAt - a.createdAt).slice(0, 200);

    set({
      heroes: analyzedHeroes,
      communityPosts: nextPosts, 
      gameState: {
        ...gameState,
        second: ns,
        minute: nm, hour: nh, day: nd,
        ccu: onlineUsers,
        totalUsers: nextTotalUsers, 
        userStatus,
        topRankers,
        godStats: nextGodStats, 
        itemStats: nextItemStats, 
        liveMatches: finalMatches,
        userSentiment: newSentiment
      }
    });
  },

  hardReset: () => {
    const currentAI = get().gameState.aiConfig;
    set({
      gameState: { ...initialGameState, aiConfig: currentAI },
      heroes: INITIAL_HEROES,
      shopItems: INITIAL_ITEMS,
      communityPosts: [],     
      selectedPost: null
    });
  }
});

// === FILE: /src/store/slices/heroSlice.ts ===

import { StateCreator } from 'zustand';
import { GameStore, HeroSlice } from '../types';
import { INITIAL_HEROES } from '../../data/heroes';
import { Hero } from '../../types';

export const createHeroSlice: StateCreator<GameStore, [], [], HeroSlice> = (set) => ({
  heroes: INITIAL_HEROES,

  addHero: (hero: Hero) => set((state) => ({ 
    heroes: [hero, ...state.heroes] 
  })),

  deleteHero: (heroId: string) => set((state) => ({
    heroes: state.heroes.filter((h) => h.id !== heroId)
  })),

  updateHero: (id: string, updates: Partial<Hero>) => set((state) => ({ 
    heroes: state.heroes.map((h) => h.id === id ? { ...h, ...updates } : h) 
  })),

  resetHeroStats: () => set((state) => {
    const resetHeroes = state.heroes.map((hero) => ({
      ...hero,
      record: { 
        totalMatches: 0, totalWins: 0, totalPicks: 0, totalBans: 0, 
        totalKills: 0, totalDeaths: 0, totalAssists: 0, 
        totalDamage: 0, totalDamageTaken: 0, totalCs: 0, totalGold: 0, 
        recentResults: [] 
      },
      tier: '3' as const, rank: 0, rankChange: 0, 
      recentWinRate: 0, pickRate: 0, banRate: 0, 
      avgKda: '0.0/0.0/0.0', kdaRatio: '0.00', 
      avgDpm: '0', avgDpg: '0', avgCs: '0', avgGold: '0'
    }));
    return { heroes: resetHeroes };
  }),
});


// === FILE: /src/store/slices/itemSlice.ts ===

import { StateCreator } from 'zustand';
import { GameStore, ItemSlice } from '../types';
import { INITIAL_ITEMS } from '../../data/items';
import { Item } from '../../types';

export const createItemSlice: StateCreator<GameStore, [], [], ItemSlice> = (set) => ({
  shopItems: INITIAL_ITEMS,

  addItem: (item: Item) => set((state) => ({ shopItems: [...state.shopItems, item] })),
  
  deleteItem: (id: string) => set((state) => ({ shopItems: state.shopItems.filter((i) => i.id !== id) })),
  
  updateItem: (id: string, updates: Partial<Item>) => set((state) => ({
    shopItems: state.shopItems.map((i) => i.id === id ? { ...i, ...updates } : i)
  })),
});


// === FILE: /src/store/types.ts ===

// ==========================================
// FILE PATH: /src/store/types.ts
// ==========================================

import { 
  Hero, Post, GameState, Item, 
  BattleSettings, BattlefieldSettings, TierConfig, AIConfig, RoleSettings, 
  ItemStatData 
} from '../types';

// 1. Hero Slice Interface
export interface HeroSlice {
  heroes: Hero[];
  addHero: (hero: Hero) => void;
  deleteHero: (heroId: string) => void;
  updateHero: (id: string, updates: Partial<Hero>) => void;
  resetHeroStats: () => void;
}

// 2. Community Slice Interface
export interface CommunitySlice {
  communityPosts: Post[];
  selectedPost: Post | null;
  openPost: (post: Post) => void;
  closePost: () => void;
  setCommunityPosts: (posts: Post[]) => void;
}

// 3. Game Slice Interface
export interface GameSlice {
  gameState: GameState;
  
  setSpeed: (speed: number) => void;
  togglePlay: () => void;
  setGameState: (updates: Partial<GameState>) => void;

  updateBattleSettings: (settings: Partial<BattleSettings['izman'] | BattleSettings['dante']>) => void;
  updateFieldSettings: (settings: Partial<BattlefieldSettings>) => void;
  updateTierConfig: (config: TierConfig) => void;
  updateAIConfig: (config: Partial<AIConfig>) => void;
  updateRoleSettings: (settings: Partial<RoleSettings>) => void;

  setCustomImage: (id: string, imageData: string) => void;
  removeCustomImage: (id: string) => void;
  loadModData: (modData: any) => void;
  
  tick: (deltaSeconds: number) => void;
  hardReset: () => void;
}

// 4. Item Slice Interface
export interface ItemSlice {
  shopItems: Item[];
  addItem: (item: Item) => void;
  deleteItem: (id: string) => void;
  updateItem: (id: string, updates: Partial<Item>) => void;
}

// 5. Combined Store Interface (ì´ ë¶€ë¶„ì´ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤)
export type GameStore = HeroSlice & CommunitySlice & GameSlice & ItemSlice;


// === FILE: /src/store/useGameStore.ts ===

// ==========================================
// FILE PATH: /src/store/useGameStore.ts
// ==========================================

import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { GameStore } from './types';

// ìŠ¬ë¼ì´ìŠ¤ë“¤ ë¶ˆëŸ¬ì˜¤ê¸°
import { createHeroSlice } from './slices/heroSlice';
import { createCommunitySlice } from './slices/communitySlice';
import { createGameSlice } from './slices/gameSlice';
import { createItemSlice } from './slices/itemSlice'; // [ì‹ ê·œ]

export const useGameStore = create<GameStore>()(
  persist(
    (...a) => ({
      ...createHeroSlice(...a),
      ...createCommunitySlice(...a),
      ...createGameSlice(...a),
      ...createItemSlice(...a), // [ì‹ ê·œ]
    }),
    { 
      name: 'gods-war-storage-v17' 
    } 
  )
);

// === FILE: /src/types/index.ts ===

// ==========================================
// FILE PATH: /src/types/index.ts
// ==========================================

// 1. ê¸°ë³¸ ìƒìˆ˜ ë° ì˜ì›…/ìŠ¤í‚¬ ê´€ë ¨
export type Role = 'ì§‘í–‰ê´€' | 'ì„ ì§€ì' | 'ìˆ˜í˜¸ê¸°ì‚¬' | 'ì¶”ì ì' | 'ì‹ ì‚´ì';
export type Tier = 'OP' | '1' | '2' | '3' | '4' | '5';
export type SkillMechanic = 
  | 'DAMAGE' | 'HEAL' | 'SHIELD' | 'HOOK' | 'DASH' 
  | 'STUN' | 'STEALTH' | 'EXECUTE' | 'GLOBAL' | 'NONE';

export interface HeroStats {
  ad: number; ap: number; hp: number; armor: number; crit: number;
  range: number; speed: number; regen: number; pen: number; baseAtk: number;
}

export interface SkillDetail {
  name: string; mechanic: SkillMechanic; val: number;
  adRatio: number; apRatio: number; cd: number; 
  range?: number; duration?: number; isPassive?: boolean;
}

export interface HeroSkillSet {
  passive: SkillDetail; q: SkillDetail; w: SkillDetail; e: SkillDetail; r: SkillDetail;
}

export interface HeroRecord {
  totalMatches: number; totalWins: number; totalPicks: number; totalBans: number;
  totalKills: number; totalDeaths: number; totalAssists: number;
  totalDamage: number; totalDamageTaken: number; totalCs: number; totalGold: number;
  recentResults: boolean[]; 
}

export interface Hero {
  id: string; name: string; role: Role; stats: HeroStats; skills: HeroSkillSet;
  record: HeroRecord; tier: Tier; rank: number; rankChange: number;
  recentWinRate: number; pickRate: number; banRate: number;
  avgKda: string; kdaRatio: string;
  avgDpm: string; avgDpg: string; avgCs: string; avgGold: string;
}

// 2. ì•„ì´í…œ
export interface Item {
  id: string; name: string; cost: number;
  ad: number; ap: number; hp: number; armor: number; crit: number; speed: number;
  type: 'WEAPON' | 'ARMOR' | 'ACCESSORY' | 'POWER'; description?: string;
}

export interface ItemStatData {
  itemId: string; totalPicks: number; totalWins: number;
  totalKills: number; totalDeaths: number; totalAssists: number;
}

// 3. ì„¤ì • ê´€ë ¨
export interface ObjectStats { hp: number; armor: number; rewardGold: number; }
export interface ColossusSettings extends ObjectStats { attack: number; }
export interface WatcherSettings extends ObjectStats { buffType: 'COMBAT' | 'GOLD'; buffAmount: number; buffDuration: number; }
export interface JungleSettings { density: number; yield: number; attack: number; defense: number; threat: number; }

export interface BattlefieldSettings {
  tower: ObjectStats; colossus: ColossusSettings; watcher: WatcherSettings; jungle: JungleSettings;
}

export interface MinionStats { label: string; hp: number; def: number; atk: number; gold: number; xp: number; }
export interface GodSettings {
  name: string; atkRatio: number; defRatio: number; hpRatio: number;
  guardianHp: number; towerAtk: number; trait: string;
  minions: { melee: MinionStats; ranged: MinionStats; siege: MinionStats; };
  servantGold: number; servantXp: number; 
}
export interface EconomySettings { minionGold: number; minionXp: number; }
export interface BattleSettings { izman: GodSettings; dante: GodSettings; economy: EconomySettings; }

export interface RoleSettings {
  executor: { damage: number; defense: number }; 
  tracker: { gold: number; smiteChance: number }; 
  prophet: { cdrPerLevel: number }; 
  slayer: { structureDamage: number }; 
  guardian: { survivalRate: number }; 
}

export interface TierConfig { 
  challengerRank: number; 
  master: number; ace: number; joker: number; gold: number; silver: number; bronze: number; 
  promos: { master: number; ace: number; joker: number; gold: number; silver: number; bronze: number; };
}
export interface AIConfig { provider: 'GEMINI' | 'OPENAI'; apiKey: string; model: string; enabled: boolean; }

// 4. ìœ ì € ë° í†µê³„
export interface MatchHistory { season: number; result: 'WIN' | 'LOSE' | 'PROMO WIN' | 'PROMO LOSS'; heroName: string; kda: string; lpChange: number; date: string; }
export interface UserHeroStat { matches: number; wins: number; kills: number; deaths: number; assists: number; }
export interface UserProfile { 
  id: number; name: string; mainHeroId: string; score: number; tier: string; winRate: number; totalGames: number; 
  history: MatchHistory[]; heroStats: Record<string, UserHeroStat>; preferredLane: string;
  mostChamps: any[]; laneStats: any[];
  promoStatus?: { targetTier: string; wins: number; losses: number; targetWins: number; } | null;
  rank?: number; isChallenger?: boolean;
}
export interface TierStat { name: string; minScore: number; count: number; percent: number; color: string; }
export interface UserStatus { totalGames: number; playingUsers: number; queuingUsers: number; avgWaitTime: number; tierDistribution: TierStat[]; }
export interface GodStats { totalMatches: number; izmanWins: number; izmanAvgKills: string; izmanAvgTime: string; danteWins: number; danteAvgKills: string; danteAvgTime: string; avgGameDuration: number; guardianDeathRate: number; godAwakenRate: number; }

// 5. ì¸ê²Œì„
export type EventType = 'KILL' | 'TOWER' | 'COLOSSUS' | 'WATCHER' | 'START';
export interface GameLog { time: number; message: string; type: EventType; team?: 'BLUE' | 'RED'; }
export interface TimelineEvent { time: number; type: EventType; killerId: string; victimId: string; message: string; }
export interface LivePlayer { 
  name: string; heroId: string; kills: number; deaths: number; assists: number; 
  gold: number; cs: number; totalDamageDealt: number;
  currentHp: number; maxHp: number; level: number; 
  items: Item[]; x: number; y: number; lane: 'TOP' | 'MID' | 'BOT' | 'JUNGLE'; buffs: string[]; mmr: number; 
}
export interface TowerStatus { top: number; mid: number; bot: number; }
export interface TeamStats { 
  towers: TowerStatus; colossus: number; watcher: number; fury: number; nexusHp: number; maxNexusHp: number;
  activeBuffs: { siegeUnit: boolean; voidPower: boolean; voidBuffEndTime?: number; };
}
export interface LiveMatch { 
  id: string; blueTeam: LivePlayer[]; redTeam: LivePlayer[]; bans: { blue: string[]; red: string[]; }; 
  startTime: number; duration: number; currentDuration: number; avgTier: string; 
  score: { blue: number, red: number }; stats: { blue: TeamStats; red: TeamStats; };
  timeline: TimelineEvent[]; logs: GameLog[]; 
  nextColossusSpawnTime: number; nextWatcherSpawnTime: number;
}

// 6. ì»¤ë®¤ë‹ˆí‹°
export interface Comment { id: number; author: string; authorTier: string; content: string; timestamp: string; }
export interface Post { 
  id: number; author: string; authorTier: string; title: string; content: string; 
  category: 'ê³µëµ'|'ìœ ë¨¸'|'ì§•ì§•'|'ë¶„ì„'|'ì¡ë‹´'|'ì§ˆë¬¸'|'ìë‘'|'ê³µì§€'; 
  views: number; upvotes: number; downvotes: number; 
  comments: number; commentList: Comment[]; createdAt: number; potential: number; isBest: boolean; displayTime: string; 
}

// 7. ì „ì²´ ìƒíƒœ
export interface GameState {
  season: number; day: number; hour: number; minute: number; second: number;
  isPlaying: boolean; gameSpeed: number; userSentiment: number; ccu: number; totalUsers: number;
  userStatus: UserStatus; topRankers: UserProfile[]; godStats: GodStats; liveMatches: LiveMatch[];
  tierConfig: TierConfig; battleSettings: BattleSettings; fieldSettings: BattlefieldSettings; 
  roleSettings: RoleSettings; aiConfig: AIConfig; itemStats: Record<string, ItemStatData>;
  customImages: Record<string, string>; 
}

// 8. Store Slices (íƒ€ì… ì •ì˜ ì¶”ê°€)
export interface HeroSlice {
  heroes: Hero[];
  addHero: (hero: Hero) => void;
  deleteHero: (heroId: string) => void;
  updateHero: (id: string, updates: Partial<Hero>) => void;
  resetHeroStats: () => void;
}

export interface ItemSlice {
  shopItems: Item[];
  addItem: (item: Item) => void;
  deleteItem: (id: string) => void;
  updateItem: (id: string, updates: Partial<Item>) => void;
}

export interface CommunitySlice {
  communityPosts: Post[];
  selectedPost: Post | null;
  openPost: (post: Post) => void;
  closePost: () => void;
  setCommunityPosts: (posts: Post[]) => void;
}

export interface GameSlice {
  gameState: GameState;
  setSpeed: (speed: number) => void;
  togglePlay: () => void;
  setGameState: (updates: Partial<GameState>) => void;
  updateBattleSettings: (settings: Partial<BattleSettings>) => void;
  updateFieldSettings: (settings: Partial<BattlefieldSettings>) => void;
  updateTierConfig: (config: TierConfig) => void;
  updateAIConfig: (config: Partial<AIConfig>) => void;
  updateRoleSettings: (settings: Partial<RoleSettings>) => void;
  setCustomImage: (id: string, data: string) => void;
  removeCustomImage: (id: string) => void;
  loadModData: (data: any) => void;
  tick: (deltaSeconds: number) => void;
  hardReset: () => void;
}

export type GameStore = HeroSlice & ItemSlice & CommunitySlice & GameSlice;


// === FILE: /src/utils/AIService.ts ===

// ==========================================
// FILE PATH: /src/utils/AIService.ts
// ==========================================

import { generateAIPost } from './ai/PostGenerator';
import { generateAIComment } from './ai/CommentGenerator';

// ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ í•¨ìˆ˜ ì´ë¦„ì„ ìœ ì§€í•˜ë©° ì—°ê²°í•©ë‹ˆë‹¤.
export const fetchAIPost = generateAIPost;
export const fetchAIComment = generateAIComment;

// === FILE: /src/utils/GeminiService.ts ===

// src/utils/GeminiService.ts

// [ì¤‘ìš”] Google AI Studio API Key í•„ìš”
const API_KEY = ""; 
const MODEL_VERSION = "gemini-2.5-flash"; // or gemini-2.0-flash-exp

export async function fetchGeminiPost(context: string, topic: string): Promise<{title: string, content: string} | null> {
  if (!API_KEY) {
    console.warn("Gemini API Key Missing");
    return null;
  }

  try {
    const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_VERSION}:generateContent?key=${API_KEY}`;
    
    // [í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§]
    // AIì—ê²Œ êµ¬ì²´ì ì¸ í˜ë¥´ì†Œë‚˜ì™€ ìƒí™©ì„ ë¶€ì—¬í•˜ì—¬ ê¸€ì˜ í€„ë¦¬í‹°ë¥¼ ë†’ì„
    const prompt = `
      ë„ˆëŠ” 'ì‹ ë“¤ì˜ ì „ìŸ(Gods' War)'ì´ë¼ëŠ” AOS(MOBA) ê²Œì„ ì»¤ë®¤ë‹ˆí‹°ì˜ ìœ ì €ì•¼.
      ì§€ê¸ˆë¶€í„° ì•„ë˜ ì£¼ì–´ì§„ [ìƒí™©]ê³¼ [ì£¼ì œ]ì— ë§ì¶°ì„œ ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ì„ ì‘ì„±í•´.
      
      [ì£¼ì œ]: ${topic}
      [í˜„ì¬ ê²Œì„ ë©”íƒ€ ìƒí™©]:
      ${context}

      [ì‘ì„± ì§€ì¹¨]:
      1. ë§íˆ¬: ë””ì‹œì¸ì‚¬ì´ë“œ, í¨ì½”, ì•„ì¹´ë¼ì´ë¸Œ ë“± í•œêµ­ ê²Œì„ ì»¤ë®¤ë‹ˆí‹° ë§íˆ¬ë¥¼ ì‚¬ìš©í•´. (ë°˜ë§, ì€ì–´ ì‚¬ìš© ê°€ëŠ¥)
      2. ë‚´ìš©: ë¬´ì¡°ê±´ì ì¸ ìš•ì„¤ì´ë‚˜ ë¹„ë‚œë§Œ í•˜ì§€ ë§ˆ.
         - 'ë¶„ì„' ì£¼ì œë¼ë©´ ì§„ì§€í•˜ê²Œ ìŠ¤íƒ¯ì´ë‚˜ ì•„ì´í…œ íŠ¸ë¦¬ë¥¼ ë…¼í•´.
         - 'ì§ˆë¬¸' ì£¼ì œë¼ë©´ ë‰´ë¹„ì²˜ëŸ¼ ëª¨ë¥´ëŠ” ê±¸ ë¬¼ì–´ë´.
         - 'ìœ ë¨¸' ì£¼ì œë¼ë©´ ê²Œì„ ìƒí™©ì„ ë¹„ê¼¬ê±°ë‚˜ ë“œë¦½ì„ ì³.
      3. ê¸¸ì´: ì œëª©ì€ ì„íŒ©íŠ¸ ìˆê²Œ í•œ ì¤„, ë‚´ìš©ì€ 2~3ë¬¸ì¥ ì •ë„ë¡œ ì§§ê³  êµµê²Œ.
      
      [ì¶œë ¥ í˜•ì‹ (JSON)]:
      ë°˜ë“œì‹œ ë§ˆí¬ë‹¤ìš´ ì—†ì´ ìˆœìˆ˜ JSONë§Œ ì¶œë ¥í•´.
      {
        "title": "ê²Œì‹œê¸€ ì œëª©",
        "content": "ê²Œì‹œê¸€ ë³¸ë¬¸ ë‚´ìš©"
      }
    `;

    const response = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });

    const data = await response.json();
    if (data.error) throw new Error(data.error.message);

    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
    if (!text) return null;
    
    const jsonStr = text.replace(/```json|```/g, "").trim();
    return JSON.parse(jsonStr);

  } catch (e) {
    console.error("Gemini Post Error:", e);
    return null;
  }
}

export async function fetchGeminiComment(postContent: string): Promise<string | null> {
  if (!API_KEY) return null;

  try {
    const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_VERSION}:generateContent?key=${API_KEY}`;
    
    const prompt = `
      AOS ê²Œì„ ì»¤ë®¤ë‹ˆí‹° ê¸€ì— ë‹¬ë¦´ ëŒ“ê¸€ í•˜ë‚˜ë¥¼ ì‘ì„±í•´.
      ê¸€ ë‚´ìš©: "${postContent}"
      
      ì§€ì¹¨:
      - ê¸€ ë‚´ìš©ì— ë™ì¡°í•˜ê±°ë‚˜, ë°˜ë°•í•˜ê±°ë‚˜, ë¹„ê¼¬ëŠ” ë“± ë¦¬ì–¼í•œ ë°˜ì‘ì„ ë³´ì—¬ì¤˜.
      - "ã…‹ã…‹ã…‹ã…‹" ê°™ì€ ì´ˆì„±ì²´ë‚˜ ì€ì–´ë¥¼ ì ì ˆíˆ ì„ì–´.
      - ì„¤ëª… ì—†ì´ ëŒ“ê¸€ ë‚´ìš© í…ìŠ¤íŠ¸ë§Œ ì¶œë ¥í•´.
    `;

    const response = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });

    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text.trim();
  } catch (e) {
    return null;
  }
}

// === FILE: /src/utils/OpenAIService.ts ===

// src/utils/OpenAIService.ts

// 1. ì—¬ê¸°ì— OpenAI API í‚¤ë¥¼ ë„£ìœ¼ë©´ ì§„ì§œ AIê°€ ì‘ë™í•©ë‹ˆë‹¤. (ì—†ìœ¼ë©´ ê°€ì§œ AI ì‘ë™)
const API_KEY = ""; // ì˜ˆ: "sk-proj-..."

export async function fetchAIPost(context: string): Promise<{title: string, content: string} | null> {
  if (!API_KEY) return null; // í‚¤ ì—†ìœ¼ë©´ null ë°˜í™˜ -> í…œí”Œë¦¿ ì—”ì§„ ì‚¬ìš©

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo", // or gpt-4
        messages: [
          { role: "system", content: "ë„ˆëŠ” 'ì‹ ë“¤ì˜ ì „ìŸ'ì´ë¼ëŠ” AOS ê²Œì„ì˜ ì•…ì§ˆ ìœ ì €ì•¼. ë””ì‹œì¸ì‚¬ì´ë“œë‚˜ í¨ì½” ë§íˆ¬ë¡œ ì§§ê³  ê°„ê²°í•˜ê²Œ ê¸€ì„ ì¨. ë°˜ë§ì„ ì‚¬ìš©í•´." },
          { role: "user", content: `ë‹¤ìŒ ìƒí™©ì„ ë³´ê³  ê²Œì‹œê¸€ ì œëª©ê³¼ ë‚´ìš©ì„ JSON í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜: ${context}` }
        ],
        temperature: 0.8,
      })
    });

    const data = await response.json();
    const content = data.choices[0].message.content;
    // JSON íŒŒì‹± ì‹œë„ (AIê°€ í…ìŠ¤íŠ¸ë¡œ ì¤„ ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ)
    try {
      return JSON.parse(content);
    } catch {
      return { title: "AI ê¸€ì‘ì„± ì˜¤ë¥˜", content: content };
    }
  } catch (e) {
    console.error("AI API Error:", e);
    return null;
  }
}

export async function fetchAIComment(postContent: string): Promise<string | null> {
  if (!API_KEY) return null;

  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [
          { role: "system", content: "ë„ˆëŠ” AOS ê²Œì„ ì»¤ë®¤ë‹ˆí‹° ìœ ì €ì•¼. ê±°ì¹ ê³  ì§§ì€ ë§íˆ¬ë¡œ ëŒ“ê¸€ì„ ë‹¬ì•„." },
          { role: "user", content: `ë‹¤ìŒ ê¸€ì— ë‹¬ë¦´ ëŒ“ê¸€ í•˜ë‚˜ë§Œ ì¨ì¤˜: "${postContent}"` }
        ],
        max_tokens: 50
      })
    });
    const data = await response.json();
    return data.choices[0].message.content;
  } catch (e) {
    return null;
  }
}

// === FILE: /src/utils/ai/AIClient.ts ===

import { AIConfig } from '../../types';

// ê³µí†µ JSON ì‘ë‹µìš©
export async function callAI(config: AIConfig, prompt: string) {
  try {
    if (config.provider === 'GEMINI') {
      const url = `https://generativelanguage.googleapis.com/v1beta/models/${config.model}:generateContent?key=${config.apiKey}`;
      const response = await fetch(url, {
        method: "POST", headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
      });
      const data = await response.json();
      if (data.error) throw new Error(data.error.message);
      const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
      const jsonStr = text.replace(/```json|```/g, "").trim();
      return JSON.parse(jsonStr);
    }

    if (config.provider === 'OPENAI') {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST", headers: { "Content-Type": "application/json", "Authorization": `Bearer ${config.apiKey}` },
        body: JSON.stringify({
          model: config.model,
          messages: [{ role: "system", content: "Reply in JSON only." }, { role: "user", content: prompt }],
          temperature: 0.9,
        })
      });
      const data = await response.json();
      return JSON.parse(data.choices[0].message.content);
    }
  } catch (e) {
    console.error("AI Error:", e);
    return null;
  }
  return null;
}

// ê³µí†µ í…ìŠ¤íŠ¸ ì‘ë‹µìš©
export async function callAIString(config: AIConfig, prompt: string) {
  try {
    if (config.provider === 'GEMINI') {
      const url = `https://generativelanguage.googleapis.com/v1beta/models/${config.model}:generateContent?key=${config.apiKey}`;
      const response = await fetch(url, {
        method: "POST", headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
      });
      const data = await response.json();
      return data.candidates?.[0]?.content?.parts?.[0]?.text.trim();
    } 

    if (config.provider === 'OPENAI') {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST", headers: { "Content-Type": "application/json", "Authorization": `Bearer ${config.apiKey}` },
        body: JSON.stringify({
          model: config.model,
          messages: [
            { role: "system", content: "You are a user of a Korean gaming community." }, 
            { role: "user", content: prompt }
          ],
          temperature: 1.0,
          max_tokens: 100
        })
      });
      const data = await response.json();
      return data.choices[0].message.content.trim();
    }
  } catch (e) { return null; }
  return null;
}

// === FILE: /src/utils/ai/CommentGenerator.ts ===

import { AIConfig } from '../../types';
import { callAIString } from './AIClient';

const FALLBACK_COMMENTS = ["ã…‹ã…‹ã…‹ã…‹", "ã„¹ã…‡ã…‹ã…‹", "ê°œì›ƒê¸°ë„¤", "???", "ã„´ã„´ ì•„ë‹˜"];
const pickRandom = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];

export async function generateAIComment(config: AIConfig, postTitle: string, postContent: string): Promise<string | null> {
  if (!config.apiKey || !config.enabled) return pickRandom(FALLBACK_COMMENTS);

  const personas = [
    { type: "íŒ©íŠ¸í­ê²©ê¸°", desc: "ê¸€ ë‚´ìš©ì˜ ëª¨ìˆœì„ ì°¾ì•„ë‚´ì„œ ë…¼ë¦¬ì ìœ¼ë¡œ ë°˜ë°•í•¨. í‹°ì–´ ë¶€ì‹¬ì´ ì‹¬í•¨." },
    { type: "ê³µê°ëŸ¬", desc: "ê¸€ì“´ì´ì˜ ìƒí™©ì— ê¹Šì´ ê³µê°í•˜ë©° ê°™ì´ ìš•í•´ì¤Œ." },
    { type: "ë¹„ê¼¬ê¸° ì¥ì¸", desc: "ì§ì ‘ì ì¸ ìš•ì„¤ ì—†ì´ ëŒë ¤ì„œ ê¹Œê±°ë‚˜, 'ê·¸ë˜ì„œ í‹°ì–´ê°€?' ì‹œì „." },
    { type: "ë‹¨ë‹µí˜• ì¿¨ì°", desc: "ì•„ì£¼ ì§§ê²Œ í•œë§ˆë”” íˆ­ ë˜ì§. ì´ˆì„±ì²´(ã„¹ã…‡ã…‹ã…‹, ã„´ã„´, ã„·ã„·) ì• ìš©." },
    { type: "ë“œë¦½ì¶©", desc: "ìƒí™©ì— ë§ëŠ” ë“œë¦½ì„ ì¹¨." }
  ];

  const selected = personas[Math.floor(Math.random() * personas.length)];

  const systemPrompt = `
    ë„ˆëŠ” ê²Œì„ ì»¤ë®¤ë‹ˆí‹° ëŒ“ê¸€ ì‘ì„±ìì•¼. 
    [ê²Œì‹œê¸€]ì„ ë³´ê³  [ì»¨ì…‰]ì— ë§ì¶° **ì•„ì£¼ ì§§ì€ ëŒ“ê¸€ í•˜ë‚˜**ë¥¼ ì¨.

    [ê²Œì‹œê¸€ ì œëª©]: ${postTitle}
    [ê²Œì‹œê¸€ ë‚´ìš©]: ${postContent}
    [ë„ˆì˜ ì»¨ì…‰]: ${selected.type} (${selected.desc})

    [ê·œì¹™]:
    1. ë¬´ì¡°ê±´ ë°˜ë§/ìŒìŠ´ì²´.
    2. ê¸¸ì´ëŠ” 5~20ì ì´ë‚´. (ê¸¸ë©´ ì•ˆ ì½ìŒ)
    3. JSON ê¸ˆì§€. í…ìŠ¤íŠ¸ë§Œ ì¶œë ¥.
    4. "ë‹ˆê°€ ëª»í•´ì„œ ê·¸ë˜" ê¸ˆì§€. ì°½ì˜ì ìœ¼ë¡œ ì¨.
  `;

  try {
    const aiResponse = await callAIString(config, systemPrompt);
    return aiResponse || pickRandom(FALLBACK_COMMENTS);
  } catch (e) {
    return pickRandom(FALLBACK_COMMENTS);
  }
}

// === FILE: /src/utils/ai/PostGenerator.ts ===

import { AIConfig } from '../../types';
import { callAI } from './AIClient';

export async function generateAIPost(config: AIConfig, context: string, category: string): Promise<{title: string, content: string} | null> {
  if (!config.apiKey || !config.enabled) return null;

  let persona = "";
  if (category === 'ê³µëµ' || category === 'ë¶„ì„') persona = "ë…¼ë¦¬ì ì´ê³  ë¶„ì„ì ì¸ ì²™í•˜ëŠ” ê²œì˜ì•Œ ìœ ì €";
  else if (category === 'ì§•ì§•' || category === 'ì¡ë‹´') persona = "ê°ì •ì ì´ê³  ê³¼ê²©í•œ ì»¤ë®¤ë‹ˆí‹° ìœ ì € (ìš•ì„¤ í•„í„°ë§ ì—†ìŒ)";
  else persona = "ìœ ë¨¸ëŸ¬ìŠ¤í•˜ê³  ë“œë¦½ì„ ì¢‹ì•„í•˜ëŠ” ìœ ì €";

  const systemPrompt = `
    ë„ˆëŠ” 'ì‹ ë“¤ì˜ ì „ìŸ(Gods' War)'ì´ë¼ëŠ” ê°€ìƒì˜ AOS ê²Œì„ ì»¤ë®¤ë‹ˆí‹°(ë¡¤ê°¤, í¨ì½” ëŠë‚Œ) ìœ ì €ì•¼.
    ì£¼ì–´ì§„ [ìƒí™© ì •ë³´]ë¥¼ ë°”íƒ•ìœ¼ë¡œ, [ì¹´í…Œê³ ë¦¬]ì— ë§ëŠ” **ë‹¨ í•˜ë‚˜ì˜ ê²Œì‹œê¸€**ì„ ì‘ì„±í•´.

    [ì¹´í…Œê³ ë¦¬]: ${category}
    [ì‘ì„±ì ì„±ê²©]: ${persona}
    [ê¸€ê° ë° ìƒí™© ì •ë³´]: ${context}

    [ì‘ì„± ì§€ì¹¨]:
    1. **ì ˆëŒ€ë¡œ** ëª¨ë“  ê¸€ì„ "ë°¸ëŸ°ìŠ¤ ë§ê²œ"ì´ë‚˜ "ìš´ì˜ì§„ ìš•"ìœ¼ë¡œ ëë‚´ì§€ ë§ˆ. ì£¼ì œì— ì§‘ì¤‘í•´.
    2. ë§íˆ¬: í•œêµ­ ì»¤ë®¤ë‹ˆí‹° ë§íˆ¬(ë°˜ë§, ìŒìŠ´ì²´, ì€ì–´, ì´ˆì„±ì²´, ìš•ì„¤)ë¥¼ ë¦¬ì–¼í•˜ê²Œ ì‚¬ìš©í•´.
    3. ë‚´ìš©: ì œëª©ì€ ì–´ê·¸ë¡œ ëŒë¦¬ê²Œ, ë³¸ë¬¸ì€ 1~3ë¬¸ì¥ìœ¼ë¡œ ì§§ê²Œ.
    4. í˜•ì‹: ì˜¤ì§ JSONë§Œ ì¶œë ¥í•´. (ë§ˆí¬ë‹¤ìš´ ì—†ì´).
    Example: {"title": "ì•¼ë§ í…œíŠ¸ë¦¬ ì´ê±° ë§ëƒ?", "content": "ì„ í…œìœ¼ë¡œ ëª°ì™• ê°”ëŠ”ë° ë”œ ì•ˆ ë°•í˜ ã…¡ã…¡"}
  `;

  return await callAI(config, systemPrompt);
}

// === FILE: /src/utils/nameGenerator.ts ===

// src/utils/nameGenerator.ts

// 1. [í•œê¸€] í˜•ìš©ì‚¬ (ìˆ˜ì‹ì–´)
const KR_PREFIXES = [
  "ë§›ìˆëŠ”", "ì¦ê±°ìš´", "ìš°ìš¸í•œ", "ê°•ë ¥í•œ", "ë°°ê³ í”ˆ", "ì§€ë‚˜ê°€ë˜", "ì „ì„¤ì˜", "ìˆ˜ìƒí•œ", 
  "ê·€ì—¬ìš´", "ì‚¬ì•…í•œ", "íˆ¬ëª…í•œ", "ë„ë§ì¹œ", "ì ìëŠ”", "í™”ë‚œ", "í–‰ë³µí•œ", "ê°€ë‚œí•œ",
  "ë¶€ì", "ì²œì¬", "ë°”ë³´", "ë¯¸ì¹œ", "ì•¼ìƒì˜", "ì§‘ë‚˜ê°„", "ëŒì•„ì˜¨", "ë§ˆì§€ë§‰",
  "íƒ‘ì‹ ë³‘ì", "ì •ê¸€ì°¨ì´", "ë¯¸ë“œì˜¤í”ˆ", "ì„œí¿ìœ ì €", "ì›ë”œì™•", "ì¥ì¸", "ê³ ìˆ˜", "ì´ˆë³´",
  "í•‘í¬", "ë¸”ë™", "í™©ê¸ˆ", "ë¯¼íŠ¸ì´ˆì½”", "í•˜ì™€ì´ì•ˆ", "ë¶ˆíƒ€ëŠ”", "ì–¼ì–´ë¶™ì€", "ì‹ ì†í•œ",
  "ì¹˜ëª…ì ì¸", "ì—„ë§ˆëª°ë˜", "í•™êµì§¸ê³ ", "ë°¤ìƒ˜í•˜ëŠ”", "ë¼ë©´ë¨¹ëŠ”", "ì¹˜í‚¨ë¨¹ëŠ”", "ë‹¤ì´ì–´íŠ¸",
  "ë¬´ì ì˜", "íŒ¨ë°°ì˜", "ìŠ¹ë¦¬ì˜", "ê¸°ì ì˜", "ì¹¨ë¬µì˜", "ì˜ê´‘ì˜", "ì‹¬ì—°ì˜", "ê³µí—ˆì˜",
  "ì „ê´‘ì„í™”", "ë¹›ì˜", "ì–´ë‘ ì˜", "í­í’ì˜", "ëŒ€ì§€ì˜", "ê°•ì² ì˜", "ì‹ ì„±í•œ", "íƒ€ë½í•œ"
];

// 2. [í•œê¸€] ëª…ì‚¬ (ë³¸ì²´)
const KR_SUFFIXES = [
  "ë‹¤ëŒì¥", "í˜¸ë‘ì´", "ì‚¬ì", "ê³ ì–‘ì´", "ê°•ì•„ì§€", "í­ê·„", "ìŠ¬ë¼ì„", "ë“œë˜ê³¤",
  "ë–¡ë³¶ì´", "ì¹˜í‚¨", "í”¼ì", "í–„ë²„ê±°", "êµ­ë°¥", "ê¹€ì¹˜ì°Œê°œ", "ë¼ë©´", "ì½œë¼",
  "ê¸°ì‚¬", "ë§ˆë²•ì‚¬", "ì•”ì‚´ì", "ê¶ìˆ˜", "ì „ì‚¬", "ì‚¬ì œ", "ë„ì ", "ì„±ê¸°ì‚¬",
  "ì•¼ìŠ¤ì˜¤", "í‹°ëª¨", "ë¦¬ì‹ ", "ë² ì¸", "ì œë“œ", "ì´ì¦ˆë¦¬ì–¼", "ëŸ­ìŠ¤", "ì•„ë¦¬",
  "ì£¼ë¨¹", "ë°œì°¨ê¸°", "ê²€", "ë°©íŒ¨", "ì§€íŒ¡ì´", "í™œ", "ë„ë¼", "ë§ì¹˜",
  "ì»´í“¨í„°", "í‚¤ë³´ë“œ", "ë§ˆìš°ìŠ¤", "ëª¨ë‹ˆí„°", "ì™€ì´íŒŒì´", "ë°ì´í„°", "ë°°í„°ë¦¬",
  "í•™ìƒ", "ì•„ì €ì”¨", "í˜•", "ëˆ„ë‚˜", "ë™ìƒ", "ì‚¬ì¥ë‹˜", "ì•Œë°”ìƒ", "ë°±ìˆ˜",
  "ìœ ì €", "í”Œë ˆì´ì–´", "ì†Œí™˜ì‚¬", "ì±”í”¼ì–¸", "ë¯¸ë‹ˆì–¸", "ì •ê¸€ëŸ¬", "ë¼ì´ë„ˆ"
];

// 3. [ì˜ì–´] ë‹¨ì–´
const EN_WORDS = [
  "Shadow", "Light", "Dark", "Fire", "Ice", "Wind", "Storm", "Thunder",
  "Killer", "Slayer", "Hunter", "Sniper", "Assassin", "Knight", "Warrior",
  "God", "King", "Queen", "Prince", "Princess", "Lord", "Master", "Boss",
  "Faker", "Chovy", "ShowMaker", "Ruler", "Deft", "Viper", "Zeus", "Keria",
  "Alpha", "Beta", "Omega", "Zero", "One", "Infinite", "Eternal", "Final",
  "Crazy", "Mad", "Super", "Ultra", "Hyper", "Mega", "Giga", "Tera",
  "Ghost", "Phantom", "Spirit", "Soul", "Dragon", "Tiger", "Lion", "Wolf"
];

const CLAN_TAGS = ["T1", "GEN", "DK", "KT", "HLE", "DRX", "NS", "BRO", "LSB", "KDF", "SKT", "DWG", "GRF"];
const pick = (arr: string[]) => arr[Math.floor(Math.random() * arr.length)];
const chance = (percent: number) => Math.random() < (percent / 100);

export function generateUserName(seedId: number): string {
  const rand = Math.random();

  // [Fix] ëª¨ë“  íŒ¨í„´ì— ëœë¤ ìˆ«ì(2~4ìë¦¬)ë¥¼ ê°•ì œë¡œ ë¶™ì…ë‹ˆë‹¤.
  // 1000 ~ 9999 ì‚¬ì´ì˜ ë‚œìˆ˜ ìƒì„±
  const num = Math.floor(100 + Math.random() * 9900); 

  // íŒ¨í„´ 1: [í•œê¸€] í˜•ìš©ì‚¬ + ëª…ì‚¬ (50%)
  if (rand < 0.5) {
    const prefix = pick(KR_PREFIXES);
    const suffix = pick(KR_SUFFIXES);
    // ì˜ˆ: ê°€ë‚œí•œê²€392, ì¹¨ë¬µì˜ë–¡ë³¶ì´1024
    return `${prefix}${suffix}${num}`;
  }

  // íŒ¨í„´ 2: [ì˜ì–´] (30%)
  else if (rand < 0.8) {
    // í´ëœ íƒœê·¸í˜•: SKT Faker 01
    if (chance(30)) {
      return `${pick(CLAN_TAGS)} ${pick(EN_WORDS)} ${Math.floor(Math.random() * 99)}`;
    }

    // ì˜ë‹¨ì–´ ì¡°í•©í˜•: ShadowKiller9999
    if (chance(50)) {
      return `${pick(EN_WORDS)}${pick(EN_WORDS)}${num}`;
    } else {
      // ë‹¨ì¼ ë‹¨ì–´í˜•: Zeus1024
      return `${pick(EN_WORDS)}${num}`;
    }
  }

  // íŒ¨í„´ 3: [ì»¨ì…‰] ë¦¬ì–¼í•œ ë¬¸ì¥í˜• (10%)
  else if (rand < 0.9) {
    const sentences = [
      "ë˜ì§€ë©´ë°”ë¡œë‚˜ê°", "í•œíƒ€ë§Œí•¨", "ì±„íŒ…ì°¨ë‹¨í•¨", "ì¦ê²œìœ ì €", "ë¹¡ê²œëŸ¬",
      "ì—„ë§ˆê°€ë°¥ë¨¹ìœ¼ë˜", "ë‚´ê¿ˆì€ì±Œë¦°ì €", "ë¸Œë¡ ì¦ˆíƒˆì¶œê¸°", "ë²„ìŠ¤ì ìš”", "ì„œí¿ì°¨ì´",
      "ë¯¸ë“œë‹¬ë ¤", "ì •ê¸€íƒ“ì•ˆí•¨", "ì˜¤ë¹ ë‹¬ë ¤", "ëˆ„ë‚˜ë‚˜ì£½ì–´", "í˜•ë¯¿ì–´",
      "í‰ì 1ì ëŒ€", "ìŠ¹ë¥ 9í• ", "ë¶€ìºì…ë‹ˆë‹¤", "í˜„ì§€ì¸ì…ë‹ˆë‹¤"
    ];
    // ì˜ˆ: ì—„ë§ˆê°€ë°¥ë¨¹ìœ¼ë˜512
    return `${pick(sentences)}${num}`;
  }

  // íŒ¨í„´ 4: ë§‰ì¹œ ì•„ì´ë”” (10%)
  else {
    const keys = ["qwer", "asdf", "zxcv", "user", "player", "guest"];
    return `${pick(keys)}${Math.floor(Math.random() * 99999)}`;
  }
}
